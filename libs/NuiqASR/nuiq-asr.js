!function e(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.NuiqASR=n():t.NuiqASR=n()}(this,(()=>(()=>{var e,t,n,r,s={612:function(e){var t;"undefined"!=typeof self&&self,t=()=>(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function r(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,(o=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,"string");if("object"!==n(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(s.key),"symbol"===n(o)?o:String(o)),s)}var o}e.r(t),e.d(t,{default:()=>i});var i=function(){function e(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).sampleRate;(function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this._context=this._createContext(t),t||(t=this._context.sampleRate),this._sampleRate=t}var t,n;return t=e,n=[{key:"_createContext",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:44100;return window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,new AudioContext({sampleRate:e})}},{key:"context",get:function(){return this._context}},{key:"fetchAudio",value:async function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return await Promise.all(n.map((async function(t){var n;return n=t instanceof File||t instanceof Blob?await t.arrayBuffer():await fetch(t).then((function(e){return e.headers.has("Content-Type")&&!e.headers.get("Content-Type").includes("audio/")&&console.warn("Crunker: Attempted to fetch an audio file, but its MIME type is `".concat(e.headers.get("Content-Type").split(";")[0],"`. We'll try and continue anyway. (file: \"").concat(t,'")')),e.arrayBuffer()})),await e._context.decodeAudioData(n)})))}},{key:"mergeAudio",value:function(e){var t=this._context.createBuffer(this._maxNumberOfChannels(e),this._sampleRate*this._maxDuration(e),this._sampleRate);return e.forEach((function(e){for(var n=0;n<e.numberOfChannels;n++){for(var r=t.getChannelData(n),s=e.getChannelData(n),o=e.getChannelData(n).length-1;o>=0;o--)r[o]+=s[o];t.getChannelData(n).set(r)}})),t}},{key:"concatAudio",value:function(e){var t=this._context.createBuffer(this._maxNumberOfChannels(e),this._totalLength(e),this._sampleRate),n=0;return e.forEach((function(e){for(var r=0;r<e.numberOfChannels;r++)t.getChannelData(r).set(e.getChannelData(r),n);n+=e.length})),t}},{key:"padAudio",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(0===n)return e;if(t<0)throw new Error('Crunker: Parameter "padStart" in padAudio must be positive');if(n<0)throw new Error('Crunker: Parameter "seconds" in padAudio must be positive');for(var r=this._context.createBuffer(e.numberOfChannels,Math.ceil(e.length+n*e.sampleRate),e.sampleRate),s=0;s<e.numberOfChannels;s++){var o=e.getChannelData(s);r.getChannelData(s).set(o.subarray(0,Math.ceil(t*e.sampleRate)+1),0),r.getChannelData(s).set(o.subarray(Math.ceil(t*e.sampleRate)+2,r.length+1),Math.ceil((t+n)*e.sampleRate))}return r}},{key:"sliceAudio",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(t>=n)throw new Error('Crunker: "start" time should be less than "end" time in sliceAudio method');for(var o=Math.round((n-t)*this._sampleRate),i=Math.round(t*this._sampleRate),a=this._context.createBuffer(e.numberOfChannels,o,this._sampleRate),c=0;c<e.numberOfChannels;c++)for(var l=e.getChannelData(c),u=a.getChannelData(c),d=0;d<o;d++)u[d]=l[i+d],d<r*this._sampleRate&&(u[d]*=d/(r*this._sampleRate)),d>o-s*this._sampleRate&&(u[d]*=(o-d)/(s*this._sampleRate));return a}},{key:"play",value:function(e){var t=this._context.createBufferSource();return t.buffer=e,t.connect(this._context.destination),t.start(),t}},{key:"export",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"audio/wav",n=this._interleave(e),r=this._writeHeaders(n,e.numberOfChannels,e.sampleRate),s=new Blob([r],{type:t});return{blob:s,url:this._renderURL(s),element:this._renderAudioElement(s)}}},{key:"download",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"crunker",n=document.createElement("a");return n.style.display="none",n.href=this._renderURL(e),n.download="".concat(t,".").concat(e.type.split("/")[1]),n.click(),n}},{key:"notSupported",value:function(e){return this._isSupported()?void 0:e()}},{key:"close",value:function(){return this._context.close(),this}},{key:"_maxDuration",value:function(e){return Math.max.apply(Math,r(e.map((function(e){return e.duration}))))}},{key:"_maxNumberOfChannels",value:function(e){return Math.max.apply(Math,r(e.map((function(e){return e.numberOfChannels}))))}},{key:"_totalLength",value:function(e){return e.map((function(e){return e.length})).reduce((function(e,t){return e+t}),0)}},{key:"_isSupported",value:function(){return"AudioContext"in window||"webkitAudioContext"in window||"mozAudioContext"in window}},{key:"_writeHeaders",value:function(e,t,n){var r=2*t,s=2*e.length,o=36+s,i=new ArrayBuffer(8+o),a=new DataView(i);return this._writeString(a,0,"RIFF"),a.setUint32(4,o,!0),this._writeString(a,8,"WAVE"),this._writeString(a,12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,t,!0),a.setUint32(24,n,!0),a.setUint32(28,n*r,!0),a.setUint16(32,r,!0),a.setUint16(34,16,!0),this._writeString(a,36,"data"),a.setUint32(40,s,!0),this._floatTo16BitPCM(a,e,44)}},{key:"_floatTo16BitPCM",value:function(e,t,n){for(var r=0;r<t.length;r++,n+=2){var s=Math.max(-1,Math.min(1,t[r]));e.setInt16(n,s<0?32768*s:32767*s,!0)}return e}},{key:"_writeString",value:function(e,t,n){for(var r=0;r<n.length;r++)e.setUint8(t+r,n.charCodeAt(r))}},{key:"_interleave",value:function(e){if(1===e.numberOfChannels)return e.getChannelData(0);for(var t=[],n=0;n<e.numberOfChannels;n++)t.push(e.getChannelData(n));for(var r=t.reduce((function(e,t){return e+t.length}),0),s=new Float32Array(r),o=0,i=0;o<r;)t.forEach((function(e){s[o++]=e[i]})),i++;return s}},{key:"_renderAudioElement",value:function(e){var t=document.createElement("audio");return t.controls=!0,t.src=this._renderURL(e),t}},{key:"_renderURL",value:function(e){return(window.URL||window.webkitURL).createObjectURL(e)}}],n&&o(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();return t})(),e.exports=t()},790:(e,t,n)=>{
/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/
e.exports=function e(t,n,r){function s(i,a){if(!n[i]){if(!t[i]){if(o)return o(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[i]={exports:{}};t[i][0].call(l.exports,(function(e){var n=t[i][1][e];return s(n||e)}),l,l.exports,e,t,n,r)}return n[i].exports}for(var o=void 0,i=0;i<r.length;i++)s(r[i]);return s}({1:[function(e,t,r){(function(e){"use strict";var n,r,s=e.MutationObserver||e.WebKitMutationObserver;if(s){var o=0,i=new s(u),a=e.document.createTextNode("");i.observe(a,{characterData:!0}),n=function(){a.data=o=++o%2}}else if(e.setImmediate||"undefined"==typeof e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){u(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(u,0)};else{var c=new e.MessageChannel;c.port1.onmessage=u,n=function(){c.port2.postMessage(0)}}var l=[];function u(){var e,t;r=!0;for(var n=l.length;n;){for(t=l,l=[],e=-1;++e<n;)t[e]();n=l.length}r=!1}function d(e){1!==l.push(e)||r||n()}t.exports=d}).call(this,"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){"use strict";var r=e(1);function s(){}var o={},i=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==s&&f(this,e)}function u(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function d(e,t,n){r((function(){var r;try{r=t(n)}catch(t){return o.reject(e,t)}r===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,r)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function n(){t.apply(e,arguments)}}function f(e,t){var n=!1;function r(t){n||(n=!0,o.reject(e,t))}function s(t){n||(n=!0,o.resolve(e,t))}function i(){t(s,r)}var a=p(i);"error"===a.status&&r(a.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}function m(e){return e instanceof this?e:o.resolve(new this(s),e)}function g(e){var t=new this(s);return o.reject(t,e)}function y(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var i=new Array(n),a=0,c=-1,l=new this(s);++c<n;)u(e[c],c);return l;function u(e,s){function c(e){i[s]=e,++a!==n||r||(r=!0,o.resolve(l,i))}t.resolve(e).then(c,(function(e){r||(r=!0,o.reject(l,e))}))}}function w(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var i=-1,a=new this(s);++i<n;)c(e[i]);return a;function c(e){t.resolve(e).then((function(e){r||(r=!0,o.resolve(a,e))}),(function(e){r||(r=!0,o.reject(a,e))}))}}t.exports=l,l.prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===i)return this;var n=new this.constructor(s);return this.state!==c?d(n,this.state===a?e:t,this.outcome):this.queue.push(new u(n,e,t)),n},u.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){d(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){o.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){d(this.promise,this.onRejected,e)},o.resolve=function(e,t){var n=p(h,t);if("error"===n.status)return o.reject(e,n.value);var r=n.value;if(r)f(e,r);else{e.state=a,e.outcome=t;for(var s=-1,i=e.queue.length;++s<i;)e.queue[s].callFulfilled(t)}return e},o.reject=function(e,t){e.state=i,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},l.resolve=m,l.reject=g,l.all=y,l.race=w},{1:1}],3:[function(e,t,r){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}var i=o();function a(){try{if(!i||!i.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}function c(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(s){if("TypeError"!==s.name)throw s;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var l=Promise;function u(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function d(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function h(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function f(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var p="local-forage-detect-blob-support",m=void 0,g={},y=Object.prototype.toString,w="readonly",b="readwrite";function v(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),s=0;s<t;s++)r[s]=e.charCodeAt(s);return n}function _(e){return new l((function(t){var n=e.transaction(p,b),r=c([""]);n.objectStore(p).put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}function k(e){return"boolean"==typeof m?l.resolve(m):_(e).then((function(e){return m=e}))}function S(e){var t=g[e.name],n={};n.promise=new l((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function x(e){var t=g[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function A(e,t){var n=g[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function C(e,t){return new l((function(n,r){if(g[e.name]=g[e.name]||N(),e.db){if(!t)return n(e.db);S(e),e.db.close()}var s=[e.name];t&&s.push(e.version);var o=i.open.apply(i,s);t&&(o.onupgradeneeded=function(t){var n=o.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(p)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),o.onerror=function(e){e.preventDefault(),r(o.error)},o.onsuccess=function(){var t=o.result;t.onversionchange=function(e){e.target.close()},n(t),x(e)}}))}function E(e){return C(e,!1)}function I(e){return C(e,!0)}function O(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,s=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),s||n){if(n){var o=e.db.version+1;o>e.version&&(e.version=o)}return!0}return!1}function M(e){return new l((function(t,n){var r=new FileReader;r.onerror=n,r.onloadend=function(n){var r=btoa(n.target.result||"");t({__local_forage_encoded_blob:!0,data:r,type:e.type})},r.readAsBinaryString(e)}))}function R(e){return c([v(atob(e.data))],{type:e.type})}function $(e){return e&&e.__local_forage_encoded_blob}function j(e){var t=this,n=t._initReady().then((function(){var e=g[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return d(n,e,e),n}function P(e){S(e);for(var t=g[e.name],n=t.forages,r=0;r<n.length;r++){var s=n[r];s._dbInfo.db&&(s._dbInfo.db.close(),s._dbInfo.db=null)}return e.db=null,E(e).then((function(t){return e.db=t,O(e)?I(e):t})).then((function(r){e.db=t.db=r;for(var s=0;s<n.length;s++)n[s]._dbInfo.db=r})).catch((function(t){throw A(e,t),t}))}function T(e,t,n,r){void 0===r&&(r=1);try{var s=e.db.transaction(e.storeName,t);n(null,s)}catch(s){if(r>0&&(!e.db||"InvalidStateError"===s.name||"NotFoundError"===s.name))return l.resolve().then((function(){if(!e.db||"NotFoundError"===s.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),I(e)})).then((function(){return P(e).then((function(){T(e,t,n,r-1)}))})).catch(n);n(s)}}function N(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function D(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var s=g[n.name];s||(s=N(),g[n.name]=s),s.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=j);var o=[];function i(){return l.resolve()}for(var a=0;a<s.forages.length;a++){var c=s.forages[a];c!==t&&o.push(c._initReady().catch(i))}var u=s.forages.slice(0);return l.all(o).then((function(){return n.db=s.db,E(n)})).then((function(e){return n.db=e,O(n,t._defaultConfig.version)?I(n):e})).then((function(e){n.db=s.db=e,t._dbInfo=n;for(var r=0;r<u.length;r++){var o=u[r];o!==t&&(o._dbInfo.db=n.db,o._dbInfo.version=n.version)}}))}function B(e,t){var n=this;e=h(e);var r=new l((function(t,r){n.ready().then((function(){T(n._dbInfo,w,(function(s,o){if(s)return r(s);try{var i=o.objectStore(n._dbInfo.storeName).get(e);i.onsuccess=function(){var e=i.result;void 0===e&&(e=null),$(e)&&(e=R(e)),t(e)},i.onerror=function(){r(i.error)}}catch(e){r(e)}}))})).catch(r)}));return u(r,t),r}function L(e,t){var n=this,r=new l((function(t,r){n.ready().then((function(){T(n._dbInfo,w,(function(s,o){if(s)return r(s);try{var i=o.objectStore(n._dbInfo.storeName).openCursor(),a=1;i.onsuccess=function(){var n=i.result;if(n){var r=n.value;$(r)&&(r=R(r));var s=e(r,n.key,a++);void 0!==s?t(s):n.continue()}else t()},i.onerror=function(){r(i.error)}}catch(e){r(e)}}))})).catch(r)}));return u(r,t),r}function F(e,t,n){var r=this;e=h(e);var s=new l((function(n,s){var o;r.ready().then((function(){return o=r._dbInfo,"[object Blob]"===y.call(t)?k(o.db).then((function(e){return e?t:M(t)})):t})).then((function(t){T(r._dbInfo,b,(function(o,i){if(o)return s(o);try{var a=i.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var c=a.put(t,e);i.oncomplete=function(){void 0===t&&(t=null),n(t)},i.onabort=i.onerror=function(){var e=c.error?c.error:c.transaction.error;s(e)}}catch(e){s(e)}}))})).catch(s)}));return u(s,n),s}function z(e,t){var n=this;e=h(e);var r=new l((function(t,r){n.ready().then((function(){T(n._dbInfo,b,(function(s,o){if(s)return r(s);try{var i=o.objectStore(n._dbInfo.storeName).delete(e);o.oncomplete=function(){t()},o.onerror=function(){r(i.error)},o.onabort=function(){var e=i.error?i.error:i.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return u(r,t),r}function U(e){var t=this,n=new l((function(e,n){t.ready().then((function(){T(t._dbInfo,b,(function(r,s){if(r)return n(r);try{var o=s.objectStore(t._dbInfo.storeName).clear();s.oncomplete=function(){e()},s.onabort=s.onerror=function(){var e=o.error?o.error:o.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return u(n,e),n}function q(e){var t=this,n=new l((function(e,n){t.ready().then((function(){T(t._dbInfo,w,(function(r,s){if(r)return n(r);try{var o=s.objectStore(t._dbInfo.storeName).count();o.onsuccess=function(){e(o.result)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return u(n,e),n}function W(e,t){var n=this,r=new l((function(t,r){e<0?t(null):n.ready().then((function(){T(n._dbInfo,w,(function(s,o){if(s)return r(s);try{var i=o.objectStore(n._dbInfo.storeName),a=!1,c=i.openKeyCursor();c.onsuccess=function(){var n=c.result;n?0===e||a?t(n.key):(a=!0,n.advance(e)):t(null)},c.onerror=function(){r(c.error)}}catch(e){r(e)}}))})).catch(r)}));return u(r,t),r}function G(e){var t=this,n=new l((function(e,n){t.ready().then((function(){T(t._dbInfo,w,(function(r,s){if(r)return n(r);try{var o=s.objectStore(t._dbInfo.storeName).openKeyCursor(),i=[];o.onsuccess=function(){var t=o.result;t?(i.push(t.key),t.continue()):e(i)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return u(n,e),n}function X(e,t){t=f.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,s=this;if(e.name){var o=e.name===n.name&&s._dbInfo.db?l.resolve(s._dbInfo.db):E(e).then((function(t){var n=g[e.name],r=n.forages;n.db=t;for(var s=0;s<r.length;s++)r[s]._dbInfo.db=t;return t}));r=e.storeName?o.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;S(e);var r=g[e.name],s=r.forages;t.close();for(var o=0;o<s.length;o++){var a=s[o];a._dbInfo.db=null,a._dbInfo.version=n}var c=new l((function(t,r){var s=i.open(e.name,n);s.onerror=function(e){s.result.close(),r(e)},s.onupgradeneeded=function(){s.result.deleteObjectStore(e.storeName)},s.onsuccess=function(){var e=s.result;e.close(),t(e)}}));return c.then((function(e){r.db=e;for(var t=0;t<s.length;t++){var n=s[t];n._dbInfo.db=e,x(n._dbInfo)}})).catch((function(t){throw(A(e,t)||l.resolve()).catch((function(){})),t}))}})):o.then((function(t){S(e);var n=g[e.name],r=n.forages;t.close();for(var s=0;s<r.length;s++)r[s]._dbInfo.db=null;var o=new l((function(t,n){var r=i.deleteDatabase(e.name);r.onerror=function(){var e=r.result;e&&e.close(),n(r.error)},r.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}}));return o.then((function(e){n.db=e;for(var t=0;t<r.length;t++)x(r[t]._dbInfo)})).catch((function(t){throw(A(e,t)||l.resolve()).catch((function(){})),t}))}))}else r=l.reject("Invalid arguments");return u(r,t),r}var J={_driver:"asyncStorage",_initStorage:D,_support:a(),iterate:L,getItem:B,setItem:F,removeItem:z,clear:U,length:q,key:W,keys:G,dropInstance:X};function H(){return"function"==typeof openDatabase}var K="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",V="~~local_forage_type~",Q=/^~~local_forage_type~([^~]+)~/,Y="__lfsc__:",Z=Y.length,ee="arbf",te="blob",ne="si08",re="ui08",se="uic8",oe="si16",ie="si32",ae="ur16",ce="ui32",le="fl32",ue="fl64",de=Z+ee.length,he=Object.prototype.toString;function fe(e){var t,n,r,s,o,i=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(i--,"="===e[e.length-2]&&i--);var l=new ArrayBuffer(i),u=new Uint8Array(l);for(t=0;t<a;t+=4)n=K.indexOf(e[t]),r=K.indexOf(e[t+1]),s=K.indexOf(e[t+2]),o=K.indexOf(e[t+3]),u[c++]=n<<2|r>>4,u[c++]=(15&r)<<4|s>>2,u[c++]=(3&s)<<6|63&o;return l}function pe(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=K[n[t]>>2],r+=K[(3&n[t])<<4|n[t+1]>>4],r+=K[(15&n[t+1])<<2|n[t+2]>>6],r+=K[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}function me(e,t){var n="";if(e&&(n=he.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===he.call(e.buffer))){var r,s=Y;e instanceof ArrayBuffer?(r=e,s+=ee):(r=e.buffer,"[object Int8Array]"===n?s+=ne:"[object Uint8Array]"===n?s+=re:"[object Uint8ClampedArray]"===n?s+=se:"[object Int16Array]"===n?s+=oe:"[object Uint16Array]"===n?s+=ae:"[object Int32Array]"===n?s+=ie:"[object Uint32Array]"===n?s+=ce:"[object Float32Array]"===n?s+=le:"[object Float64Array]"===n?s+=ue:t(new Error("Failed to get type for BinaryArray"))),t(s+pe(r))}else if("[object Blob]"===n){var o=new FileReader;o.onload=function(){var n=V+e.type+"~"+pe(this.result);t(Y+te+n)},o.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}}function ge(e){if(e.substring(0,Z)!==Y)return JSON.parse(e);var t,n=e.substring(de),r=e.substring(Z,de);if(r===te&&Q.test(n)){var s=n.match(Q);t=s[1],n=n.substring(s[0].length)}var o=fe(n);switch(r){case ee:return o;case te:return c([o],{type:t});case ne:return new Int8Array(o);case re:return new Uint8Array(o);case se:return new Uint8ClampedArray(o);case oe:return new Int16Array(o);case ae:return new Uint16Array(o);case ie:return new Int32Array(o);case ce:return new Uint32Array(o);case le:return new Float32Array(o);case ue:return new Float64Array(o);default:throw new Error("Unkown type: "+r)}}var ye={serialize:me,deserialize:ge,stringToBuffer:fe,bufferToString:pe};function we(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function be(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var s=new l((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(s){we(s,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=ye,s}function ve(e,t,n,r,s,o){e.executeSql(n,r,s,(function(e,i){i.code===i.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,a){a.rows.length?o(e,i):we(e,t,(function(){e.executeSql(n,r,s,o)}),o)}),o):o(e,i)}),o)}function _e(e,t){var n=this;e=h(e);var r=new l((function(t,r){n.ready().then((function(){var s=n._dbInfo;s.db.transaction((function(n){ve(n,s,"SELECT * FROM "+s.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=s.serializer.deserialize(r)),t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,t),r}function ke(e,t){var n=this,r=new l((function(t,r){n.ready().then((function(){var s=n._dbInfo;s.db.transaction((function(n){ve(n,s,"SELECT * FROM "+s.storeName,[],(function(n,r){for(var o=r.rows,i=o.length,a=0;a<i;a++){var c=o.item(a),l=c.value;if(l&&(l=s.serializer.deserialize(l)),void 0!==(l=e(l,c.key,a+1)))return void t(l)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,t),r}function Se(e,t,n,r){var s=this;e=h(e);var o=new l((function(o,i){s.ready().then((function(){void 0===t&&(t=null);var a=t,c=s._dbInfo;c.serializer.serialize(t,(function(t,l){l?i(l):c.db.transaction((function(n){ve(n,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){o(a)}),(function(e,t){i(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(r>0)return void o(Se.apply(s,[e,a,n,r-1]));i(t)}}))}))})).catch(i)}));return u(o,n),o}function xe(e,t,n){return Se.apply(this,[e,t,n,1])}function Ae(e,t){var n=this;e=h(e);var r=new l((function(t,r){n.ready().then((function(){var s=n._dbInfo;s.db.transaction((function(n){ve(n,s,"DELETE FROM "+s.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,t),r}function Ce(e){var t=this,n=new l((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){ve(t,r,"DELETE FROM "+r.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return u(n,e),n}function Ee(e){var t=this,n=new l((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){ve(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(t,n){var r=n.rows.item(0).c;e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return u(n,e),n}function Ie(e,t){var n=this,r=new l((function(t,r){n.ready().then((function(){var s=n._dbInfo;s.db.transaction((function(n){ve(n,s,"SELECT key FROM "+s.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,t),r}function Oe(e){var t=this,n=new l((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){ve(t,r,"SELECT key FROM "+r.storeName,[],(function(t,n){for(var r=[],s=0;s<n.rows.length;s++)r.push(n.rows.item(s).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return u(n,e),n}function Me(e){return new l((function(t,n){e.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,r){for(var s=[],o=0;o<r.rows.length;o++)s.push(r.rows.item(o).name);t({db:e,storeNames:s})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}function Re(e,t){t=f.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,s=this;return u(r=e.name?new l((function(t){var r;r=e.name===n.name?s._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:r,storeNames:[e.storeName]}):t(Me(r))})).then((function(e){return new l((function(t,n){e.db.transaction((function(r){function s(e){return new l((function(t,n){r.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var o=[],i=0,a=e.storeNames.length;i<a;i++)o.push(s(e.storeNames[i]));l.all(o).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):l.reject("Invalid arguments"),t),r}var $e={_driver:"webSQLStorage",_initStorage:be,_support:H(),iterate:ke,getItem:_e,setItem:xe,removeItem:Ae,clear:Ce,length:Ee,key:Ie,keys:Oe,dropInstance:Re};function je(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}function Pe(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function Te(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}function Ne(){return!Te()||localStorage.length>0}function De(e){var t=this,n={};if(e)for(var r in e)n[r]=e[r];return n.keyPrefix=Pe(e,t._defaultConfig),Ne()?(t._dbInfo=n,n.serializer=ye,l.resolve()):l.reject()}function Be(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return u(n,e),n}function Le(e,t){var n=this;e=h(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r}));return u(r,t),r}function Fe(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,s=r.length,o=localStorage.length,i=1,a=0;a<o;a++){var c=localStorage.key(a);if(0===c.indexOf(r)){var l=localStorage.getItem(c);if(l&&(l=t.serializer.deserialize(l)),void 0!==(l=e(l,c.substring(s),i++)))return l}}}));return u(r,t),r}function ze(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t}));return u(r,t),r}function Ue(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],s=0;s<n;s++){var o=localStorage.key(s);0===o.indexOf(e.keyPrefix)&&r.push(o.substring(e.keyPrefix.length))}return r}));return u(n,e),n}function qe(e){var t=this.keys().then((function(e){return e.length}));return u(t,e),t}function We(e,t){var n=this;e=h(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return u(r,t),r}function Ge(e,t,n){var r=this;e=h(e);var s=r.ready().then((function(){void 0===t&&(t=null);var n=t;return new l((function(s,o){var i=r._dbInfo;i.serializer.serialize(t,(function(t,r){if(r)o(r);else try{localStorage.setItem(i.keyPrefix+e,t),s(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||o(e),o(e)}}))}))}));return u(s,n),s}function Xe(e,t){if(t=f.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r,s=this;return r=e.name?new l((function(t){e.storeName?t(Pe(e,s._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):l.reject("Invalid arguments"),u(r,t),r}var Je={_driver:"localStorageWrapper",_initStorage:De,_support:je(),iterate:Fe,getItem:Le,setItem:Ge,removeItem:We,clear:Be,length:qe,key:ze,keys:Ue,dropInstance:Xe},He=function e(t,n){return t===n||"number"==typeof t&&"number"==typeof n&&isNaN(t)&&isNaN(n)},Ke=function e(t,n){for(var r=t.length,s=0;s<r;){if(He(t[s],n))return!0;s++}return!1},Ve=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Qe={},Ye={},Ze={INDEXEDDB:J,WEBSQL:$e,LOCALSTORAGE:Je},et=[Ze.INDEXEDDB._driver,Ze.WEBSQL._driver,Ze.LOCALSTORAGE._driver],tt=["dropInstance"],nt=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(tt),rt={description:"",driver:et.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function st(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function ot(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(Ve(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var it=function(){function e(t){for(var n in s(this,e),Ze)if(Ze.hasOwnProperty(n)){var r=Ze[n],o=r._driver;this[n]=o,Qe[o]||this.defineDriver(r)}this._defaultConfig=ot({},rt),this._config=ot({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function e(t){if("object"===("undefined"==typeof t?"undefined":r(t))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var n in t){if("storeName"===n&&(t[n]=t[n].replace(/\W/g,"_")),"version"===n&&"number"!=typeof t[n])return new Error("Database version must be a number.");this._config[n]=t[n]}return!("driver"in t)||!t.driver||this.setDriver(this._config.driver)}return"string"==typeof t?this._config[t]:this._config},e.prototype.defineDriver=function e(t,n,r){var s=new l((function(e,n){try{var r=t._driver,s=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!t._driver)return void n(s);for(var o=nt.concat("_initStorage"),i=0,a=o.length;i<a;i++){var c=o[i];if((!Ke(tt,c)||t[c])&&"function"!=typeof t[c])return void n(s)}var d=function e(){for(var n=function e(t){return function(){var e=new Error("Method "+t+" is not implemented by the current driver"),n=l.reject(e);return u(n,arguments[arguments.length-1]),n}},r=0,s=tt.length;r<s;r++){var o=tt[r];t[o]||(t[o]=n(o))}};d();var h=function n(s){Qe[r]&&console.info("Redefining LocalForage driver: "+r),Qe[r]=t,Ye[r]=s,e()};"_support"in t?t._support&&"function"==typeof t._support?t._support().then(h,n):h(!!t._support):h(!0)}catch(e){n(e)}}));return d(s,n,r),s},e.prototype.driver=function e(){return this._driver||null},e.prototype.getDriver=function e(t,n,r){var s=Qe[t]?l.resolve(Qe[t]):l.reject(new Error("Driver not found."));return d(s,n,r),s},e.prototype.getSerializer=function e(t){var n=l.resolve(ye);return d(n,t),n},e.prototype.ready=function e(t){var n=this,r=n._driverSet.then((function(){return null===n._ready&&(n._ready=n._initDriver()),n._ready}));return d(r,t,t),r},e.prototype.setDriver=function e(t,n,r){var s=this;Ve(t)||(t=[t]);var o=this._getSupportedDrivers(t);function i(){s._config.driver=s.driver()}function a(e){return s._extend(e),i(),s._ready=s._initStorage(s._config),s._ready}function c(e){return function(){var t=0;function n(){for(;t<e.length;){var r=e[t];return t++,s._dbInfo=null,s._ready=null,s.getDriver(r).then(a).catch(n)}i();var o=new Error("No available storage method found.");return s._driverSet=l.reject(o),s._driverSet}return n()}}var u=null!==this._driverSet?this._driverSet.catch((function(){return l.resolve()})):l.resolve();return this._driverSet=u.then((function(){var e=o[0];return s._dbInfo=null,s._ready=null,s.getDriver(e).then((function(e){s._driver=e._driver,i(),s._wrapLibraryMethodsWithReady(),s._initDriver=c(o)}))})).catch((function(){i();var e=new Error("No available storage method found.");return s._driverSet=l.reject(e),s._driverSet})),d(this._driverSet,n,r),this._driverSet},e.prototype.supports=function e(t){return!!Ye[t]},e.prototype._extend=function e(t){ot(this,t)},e.prototype._getSupportedDrivers=function e(t){for(var n=[],r=0,s=t.length;r<s;r++){var o=t[r];this.supports(o)&&n.push(o)}return n},e.prototype._wrapLibraryMethodsWithReady=function e(){for(var t=0,n=nt.length;t<n;t++)st(this,nt[t])},e.prototype.createInstance=function t(n){return new e(n)},e}(),at=new it;t.exports=at},{3:3}]},{},[4])(4)},712:(e,t,n)=>{"use strict";n.d(t,{fm:()=>h,uC:()=>u});var r=n(784),s=n(436),o=n(41),i=n(669),a=n(78),c=n(463),l=n(901);class u extends r.v{constructor(){super(...arguments),this.state="not-started",this.slices=[],this.isOnline=!1,this.duration=0,this.done=!1,this.isReadyPromise=new Promise((e=>this.resolveIsReady=e))}get isFinished(){return"finished"===this.state||"failed"===this.state}static getAudioSlice(e,t,n){const r=e.map((e=>e.getAudioSlice(t,n)));return(0,o.BP)(r)}getAudioSlice(e,t){const{slices:n}=this,r=n.find((t=>e>=t.start&&e<t.end)),o=n.find((e=>t>e.start&&t<e.end));if(!r)return[];const i=Math.floor(r.audio.length*(0,s.V0)(r.start,r.end,e));if(!o)return r.audio.slice(i);const a=Math.floor(o.audio.length*(0,s.V0)(o.start,o.end,t));if(r===o)return r.audio.slice(i,a);const c=new Set(n.slice(n.indexOf(r),n.indexOf(o)+1)),l=new Set([r,o]),u=[...c.difference(l)];return[...r.audio.slice(i),...u.flatMap((e=>[...e.audio])),...o.audio.slice(0,a)]}async start(e){}async stop(){}}const d=(0,a.Q7)(.05,i.RK);class h extends u{async getSegmentSlices(e=this.buffer,{maxDuration:t,minDuration:n}=h){const r=i.NG*t/2,o=[];if(e.length<i.NG*n){const n=new Float32Array(i.NG*t);n.set(e,i.NG*t-e.length);const r={audio:n,start:0,end:e.length/i.NG,index:0};return this.dispatchEvent("next",r),this.slices=[r]}let l=0;for(let t=0;t<e.length;t+=1)if(e[t]){l=t;break}const u=l/i.NG;e=e.slice(l);const f=Math.ceil(e.length/i.NG/(t/2));let p=0,m=0;for(let t=0;t<f;t+=1){let l,u=1,h=0;for(let n=t*r;n<(t+1)*r;n+=i.RK){const r=(0,a.j3)(e,n,n+i.RK);null!=l||(l=r),l=(0,s.Cc)(l,r,d),(t>0||n>i.NG)&&l<u&&(u=l,h=n+i.RK/2)}const f=h,g=f>=e.length-n*i.NG;if((f-m)/i.NG>=n){const t={audio:e.slice(m,f),start:m/i.NG,end:f/i.NG,index:p};g&&(t.last=g),m=f,p+=1,o.push(t),this.dispatchEvent("next",t),p%16==0&&await(0,c.Pm)(20)}}if(m<e.length){const t=e.slice(m),r=new Float32Array(Math.max(n*i.NG,t.length)),s=m/i.NG+u,a=s+r.length/i.NG;r.set(t);const c={audio:r,start:s,end:a,last:!0,index:p};o.push(c),this.dispatchEvent("next",c)}return this.slices=o}async start(e={maxDuration:20,minDuration:10}){const{buffer:t}=this;setTimeout((async()=>{this.state="active";try{const n=(await this.getSegmentSlices(t,e)).map((({audio:{length:e}})=>e/i.NG));(0,l.Rm)("offline-audio-source-durations",(0,o.M1)(n).toString()),this.state="finished"}catch(e){(0,l.Rm)("error initiating offline-audio-source",e),this.state="failed"}}))}constructor(e){super(),this.buffer=e,this.isOnline=!1,this.done=!0,Object.assign(this,{buffer:e,duration:e.length/i.NG}),this.resolveIsReady()}}h.maxDuration=20,h.minDuration=10},105:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var r=n(41),s=n(410),o=n(784),i=n(241),a=n(463);class c extends o.v{constructor(){super(...arguments),this.metrics=(0,a.Oo)(async function(){const e=(0,r.Am)([...this.transcribeNodes,...this.embedNodes]),t=await Promise.all(this.transcribeNodes.map((e=>e.metrics()))),n=this.embedNodes.filter((e=>!this.transcribeNodes.includes(e))),s=await Promise.all(n.map((e=>e.metrics())));let o=[...t,...s];o=o.filter((0,r.by)("requests"));const a=(0,r.cz)(o,(0,r.by)("requests")),c=(0,r.cz)(o,(0,r.by)("successes")),l=(0,r.cz)(o,(0,r.by)("retries")),u=(0,r.cz)(o,(0,r.by)("hallucinations")),d=e=>null!=e,h=(0,r.i2)(o.map((e=>e.failures/e.requests)).filter(d)),f=(0,r.i2)(o.map((e=>e.successes/e.requests)).filter(d)),p=u/a,m=(0,r.i2)(o.map((0,r.by)("xRealTime"))),g=(0,r.Am)(o.flatMap((e=>{var t,n;return null!==(n=null===(t=e.misc)||void 0===t?void 0:t.hostsUsed)&&void 0!==n?n:[]}))),y=(0,r.Am)(o.flatMap((e=>{var t,n;return null!==(n=null===(t=e.misc)||void 0===t?void 0:t.hostsFailed)&&void 0!==n?n:[]}))),w=t.flatMap((0,r.by)("processedIndices")),b=(0,r.Am)(w).length,v=w.length-b,_=v/b,k=(0,r.Os)(o,(0,r.by)("id")).map((e=>({id:e[0].id,successes:(0,r.cz)(e.map((0,r.by)("successes")))}))).map((({id:e,successes:t})=>`${e}-%: ${(0,i.X1)(t/c)}`));return{backend:this.name,threads:e.length,requests:a,retries:l,hallucinations:u,failureRate:h,successRate:f,redundancy:v,redundancyRatio:_,hallucinationRate:p,xRealTime:m,serversUsed:g,serversFailed:y,threadRequestRatios:k}}.bind(this)),this.loadMap=new s.Ou((()=>0))}addTranscribeNode(e){this.transcribeNodes.push(e)}addEmbedNode(e){this.embedNodes.push(e)}consume(e,t,n,s,o,i){const a=[],c=c=>{const l=async()=>{if(o())i();else if(n.includes(c)){if(e.empty){if(a.length&&t.isFinished){const e=a.shift(),t=+setTimeout((()=>!e.processed&&a.unshift(e)),2500);await s(c,e),clearTimeout(t)}}else{const t=e.get();a.push(t),await s(c,t),(0,r.TF)(a,t)}setTimeout(l,16)}};l()};n.forEach(c);const{push:l}=n;n.push=(...e)=>{const t=l.apply(n,e);for(const t of e)c(t);return t}}dispose(){}}},758:(e,t,n)=>{"use strict";n.d(t,{j6:()=>h,jz:()=>f,oe:()=>u});var r=n(358),s=n(669),o=n(279),i=n(981),a=n(687),c=n(383);const l={get LocalBackend(){return n.e(452).then(n.bind(n,452)).then((({LocalBackend:e})=>e))},get RemoteBackend(){return Promise.resolve(r.Fo)},get CompositeBackend(){return Promise.all([n.e(452),n.e(385)]).then(n.bind(n,385)).then((({CompositeBackend:e})=>e))}},u=async()=>{var e,t;const n=await(null===(t=null===(e=navigator.gpu)||void 0===e?void 0:e.requestAdapter())||void 0===t?void 0:t.catch((()=>null)));return n&&!n.isFallbackAdapter},d=()=>o.I.local.get("lastBenchmark",{cpu_bench:100,network_speed:100}),h=(0,c.Bp)("isLocalTranscriptionAvailable",(async()=>{var e;const{Fr:t,Ll:n}=s;if(t||n)return!1;const r=await u(),o=!("deviceMemory"in navigator)||navigator.deviceMemory>=8,i=(null!==(e=navigator.hardwareConcurrency)&&void 0!==e?e:0)>=10||+d().cpu_bench<=55,a=(()=>{var e,t;return+(null!==(t=null===(e=navigator.connection)||void 0===e?void 0:e.downlink)&&void 0!==t?t:0)>=10||+d().network_speed>=2500})();return r&&(o&&i&&a)}));h.addMock("yes",(async()=>!0)),h.addMock("no",(async()=>!1));const f=async e=>{const t=null!=e?e:o.I.local.get("transcription-backend");if(t&&t in l)return new(await l[t]);t&&console.error(`specified backend ${t} not recognized. options are ${(0,a.Rt)(Object.keys(l),"or")}`);let n=o.I.local.get("enable-local-transcription"),s=o.I.local.get("disable-local-transcription"),c=!0;try{c=await i.q.get("useLocalTranscription")}catch(e){console.error(e)}if(n&&s&&(console.warn('enable-local-transcription and disable-local-transcription are both set to "true" and will thus cancel each other out. consider setting one to "false"'),n=s=!1),n)return new(await l.CompositeBackend);const u=await h();return c&&u&&!s?new(await l.CompositeBackend):new r.Fo}},358:(e,t,n)=>{"use strict";n.d(t,{Fo:()=>M});var r=n(41),s=n(512),o=n.n(s);function i(){return o()('(()=>{var e={612:function(e){var t;"undefined"!=typeof self&&self,t=()=>(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function r(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function a(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(a=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key),"symbol"===n(a)?a:String(a)),o)}var a}e.r(t),e.d(t,{default:()=>s});var s=function(){function e(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).sampleRate;(function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this._context=this._createContext(t),t||(t=this._context.sampleRate),this._sampleRate=t}var t,n;return t=e,n=[{key:"_createContext",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:44100;return window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,new AudioContext({sampleRate:e})}},{key:"context",get:function(){return this._context}},{key:"fetchAudio",value:async function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return await Promise.all(n.map((async function(t){var n;return n=t instanceof File||t instanceof Blob?await t.arrayBuffer():await fetch(t).then((function(e){return e.headers.has("Content-Type")&&!e.headers.get("Content-Type").includes("audio/")&&console.warn("Crunker: Attempted to fetch an audio file, but its MIME type is `".concat(e.headers.get("Content-Type").split(";")[0],"`. We\'ll try and continue anyway. (file: \\"").concat(t,\'")\')),e.arrayBuffer()})),await e._context.decodeAudioData(n)})))}},{key:"mergeAudio",value:function(e){var t=this._context.createBuffer(this._maxNumberOfChannels(e),this._sampleRate*this._maxDuration(e),this._sampleRate);return e.forEach((function(e){for(var n=0;n<e.numberOfChannels;n++){for(var r=t.getChannelData(n),o=e.getChannelData(n),a=e.getChannelData(n).length-1;a>=0;a--)r[a]+=o[a];t.getChannelData(n).set(r)}})),t}},{key:"concatAudio",value:function(e){var t=this._context.createBuffer(this._maxNumberOfChannels(e),this._totalLength(e),this._sampleRate),n=0;return e.forEach((function(e){for(var r=0;r<e.numberOfChannels;r++)t.getChannelData(r).set(e.getChannelData(r),n);n+=e.length})),t}},{key:"padAudio",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(0===n)return e;if(t<0)throw new Error(\'Crunker: Parameter "padStart" in padAudio must be positive\');if(n<0)throw new Error(\'Crunker: Parameter "seconds" in padAudio must be positive\');for(var r=this._context.createBuffer(e.numberOfChannels,Math.ceil(e.length+n*e.sampleRate),e.sampleRate),o=0;o<e.numberOfChannels;o++){var a=e.getChannelData(o);r.getChannelData(o).set(a.subarray(0,Math.ceil(t*e.sampleRate)+1),0),r.getChannelData(o).set(a.subarray(Math.ceil(t*e.sampleRate)+2,r.length+1),Math.ceil((t+n)*e.sampleRate))}return r}},{key:"sliceAudio",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(t>=n)throw new Error(\'Crunker: "start" time should be less than "end" time in sliceAudio method\');for(var a=Math.round((n-t)*this._sampleRate),s=Math.round(t*this._sampleRate),i=this._context.createBuffer(e.numberOfChannels,a,this._sampleRate),l=0;l<e.numberOfChannels;l++)for(var c=e.getChannelData(l),u=i.getChannelData(l),f=0;f<a;f++)u[f]=c[s+f],f<r*this._sampleRate&&(u[f]*=f/(r*this._sampleRate)),f>a-o*this._sampleRate&&(u[f]*=(a-f)/(o*this._sampleRate));return i}},{key:"play",value:function(e){var t=this._context.createBufferSource();return t.buffer=e,t.connect(this._context.destination),t.start(),t}},{key:"export",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"audio/wav",n=this._interleave(e),r=this._writeHeaders(n,e.numberOfChannels,e.sampleRate),o=new Blob([r],{type:t});return{blob:o,url:this._renderURL(o),element:this._renderAudioElement(o)}}},{key:"download",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"crunker",n=document.createElement("a");return n.style.display="none",n.href=this._renderURL(e),n.download="".concat(t,".").concat(e.type.split("/")[1]),n.click(),n}},{key:"notSupported",value:function(e){return this._isSupported()?void 0:e()}},{key:"close",value:function(){return this._context.close(),this}},{key:"_maxDuration",value:function(e){return Math.max.apply(Math,r(e.map((function(e){return e.duration}))))}},{key:"_maxNumberOfChannels",value:function(e){return Math.max.apply(Math,r(e.map((function(e){return e.numberOfChannels}))))}},{key:"_totalLength",value:function(e){return e.map((function(e){return e.length})).reduce((function(e,t){return e+t}),0)}},{key:"_isSupported",value:function(){return"AudioContext"in window||"webkitAudioContext"in window||"mozAudioContext"in window}},{key:"_writeHeaders",value:function(e,t,n){var r=2*t,o=2*e.length,a=36+o,s=new ArrayBuffer(8+a),i=new DataView(s);return this._writeString(i,0,"RIFF"),i.setUint32(4,a,!0),this._writeString(i,8,"WAVE"),this._writeString(i,12,"fmt "),i.setUint32(16,16,!0),i.setUint16(20,1,!0),i.setUint16(22,t,!0),i.setUint32(24,n,!0),i.setUint32(28,n*r,!0),i.setUint16(32,r,!0),i.setUint16(34,16,!0),this._writeString(i,36,"data"),i.setUint32(40,o,!0),this._floatTo16BitPCM(i,e,44)}},{key:"_floatTo16BitPCM",value:function(e,t,n){for(var r=0;r<t.length;r++,n+=2){var o=Math.max(-1,Math.min(1,t[r]));e.setInt16(n,o<0?32768*o:32767*o,!0)}return e}},{key:"_writeString",value:function(e,t,n){for(var r=0;r<n.length;r++)e.setUint8(t+r,n.charCodeAt(r))}},{key:"_interleave",value:function(e){if(1===e.numberOfChannels)return e.getChannelData(0);for(var t=[],n=0;n<e.numberOfChannels;n++)t.push(e.getChannelData(n));for(var r=t.reduce((function(e,t){return e+t.length}),0),o=new Float32Array(r),a=0,s=0;a<r;)t.forEach((function(e){o[a++]=e[s]})),s++;return o}},{key:"_renderAudioElement",value:function(e){var t=document.createElement("audio");return t.controls=!0,t.src=this._renderURL(e),t}},{key:"_renderURL",value:function(e){return(window.URL||window.webkitURL).createObjectURL(e)}}],n&&a(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();return t})(),e.exports=t()},669:(e,t,n)=>{"use strict";n.d(t,{Ll:()=>l,NG:()=>a,YX:()=>p,ig:()=>s,pE:()=>h,xD:()=>u});const r="undefined"!=typeof navigator&&navigator.userAgent.includes("Firefox");let o=48e3;if("undefined"!=typeof AudioContext){const e=new AudioContext;o=e.sampleRate,e.close()}const a=r?o:16e3,s=1,i=(!!globalThis.navigator&&/Mobi|Android/i.test(navigator.userAgent),"undefined"==typeof location?"":location.search),l="undefined"!=typeof process,c=(!l&&"undefined"!=typeof location&&location.pathname.includes("/dashboard"),"undefined"!=typeof AudioWorkletProcessor),u="undefined"!=typeof DedicatedWorkerGlobalScope||c,f=!l&&(u||c||"undefined"!=typeof navigator),d="undefined"!=typeof location&&("localhost"===location.hostname||location.href.startsWith("blob:http://localhost")),p=(f&&"undefined"!=typeof location&&(location.host.includes("nuiq.com")||location.href.startsWith("blob:https://nuiq.com")||d&&location.port),"undefined"!=typeof location&&(location.host.includes("stage.nuiq.com")||location.href.startsWith("blob:https://stage.nuiq.com")),d||/debug(\\=true)?($|&)/.test(i),"undefined"!=typeof navigator&&/Safari/i.test(navigator.userAgent)&&navigator.userAgent.includes("Chrome"),i.includes("useDevServer=true")?"asrd.nuzi.ai":"asr.nuzi.ai"),h="turbo";Math.PI}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,r)=>(n.f[r](e,t),t)),[])),n.u=e=>e+".nuiq-asr.worker.js",n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var o=r.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=r[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\\?.*$/,"").replace(/\\/[^\\/]+$/,"/"),n.p=e})(),(()=>{var e={335:1};n.f.i=(t,r)=>{e[t]||importScripts(n.p+n.u(t))};var t=self.webpackChunkNuiqASR=self.webpackChunkNuiqASR||[],r=t.push.bind(t);t.push=t=>{var[o,a,s]=t;for(var i in a)n.o(a,i)&&(n.m[i]=a[i]);for(s&&s(n);o.length;)e[o.pop()]=1;r(t)}})(),(()=>{"use strict";\n/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\nconst e=Symbol("Comlink.proxy"),t=Symbol("Comlink.endpoint"),r=Symbol("Comlink.releaseProxy"),o=Symbol("Comlink.finalizer"),a=Symbol("Comlink.thrown"),s=e=>"object"==typeof e&&null!==e||"function"==typeof e,i=new Map([["proxy",{canHandle:t=>s(t)&&t[e],serialize(e){const{port1:t,port2:n}=new MessageChannel;return l(e,t),[n,[n]]},deserialize:e=>(e.start(),function t(e,n){return h(e,[],n)}(e))}],["throw",{canHandle:e=>s(e)&&a in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function l(t,n=globalThis,r=["*"]){n.addEventListener("message",(function s(i){if(!i||!i.data)return;if(!function u(e,t){for(const n of e){if(t===n||"*"===n)return!0;if(n instanceof RegExp&&n.test(t))return!0}return!1}(r,i.origin))return void console.warn(`Invalid origin \'${i.origin}\' for comlink proxy`);const{id:f,type:d,path:p}=Object.assign({path:[]},i.data),h=(i.data.argumentList||[]).map(v);let m;try{const n=p.slice(0,-1).reduce(((e,t)=>e[t]),t),r=p.reduce(((e,t)=>e[t]),t);switch(d){case"GET":m=r;break;case"SET":n[p.slice(-1)[0]]=v(i.data.value),m=!0;break;case"APPLY":m=r.apply(n,h);break;case"CONSTRUCT":m=function o(t){return Object.assign(t,{[e]:!0})}(new r(...h));break;case"ENDPOINT":{const{port1:e,port2:n}=new MessageChannel;l(t,n),m=b(e,[e])}break;case"RELEASE":m=void 0;break;default:return}}catch(e){m={value:e,[a]:0}}Promise.resolve(m).catch((e=>({value:e,[a]:0}))).then((e=>{const[r,a]=w(e);n.postMessage(Object.assign(Object.assign({},r),{id:f}),a),"RELEASE"===d&&(n.removeEventListener("message",s),c(n),o in t&&"function"==typeof t[o]&&t[o]())})).catch((e=>{const[t,r]=w({value:new TypeError("Unserializable return value"),[a]:0});n.postMessage(Object.assign(Object.assign({},t),{id:f}),r)}))})),n.start&&n.start()}function c(e){(function t(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function u(e){if(e)throw new Error("Proxy has been released and is not useable")}function f(e){return A(e,{type:"RELEASE"}).then((()=>{c(e)}))}const d=new WeakMap,p="FinalizationRegistry"in globalThis&&new FinalizationRegistry((e=>{const t=(d.get(e)||0)-1;d.set(e,t),0===t&&f(e)}));function h(e,n=[],o=function(){}){let a=!1;const s=new Proxy(o,{get(t,o){if(u(a),o===r)return()=>{!function t(e){p&&p.unregister(e)}(s),f(e),a=!0};if("then"===o){if(0===n.length)return{then:()=>s};const t=A(e,{type:"GET",path:n.map((e=>e.toString()))}).then(v);return t.then.bind(t)}return h(e,[...n,o])},set(t,r,o){u(a);const[s,i]=w(o);return A(e,{type:"SET",path:[...n,r].map((e=>e.toString())),value:s},i).then(v)},apply(r,o,s){u(a);const i=n[n.length-1];if(i===t)return A(e,{type:"ENDPOINT"}).then(v);if("bind"===i)return h(e,n.slice(0,-1));const[l,c]=g(s);return A(e,{type:"APPLY",path:n.map((e=>e.toString())),argumentList:l},c).then(v)},construct(t,r){u(a);const[o,s]=g(r);return A(e,{type:"CONSTRUCT",path:n.map((e=>e.toString())),argumentList:o},s).then(v)}});return function i(e,t){const n=(d.get(t)||0)+1;d.set(t,n),p&&p.register(e,t,e)}(s,e),s}function m(e){return Array.prototype.concat.apply([],e)}function g(e){const t=e.map(w);return[t.map((e=>e[0])),m(t.map((e=>e[1])))]}const y=new WeakMap;function b(e,t){return y.set(e,t),e}function w(e){for(const[t,n]of i)if(n.canHandle(e)){const[r,o]=n.serialize(e);return[{type:"HANDLER",name:t,value:r},o]}return[{type:"RAW",value:e},y.get(e)||[]]}function v(e){switch(e.type){case"HANDLER":return i.get(e.name).deserialize(e.value);case"RAW":return e.value}}function A(e,t,n){return new Promise((r=>{const o=function a(){return new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-")}();e.addEventListener("message",(function t(n){n.data&&n.data.id&&n.data.id===o&&(e.removeEventListener("message",t),r(n.data))})),e.start&&e.start(),e.postMessage(Object.assign({id:o},t),n)}))}var x=n(669);const C=(e="GET")=>async(t,...n)=>await fetch(n[0],{method:e,...n[1],signal:AbortSignal.timeout(t)}),k=Object.assign(fetch,{cors:(...e)=>(e[1]?e[1].mode="cors":e[1]={mode:"cors"},fetch(...e)),timeout:Object.assign(C(),{post:C("POST")})}),S=k;function O(e){const t=atob(e),n=t.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=t.charCodeAt(e);return new Float32Array(r.buffer)}const R=x.Ll?e=>Buffer.from(e.buffer).toString("base64"):e=>{const t=new Uint8Array(e.buffer),n=Array.from(t,(e=>String.fromCharCode(e))).join("");return btoa(n)};var E,T,$=n(612),_=n.n($);const M=(...e)=>e.reduce(((e,t)=>(e[t]=t,e)),{}),j=M("milliseconds","seconds","minutes","hours","days","weeks"),D=M("ms","s","m","h","d","w"),I=36e5,P=864e5,U={milliseconds:1,seconds:1e3,minutes:6e4,hours:I,days:P,weeks:7*P},L={ms:"milliseconds",s:"seconds",m:"minutes",h:"hours",d:"days",w:"weeks"};Number.prototype.in=function(e){return this/("number"==typeof e?e:U[e])},Object.defineProperties(Number.prototype,Object.values(j).reduce(((e,t)=>(e[t]={get(){return this*U[t]}},e)),{})),Object.defineProperties(Number.prototype,Object.values(D).reduce(((e,t)=>(e[t]={get(){return G(this*U[L[t]])}},e)),{}));const B="undefined"==typeof performance?()=>currentTime:performance.now.bind(performance),N="undefined"==typeof performance?B:()=>performance.timeOrigin+F(),F=new(T=class e extends Function{constructor(){super("return performance.now();"),this[E]=B}},E=Symbol.toPrimitive,T),G=e=>{let t=!1;const n=new Promise((n=>setTimeout((()=>!t&&n()),e)));return Object.assign(n,{cancel:()=>{t=!0}})},{fromEntries:z,keys:W}=((new Date).getDay(),Object);const{parse:q,stringify:H}=JSON;["upload","listen","summarize","telehealth"].map((e=>`finished-${e}-transcriptions`));const V=(e,t=void 0)=>e instanceof Function?e(t):e,Y=(e,t,n=(()=>{}))=>(...r)=>V(e)?t(...r):n(...r);var X;let J=!1;try{J=!1}catch(T){}const Q=globalThis.setTimeout||(e=>{});class Z{}X=Z,Z.passed=0,Z.failed=0,Z.testPromises=[],Z.expect=Y(J,((e,t,n="")=>{const r=new Promise((r=>Q((async()=>{const o=await V(e),a=V(t),s=o===a,i=null!=n?n:e instanceof Function?e.name:"";s?X.passed+=1:(console.error(` failed InlineTest::${i} (expected ${a}, got ${o})`),X.failed+=1),r()}))));return X.testPromises.push(r),r})),Q(Y(J,(async()=>{await Promise.all(X.testPromises);const{passed:e,failed:t}=X,n=e+t;console.log(` InlineTest: passed ${e} / ${n} (${ie(e/n)})`),t&&console.log(` InlineTest: failed ${t} / ${n} (${ie(t/n)})`)})),5..seconds);const K=new Map,ee=e=>{const t=JSON.stringify(e);return K.has(t)?K.get(t):(K.set(t,e),e)};Z.expect(ee({a:1,b:2,c:3}),ee({a:1,b:2,c:3}));const{floor:te,max:ne,round:re}=Math,{isArray:oe}=Array,{entries:ae}=Object,{ListFormat:se}=Intl,ie=e=>ue(e)?`${le(100*+e)}%`:"0%",le=e=>e.toFixed(/\\./.test(`${e}`)?2:0),ce=new Set(["boolean","symbol"]),ue=e=>!ce.has(typeof e)&&""!==e&&+e==+e;new se("en",{style:"long",type:"conjunction"});Map;Map;WeakMap;Map;Map;const{floor:fe,max:de,min:pe,pow:he,random:me,sqrt:ge}=Math;new Intl.Collator("en");function ye(e,t){return n=>null==t?n[e]:t instanceof Function?t(n[e]):n[e]===t}ye("length");const be=(e,t)=>e[t%e.length],we=(e=[])=>{let t=0;return Object.assign(e,{next(n=(e=>!0)){let r=be(e,t);for(t+=1;!n(r);)r=be(e,t),t+=1;return r},peekNext:()=>be(e,t+1),add(t){e.includes(t)||e.push(t)},delete(t){ve(e,t)},set(t){Ee(e,t)}})},ve=function(e,t){return Re(e,e.filter((e=>e!==t)))},Ae=(e,t=(e=>e))=>{let n=0;for(let r=0;r<e.length;r+=1)n+=t(e[r]);return n},xe=(e,t=(e=>e))=>Ae(e,t)/e.length,Ce=(e,t=(e=>e))=>de.apply(null,e.map((e=>t(e)))),ke=(e,t=(e=>e))=>pe.apply(null,e.map((e=>t(e)))),Se=(e,t=(e=>e))=>{e=e.map((e=>t(e)));const n=xe(e),r=[];let o=e.length;for(;o-- >0;)r.push(he(e[o]-n,2));return xe(r)},Oe={sum:Ae,mean:xe,median:(e,t=(e=>e))=>{const n=[].sort.call(e.map(t),((e,t)=>e-t)),r=n.length,o=fe(.5*r);return r%2?n[o]:.5*(n[o-1]+n[o])},mode:(e,t=(e=>e))=>{var n;const r=new Map;for(const o of e){const e=t(o);r.set(e,(null!==(n=r.get(e))&&void 0!==n?n:0)+1)}const o=Math.max.apply(null,[...r.values()]);return[...r.keys()].find((e=>r.get(e)===o))},min:ke,max:Ce,range:(e,t=(e=>e))=>(e=e.map((e=>t(e))),Ce(e)-ke(e)),deviation:(e,t=(e=>e))=>ge(Se(e,t)),variance:Se};Object.keys(Oe);const Re=(e,t)=>{let{length:n}=t;for(e.length!==n&&(e.length=n);n-- >0;)e[n]=t[n];return e},Ee=Re;let{from:Te}=Array;const $e=e=>Math.floor(e*x.NG),_e=(e,t)=>t.map((e=>t=>{const n=t.end-t.start,r=e.length/x.NG,o=Math.max(0,x.ig-n);if(o){const e={start:t.start-o/2,end:t.end+o/2};e.start<0?(e.end+=Math.abs(e.start),e.start=0):e.end>r&&(e.start-=e.end-r),t.start=e.start,t.end=e.end}return e.slice($e(t.start),$e(t.end))})(e)),Me=e=>{let t=44;const n=new ArrayBuffer(t+4*e.length),r=new DataView(n);je(r,0,"RIFF"),r.setUint32(4,36+4*e.length,!0),je(r,8,"WAVE"),je(r,12,"fmt "),r.setUint32(16,16,!0),r.setUint16(20,3,!0),r.setUint16(22,1,!0),r.setUint32(24,x.NG,!0),r.setUint32(28,4*x.NG,!0),r.setUint16(32,4,!0),r.setUint16(34,32,!0),je(r,36,"data"),r.setUint32(40,4*e.length,!0);for(let n=0;n<e.length;++n,t+=4)r.setFloat32(t,e[n],!0);return n};function je(e,t,n){for(let r=0;r<n.length;++r)e.setUint8(t+r,n.charCodeAt(r))}class De{constructor(e){if(!e)throw TypeError("options argument is required");if(!e.sampleRate)throw TypeError("options.sampleRate is required");if(e.sampleRate<3e3||e.sampleRate>768e3)throw TypeError("options.sampleRate must be within 3000..768000");if(!e.length)throw TypeError("options.length must be more than 0");this.sampleRate=e.sampleRate,this.numberOfChannels=e.numberOfChannels||1,this.length=0|e.length,this.duration=this.length/this.sampleRate,this._data=new Float32Array(this.length*this.numberOfChannels),this._channelData=[];for(let e=0;e<this.numberOfChannels;e++)this._channelData.push(this._data.subarray(e*this.length,(e+1)*this.length))}getChannelData(e){if(e>=this.numberOfChannels||e<0||null==e)throw Error("Cannot getChannelData: channel number ("+e+") exceeds number of channels ("+this.numberOfChannels+")");return this._channelData[e]}copyFromChannel(e,t,n){null==n&&(n=0);for(var r=this._channelData[t],o=n,a=0;o<this.length&&a<e.length;o++,a++)e[a]=r[o]}copyToChannel(e,t,n){var r=this._channelData[t];n||(n=0);for(var o=n,a=0;o<this.length&&a<e.length;o++,a++)r[o]=e[a]}}function Ie(e){const t=new AudioContext({sampleRate:x.NG}),n=t.createBuffer(1,e.length,x.NG);return n.getChannelData(0).set(e),t.close(),n}class Pe{static get resampler(){return e=>{const t=new OfflineAudioContext(1,e.duration*x.NG,x.NG),n=t.createBufferSource();return n.buffer=e,n.connect(t.destination),n.start(),t.startRendering()}}static get slicer(){var e;return null!==(e=this._slicer)&&void 0!==e?e:this._slicer=new(_())({sampleRate:x.NG})}static fromTo(e,t,...n){const r=Pe.from(e);return r instanceof Promise?r.then((async e=>e.to(t,...n))):r.to(t,...n)}static fromSync(e){if(e instanceof Array&&(e=Float32Array.from(e)),e instanceof Float32Array){const t=Ie(e);return new Pe(t)}if(e instanceof ArrayBuffer){const t=Ie(new Float32Array(e));return new Pe(t)}if(e instanceof De)return new Pe(e);const t=+e;return new Pe(new De({numberOfChannels:1,sampleRate:x.NG,length:t==t?t:1e3}))}static async fromAsync(e){if("upload"===`${e}`.toLowerCase()){const{files:t}=await(async({accept:e="audio",directory:t=!1,multiple:n=t,keepInput:r=!0}={})=>{const o=document.createElement("input");o.type="file",o.accept=e,o.multiple=n,o.webkitdirectory=t,o.click();const a=await new Promise((e=>o.onchange=async t=>{const{files:n}=t.target;e(n),r||o.remove()}));return{input:o,files:Array.from(a)}})();e=t[0]}if(e instanceof Blob){const t=URL.createObjectURL(e),n=await Pe.resampler((await this.slicer.fetchAudio(t))[0]);return URL.revokeObjectURL(t),new Pe(n)}if("string"==typeof e)try{const[t]=await this.slicer.fetchAudio(e),n=await Pe.resampler(t);return new Pe(n)}catch(t){console.warn(t);const n=Ie(O(e));return new Pe(n)}if(e instanceof HTMLAudioElement)return await Pe.from(e.src);const t=+e;return new Pe(new De({numberOfChannels:1,sampleRate:x.NG,length:t==t?t:1e3}))}static from(e){return"number"==typeof e||e instanceof Array||e instanceof Float32Array||e instanceof ArrayBuffer||e instanceof De?Pe.fromSync(e):Pe.fromAsync(e)}constructor(e){this.audioBuffer=e,this.out={Buffer:()=>this.audioBuffer,Float32Array:()=>this.audioBuffer.getChannelData(0),Array:()=>this.audioBuffer.getChannelData(0),Audio:()=>function e(t){const n=Me(t),r=new Blob([n],{type:"audio/wav"}),o=URL.createObjectURL(r);return new Audio(o)}(this.audioBuffer.getChannelData(0)),Blob:()=>Pe.slicer.export(this.audioBuffer).blob,File:()=>{const e=this.to.Blob();return new File([e],"audio.wav",{type:"audio/mpeg"})},Wav:()=>Me(this.audioBuffer.getChannelData(0)),String:()=>URL.createObjectURL(this.to.Blob()),URL:()=>this.out.String(),Base64:()=>R(this.audioBuffer.getChannelData(0)),Download:(e="audio.wav")=>Pe.slicer.download(this.to.Blob(),e),Duration:e=>{let t=this.to.Array();return t=e>this.audioBuffer.duration?Float32Array.from([...t,...t.slice(0,Math.floor(x.NG*e)-t.length)]):t.slice(0,Math.floor(e*x.NG)),Pe.from(t)},Segment:e=>{const t=this.to.Array();return Pe.from(t.slice(Math.floor(e.start*x.NG),Math.floor(e.end*x.NG)))}},this.to=Object.assign(((e,...t)=>{e=e.toLowerCase();const n=Object.fromEntries(Object.entries(this.out).map((([e,t])=>[e.toLowerCase(),t])));return e in n?n[e].apply(n[e],t):this.out.String()}),this.out),this.audioBuffer=e}static async play(e){return(await Pe.from(e)).play()}async play(){return this.to("Audio").play()}static async compress(e){const{compressor:t}=await n.e(405).then(n.bind(n,405));return Pe.from(await t.process(await Pe.fromTo(e,"Buffer")))}}const Ue=async(e,t,{timeout:n=1e9}={})=>{const r=t instanceof File?[(await Pe.fromTo(t,"Float32Array")).buffer]:[t.buffer],o=new Blob(r,{type:"application/octet-stream"}),a=new FormData;a.append("audio",o);try{return await S.timeout(n,e,{method:"POST",body:a,mode:"cors"})}catch(e){console.error(e)}},Le=async(e,t,{model:n,xvects:r=!1,transcriptionId:o="",noteId:a="",diarize:s,numSpeakers:i,clients:l,clinicians:c,timeout:u})=>{const f=`?${`&diarize=${s}`}${`&id=${o}`}${`&noteId=${a}`}${n&&n!==x.pE?`&model=${n}`:""}${`&xvects=${r}`}${[i?`&numSpeakers=${i}`:"",c?`&clinicians=${c}`:"",l?`&clients=${l}`:""].join("")}`,d=`${e.includes("localhost")?"http":"https"}://${e}/${t instanceof File?"api/transcribe-file":"api/transcribe"}${f}`;return await(async e=>{let t;if(!e)return{processed:!1};try{if(404===e.status)throw void 0;t=await e.json(),!1!==t.processed&&(t.processed=!0)}catch(e){t={processed:!1},console.error(e)}return t})(await Ue(d,t,{timeout:u}))},Be=async(e,t,{dtype:n="fp32",transcriptionId:r="",noteId:o=""})=>{const a=`?${`&id=${r}`}${`&noteId=${o}`}${`&dtype=${n}`}`,s=`${e.includes("localhost")?"http":"https"}://${e}/api/embed${a}`,i=await Ue(s,t);return"string"==typeof(l=await(async e=>await(null==e?void 0:e.json()))(i)).embedding?O(l.embedding):Float32Array.from(l);var l};var Ne,Fe;globalThis.requestIdleCallback||(globalThis.requestIdleCallback=e=>+setTimeout((()=>e({didTimeout:!1,timeRemaining:()=>1})))),globalThis.cancelIdleCallback||(globalThis.cancelIdleCallback=clearTimeout);null!==(Ne=(Fe=Set.prototype).union)&&void 0!==Ne||(Fe.union=function(e){const t=new Set(this);for(const n of e.keys())t.add(n);return t}),x.xD&&self.addEventListener("unhandledrejection",(e=>{e.preventDefault(),postMessage({status:"error",args:[e.reason]}),console.error("error in worker",e)}));class Ge{async init(e,t){x.xD&&postMessage({status:"ready"})}async process(e,t){return e}constructor(){x.xD&&(l(this),postMessage({status:"listening"}))}}const ze=e=>{const t=1/function n(e){let t=0,n=e.length;for(;n-- >0;){const r=e[n];t+=r*r}return Math.sqrt(t)}(e),r=e.slice();let o=r.length;for(;o-- >0;)r[o]*=t;return r},{log10:We}=Math,qe=(e,t,n=.5)=>e*(1-n)+t*n,He=/(?:(?:\\s[.,?!:;\'"])|(?:[.,?!:;\'"]\\s)|[\\s.,?!:;])+/g,Ve="Okay, so good evening, everyone. I want to say welcome to the Substance Abuse Support Group. I\'m Courtney and I will be the facilitator or the group leader of this group and I just want to say welcome first and I want to just kind of briefly go over some some rules, you know, I don\'t necessarily, you guys don\'t have to be on mute if you don\'t want to be, but I don\'t want anyone talking over anyone else or cutting them off.",Ye=["Okay","so","good","evening","everyone","I","want","to","say","welcome","to","the","Substance","Abuse","Support","Group","I\'m","Courtney","and","I","will","be","the","facilitator","or","the","group","leader","of","this","group","and","I","just","want","to","say","welcome","first","and","I","want","to","just","kind","of","briefly","go","over","some","some","rules","you","know","I","don\'t","necessarily","you","guys","don\'t","have","to","be","on","mute","if","you","don\'t","want","to","be","but","I","don\'t","want","anyone","talking","over","anyone","else","or","cutting","them","off",""];Z.expect((()=>Ve.split(He).join("::")),(()=>Ye.join("::")));const Xe=/^.+\\@.+\\..+$/g;Z.expect(Xe.test("test@email.com"),!0),Z.expect(Xe.test("123 test address st., denver co 80201"),!1);const Je=/\\d+ .+\\,?.+[A-Z]{2}\\,? ?\\d{5}\\-?\\d{0,4}/;Z.expect(Je.test("72 Applegate Drive Taunton, MA 02780"),!0),Z.expect(Je.test("723 Applegate Dr, Taunton, MA 02780"),!0),Z.expect(Je.test("7 Applegate Ln., Taunton MA 02780"),!0),Z.expect(Je.test("72 Applegate Way, Taunton MA 02780-4052"),!0),Z.expect(Je.test("Applegate Way, Taunton MA 02780-4052"),!1),Z.expect(Je.test("42 Applegate Way, Taunton MA"),!1),Z.expect(Je.test("42 Applegate Way, Taunton 02780"),!1);Z.expect(/\\d{3}\\-\\d{2}\\-\\d{4}/.test("111-11-1111"),!0);const Qe=/^(?:\\$\\s*\\d+(\\.\\d{2})?\\s*|\\s*\\d+(\\.\\d{2})?\\s*\\$)$/;Z.expect(Qe.test("$24.40"),!0),Z.expect(Qe.test("$ 24.40"),!0),Z.expect(Qe.test("$\\n24.40"),!0),Z.expect(Qe.test("24.40 $"),!0),Z.expect(Qe.test("24$"),!0),Z.expect(Qe.test("24"),!1),Z.expect(Qe.test("$ 24.3432"),!1);const Ze=(e="")=>e.trim().split(He).filter(Boolean),Ke=e=>e.replaceAll(He,""),et=e=>(e.words?e.words.map(ye("word")):Ze(e.text)).map(Ke),tt=e=>{var t,n;const r=et(e);let{words:o}=e;if(null==o){const t=Ae(r,(e=>e.length));let n=0;const{start:a=0,end:s=0}=e;o=r.map((e=>{const r=qe(a,s,n/t),o=qe(a,s,(n+e.length)/t);return n+=e.length,{word:e,start:r,end:o}}))}const a=null!==(t=e.wordsSet)&&void 0!==t?t:new Set(r);return{...e,wordCount:null!==(n=e.wordCount)&&void 0!==n?n:a.size,words:o,wordsSet:a}};const nt=()=>{const e=x.xD?b:e=>e,t=!x.Ll&&location.origin.includes("localhost");let n=0,r=0,o=0,a=0,s=0;const i=new Set,l=new Set;let c="http://localhost:3004";let u,f,d=we(),p="fp32",h=!1,m=0,g=new Set,y=0,w=x.pE,v=!1,A="offline";const C=()=>{const e=u;l.add(e),u=d.next((t=>t!==e)),i.add(u)},k=async()=>{let e=`${u.includes("localhost")?"http":"https"}://${u}/api/heartbeat`;const t=new AbortController,{signal:n}=t,r=setTimeout(C,1e4);await S(e,{signal:n,mode:"cors"}),clearTimeout(r)},O="undefined"==typeof self?globalThis:self;return new class R extends Ge{async metrics(){return{id:null!=u?u:crypto.randomUUID().split("-")[0],requests:n,retries:o,failures:a,successes:r,hallucinations:s,processed:m,processedIndices:[...g],elapsed:y,xRealTime:y?m/y:0,misc:{hostsUsed:[...i],hostsFailed:[...l]}}}async init(e){var n,r;Object.assign(O,{"timeout-multiplier":e.timeoutMultiplier}),A=null!==(n=e.type)&&void 0!==n?n:"offline",h=e.diarize,e.model&&!e.model.includes("distil")&&(w=e.model),null!=e.xvects&&(v=e.xvects),c=e.remoteOrigin,e.embedQuantized||(p="fp32"),d=we(e.hosts),u=null!==(r=e.host)&&void 0!==r?r:await(async(e="transcribe")=>c.includes("localhost")&&t?location.origin.replace("http://",""):await(await S(`https://${x.YX}/api/next${"transcribe"===e?"":"/embed"}`,{mode:"cors"})).text())(),i.add(u),f=we(e.hosts),await super.init()}async process(t){var i,l,c,b;const S=N();n+=1;const{segments:O}=t,{transcriptionId:R,noteId:E}=t;if(!O){const{audio:n}=t;m+=n.length/x.NG,g.add(t.index);const c={diarize:h,model:w,xvects:v,transcriptionId:R,noteId:E},f=N();let p=await Le(u,n,c),b=0;for(p.hallucinated&&(s+=1);!1===p.processed&&b<d.length;){const e=u;C(),console.log(`remote worker retrying after failed request to ${e} with fallback host ${u} (retry ${b})`),p=await Le(u,n,c),b+=1}{for(const e of p.segments)e.hallucinated=p.hallucinated,null!==(i=e.texts)&&void 0!==i||(e.texts=p.texts);const{models:e=[w]}=p;for(const t of p.segments)null!==(l=t.models)&&void 0!==l||(t.models=e)}!1===p.processed?(console.log("remote worker failed to transcribe audio after attempting with fallbacks"),a+=1):b&&console.log(`remote worker successfully transcribed after ${b} retries`),o+=b;const S=p.segments.every(ye("embedding")),O=p.segments.every(ye("xvect"));h&&S&&(p.segments.forEach((e=>e.embedding=ze(x.xD?new Float32Array(e.embedding):e.embedding))),v&&p.segments.forEach((e=>{var t;return e.xvect=x.xD?new Float32Array(e.xvect):null!==(t=e.xvect)&&void 0!==t?t:[]}))),p.segments.forEach((e=>e.processor=u)),p.processor=u;const T=h&&S?p.segments.map(ye("embedding")).map(ye("buffer")):[],$=h&&v&&O?p.segments.map(ye("xvect")).map(ye("buffer")):[],_=[n.buffer,...T,...$];y+=.001*(N()-f),"online"===A&&navigator.onLine&&setTimeout(k),r+=1;const M={segments:p.segments.map(tt),groupedSegments:void 0};return e(Object.assign(p,{audio:n,...M}),_)}r-=1;const T=null===(c=t.segments)||void 0===c?void 0:c.filter(ye("text")),$=_e(t.audio,T);m+=t.audio.length/x.NG;const _={transcriptionId:R,noteId:E,dtype:p},M=await Promise.all($.map((async e=>{const t=T[$.indexOf(e)];let n=f.next(),r=await Be(n,e,_);if(!(e=>{let t=e.length;for(;t-- >0;)if(e[t])return!0;return!1})(r)){const t=n;n=f.next(),console.warn(`got invalid embedding from ${t}. retrying with ${n}`),r=await Be(n,e,_)}return Object.assign(t,{embedding:ze(r)})})));null!==(b=t.processor)&&void 0!==b||(t.processor=u),y+=.001*(N()-S),r+=1;const j={segments:M.map(tt),groupedSegments:void 0},D=M.map((({embedding:e})=>e)).map(ye("buffer"));return e(Object.assign(t,j),D)}}};nt()})()})();',"Worker",void 0,void 0)}var a=n(590),c=n(831),l=n(78),u=n(669),d=n(43),h=n(148),f=n(75),p=n(656),m=n(258),g=n(516);const y=()=>{const e=u.xD?a.k0:e=>e,t=!u.Ll&&location.origin.includes("localhost");let n=0,s=0,o=0,i=0,y=0;const w=new Set,b=new Set;let v="http://localhost:3004";let _,k,S=(0,r.Ry)(),x="fp32",A=!1,C=0,E=new Set,I=0,O=u.pE,M=!1,R="offline";const $=()=>{const e=_;b.add(e),_=S.next((t=>t!==e)),w.add(_)},j=async()=>{let e=`${_.includes("localhost")?"http":"https"}://${_}/api/heartbeat`;const t=new AbortController,{signal:n}=t,r=setTimeout($,1e4);await(0,h.Ay)(e,{signal:n,mode:"cors"}),clearTimeout(r)},P="undefined"==typeof self?globalThis:self;class T extends p.n{async metrics(){return{id:null!=_?_:(0,d.u)(),requests:n,retries:o,failures:i,successes:s,hallucinations:y,processed:C,processedIndices:[...E],elapsed:I,xRealTime:I?C/I:0,misc:{hostsUsed:[...w],hostsFailed:[...b]}}}async init(e){var n,s;Object.assign(P,{"timeout-multiplier":e.timeoutMultiplier}),R=null!==(n=e.type)&&void 0!==n?n:"offline",A=e.diarize,e.model&&!e.model.includes("distil")&&(O=e.model),null!=e.xvects&&(M=e.xvects),v=e.remoteOrigin,e.embedQuantized||(x="fp32"),S=(0,r.Ry)(e.hosts),_=null!==(s=e.host)&&void 0!==s?s:await(async(e="transcribe")=>v.includes("localhost")&&t?location.origin.replace("http://",""):await(await(0,h.Ay)(`https://${u.YX}/api/next${"transcribe"===e?"":"/embed"}`,{mode:"cors"})).text())(),w.add(_),k=(0,r.Ry)(e.hosts),await super.init()}async process(t){var a,d,h,p;const w=(0,f.tB)();n+=1;const{segments:b}=t,{transcriptionId:v,noteId:P}=t;if(!b){const{audio:n}=t;C+=n.length/u.NG,E.add(t.index);const l={diarize:A,model:O,xvects:M,transcriptionId:v,noteId:P},h=(0,f.tB)();let p=await(0,c.X8)(_,n,l),w=0;for(p.hallucinated&&(y+=1);!1===p.processed&&w<S.length;){const e=_;$(),console.log(`remote worker retrying after failed request to ${e} with fallback host ${_} (retry ${w})`),p=await(0,c.X8)(_,n,l),w+=1}{for(const e of p.segments)e.hallucinated=p.hallucinated,null!==(a=e.texts)&&void 0!==a||(e.texts=p.texts);const{models:e=[O]}=p;for(const t of p.segments)null!==(d=t.models)&&void 0!==d||(t.models=e)}!1===p.processed?(console.log("remote worker failed to transcribe audio after attempting with fallbacks"),i+=1):w&&console.log(`remote worker successfully transcribed after ${w} retries`),o+=w;const b=p.segments.every((0,r.by)("embedding")),k=p.segments.every((0,r.by)("xvect"));A&&b&&(p.segments.forEach((e=>e.embedding=(0,m.S8)(u.xD?new Float32Array(e.embedding):e.embedding))),M&&p.segments.forEach((e=>{var t;return e.xvect=u.xD?new Float32Array(e.xvect):null!==(t=e.xvect)&&void 0!==t?t:[]}))),p.segments.forEach((e=>e.processor=_)),p.processor=_;const x=A&&b?p.segments.map((0,r.by)("embedding")).map((0,r.by)("buffer")):[],T=A&&M&&k?p.segments.map((0,r.by)("xvect")).map((0,r.by)("buffer")):[],N=[n.buffer,...x,...T];I+=.001*((0,f.tB)()-h),"online"===R&&navigator.onLine&&setTimeout(j),s+=1;const D={segments:p.segments.map(g.gj),groupedSegments:void 0};return e(Object.assign(p,{audio:n,...D}),N)}s-=1;const T=null===(h=t.segments)||void 0===h?void 0:h.filter((0,r.by)("text")),N=(0,l.v8)(t.audio,T);C+=t.audio.length/u.NG;const D={transcriptionId:v,noteId:P,dtype:x},B=await Promise.all(N.map((async e=>{const t=T[N.indexOf(e)];let n=k.next(),r=await(0,c.X)(n,e,D);if(!(e=>{let t=e.length;for(;t-- >0;)if(e[t])return!0;return!1})(r)){const t=n;n=k.next(),console.warn(`got invalid embedding from ${t}. retrying with ${n}`),r=await(0,c.X)(n,e,D)}return Object.assign(t,{embedding:(0,m.S8)(r)})})));null!==(p=t.processor)&&void 0!==p||(t.processor=_),I+=.001*((0,f.tB)()-w),s+=1;const L={segments:B.map(g.gj),groupedSegments:void 0},F=B.map((({embedding:e})=>e)).map((0,r.by)("buffer"));return e(Object.assign(t,L),F)}}return new T};var w=n(105),b=n(601),v=n(279);var _=n(758),k=n(794),S=n(901);const x=async e=>{const t=new i,n=(0,a.LV)(t);return await n.init(Object.assign(e,{timeoutMultiplier:k.lg.timeoutMultiplier})),[t,n]},A=async e=>{const t={terminate(){}},n=y();return await n.init(e),[t,n]};let C={},E={};const I=async(e=(0,b.xr)())=>{var t;let n;if(v.I.local.has("active-servers"))n=v.I.local.get("active-servers");else if(e in C)n=C[e];else try{n=await(0,b.BP)(e),v.I.local.set("last-active-servers",n),C[e]=n}catch(e){n=v.I.local.get("last-active-servers",[]),n.length?console.warn("failed to fetch active servers. using last-active-servers",e):console.warn("failed to fetch active servers",e)}(0,r.k4)(n,n);for(const r of n)null!==(t=E[r])&&void 0!==t||(E[r]=(0,b.jQ)(`${(0,b.TB)(e)}://${r}`));return(0,r.Ry)(n)};I();const O=!u.Ll&&!u.nr;class M extends w.Z{constructor(){super(...arguments),this.name="RemoteBackend",this.chunkParams={minDuration:v.I.local.get("remote-backend-min-chunk-duration",10),maxDuration:v.I.local.get("remote-backend-max-chunk-duration",20)},this.segments=[],this.transcribeNodes=(0,r.Ry)(),this.embedNodes=(0,r.Ry)(),this.workers=[],this.ownNodes=[],this.dispose=()=>{for(const e of this.workers)e.terminate();C={},E={}}}async init({type:e,diarize:t=!1,model:s,xvects:o,useMultipleThreads:i,remoteWorkers:a=4,remoteOrigin:c=(0,b.xr)(),...l}={}){const d=await I(c);d.length<5&&!u.ri&&(a=Math.min(Math.round(2.5*d.length),a)),(0,S.Rm)(`spinning up ${a} remote workers`);const h=async()=>{var n;try{const[r,a]=null!==(n=await(async({remoteOrigin:e=(0,b.xr)(),hosts:t=C[e],transcriptionId:n="",type:r="offline",diarize:s=!0,model:o=null,xvects:i=!1,useMultipleThreads:a=O})=>{var c;const l=t.next(),u=`${(0,b.TB)(e)}://${l}`;if(await(null!==(c=E[u])&&void 0!==c?c:E[u]=(0,b.jQ)(u))){const[c,u]=await(a?x:A)({transcriptionId:n,type:r,task:"transcribe",diarize:s,model:o,xvects:i,remoteOrigin:e,host:l,hosts:[...t]});return[c,u]}})({hosts:d,type:e,diarize:t,model:s,xvects:o,remoteOrigin:c,useMultipleThreads:i}))&&void 0!==n?n:[];r&&a&&(this.workers.push(r),this.ownNodes.push(a),this.transcribeNodes.push(a),this.embedNodes.push(a))}catch(e){(0,S.R8)("failed to add transcribe worker",e)}};u.Ll||(window.addEventListener("offline",(()=>{this.ownNodes.forEach((e=>(0,r.TF)(this.transcribeNodes,e))),this.ownNodes.forEach((e=>(0,r.TF)(this.embedNodes,e)))})),window.addEventListener("online",(()=>{this.ownNodes.forEach((e=>this.transcribeNodes.push(e))),this.ownNodes.forEach((e=>this.embedNodes.push(e)))})));const f=[];for(;a-- >0;)f.push(h());return Promise.allSettled(f).then((async()=>{if(!this.transcribeNodes.length)if(await(0,_.j6)()){const r=new((await n.e(452).then(n.bind(n,452))).LocalBackend);r.transcribeNodes=this.transcribeNodes,r.embedNodes=this.embedNodes,r.workers=this.workers;const{dispose:s}=this,{dispose:o}=r;Object.assign(this,{name:"LocalBackend",dispose:()=>[s,o].forEach((e=>e()))}),await r.init({type:e,diarize:t,model:"tiny",...l})}else((e,t={})=>{dispatchEvent(new CustomEvent(e,{detail:t}))})("trigger-fallback","failed to construct remote backend - nodes unreachable")})),this}}},258:(e,t,n)=>{"use strict";n.d(t,{Kg:()=>l,S8:()=>u,gz:()=>c,k8:()=>o,kA:()=>a});var r=n(41);function s(e,t){let n=e.length,r=0;for(;n-- >0;)r+=e[n]*t[n];return r}const o=s,i=(e,t)=>{const n=t.map((t=>1-s(e,t)));return(0,r.i2)([(0,r.i2)(n),(0,r.jk)(n)])},a=(e,t)=>{const n=t.map((t=>o(e,t)));return(0,r.T9)(n)},c=(e,t)=>(0,r.i2)(e.map((e=>i(e,t)))),l=({embedding:e})=>e&&!(e=>{let t=e.length;for(;t-- >0;)if(e[t])return!1;return!0})(e);const u=e=>{const t=1/function n(e){let t=0,n=e.length;for(;n-- >0;){const r=e[n];t+=r*r}return Math.sqrt(t)}(e),r=e.slice();let s=r.length;for(;s-- >0;)r[s]*=t;return r}},211:(e,t,n)=>{"use strict";n.d(t,{Y:()=>c});n(669);var r,s=n(241),o=n(463);let i=!1;try{i=!1}catch(e){}const a=globalThis.setTimeout||(e=>{});class c{}r=c,c.passed=0,c.failed=0,c.testPromises=[],c.expect=(0,o.Gj)(i,((e,t,n="")=>{const s=new Promise((s=>a((async()=>{const i=await(0,o.M_)(e),a=(0,o.M_)(t),c=i===a,l=null!=n?n:e instanceof Function?e.name:"";c?r.passed+=1:(console.error(` failed InlineTest::${l} (expected ${a}, got ${i})`),r.failed+=1),s()}))));return r.testPromises.push(s),s})),a((0,o.Gj)(i,(async()=>{await Promise.all(r.testPromises);const{passed:e,failed:t}=r,n=e+t;console.log(` InlineTest: passed ${e} / ${n} (${(0,s.X1)(e/n)})`),t&&console.log(` InlineTest: failed ${t} / ${n} (${(0,s.X1)(t/n)})`)})),5..seconds)},383:(e,t,n)=>{"use strict";n.d(t,{Bp:()=>m,ET:()=>p});var r,s=n(712),o=n(831),i=n(41),a=n(600),c=n(279),l=n(687),u=n(75),d=n(43);const h={name:"default",mocksConfiguration:{}},{stringify:f}=JSON;class p{static get activeConfiguration(){return c.I.session.get("active-test-configuration",h)}static clearActiveConfiguration(){c.I.session.set("active-test-configuration",h),r.isActive=!1}static setActiveConfiguration(e){this.clearActiveConfiguration(),c.I.session.set("active-test-configuration",e),r.isActive=!0}static async expect(e,t,n=h){r.setActiveConfiguration(n);const s=(0,u.tB)(),o=await e(),i=(0,u.tB)()-s,a=await t(o),{activeConfiguration:c}=r;return r.clearActiveConfiguration(),"boolean"==typeof a?{passed:a,configuration:c,elapsed:i,refs:{}}:{...a,configuration:c,elapsed:i}}}r=p,p.pass=Symbol(),p.watchableRegistry={},p.mockable=(e,t)=>{const n={};return Object.assign(((...s)=>{var o;const i=(null!==(o=n[r.activeConfiguration.mocksConfiguration[e]])&&void 0!==o?o:t)(...s);return i===r.pass?t(...s):i}),{addMock(e,t){n[e]=t}})},p.watchable=(e,t)=>r.watchableRegistry[e]=(e=>{const t=[],n={get wasCalled(){return t.length>0},get wasCalledAndErrored(){return t.length>0&&t.some((0,i.by)("2"))},wasCalledWithArgs:e=>{const n=f(e);return t.some((([e])=>f(e)===n))},wasCalledWithArgsAndReturned:(e,n)=>{const r=f(e),s=f(n);return t.some((([e,t])=>f(e)===r&&f(t)===s))},wasCalledWithArgsAndErrored:(e,n)=>{const r=f(e),s=f(n);return t.some((([e,,t])=>t&&f(e)===r&&f(t)===s))},reset:()=>t.length=0};return Object.assign(((...n)=>{var s,o;if(!r.isActive)return e(...n);let i;const a=[n];try{i=e(...n),a[1]=i}catch(e){i=e,a[2]=null!==(s=e.message)&&void 0!==s?s:null!==(o=e.reason)&&void 0!==o?o:e}return t.push(a),i}),n)})(t),p.lookupWatchable=e=>{if(e in r.watchableRegistry)return r.watchableRegistry[e];throw Error(`key ${e} does not exist in watchable registry`)},p.isActive=!1,p.smokeTest=async e=>{var t,n,c,h;const f=null!==(t=r.smokeTestBuffer)&&void 0!==t?t:r.smokeTestBuffer=await a.uU.fromTo("/brimley.wav","Buffer");let p=(0,u.t)();const m=new s.fm(f.getChannelData(0)),{4:{audio:g}}=await m.getSegmentSlices(),y=(0,d.u)(),w=(0,d.u)(),b={passed:!1,elapsed:0,processingTime:0,words:0,error:null};try{p=(0,u.t)();const t=await(0,o.X8)(e,g,{model:"turbo",transcriptionId:y,noteId:w,diarize:!0,timeout:30..seconds});if(!t.processed)throw Error("Transcript Not Processed");const r=(0,u.t)()-p,s=null===(n=null==t?void 0:t.text)||void 0===n?void 0:n.length,a=null===(c=null==t?void 0:t.segments)||void 0===c?void 0:c.length,d=null===(h=null==t?void 0:t.segments)||void 0===h?void 0:h.every((0,i.by)("embedding")),f=!t.errored;b.passed=Boolean(s&&a&&d&&f),b.elapsed=r,b.processingTime=t.processingTime,b.words=(0,l.aL)(t.text).length,f&&!d&&(b.error="No Embeddings")}catch(e){b.passed=!1,b.error=e.message||e.reason,console.error(e)}return b},setTimeout((()=>p.clearActiveConfiguration()),16);const{mockable:m,pass:g}=p},831:(e,t,n)=>{"use strict";n.d(t,{RO:()=>u,X:()=>l,X8:()=>c});var r=n(669),s=n(148),o=n(693),i=n(600);const a=async(e,t,{timeout:n=1e9}={})=>{const r=t instanceof File?[(await i.uU.fromTo(t,"Float32Array")).buffer]:[t.buffer],o=new Blob(r,{type:"application/octet-stream"}),a=new FormData;a.append("audio",o);try{return await s.Ay.timeout(n,e,{method:"POST",body:a,mode:"cors"})}catch(e){console.error(e)}},c=async(e,t,{model:n,xvects:s=!1,transcriptionId:o="",noteId:i="",diarize:c,numSpeakers:l,clients:u,clinicians:d,timeout:h})=>{const f=`?${`&diarize=${c}`}${`&id=${o}`}${`&noteId=${i}`}${n&&n!==r.pE?`&model=${n}`:""}${`&xvects=${s}`}${[l?`&numSpeakers=${l}`:"",d?`&clinicians=${d}`:"",u?`&clients=${u}`:""].join("")}`,p=`${e.includes("localhost")?"http":"https"}://${e}/${t instanceof File?"api/transcribe-file":"api/transcribe"}${f}`;return await(async e=>{let t;if(!e)return{processed:!1};try{if(404===e.status)throw void 0;t=await e.json(),!1!==t.processed&&(t.processed=!0)}catch(e){t={processed:!1},console.error(e)}return t})(await a(p,t,{timeout:h}))},l=async(e,t,{dtype:n="fp32",transcriptionId:r="",noteId:i=""})=>{const c=`?${`&id=${r}`}${`&noteId=${i}`}${`&dtype=${n}`}`,l=`${e.includes("localhost")?"http":"https"}://${e}/api/embed${c}`,u=await a(l,t);return"string"==typeof(d=await(0,s.Gg)(u)).embedding?(0,o.E)(d.embedding):Float32Array.from(d);var d},u=async e=>(await e).default},352:(e,t,n)=>{"use strict";n.d(t,{F:()=>a});var r=n(601),s=n(148),o=n(794);const i=e=>e.replace(/\/{1,}/g,"/").replace(/^(https?)\:\//,"$1://"),a={req:(e="GET",t)=>({method:e,cache:"no-cache",headers:{"Content-Type":"application/json"},...t?{body:JSON.stringify(t)}:null}),async get(e="",t=(0,r.xr)()){const n=await s.Ay.timeout(o.lg.getAdjustedTimeout(1e4),i(`${t}/api/${e}`),{mode:"cors"});return await n.json()},async post(e="",t={},n=(0,r.xr)()){const o=i(`${n}/api/${e}`),a=await(0,s.Ay)(o,{mode:"cors",method:"POST",body:JSON.stringify(t),headers:{Accept:"application/json","Content-Type":"application/json"}}),{status:c}=a;if(400===c||404===c)throw Error(`post request to ${o} was rejected`);return await a.json()}}},41:(e,t,n)=>{"use strict";n.d(t,{Am:()=>T,BP:()=>N,Bp:()=>g,FL:()=>B,HV:()=>h,JZ:()=>E,Jt:()=>q,KC:()=>J,M1:()=>P,Mq:()=>R,Os:()=>z,Pe:()=>G,Ph:()=>m,QL:()=>D,Ry:()=>k,S8:()=>X,T9:()=>I,TF:()=>S,WH:()=>U,Y6:()=>f,by:()=>y,cz:()=>A,i2:()=>C,i8:()=>p,jk:()=>O,k4:()=>v,mx:()=>L,yT:()=>w});var r=n(241),s=n(410),o=n(436);const{floor:i,max:a,min:c,pow:l,random:u,sqrt:d}=Math,h=e=>e[e.length-1],f=function(e,t=(e=>0)){return e.slice().sort(((e,n)=>t(e)-t(n)))},p=function(e,t=(e=>0)){return e.slice().sort(((e,n)=>t(n)-t(e)))},m=function(e,t){let n=Number.MIN_SAFE_INTEGER,r=e[0],s=e.length;for(;s-- >0;){const o=t(e[s]);n=o>n?o:n,n===o&&(r=e[s])}return r},g=function(e,t){let n=Number.MAX_SAFE_INTEGER,r=e[0],s=e.length;for(;s-- >0;){const o=t(e[s]);n=o<n?o:n,n===o&&(r=e[s])}return r};new Intl.Collator("en");function y(e,t){return n=>null==t?n[e]:t instanceof Function?t(n[e]):n[e]===t}const w=e=>e[i(e.length*u())],b=e=>i(u()*e.length),v=(e,t=e.slice())=>{for(let n=0;n<e.length;n+=1){let r=n,s=b(e);[t[r],t[s]]=[t[s],t[r]]}return t},_=(y("length"),(e,t)=>e[t%e.length]),k=(e=[])=>{let t=0;return Object.assign(e,{next(n=(e=>!0)){let r=_(e,t);for(t+=1;!n(r);)r=_(e,t),t+=1;return r},peekNext:()=>_(e,t+1),add(t){e.includes(t)||e.push(t)},delete(t){x(e,t)},set(t){F(e,t)}})},S=function(e,t){const n=e.indexOf(t);return-1!==n&&e.splice(n,1),t},x=function(e,t){return L(e,e.filter((e=>e!==t)))},A=(e,t=(e=>e))=>{let n=0;for(let r=0;r<e.length;r+=1)n+=t(e[r]);return n},C=(e,t=(e=>e))=>A(e,t)/e.length,E=(e,t=(e=>e))=>{const n=[].sort.call(e.map(t),((e,t)=>e-t)),r=n.length,s=i(.5*r);return r%2?n[s]:.5*(n[s-1]+n[s])},I=(e,t=(e=>e))=>a.apply(null,e.map((e=>t(e)))),O=(e,t=(e=>e))=>c.apply(null,e.map((e=>t(e)))),M=(e,t=(e=>e))=>{e=e.map((e=>t(e)));const n=C(e),r=[];let s=e.length;for(;s-- >0;)r.push(l(e[s]-n,2));return C(r)},R=(e,t=(e=>e))=>{var n;const r=new Map;for(const s of e){const e=t(s);r.set(e,(null!==(n=r.get(e))&&void 0!==n?n:0)+1)}const s=Math.max.apply(null,[...r.values()]);return[...r.keys()].find((e=>r.get(e)===s))},$={sum:A,mean:C,median:E,mode:R,min:O,max:I,range:(e,t=(e=>e))=>(e=e.map((e=>t(e))),I(e)-O(e)),deviation:(e,t=(e=>e))=>d(M(e,t)),variance:M},j=Object.keys($),P=(e,t=j,n=(e=>e))=>{const s={};for(const r of t)s[r]=$[r](e,n);const o=(t=r.LI)=>{const n=Object.keys(s).map((e=>`${e}: ${null==s[e]?"":t(s[e])}`));return n.unshift(`samples: ${e.length}`),n.join(", ")},i=o;return Object.defineProperties(s,{format:{value:o,enumerable:!1},toString:{value:i,enumerable:!1}}),s},T=(e,t=(e=>e))=>{const n=new Map;for(const r of e)n.set(t(r),r);return[...n.values()]};function N(e){if(!e.length)return new Float32Array(0);const t=new Float32Array(e[0].length);for(let n=0;n<e[0].length;n+=1)for(const r of e)t[n]+=r[n];return t}const D=(e,t)=>{const n=Array.from({length:e});return t instanceof Function?n.map(((e,n)=>t(n))):n.fill(null!=t?t:0)},B=e=>e.indexOf(I(e)),L=(e,t)=>{let{length:n}=t;for(e.length!==n&&(e.length=n);n-- >0;)e[n]=t[n];return e},F=L,z=(e,t=(e=>e))=>{const n=new s.Ou((()=>[]));for(let r=0;r<e.length;r+=1){const s=e[r];n.get(t(s,r)).push(s)}return[...n.values()]},U=(e,t=(e=>e))=>{const n=new s.Ou((()=>[]));for(let r=0;r<e.length;r+=1){const s=e[r];n.get(t(s,r)).push(s)}const r=new Map([...n.entries()]);return Object.assign(r,{toObject:()=>Object.fromEntries([...r.entries()]),toCountMap(){const e=[...r.entries()].map((([e,t])=>[e,t.length]));return Object.fromEntries(p(e,y("1")))}})},q=(e,t)=>t<1?e[Math.floor(t*e.length)]:e[Math.floor(t)];let{from:W}=Array;const G=(e,t=((e,t)=>e))=>("number"==typeof e?D(e):e).map(((e,n,r)=>t(n,r))),X=(e,t=(e=>e))=>{const n=O(e,t),r=I(e,t);return e.map((e=>(0,o.V0)(n,r,e)))},J=e=>e.reduce(((e,t)=>e.union(t)),new Set)},600:(e,t,n)=>{"use strict";n.d(t,{uU:()=>u,gh:()=>l});var r=n(612),s=n.n(r),o=n(78),i=n(669);class a{constructor(e){if(!e)throw TypeError("options argument is required");if(!e.sampleRate)throw TypeError("options.sampleRate is required");if(e.sampleRate<3e3||e.sampleRate>768e3)throw TypeError("options.sampleRate must be within 3000..768000");if(!e.length)throw TypeError("options.length must be more than 0");this.sampleRate=e.sampleRate,this.numberOfChannels=e.numberOfChannels||1,this.length=0|e.length,this.duration=this.length/this.sampleRate,this._data=new Float32Array(this.length*this.numberOfChannels),this._channelData=[];for(let e=0;e<this.numberOfChannels;e++)this._channelData.push(this._data.subarray(e*this.length,(e+1)*this.length))}getChannelData(e){if(e>=this.numberOfChannels||e<0||null==e)throw Error("Cannot getChannelData: channel number ("+e+") exceeds number of channels ("+this.numberOfChannels+")");return this._channelData[e]}copyFromChannel(e,t,n){null==n&&(n=0);for(var r=this._channelData[t],s=n,o=0;s<this.length&&o<e.length;s++,o++)e[o]=r[s]}copyToChannel(e,t,n){var r=this._channelData[t];n||(n=0);for(var s=n,o=0;s<this.length&&o<e.length;s++,o++)r[s]=e[o]}}var c=n(693);function l(e){const t=new AudioContext({sampleRate:i.NG}),n=t.createBuffer(1,e.length,i.NG);return n.getChannelData(0).set(e),t.close(),n}class u{static get resampler(){return e=>{const t=new OfflineAudioContext(1,e.duration*i.NG,i.NG),n=t.createBufferSource();return n.buffer=e,n.connect(t.destination),n.start(),t.startRendering()}}static get slicer(){var e;return null!==(e=this._slicer)&&void 0!==e?e:this._slicer=new(s())({sampleRate:i.NG})}static fromTo(e,t,...n){const r=u.from(e);return r instanceof Promise?r.then((async e=>e.to(t,...n))):r.to(t,...n)}static fromSync(e){if(e instanceof Array&&(e=Float32Array.from(e)),e instanceof Float32Array){const t=l(e);return new u(t)}if(e instanceof ArrayBuffer){const t=l(new Float32Array(e));return new u(t)}if(e instanceof a)return new u(e);const t=+e;return new u(new a({numberOfChannels:1,sampleRate:i.NG,length:t==t?t:1e3}))}static async fromAsync(e){if("upload"===`${e}`.toLowerCase()){const{files:t}=await(async({accept:e="audio",directory:t=!1,multiple:n=t,keepInput:r=!0}={})=>{const s=document.createElement("input");s.type="file",s.accept=e,s.multiple=n,s.webkitdirectory=t,s.click();const o=await new Promise((e=>s.onchange=async t=>{const{files:n}=t.target;e(n),r||s.remove()}));return{input:s,files:Array.from(o)}})();e=t[0]}if(e instanceof Blob){const t=URL.createObjectURL(e),n=await u.resampler((await this.slicer.fetchAudio(t))[0]);return URL.revokeObjectURL(t),new u(n)}if("string"==typeof e)try{const[t]=await this.slicer.fetchAudio(e),n=await u.resampler(t);return new u(n)}catch(t){console.warn(t);const n=l((0,c.E)(e));return new u(n)}if(e instanceof HTMLAudioElement)return await u.from(e.src);const t=+e;return new u(new a({numberOfChannels:1,sampleRate:i.NG,length:t==t?t:1e3}))}static from(e){return"number"==typeof e||e instanceof Array||e instanceof Float32Array||e instanceof ArrayBuffer||e instanceof a?u.fromSync(e):u.fromAsync(e)}constructor(e){this.audioBuffer=e,this.out={Buffer:()=>this.audioBuffer,Float32Array:()=>this.audioBuffer.getChannelData(0),Array:()=>this.audioBuffer.getChannelData(0),Audio:()=>function e(t){const n=(0,o.lZ)(t),r=new Blob([n],{type:"audio/wav"}),s=URL.createObjectURL(r);return new Audio(s)}(this.audioBuffer.getChannelData(0)),Blob:()=>u.slicer.export(this.audioBuffer).blob,File:()=>{const e=this.to.Blob();return new File([e],"audio.wav",{type:"audio/mpeg"})},Wav:()=>(0,o.lZ)(this.audioBuffer.getChannelData(0)),String:()=>URL.createObjectURL(this.to.Blob()),URL:()=>this.out.String(),Base64:()=>(0,c.n)(this.audioBuffer.getChannelData(0)),Download:(e="audio.wav")=>u.slicer.download(this.to.Blob(),e),Duration:e=>{let t=this.to.Array();return t=e>this.audioBuffer.duration?Float32Array.from([...t,...t.slice(0,Math.floor(i.NG*e)-t.length)]):t.slice(0,Math.floor(e*i.NG)),u.from(t)},Segment:e=>{const t=this.to.Array();return u.from(t.slice(Math.floor(e.start*i.NG),Math.floor(e.end*i.NG)))}},this.to=Object.assign(((e,...t)=>{e=e.toLowerCase();const n=Object.fromEntries(Object.entries(this.out).map((([e,t])=>[e.toLowerCase(),t])));return e in n?n[e].apply(n[e],t):this.out.String()}),this.out),this.audioBuffer=e}static async play(e){return(await u.from(e)).play()}async play(){return this.to("Audio").play()}static async compress(e){const{compressor:t}=await n.e(405).then(n.bind(n,405));return u.from(await t.process(await u.fromTo(e,"Buffer")))}}},78:(e,t,n)=>{"use strict";n.d(t,{Q7:()=>a,cg:()=>d,j3:()=>u,lZ:()=>c,v8:()=>i});n(41);var r=n(669),s=n(436);const o=e=>Math.floor(e*r.NG),i=(e,t)=>t.map((e=>t=>{const n=t.end-t.start,s=e.length/r.NG,i=Math.max(0,r.ig-n);if(i){const e={start:t.start-i/2,end:t.end+i/2};e.start<0?(e.end+=Math.abs(e.start),e.start=0):e.end>s&&(e.start-=e.end-s),t.start=e.start,t.end=e.end}return e.slice(o(t.start),o(t.end))})(e)),a=(e,t)=>{e=(0,s.qE)(e);const n=r.NG/t,o=-.008/Math.log(1-e);return 1-Math.exp(-1/n/o)},c=e=>{let t=44;const n=new ArrayBuffer(t+4*e.length),s=new DataView(n);l(s,0,"RIFF"),s.setUint32(4,36+4*e.length,!0),l(s,8,"WAVE"),l(s,12,"fmt "),s.setUint32(16,16,!0),s.setUint16(20,3,!0),s.setUint16(22,1,!0),s.setUint32(24,r.NG,!0),s.setUint32(28,4*r.NG,!0),s.setUint16(32,4,!0),s.setUint16(34,32,!0),l(s,36,"data"),s.setUint32(40,4*e.length,!0);for(let n=0;n<e.length;++n,t+=4)s.setFloat32(t,e[n],!0);return n};function l(e,t,n){for(let r=0;r<n.length;++r)e.setUint8(t+r,n.charCodeAt(r))}const u=(e,t=0,n=e.length)=>{let r=0;for(let s=t;s<n;s+=1){const t=e[s];r+=t*t}const s=r/e.length;return Math.sqrt(s)};const d=(e,t={sampleRate:r.NG})=>{const n=new OfflineAudioContext(r.L9,e.duration*t.sampleRate,t.sampleRate),s=n.createBufferSource();return s.buffer=e,s.connect(n.destination),s.start(),n.startRendering()}},693:(e,t,n)=>{"use strict";function r(e){const t=atob(e),n=t.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=t.charCodeAt(e);return new Float32Array(r.buffer)}n.d(t,{E:()=>r,n:()=>s});const s=n(669).Ll?e=>Buffer.from(e.buffer).toString("base64"):e=>{const t=new Uint8Array(e.buffer),n=Array.from(t,(e=>String.fromCharCode(e))).join("");return btoa(n)}},669:(e,t,n)=>{"use strict";n.d(t,{Bd:()=>g,Fr:()=>u,KV:()=>b,L9:()=>i,Ll:()=>h,NG:()=>o,Qp:()=>O,RK:()=>c,RS:()=>A,YX:()=>k,_o:()=>v,dv:()=>E,gm:()=>r,iF:()=>S,ig:()=>l,jV:()=>x,nr:()=>_,nu:()=>a,pE:()=>C,ri:()=>f,vu:()=>I,xD:()=>m});const r="undefined"!=typeof navigator&&navigator.userAgent.includes("Firefox");let s=48e3;if("undefined"!=typeof AudioContext){const e=new AudioContext;s=e.sampleRate,e.close()}const o=r?s:16e3,i=1,a=256,c=256,l=1,u=!!globalThis.navigator&&/Mobi|Android/i.test(navigator.userAgent),d="undefined"==typeof location?"":location.search,h="undefined"!=typeof process,f=!h&&"undefined"!=typeof location&&location.pathname.includes("/dashboard"),p="undefined"!=typeof AudioWorkletProcessor,m="undefined"!=typeof DedicatedWorkerGlobalScope||p,g=!h&&(m||p||"undefined"!=typeof navigator),y="undefined"!=typeof location&&("localhost"===location.hostname||location.href.startsWith("blob:http://localhost")),w=g&&"undefined"!=typeof location&&(location.host.includes("nuiq.com")||location.href.startsWith("blob:https://nuiq.com")||y&&"3004"!==location.port),b=("undefined"!=typeof location&&(location.host.includes("stage.nuiq.com")||location.href.startsWith("blob:https://stage.nuiq.com")),!!h||w&&!y),v=y||/debug(\=true)?($|&)/.test(d),_="undefined"!=typeof navigator&&/Safari/i.test(navigator.userAgent)&&!navigator.userAgent.includes("Chrome"),k=d.includes("useDevServer=true")?"asrd.nuzi.ai":"asr.nuzi.ai",S=`https://${k}`,x="https://asr-backup.nuzi.ai",A="small",C="turbo",E=(Math.PI,3e4),I=3e4,O=2.5},43:(e,t,n)=>{"use strict";n.d(t,{u:()=>r});const r=()=>crypto.randomUUID().split("-")[0]},784:(e,t,n)=>{"use strict";n.d(t,{v:()=>r});class r extends EventTarget{constructor(){super(...arguments),this.handlerMap=new WeakMap}addEventListener(e,t){const n=({detail:e})=>t(e);return this.handlerMap.set(t,n),super.addEventListener(e,n)}removeEventListener(e,t){const n=this.handlerMap.get(t);return super.removeEventListener(e,n)}dispatchEvent(e,t){return super.dispatchEvent(new CustomEvent(e,{detail:t}))}}},981:(e,t,n)=>{"use strict";n.d(t,{q:()=>u});var r=n(352),s=n(669),o=n(601),i=n(315);const a={useLocalTranscription:!1,useMediumModelForSummarize:!1,useAllowForceDisable:!0,useInferSpeakerNames:!1,useDeduceSpeakerNames:!1},c={},l=async(e=(0,o.xr)())=>{var t;try{return null!==(t=c[e])&&void 0!==t?t:c[e]=await r.F.get("features",e)}catch(t){return console.log("error fetching features",t),c[e]={...a}}};s.Ll||s.ri||l();const u=Object.assign(l,{async get(e){var t,n;const r=null!==(t=await l())&&void 0!==t?t:{};return null!==(n=i.f[e])&&void 0!==n?n:r[e]}})},148:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>o,Gg:()=>a,TB:()=>i});const r=(e="GET")=>async(t,...n)=>await fetch(n[0],{method:e,...n[1],signal:AbortSignal.timeout(t)}),s=Object.assign(fetch,{cors:(...e)=>(e[1]?e[1].mode="cors":e[1]={mode:"cors"},fetch(...e)),timeout:Object.assign(r(),{post:r("POST")})}),o=s,i=(e,t,n,r)=>(null==r?fetch:(...e)=>s.timeout(r,...e))(e,{...n,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(null!=t?t:{})}),a=async e=>await(null==e?void 0:e.json())},241:(e,t,n)=>{"use strict";n.d(t,{ZH:()=>m,kR:()=>g,p0:()=>p,z3:()=>x,kf:()=>v,p_:()=>A,n:()=>S,Ik:()=>C,X1:()=>y,LI:()=>w});n(75);var r=n(873),s=n(211);const o=new Map,i=e=>{const t=JSON.stringify(e);return o.has(t)?o.get(t):(o.set(t,e),e)};s.Y.expect(i({a:1,b:2,c:3}),i({a:1,b:2,c:3}));const{floor:a,max:c,round:l}=Math,{isArray:u}=Array,{entries:d}=Object,{ListFormat:h}=Intl,f={seconds:1,ms:.001},p=(e,t="seconds")=>{const n=l(f[t]*e%60),r=a(f[t]*e/60);return r?S`${r} minutes, ${n} seconds`:S`${n} seconds`},m=e=>{var t;return`${(null!==(t=e[0])&&void 0!==t?t:"").toUpperCase()}${e.slice(1)}`},g=e=>e.split(" ").map(m).join(" "),y=e=>v(e)?`${w(100*+e)}%`:"0%",w=e=>e.toFixed(/\./.test(`${e}`)?2:0),b=new Set(["boolean","symbol"]),v=e=>!b.has(typeof e)&&""!==e&&+e==+e,_=/\./,k=e=>{const t=`${e}`;let n=_.test(t);const r=(n?t.split(_)[0]:t).length>3;n&&(n=!r);const s=c(((e,t=Infinity)=>{const n=`${e}`.split(".")[1];if(!n)return 2;const r=n.split("").findIndex((e=>"0"!==e))+1;return r>t?2:r})(e,4),2);return n?(+e).toFixed(s):r?(e=>(new Intl.NumberFormat).format(e))(l(e)):t},S=(e,...t)=>(t=t.map((e=>v(e)?k(e):e)),String.raw({raw:e},...t)),x=e=>"string"==typeof e?e:JSON.stringify(e,["message","arguments","type","name","stack"]),A=(e,{joiner:t=", ",emptyText:n="none"}={})=>u(e)?e.length?e.join(t):n:e,C=(e,{joiner:t="\n",listJoiner:n=", ",emptyText:s="none",indentLevel:o=0}={})=>d(e).map((([e,i])=>{const a=(0,r.sO)(i),c=u(i)||a,l=!a&&!c,d=l?`${t}${t}`:" ",h=l?t:"",f="\t".repeat(o);return S`${f}${e}:${d}${c?A(i,{joiner:n,emptyText:s}):C(i,{joiner:t,listJoiner:n,emptyText:s,indentLevel:o+1})}${h}`})).join(t);new h("en",{style:"long",type:"conjunction"})},463:(e,t,n)=>{"use strict";n.d(t,{Bb:()=>c,sg:()=>i,Pm:()=>l,Gj:()=>a,Oo:()=>s,vX:()=>r,M_:()=>o});["upload","listen","summarize","telehealth"].map((e=>`finished-${e}-transcriptions`));const r=(e,{mode:t="chain"}={})=>{let n,r=!1;const s=async(...o)=>r?"chain"===t?n.then((()=>s(...o))):n:(r=!0,n=new Promise((async(t,n)=>{try{t(await e(...o))}catch(e){console.error(e),n(e)}finally{r=!1}})),n);return s},s=e=>{let t,n=!1;const r=(...r)=>(n||(n=!0,t=e(...r)),t);return Object.defineProperty(r,"hasRun",{get:()=>n}),r},o=(e,t=void 0)=>e instanceof Function?e(t):e,i=(e,t=100,n=!0)=>{let r,s=-t,o=0;return(...i)=>{const a=performance.now();return a-s>=t?(s=a,o&&clearTimeout(o),r=e(...i)):(o&&clearTimeout(o),n&&(o=setTimeout((()=>r=e(...i)),t)),r)}},a=(e,t,n=(()=>{}))=>(...r)=>o(e)?t(...r):n(...r),c=(e,t,n=null)=>e.apply(n,t),l=async(e=4)=>await new Promise((t=>setTimeout(t,e)))},601:(e,t,n)=>{"use strict";n.d(t,{BP:()=>m,HI:()=>h,TB:()=>u,jQ:()=>p,xr:()=>d});var r=n(383),s=n(41),o=n(669),i=n(148),a=n(463),c=n(794),l=n(279);const u=e=>e.includes("localhost")?"http":"https",d=()=>l.I.local.get("remote-origin",o.iF),h=()=>l.I.local.get("remote-origin",o.iF).replace(/https?\:\/\//,""),f=l.I.local.get("last-active-servers",[...(0,s.Pe)((0,s.QL)(5),(e=>`asr${e+2}.nuzi.ai`))]),p=(0,r.Bp)("heartbeat",(async(e,{timeout:t=c.lg.getAdjustedTimeout(o.dv)}={})=>{try{const n=await i.Ay.timeout(t,`${e}/api/heartbeat`,{mode:"cors"}),r=await n.json();return 200===n.status&&"number"==typeof r}catch(e){return!1}}));p.addMock("fail-gateway-pass-compute",(async e=>e!==d())),p.addMock("pass-gateway-fail-compute",(async e=>e===d())),p.addMock("fail-all",(async()=>!1));const m=async(e=d())=>{try{const t=await i.Ay.timeout(c.lg.getAdjustedTimeout(o.vu),`${e}/api/report`,{mode:"cors"});if(502===t.status)throw Error("error in local transcription: gateway unreachable");return t.json()}catch(t){return console.log(t),e===o.jV?f:await m(o.jV)}};(0,a.vX)((async(e="asr2.nuzi.ai")=>{try{return(await(0,i.Ay)(`${e}/api/performance-metrics`,{mode:"cors"})).json()}catch(e){return console.log(e),[]}}))},901:(e,t,n)=>{"use strict";n.d(t,{R8:()=>u,Rm:()=>c});var r=n(669);const s=r.KV&&!r._o,o=Object.fromEntries(["log","info","warn","error"].map((e=>[e,s?()=>{}:(...t)=>console[e](...(e=>e.map((e=>"string"==typeof e?e.trim():e)))(t))]))),i={};s||Object.assign(globalThis,{debugData:i});const a=s?()=>{}:(e,t)=>{var n;return null!==(n=i[e])&&void 0!==n||(i[e]=[]),i[e].push(t),o.log(e,t)},c=Object.assign(o.log,{data:a}),{info:l,warn:u,error:d}=o},410:(e,t,n)=>{"use strict";n.d(t,{B8:()=>r,Ou:()=>s,ef:()=>i,xP:()=>o});const r=e=>new Map([...e.entries()].map((e=>e.reverse())));class s extends Map{constructor(e,t=null){super(t),this.getDefault=e,this.getDefault=e}get(e){if(this.has(e))return super.get(e);const t=this.getDefault(e);return this.set(e,t),t}}Map;WeakMap;class o extends Map{constructor(){super(...arguments),this.history=[]}set(e,t){const n=super.set(e,t);return this.history.push([e,t]),n}delete(e){const t=super.delete(e);return this.history.push([e,super.get(e)]),t}}class i extends Map{constructor(e){super(e),this.inverseMap=new Map([...null!=e?e:[]].map((([e,t])=>[t,e])))}key(e){return this.inverseMap.get(e)}value(e){return this.get(e)}static key(e,t){return new i(e.entries()).key(t)}static value(e,t){return new i(e.entries()).value(t)}set(e,t){const n=super.set(e,t);return this.inverseMap.set(t,e),n}delete(e){this.has(e)&&this.inverseMap.delete(this.get(e));return super.delete(e)}clear(){const e=super.clear();return this.inverseMap.clear(),e}}},436:(e,t,n)=>{"use strict";n.d(t,{Cc:()=>s,V0:()=>o,qE:()=>i});const{log10:r}=Math,s=(e,t,n=.5)=>e*(1-n)+t*n,o=(e,t,n)=>t-e?(n-e)/(t-e):0,i=(e=.5,t=0,n=1)=>Math.max(Math.min(e,n),t)},794:(e,t,n)=>{"use strict";n.d(t,{lg:()=>p});var r,s,o,i=n(669),a=n(241),c=n(901),l=n(279),u=n(75);const d={unknown:5,"2g":5,"3g":4,"4g":3,"5g/WiFi":1},h={type:"5g/WiFi",downlink:null,rtt:null,effectiveType:"5g/WiFi",timeoutMultiplier:1},f=null!==(r=globalThis.navigator)&&void 0!==r?r:{};class p{static async getInfo(){const e=await new Promise((async e=>{var t;if(i.Ll)return e(h);const n={type:"unknown",downlink:null,rtt:null,effectiveType:"unknown",timeoutMultiplier:d.unknown},{connection:r}=f;if(r){const{type:e,downlink:t,rtt:s,effectiveType:o}=r;n.type=null!=e?e:"unknown",n.downlink=null!=t?t:null,n.rtt=null!=s?s:null,n.effectiveType=null!=o?o:"unknown"}const s=(0,u.tB)(),o=i.ri?`/julie.wav?q=${Date.now()}`:`${location.origin}/assets/audios/Free_Test_Data_1OMB_MP3.mp3?q=${Date.now()}`;let a,l=n.effectiveType;try{const e=await fetch(o,{cache:"no-store"}),t=await e.blob(),n=(0,u.tB)()-s;a=8*t.size/1024/1024/n.in("seconds"),l=a<.1?"2g":a<.5?"3g":a<5?"4g":"5g/WiFi"}catch(e){(0,c.R8)(e),a=0}e({...n,type:l,effectiveType:l,downlink:a,timeoutMultiplier:null!==(t=d[l])&&void 0!==t?t:d.unknown})}));return(0,c.Rm)(`found network info: ${(0,a.Ik)(e)}`),e}static getAdjustedTimeout(e,t=1){var n,r,s;null!==(n=p.timeoutMultiplier)&&void 0!==n||(p.timeoutMultiplier=i.xD?self["timeout-multiplier"]:l.I.local.get("timeout-multiplier",d[null!==(s=null===(r=f.connection)||void 0===r?void 0:r.effectiveType)&&void 0!==s?s:"unknown"])),i.xD&&("timeout-multiplier"in self?(0,c.Rm)(`worker: received 'timeout-multiplier' of ${p.timeoutMultiplier} from self`):(0,c.R8)("worker: key 'timeout-multiplier' missing on self - set this to adjust timeouts properly"));const{timeoutMultiplier:o=2}=p;return t*o*e}}p.timeoutMultiplier=i.xD?self["timeout-multiplier"]:l.I.local.get("timeout-multiplier",d[null!==(o=null===(s=f.connection)||void 0===s?void 0:s.effectiveType)&&void 0!==o?o:"unknown"]),i.xD||p.getInfo().then((({timeoutMultiplier:e})=>{l.I.local.set("timeout-multiplier",p.timeoutMultiplier=e),(0,c.Rm)(`set timeout multiplier to ${e}`)}))},873:(e,t,n)=>{"use strict";n.d(t,{d4:()=>u,sO:()=>a,vq:()=>h});n(41);const{fromEntries:r,keys:s}=Object,o=["string","number","boolean"],i=[null,void 0];function a(e){const t=typeof e;return o.includes(t)||i.includes(e)}const{parse:c,stringify:l}=JSON,u=(e,t)=>Object.fromEntries(Object.keys(e).map((n=>[t(n),e[n]]))),d=e=>(e=>[...Object.keys(e),...Object.getOwnPropertySymbols(e).filter((t=>{var n;return null===(n=Object.getOwnPropertyDescriptor(e,t))||void 0===n?void 0:n.enumerable}))])(e).map((t=>[t,e[t]])),h=(e,t)=>{for(const[n,r]of d(Object.getOwnPropertyDescriptors(t)))r.enumerable&&(r.get||r.set)&&Object.defineProperty(e,n,r);return e}},315:(e,t,n)=>{"use strict";n.d(t,{f:()=>o});const r=new URLSearchParams("undefined"!=typeof location?location.search:""),s=()=>history.replaceState({},document.title,`?${r}`),o=new Proxy(r,{get(e,t){const n=r.get(t);try{return JSON.parse(n)}catch(e){return n}},set:(e,t,n)=>(r.set(t,n),s(),!0),deleteProperty:(e,t)=>(r.delete(t),s(),!0),has:(e,t)=>r.has(t)})},803:(e,t,n)=>{"use strict";n.d(t,{A3:()=>c,Ji:()=>h,Vr:()=>u,ed:()=>a,kf:()=>l,nZ:()=>s,xo:()=>d});var r=n(211);const s=/(?:(?:\s[.,?!:;'"])|(?:[.,?!:;'"]\s)|[\s.,?!:;])+/g,o="Okay, so good evening, everyone. I want to say welcome to the Substance Abuse Support Group. I'm Courtney and I will be the facilitator or the group leader of this group and I just want to say welcome first and I want to just kind of briefly go over some some rules, you know, I don't necessarily, you guys don't have to be on mute if you don't want to be, but I don't want anyone talking over anyone else or cutting them off.",i=["Okay","so","good","evening","everyone","I","want","to","say","welcome","to","the","Substance","Abuse","Support","Group","I'm","Courtney","and","I","will","be","the","facilitator","or","the","group","leader","of","this","group","and","I","just","want","to","say","welcome","first","and","I","want","to","just","kind","of","briefly","go","over","some","some","rules","you","know","I","don't","necessarily","you","guys","don't","have","to","be","on","mute","if","you","don't","want","to","be","but","I","don't","want","anyone","talking","over","anyone","else","or","cutting","them","off",""];r.Y.expect((()=>o.split(s).join("::")),(()=>i.join("::")));const a=/^rgba?\(\d+,\s?\d+,\s?\d+,?\s?(?:\d+\s?)?\)$/,c=/^.+\@.+\..+$/g;r.Y.expect(c.test("test@email.com"),!0),r.Y.expect(c.test("123 test address st., denver co 80201"),!1);const l=/\d+ .+\,?.+[A-Z]{2}\,? ?\d{5}\-?\d{0,4}/;r.Y.expect(l.test("72 Applegate Drive Taunton, MA 02780"),!0),r.Y.expect(l.test("723 Applegate Dr, Taunton, MA 02780"),!0),r.Y.expect(l.test("7 Applegate Ln., Taunton MA 02780"),!0),r.Y.expect(l.test("72 Applegate Way, Taunton MA 02780-4052"),!0),r.Y.expect(l.test("Applegate Way, Taunton MA 02780-4052"),!1),r.Y.expect(l.test("42 Applegate Way, Taunton MA"),!1),r.Y.expect(l.test("42 Applegate Way, Taunton 02780"),!1);const u=/\d{3}\-\d{2}\-\d{4}/;r.Y.expect(u.test("111-11-1111"),!0);const d=/(\d+\-)+\d+/,h=/^(?:\$\s*\d+(\.\d{2})?\s*|\s*\d+(\.\d{2})?\s*\$)$/;r.Y.expect(h.test("$24.40"),!0),r.Y.expect(h.test("$ 24.40"),!0),r.Y.expect(h.test("$\n24.40"),!0),r.Y.expect(h.test("24.40 $"),!0),r.Y.expect(h.test("24$"),!0),r.Y.expect(h.test("24"),!1),r.Y.expect(h.test("$ 24.3432"),!1)},516:(e,t,n)=>{"use strict";n.d(t,{gZ:()=>d,gj:()=>u,mL:()=>c});var r=n(41),s=n(436),o=n(803),i=n(687);const a=e=>e.end-e.start,c=e=>{let t=e.speaker;const n={...e,duration:a(e),isSilence:!1,componentSegments:[e],get speaker(){return t},set speaker(e){t=e;for(const t of n.componentSegments)t.speaker=e}};return n},l=e=>e.replaceAll(o.nZ,""),u=e=>{var t,n;const o=(e=>(e.words?e.words.map((0,r.by)("word")):(0,i.aL)(e.text)).map(l))(e);let{words:a}=e;if(null==a){const t=(0,r.cz)(o,(e=>e.length));let n=0;const{start:i=0,end:c=0}=e;a=o.map((e=>{const r=(0,s.Cc)(i,c,n/t),o=(0,s.Cc)(i,c,(n+e.length)/t);return n+=e.length,{word:e,start:r,end:o}}))}const c=null!==(t=e.wordsSet)&&void 0!==t?t:new Set(o);return{...e,wordCount:null!==(n=e.wordCount)&&void 0!==n?n:c.size,words:a,wordsSet:c}};const d=e=>e.slice(1).reduce(((e,t)=>((e,t)=>{var n,r,s,o;const i=c(e);if(i.end=Math.max(e.end,t.end),i.text=`${i.text} ${t.text}`,null===(n=i.words)||void 0===n||n.push(...null!==(r=t.words)&&void 0!==r?r:[]),i.wordCount=(null!==(s=i.wordCount)&&void 0!==s?s:0)+(null!==(o=t.wordCount)&&void 0!==o?o:0),i.componentSegments.push(t),i.embedding&&t.embedding)for(let e=0;e<i.embedding.length;e+=1)i.embedding[e]+=t.embedding[e],i.embedding[e]/=2;return i})(e,t)),e[0])},610:(e,t,n)=>{"use strict";var r,s;n.d(t,{BB:()=>o});const o=globalThis.requestIdleCallback||(globalThis.requestIdleCallback=e=>+setTimeout((()=>e({didTimeout:!1,timeRemaining:()=>1}))));globalThis.cancelIdleCallback||(globalThis.cancelIdleCallback=clearTimeout);null!==(r=(s=Set.prototype).union)&&void 0!==r||(s.union=function(e){const t=new Set(this);for(const n of e.keys())t.add(n);return t})},279:(e,t,n)=>{"use strict";n.d(t,{I:()=>x});var r=n(383),s=n(41),o=n(669),i=n(436);const{abs:a,sign:c}=Math,l=Math;class u{static create({x:e,y:t,z:n,w:r}={}){return new u(e,t,n,r)}clone(){return u.create(this)}get brightness(){return 1/3*(this.x+this.y+this.z)}static random(e=(()=>l.random())){return u.create({x:e(),y:e(),z:e(),w:1})}static stringHash(e){const t=(e=>()=>{e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296})((0,s.cz)([...e].map((e=>e.charCodeAt(0))))),n=[(0,s.Jt)(u.rainbow,t()),(0,s.Jt)(u.rainbow,t())];return n[0].mix(n[1],t())}[Symbol.iterator](){return[this.x,this.y,this.z,this.w][Symbol.iterator]()}constructor(e=0,t=0,n=0,r=1){this.x=e,this.y=t,this.z=n,this.w=r}static named(e){const t=document.createElement("div");t.setAttribute("style",`color: ${e}; display: none;`),document.body.append(t),setTimeout(t.remove.bind(t));const n=u.parse(`${t.computedStyleMap().get("color")}`);return"white"!==e&&`${n}`==`${u.white}`?null:n}static parse(e){const t=`${e}`,n=!/rgba?|\(|\)|\"/g.test(t);if(!o.Ll&&n)return u.named(t);const r=t.replace(/rgba?|\(|\)|\"/g,"").split(/,\s?/).map(Number),[s,i,a]=r.map((e=>e/255)),[,,,c]=r;return u.create({x:s,y:i,z:a,w:c})}static complementary(e){return u.create({x:1-e.x,y:1-e.y,z:1-e.z,w:e.w})}complementary(){return u.create({x:1-this.x,y:1-this.y,z:1-this.z,w:this.w})}static mix(e,t,n=.5){return"number"!=typeof n&&(n=.5*n[1]),u.create({x:(0,i.Cc)(e.x,t.x,n),y:(0,i.Cc)(e.y,t.y,n),z:(0,i.Cc)(e.z,t.z,n),w:(0,i.Cc)(e.w,t.w,n)})}mix(e,t=.5){return"number"!=typeof t&&(t=.5*t[1]),u.create({x:(0,i.Cc)(this.x,e.x,t),y:(0,i.Cc)(this.y,e.y,t),z:(0,i.Cc)(this.z,e.z,t),w:(0,i.Cc)(this.w,e.w,t)})}scale(e,t=this.w){return u.create({x:(0,i.qE)(e*this.x),y:(0,i.qE)(e*this.y),z:(0,i.qE)(e*this.z),w:(0,i.qE)(t)})}alpha(e){return u.create({...this,w:e})}toHex(){return 255*this.x<<16^255*this.y<<8^255*this.z}equals(e,t=0){return t?l.abs(this.x-e.x)<t&&l.abs(this.y-e.y)<t&&l.abs(this.z-e.z)<t:this.x===e.x&&this.y===e.y&&this.z===e.z}toString(){return`rgba(${255*this.x|0},${255*this.y|0},${255*this.z|0},${this.w})`}toArray(e=[],t=0){return e[t+0]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}toVec4({precision:e=6}={}){const t=t=>((e,t)=>{if(!t)return e;if(e!=e)return 0;if(Infinity===e)return Infinity;const n=c(e),r=(e*=n)-e%t,s=r+t;let o=a(e-s)<a(e-r)?s:r;if(o%1!=0){const e=`${o}`.split(".");o=+`${e[0]}.${e[1].slice(0,(e=>{const t=`${e}`,n=t.indexOf(".")+1;return n?t.length-n:0})(t))}`}return n*o})((0,i.qE)(t),Math.pow(10,-e));return`vec4(${t(this.x)}, ${t(this.y)}, ${t(this.z)}, ${t(this.w)})`}toJSON(){return`${this}`}}u.white=u.create({x:1,y:1,z:1}),u.black=u.create(),u.darkBrown=u.create({x:.128,y:.052,z:.008}),u.brown=u.create({x:.5823529411764707,y:.3529411764705882,z:.12352941176470589}),u.gray=u.create({x:.5,y:.5,z:.5}),u.red=u.create({x:.95,y:.05,z:.05}),u.orange=u.create({x:.9,y:.35,z:.03137}),u.goldenYellow=u.create({x:.87952,y:.797,z:.115}),u.green=u.create({x:.025,y:.775,z:.025}),u.blue=u.create({x:.05,y:.05,z:.75}),u.indigo=u.create({x:75/255,y:0,z:130/255}),u.violet=u.create({x:.5,y:0,z:.95}),u.skyBlue=u.create({x:.529,y:.808,z:.922}),u.darkRed=u.create(u.red.scale(.5)),u.darkOrange=u.create({x:.75,y:.275,z:.01}),u.yellow=u.create({x:.91776,y:.8315999999999999,z:.15}),u.brilliantYellow=u.create({x:.95,y:.975,z:.0075}),u.darkGreen=u.create({x:.025,y:.3,z:.025}),u.cyan=u.create({x:.0863,y:.8824,z:.969}),u.darkCyan=u.create({x:.05,y:.2,z:.255}),u.navy=u.create({z:.8}),u.darkViolet=u.create({x:.93,y:.51,z:.93}),u.purple=u.create({x:.75,y:.1,z:.75}),u.magenta=u.create({x:1,y:.01,z:1}),u.pink=u.create({x:1,y:.08,z:.57}),u.teal=u.create({x:.0075,y:.5,z:.85}),u.rainbow=(0,s.Ry)(["red","orange","yellow","green","blue","purple","violet"]).map((e=>u[e])),u.transparent=u.create({w:0}),u.transparentBlack=u.transparent.scale(0),u.rgbaString=/rgba?\(.+\)/;var d,h,f=n(463),p=n(873),m=n(803),g=n(790),y=n(610);const{parse:w,stringify:b}=JSON;class v extends Map{constructor(){super(...arguments),this.setItem=(e,t)=>this.set(e,"string"==typeof t?t:b(t)),this.setIfAbsent=(e,t)=>this.has(e)||this.set(e,t),this.getItem=e=>b(this.get(e)),this.removeItem=e=>this.delete(e)}key(e){return[...Object.keys(this)][e]}get length(){return+this}}const _=null!==(d=globalThis.localStorage)&&void 0!==d?d:new v,k=null!==(h=globalThis.sessionStorage)&&void 0!==h?h:new v;class S{constructor(e,t=0){this.storage=e,this.version=t,this.memoryStore={},this.get=(e,t="")=>{var n;if((e=this.key(e))in this.memoryStore)return this.memoryStore[e];const r=null!==(n=this.storage.getItem(e))&&void 0!==n?n:"",s=S.parse(r,t),o=t instanceof Object?(0,p.vq)(s,t):s;return this.memoryStore[e]=o}}key(e){if(this.version){const t=`~v${this.version}`;return e.endsWith(t)?e:`${e}${t}`}return e}static parse(e,t=e){var n;if("string"!=typeof e)return e;let r;try{for(const[t,n]of S.parsers.entries())if(t.test(e)){r=n(e);break}null!=r||(r=w(e,S.revive))}catch(e){}return null!==(n=r)&&void 0!==n?n:t}set(e,t){e=this.key(e),this.memoryStore[e]=t;const{storage:n,memoryStore:r}=this;(0,y.BB)((function o(i){if(!i.timeRemaining())return(0,y.BB)(o);try{n.setItem(e,b(t,S.serialize))}catch(e){if(console.warn(e),e.code===DOMException.QUOTA_EXCEEDED_ERR){const[e]=(0,s.i8)(Object.keys(n),(e=>n.getItem(e).length));return n.removeItem(e),delete r[e],(0,y.BB)(o)}}}))}has(e){return this.key(e)in this.storage}remove(e){this.storage.removeItem(this.key(e))}synced(e,t){const n=(0,p.vq)(this.get(e,t),t),r=(0,f.sg)(this.set.bind(this),1e3,!0);return new Proxy(n,{get:(e,t)=>{const n=Reflect.get(e,t);return S.parse(n)},set:(t,n,s)=>{const o=Reflect.set(t,n,s);return r(e,t),o},deleteProperty:(t,n)=>{const r=Reflect.deleteProperty(t,n);return this.set(e,t),r}})}collection(e,t,n=(e=>{})){const r=this;return new Proxy(this.get(e,t),{set(t,s,o){const i=Reflect.set(t,s,o);return"length"===s&&(r.set(e,t),setTimeout((()=>n(t)))),i}})}}S.parsers=new Map([[m.ed,u.parse]]),S.revive=(e,t)=>(null==t?void 0:t.isFloat32Array)?new Float32Array(Object.values(t).filter((e=>"number"==typeof e))):t,S.serialize=(e,t)=>t instanceof Float32Array?{isFloat32Array:!0,...t}:t;const x={local:new S(_,4),session:new S(k),db:o.Ll?{}:new class A{constructor(e){this.localForage=e,this.syncStore={},this.ready=o.Ll?Promise.resolve():new Promise((e=>this.resolveReady=e)),e.setItem=(0,f.sg)(e.setItem.bind(e)),e.getItem=(0,f.sg)(e.getItem.bind(e)),e.removeItem=(0,f.sg)(e.removeItem.bind(e)),e.keys().then((async t=>{const n=await Promise.all(t.map((t=>e.getItem(t))));Object.assign(this.syncStore,Object.fromEntries(t.map(((e,t)=>[e,n[t]])))),this.resolveReady()}))}set(e,t){return this.syncStore[e]=t,this.localForage.setItem(e,t),t}get(e){return this.syncStore[e]}has(e){return e in this.syncStore}keys(){return Object.keys(this.syncStore)}del(e){delete this.syncStore[e],this.localForage.removeItem(e)}}((0,g.createInstance)({name:"db",driver:g.INDEXEDDB}))};setTimeout((()=>{const e=x.local.get=(0,r.Bp)("storage.local.get",x.local.get);e.addMock("no-last-active-servers",(e=>"last-active-servers"===e?[]:r.ET.pass)),e.addMock("has-last-active-servers",(e=>"last-active-servers"===e?["asr4.nuzi.ai"]:r.ET.pass))}))},687:(e,t,n)=>{"use strict";n.d(t,{Rt:()=>a,_h:()=>o,aL:()=>c,vp:()=>i});var r=n(41),s=n(803);const o=(e,t=" ")=>((e,t="_")=>e.replace(/([0-9]{1}[A-Z]{1})/g,(e=>`${t}${e.toLowerCase()}`)).replace(/([A-Z]{2,})([A-Z])([a-z])/g,((e,n,r,s)=>`${n.toLowerCase()}${t}${r.toLowerCase()}${s}`)).replace(/(?<!^)([A-Z]{1}|[0-9]{1}[A-Z]{1})([a-z0-9]{1,})/g,`${t}$1$2`).toLowerCase())(e,t),i=e=>e.replace(/[ \n\b\s]+/gm," ").trim(),a=(e,t="and")=>0===e.length?"":1===e.length?e[0]:2===e.length?e.join(` ${t} `):[e.slice(0,-1).join(", "),(0,r.HV)(e)].join(`, ${t} `),c=(e="")=>e.trim().split(s.nZ).filter(Boolean)},75:(e,t,n)=>{"use strict";var r,s;n.d(t,{t:()=>p,tB:()=>f});const o=(...e)=>e.reduce(((e,t)=>(e[t]=t,e)),{}),i=o("milliseconds","seconds","minutes","hours","days","weeks"),a=o("ms","s","m","h","d","w"),c=36e5,l=864e5,u={milliseconds:1,seconds:1e3,minutes:6e4,hours:c,days:l,weeks:7*l},d={ms:"milliseconds",s:"seconds",m:"minutes",h:"hours",d:"days",w:"weeks"};Number.prototype.in=function(e){return this/("number"==typeof e?e:u[e])},Object.defineProperties(Number.prototype,Object.values(i).reduce(((e,t)=>(e[t]={get(){return this*u[t]}},e)),{})),Object.defineProperties(Number.prototype,Object.values(a).reduce(((e,t)=>(e[t]={get(){return m(this*u[d[t]])}},e)),{}));const h="undefined"==typeof performance?()=>currentTime:performance.now.bind(performance),f="undefined"==typeof performance?h:()=>performance.timeOrigin+p(),p=new(s=class e extends Function{constructor(){super("return performance.now();"),this[r]=h}},r=Symbol.toPrimitive,s),m=e=>{let t=!1;const n=new Promise((n=>setTimeout((()=>!t&&n()),e)));return Object.assign(n,{cancel:()=>{t=!0}})};(new Date).getDay()},656:(e,t,n)=>{"use strict";n.d(t,{n:()=>o});n(610);var r=n(590),s=n(669);s.xD&&self.addEventListener("unhandledrejection",(e=>{e.preventDefault(),postMessage({status:"error",args:[e.reason]}),console.error("error in worker",e)}));class o{async init(e,t){s.xD&&postMessage({status:"ready"})}async process(e,t){return e}constructor(){s.xD&&(r.p(this),postMessage({status:"listening"}))}}},512:e=>{"use strict";e.exports=function(e,t,n,r){var s=self||window;try{try{var o;try{o=new s.Blob([e])}catch(t){(o=new(s.BlobBuilder||s.WebKitBlobBuilder||s.MozBlobBuilder||s.MSBlobBuilder)).append(e),o=o.getBlob()}var i=s.URL||s.webkitURL,a=i.createObjectURL(o),c=new s[t](a,n);return i.revokeObjectURL(a),c}catch(r){return new s[t]("data:application/javascript,".concat(encodeURIComponent(e)),n)}}catch(e){if(!r)throw Error("Inline worker is not supported");return new s[t](r,n)}}},158:(e,t,n)=>{e.exports=n.p+"segment-processor.worklet.14417fdab8d253648bac.js"},590:(e,t,n)=>{"use strict";n.d(t,{LV:()=>h,k0:()=>_,p:()=>u});
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
const r=Symbol("Comlink.proxy"),s=Symbol("Comlink.endpoint"),o=Symbol("Comlink.releaseProxy"),i=Symbol("Comlink.finalizer"),a=Symbol("Comlink.thrown"),c=e=>"object"==typeof e&&null!==e||"function"==typeof e,l=new Map([["proxy",{canHandle:e=>c(e)&&e[r],serialize(e){const{port1:t,port2:n}=new MessageChannel;return u(e,t),[n,[n]]},deserialize:e=>(e.start(),h(e))}],["throw",{canHandle:e=>c(e)&&a in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function u(e,t=globalThis,n=["*"]){t.addEventListener("message",(function s(o){if(!o||!o.data)return;if(!function c(e,t){for(const n of e){if(t===n||"*"===n)return!0;if(n instanceof RegExp&&n.test(t))return!0}return!1}(n,o.origin))return void console.warn(`Invalid origin '${o.origin}' for comlink proxy`);const{id:l,type:h,path:f}=Object.assign({path:[]},o.data),p=(o.data.argumentList||[]).map(S);let m;try{const t=f.slice(0,-1).reduce(((e,t)=>e[t]),e),n=f.reduce(((e,t)=>e[t]),e);switch(h){case"GET":m=n;break;case"SET":t[f.slice(-1)[0]]=S(o.data.value),m=!0;break;case"APPLY":m=n.apply(t,p);break;case"CONSTRUCT":m=function s(e){return Object.assign(e,{[r]:!0})}(new n(...p));break;case"ENDPOINT":{const{port1:t,port2:n}=new MessageChannel;u(e,n),m=_(t,[t])}break;case"RELEASE":m=void 0;break;default:return}}catch(e){m={value:e,[a]:0}}Promise.resolve(m).catch((e=>({value:e,[a]:0}))).then((n=>{const[r,o]=k(n);t.postMessage(Object.assign(Object.assign({},r),{id:l}),o),"RELEASE"===h&&(t.removeEventListener("message",s),d(t),i in e&&"function"==typeof e[i]&&e[i]())})).catch((e=>{const[n,r]=k({value:new TypeError("Unserializable return value"),[a]:0});t.postMessage(Object.assign(Object.assign({},n),{id:l}),r)}))})),t.start&&t.start()}function d(e){(function t(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function h(e,t){return y(e,[],t)}function f(e){if(e)throw new Error("Proxy has been released and is not useable")}function p(e){return x(e,{type:"RELEASE"}).then((()=>{d(e)}))}const m=new WeakMap,g="FinalizationRegistry"in globalThis&&new FinalizationRegistry((e=>{const t=(m.get(e)||0)-1;m.set(e,t),0===t&&p(e)}));function y(e,t=[],n=function(){}){let r=!1;const i=new Proxy(n,{get(n,s){if(f(r),s===o)return()=>{!function t(e){g&&g.unregister(e)}(i),p(e),r=!0};if("then"===s){if(0===t.length)return{then:()=>i};const n=x(e,{type:"GET",path:t.map((e=>e.toString()))}).then(S);return n.then.bind(n)}return y(e,[...t,s])},set(n,s,o){f(r);const[i,a]=k(o);return x(e,{type:"SET",path:[...t,s].map((e=>e.toString())),value:i},a).then(S)},apply(n,o,i){f(r);const a=t[t.length-1];if(a===s)return x(e,{type:"ENDPOINT"}).then(S);if("bind"===a)return y(e,t.slice(0,-1));const[c,l]=b(i);return x(e,{type:"APPLY",path:t.map((e=>e.toString())),argumentList:c},l).then(S)},construct(n,s){f(r);const[o,i]=b(s);return x(e,{type:"CONSTRUCT",path:t.map((e=>e.toString())),argumentList:o},i).then(S)}});return function a(e,t){const n=(m.get(t)||0)+1;m.set(t,n),g&&g.register(e,t,e)}(i,e),i}function w(e){return Array.prototype.concat.apply([],e)}function b(e){const t=e.map(k);return[t.map((e=>e[0])),w(t.map((e=>e[1])))]}const v=new WeakMap;function _(e,t){return v.set(e,t),e}function k(e){for(const[t,n]of l)if(n.canHandle(e)){const[r,s]=n.serialize(e);return[{type:"HANDLER",name:t,value:r},s]}return[{type:"RAW",value:e},v.get(e)||[]]}function S(e){switch(e.type){case"HANDLER":return l.get(e.name).deserialize(e.value);case"RAW":return e.value}}function x(e,t,n){return new Promise((r=>{const s=function o(){return new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-")}();e.addEventListener("message",(function t(n){n.data&&n.data.id&&n.data.id===s&&(e.removeEventListener("message",t),r(n.data))})),e.start&&e.start(),e.postMessage(Object.assign({id:s},t),n)}))}}},o={};function i(e){var t=o[e];if(void 0!==t)return t.exports;var n=o[e]={exports:{}};return s[e].call(n.exports,n,n.exports,i),n.exports}i.m=s,i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"==typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"==typeof n.then)return n}var s=Object.create(null);i.r(s);var o={};e=e||[null,t({}),t([]),t(t)];for(var a=2&r&&n;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>o[e]=()=>n[e]));return o.default=()=>n,i.d(s,o),s},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce(((t,n)=>(i.f[n](e,t),t)),[])),i.u=e=>e+".nuiq-asr.js",i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n={},r="NuiqASR:",i.l=(e,t,s,o)=>{if(n[e])n[e].push(t);else{var a,c;if(void 0!==s)for(var l=document.getElementsByTagName("script"),u=0;u<l.length;u++){var d=l[u];if(d.getAttribute("src")==e||d.getAttribute("data-webpack")==r+s){a=d;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,i.nc&&a.setAttribute("nonce",i.nc),a.setAttribute("data-webpack",r+s),a.src=e),n[e]=[t];var h=(t,r)=>{a.onerror=a.onload=null,clearTimeout(f);var s=n[e];if(delete n[e],a.parentNode&&a.parentNode.removeChild(a),s&&s.forEach((e=>e(r))),t)return t(r)},f=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),c&&document.head.appendChild(a)}},i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=n[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e})(),(()=>{var e={792:0};i.f.j=(t,n)=>{var r=i.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var s=new Promise(((n,s)=>r=e[t]=[n,s]));n.push(r[2]=s);var o=i.p+i.u(t),a=new Error;i.l(o,(n=>{if(i.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var s=n&&("load"===n.type?"missing":n.type),o=n&&n.target&&n.target.src;a.message="Loading chunk "+t+" failed.\n("+s+": "+o+")",a.name="ChunkLoadError",a.type=s,a.request=o,r[1](a)}}),"chunk-"+t,t)}};var t=(t,n)=>{var r,s,[o,a,c]=n,l=0;if(o.some((t=>0!==e[t]))){for(r in a)i.o(a,r)&&(i.m[r]=a[r]);if(c)c(i)}for(t&&t(n);l<o.length;l++)s=o[l],i.o(e,s)&&e[s]&&e[s][0](),e[s]=0},n=this.webpackChunkNuiqASR=this.webpackChunkNuiqASR||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var a={};return(()=>{"use strict";i.r(a),i.d(a,{AudioAdapter:()=>io.uU,SpeakerDeducer:()=>bs,disable:()=>qo,isDisabled:()=>Wo,preload:()=>Uo,transcribe:()=>Fo,transcribeFile:()=>zo,transcription:()=>Bo,transcriptions:()=>Lo,version:()=>Go});var e=i(463),t=i(43),n=i(241),r=i(590),s=i(258),o=i(41),c=i(516),l=i(410);class u extends EventTarget{constructor(){super(...arguments),this.isReady=!0,this.isReadyPromise=Promise.resolve({})}async set(e){Object.assign(this,e)}async process(e,t){return e}terminate(){}}class d extends u{constructor(){super(...arguments),this.joiner=" ",this.segmentToSpeaker=(0,o.by)("speaker")}async process(e){var t,n;const{joiner:r,segmentToSpeaker:s}=this;let o,i=null;const a=[];for(let l=0;l<e.length;l+=1){const u=e[l],d=s(u),{end:h,text:f,words:p=[],wordCount:m=0,wordsSet:g}=u;d===o&&i?(i.end=h,i.text=`${i.text}${r}${f}`,null===(t=i.words)||void 0===t||t.push(...p),i.wordCount=(null!==(n=i.wordCount)&&void 0!==n?n:0)+m,i.wordsSet=i.wordsSet.union(g),i.componentSegments.push(u)):(o=d,i=(0,c.mL)(u),a.push(i))}return a}}class h extends u{constructor(){super(...arguments),this.joiner="\n"}async process(e){const t=Array.isArray(e)?e:e.segments,n=Array.isArray(e)?new l.xP:e.speakerMap,{joiner:r}=this,s=t.map((e=>{var t;let{text:r}=e;return null!=r||(r=""),r=r.replace(/\s{2,}/g," ").trim().replace(/^\-\s?/,""),r=r.replaceAll("i'm","I'm"),r=(e=>e?`${e[0].toUpperCase()}${e.slice(1)}`:"")(r),{...e,text:r,speaker:null!==(t=n.get(e.speaker))&&void 0!==t?t:e.speaker}}));return{text:s.map((e=>{const{text:t}=e,{speaker:n}=e;return null==n?t:`[${n}] ${t}`})).join(r),segments:s}}}var f=i(687);const p="RFC3986",m={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:e=>String(e)},g=(Object.prototype.hasOwnProperty,Array.isArray),y=(()=>{const e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();const w=1024;function b(e,t){if(g(e)){const n=[];for(let r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)}const v=Object.prototype.hasOwnProperty,_={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},k=Array.isArray,S=Array.prototype.push,x=function(e,t){S.apply(e,k(t)?t:[t])},A=Date.prototype.toISOString,C={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,n,r,s)=>{if(0===e.length)return e;let o=e;if("symbol"==typeof e?o=Symbol.prototype.toString.call(e):"string"!=typeof e&&(o=String(e)),"iso-8859-1"===n)return escape(o).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));let i="";for(let e=0;e<o.length;e+=w){const t=o.length>=w?o.slice(e,e+w):o,n=[];for(let e=0;e<t.length;++e){let r=t.charCodeAt(e);45===r||46===r||95===r||126===r||r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||"RFC1738"===s&&(40===r||41===r)?n[n.length]=t.charAt(e):r<128?n[n.length]=y[r]:r<2048?n[n.length]=y[192|r>>6]+y[128|63&r]:r<55296||r>=57344?n[n.length]=y[224|r>>12]+y[128|r>>6&63]+y[128|63&r]:(e+=1,r=65536+((1023&r)<<10|1023&t.charCodeAt(e)),n[n.length]=y[240|r>>18]+y[128|r>>12&63]+y[128|r>>6&63]+y[128|63&r])}i+=n.join("")}return i},encodeValuesOnly:!1,format:p,formatter:m[p],indices:!1,serializeDate:e=>A.call(e),skipNulls:!1,strictNullHandling:!1};const E={};function I(e,t,n,r,s,o,i,a,c,l,u,d,h,f,p,m,g,y){let w=e,v=y,_=0,S=!1;for(;void 0!==(v=v.get(E))&&!S;){const t=v.get(e);if(_+=1,"undefined"!=typeof t){if(t===_)throw new RangeError("Cyclic object value");S=!0}"undefined"==typeof v.get(E)&&(_=0)}if("function"==typeof l?w=l(t,w):w instanceof Date?w=h?.(w):"comma"===n&&k(w)&&(w=b(w,(function(e){return e instanceof Date?h?.(e):e}))),null===w){if(o)return c&&!m?c(t,C.encoder,g,"key",f):t;w=""}if(function A(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||"symbol"==typeof e||"bigint"==typeof e}(w)||function O(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))}(w)){if(c){const e=m?t:c(t,C.encoder,g,"key",f);return[p?.(e)+"="+p?.(c(w,C.encoder,g,"value",f))]}return[p?.(t)+"="+p?.(String(w))]}const M=[];if("undefined"==typeof w)return M;let R;if("comma"===n&&k(w))m&&c&&(w=b(w,c)),R=[{value:w.length>0?w.join(",")||null:void 0}];else if(k(l))R=l;else{const e=Object.keys(w);R=u?e.sort(u):e}const $=a?String(t).replace(/\./g,"%2E"):String(t),j=r&&k(w)&&1===w.length?$+"[]":$;if(s&&k(w)&&0===w.length)return j+"[]";for(let t=0;t<R.length;++t){const b=R[t],v="object"==typeof b&&"undefined"!=typeof b.value?b.value:w[b];if(i&&null===v)continue;const S=d&&a?b.replace(/\./g,"%2E"):b,A=k(w)?"function"==typeof n?n(j,S):j:j+(d?"."+S:"["+S+"]");y.set(e,_);const C=new WeakMap;C.set(E,y),x(M,I(v,A,n,r,s,o,i,a,"comma"===n&&m&&k(w)?null:c,l,u,d,h,f,p,m,g,C))}return M}function O(e,t={}){let n=e;const r=function s(e=C){if("undefined"!=typeof e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if("undefined"!=typeof e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&"undefined"!=typeof e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");const t=e.charset||C.charset;if("undefined"!=typeof e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=p;if("undefined"!=typeof e.format){if(!v.call(m,e.format))throw new TypeError("Unknown format option provided.");n=e.format}const r=m[n];let s,o=C.filter;if(("function"==typeof e.filter||k(e.filter))&&(o=e.filter),s=e.arrayFormat&&e.arrayFormat in _?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":C.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const i="undefined"==typeof e.allowDots?1==!!e.encodeDotInKeys||C.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:C.addQueryPrefix,allowDots:i,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:C.allowEmptyArrays,arrayFormat:s,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:C.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:"undefined"==typeof e.delimiter?C.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:C.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:C.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:C.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:C.encodeValuesOnly,filter:o,format:n,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:C.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:C.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:C.strictNullHandling}}(t);let o,i;"function"==typeof r.filter?(i=r.filter,n=i("",n)):k(r.filter)&&(i=r.filter,o=i);const a=[];if("object"!=typeof n||null===n)return"";const c=_[r.arrayFormat],l="comma"===c&&r.commaRoundTrip;o||(o=Object.keys(n)),r.sort&&o.sort(r.sort);const u=new WeakMap;for(let e=0;e<o.length;++e){const t=o[e];r.skipNulls&&null===n[t]||x(a,I(n[t],t,c,l,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,u))}const d=a.join(r.delimiter);let h=!0===r.addQueryPrefix?"?":"";return r.charsetSentinel&&("iso-8859-1"===r.charset?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),d.length>0?h+d:""}const M="4.82.0";let R,$,j,P,T,N,D,B,L,F=!1,z=null,U=null,q=null,W=null;class G{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}R||function J(e,t={auto:!1}){if(F)throw new Error(`you must \`import 'openai/shims/${e.kind}'\` before importing anything else from openai`);if(R)throw new Error(`can't \`import 'openai/shims/${e.kind}'\` after \`import 'openai/shims/${R}'\``);F=t.auto,R=e.kind,$=e.fetch,z=e.Request,U=e.Response,q=e.Headers,j=e.FormData,W=e.Blob,P=e.File,T=e.ReadableStream,N=e.getMultipartRequestOptions,D=e.getDefaultAgent,B=e.fileFromPath,L=e.isFsReadStream}(function X({manuallyImported:e}={}){const t=e?"You may need to use polyfills":"Add one of these imports before your first `import  from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let n,r,s,o;try{n=fetch,r=Request,s=Response,o=Headers}catch(e){throw new Error(`this environment is missing the following Web Fetch API type: ${e.message}. ${t}`)}return{kind:"web",fetch:n,Request:r,Response:s,Headers:o,FormData:"undefined"!=typeof FormData?FormData:class e{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${t}`)}},Blob:"undefined"!=typeof Blob?Blob:class e{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${t}`)}},File:"undefined"!=typeof File?File:class e{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${t}`)}},ReadableStream:"undefined"!=typeof ReadableStream?ReadableStream:class e{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${t}`)}},getMultipartRequestOptions:async(e,t)=>({...t,body:new G(e)}),getDefaultAgent:e=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:e=>!1}}(),{auto:!0});class H extends Error{}class K extends H{constructor(e,t,n,r){super(`${K.makeMessage(e,t,n)}`),this.status=e,this.headers=r,this.request_id=r?.["x-request-id"],this.error=t;const s=t;this.code=s?.code,this.param=s?.param,this.type=s?.type}static makeMessage(e,t,n){const r=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,n,r){if(!e||!r)return new Q({message:n,cause:Je(t)});const s=t?.error;return 400===e?new Z(e,s,n,r):401===e?new ee(e,s,n,r):403===e?new te(e,s,n,r):404===e?new ne(e,s,n,r):409===e?new re(e,s,n,r):422===e?new se(e,s,n,r):429===e?new oe(e,s,n,r):e>=500?new ie(e,s,n,r):new K(e,s,n,r)}}class V extends K{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Q extends K{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class Y extends Q{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Z extends K{}class ee extends K{}class te extends K{}class ne extends K{}class re extends K{}class se extends K{}class oe extends K{}class ie extends K{}class ae extends H{constructor(){super("Could not parse response content as the length limit was reached")}}class ce extends H{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class le{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const n=le.NEWLINE_CHARS.has(t[t.length-1]||"");let r=t.split(le.NEWLINE_REGEXP);return n&&r.pop(),1!==r.length||n?(this.buffer.length>0&&(r=[this.buffer.join("")+r[0],...r.slice(1)],this.buffer=[]),n||(this.buffer=[r.pop()||""]),r):(this.buffer.push(r[0]),[])}decodeText(e){if(null==e)return"";if("string"==typeof e)return e;if("undefined"!=typeof Buffer){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new H(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new H(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new H("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}function ue(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}le.NEWLINE_CHARS=new Set(["\n","\r"]),le.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class de{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;return new de((async function*r(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let r=!1;try{for await(const n of async function*s(e,t){if(!e.body)throw t.abort(),new H("Attempted to iterate over a response with no body");const n=new fe,r=new le,s=ue(e.body);for await(const e of async function*t(e){let t=new Uint8Array;for await(const n of e){if(null==n)continue;const e=n instanceof ArrayBuffer?new Uint8Array(n):"string"==typeof n?(new TextEncoder).encode(n):n;let r,s=new Uint8Array(t.length+e.length);for(s.set(t),s.set(e,t.length),t=s;-1!==(r=he(t));)yield t.slice(0,r),t=t.slice(r)}t.length>0&&(yield t)}(s))for(const t of r.decode(e)){const e=n.decode(t);e&&(yield e)}for(const e of r.flush()){const t=n.decode(e);t&&(yield t)}}(e,t))if(!r)if(n.data.startsWith("[DONE]"))r=!0;else if(null===n.event){let e;try{e=JSON.parse(n.data)}catch(e){throw console.error("Could not parse message into JSON:",n.data),console.error("From chunk:",n.raw),e}if(e&&e.error)throw new K(void 0,e.error,void 0,void 0);yield e}else{let e;try{e=JSON.parse(n.data)}catch(e){throw console.error("Could not parse message into JSON:",n.data),console.error("From chunk:",n.raw),e}if("error"==n.event)throw new K(void 0,e.error,e.message,void 0);yield{event:n.event,data:e}}r=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{r||t.abort()}}),t)}static fromReadableStream(e,t){let n=!1;return new de((async function*r(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let r=!1;try{for await(const t of async function*n(){const t=new le,n=ue(e);for await(const e of n)for(const n of t.decode(e))yield n;for(const e of t.flush())yield e}())r||t&&(yield JSON.parse(t));r=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{r||t.abort()}}),t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),r=r=>({next:()=>{if(0===r.length){const r=n.next();e.push(r),t.push(r)}return r.shift()}});return[new de((()=>r(e)),this.controller),new de((()=>r(t)),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new T({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:r,done:s}=await t.next();if(s)return e.close();const o=n.encode(JSON.stringify(r)+"\n");e.enqueue(o)}catch(t){e.error(t)}},async cancel(){await(t.return?.())}})}}function he(e){for(let t=0;t<e.length-2;t++){if(10===e[t]&&10===e[t+1])return t+2;if(13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return-1}class fe{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,r]=function s(e,t){const n=e.indexOf(t);if(-1!==n)return[e.substring(0,n),t,e.substring(n+t.length)];return[e,"",""]}(e,":");return r.startsWith(" ")&&(r=r.substring(1)),"event"===t?this.event=r:"data"===t&&this.data.push(r),null}}const pe=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob,me=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&ge(e),ge=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,ye=e=>me(e)||pe(e)||L(e);async function we(e,t,n){if(e=await e,me(e))return e;if(pe(e)){const r=await e.blob();t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()??"unknown_file");const s=ge(r)?[await r.arrayBuffer()]:[r];return new P(s,t,n)}const r=await async function s(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(ge(e))t.push(await e.arrayBuffer());else{if(!ve(e))throw new Error(`Unexpected data type: ${typeof e}; constructor: ${e?.constructor?.name}; props: ${function n(e){const t=Object.getOwnPropertyNames(e);return`[${t.map((e=>`"${e}"`)).join(", ")}]`}(e)}`);for await(const n of e)t.push(n)}return t}(e);if(t||(t=function o(e){return be(e.name)||be(e.filename)||be(e.path)?.split(/[\\/]/).pop()}(e)??"unknown_file"),!n?.type){const e=r[0]?.type;"string"==typeof e&&(n={...n,type:e})}return new P(r,t,n)}const be=e=>"string"==typeof e?e:"undefined"!=typeof Buffer&&e instanceof Buffer?String(e):void 0,ve=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],_e=e=>e&&"object"==typeof e&&e.body&&"MultipartBody"===e[Symbol.toStringTag],ke=async e=>{const t=await Se(e.body);return N(t,e)},Se=async e=>{const t=new j;return await Promise.all(Object.entries(e||{}).map((([e,n])=>xe(t,e,n)))),t},xe=async(e,t,n)=>{if(void 0!==n){if(null==n)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)e.append(t,String(n));else if(ye(n)){const r=await we(n);e.append(t,r)}else if(Array.isArray(n))await Promise.all(n.map((n=>xe(e,t+"[]",n))));else{if("object"!=typeof n)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`);await Promise.all(Object.entries(n).map((([n,r])=>xe(e,`${t}[${n}]`,r))))}}};var Ae,Ce=function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},Ee=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};async function Ie(e){const{response:t}=e;if(e.options.stream)return Ze("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):de.fromSSEResponse(t,e.controller);if(204===t.status)return null;if(e.options.__binaryResponse)return t;const n=t.headers.get("content-type");if(n?.includes("application/json")||n?.includes("application/vnd.api+json")){const e=await t.json();return Ze("response",t.status,t.url,t.headers,e),Oe(e,t)}const r=await t.text();return Ze("response",t.status,t.url,t.headers,r),r}function Oe(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class Me extends Promise{constructor(e,t=Ie){super((e=>{e(null)})),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new Me(this.responsePromise,(async t=>Oe(e(await this.parseResponse(t),t),t.response)))}asResponse(){return this.responsePromise.then((e=>e.response))}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class Re{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:r,fetch:s}){this.baseURL=e,this.maxRetries=Xe("maxRetries",t),this.timeout=Xe("timeout",n),this.httpAgent=r,this.fetch=s??$}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...ze(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${et()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then((async n=>{const r=n&&ge(n?.body)?new DataView(await n.body.arrayBuffer()):n?.body instanceof DataView?n.body:n?.body instanceof ArrayBuffer?new DataView(n.body):n&&ArrayBuffer.isView(n?.body)?new DataView(n.body.buffer):n?.body;return{method:e,path:t,...n,body:r}})))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if("string"==typeof e){if("undefined"!=typeof Buffer)return Buffer.byteLength(e,"utf8").toString();if("undefined"!=typeof TextEncoder){return(new TextEncoder).encode(e).length.toString()}}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){const{method:n,path:r,query:s,headers:o={}}=e,i=ArrayBuffer.isView(e.body)||e.__binaryRequest&&"string"==typeof e.body?e.body:_e(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,a=this.calculateContentLength(i),c=this.buildURL(r,s);"timeout"in e&&Xe("timeout",e.timeout);const l=e.timeout??this.timeout,u=e.httpAgent??this.httpAgent??D(c),d=l+1e3;"number"==typeof u?.options?.timeout&&d>(u.options.timeout??0)&&(u.options.timeout=d),this.idempotencyHeader&&"get"!==n&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);return{req:{method:n,...i&&{body:i},headers:this.buildHeaders({options:e,headers:o,contentLength:a,retryCount:t}),...u&&{agent:u},signal:e.signal??null},url:c,timeout:l}}buildHeaders({options:e,headers:t,contentLength:n,retryCount:r}){const s={};n&&(s["content-length"]=n);const o=this.defaultHeaders(e);return Qe(s,o),Qe(s,t),_e(e.body)&&"node"!==R&&delete s["content-type"],void 0===tt(o,"x-stainless-retry-count")&&void 0===tt(t,"x-stainless-retry-count")&&(s["x-stainless-retry-count"]=String(r)),this.validateHeaders(s,t),s}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map((e=>[...e]))):{...e}:{}}makeStatusError(e,t,n,r){return K.generate(e,t,n,r)}request(e,t=null){return new Me(this.makeRequest(e,t))}async makeRequest(e,t){const n=await e,r=n.maxRetries??this.maxRetries;null==t&&(t=r),await this.prepareOptions(n);const{req:s,url:o,timeout:i}=this.buildRequest(n,{retryCount:r-t});if(await this.prepareRequest(s,{url:o,options:n}),Ze("request",o,n,s.headers),n.signal?.aborted)throw new V;const a=new AbortController,c=await this.fetchWithTimeout(o,s,i,a).catch(Je);if(c instanceof Error){if(n.signal?.aborted)throw new V;if(t)return this.retryRequest(n,t);if("AbortError"===c.name)throw new Y;throw new Q({cause:c})}const l=Pe(c.headers);if(!c.ok){if(t&&this.shouldRetry(c)){return Ze(`response (error; ${`retrying, ${t} attempts remaining`})`,c.status,o,l),this.retryRequest(n,t,l)}const e=await c.text().catch((e=>Je(e).message)),r=Ue(e),s=r?void 0:e;Ze(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,c.status,o,l,s);throw this.makeStatusError(c.status,r,s,l)}return{response:c,options:n,controller:a}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new je(this,n,e)}buildURL(e,t){const n=We(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),r=this.defaultQuery();return Ke(r)||(t={...r,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter((([e,t])=>"undefined"!=typeof t)).map((([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new H(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)})).join("&")}async fetchWithTimeout(e,t,n,r){const{signal:s,...o}=t||{};s&&s.addEventListener("abort",(()=>r.abort()));const i=setTimeout((()=>r.abort()),n),a={signal:r.signal,...o};return a.method&&(a.method=a.method.toUpperCase()),this.fetch.call(void 0,e,a).finally((()=>{clearTimeout(i)}))}shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||(409===e.status||(429===e.status||e.status>=500)))}async retryRequest(e,t,n){let r;const s=n?.["retry-after-ms"];if(s){const e=parseFloat(s);Number.isNaN(e)||(r=e)}const o=n?.["retry-after"];if(o&&!r){const e=parseFloat(o);r=Number.isNaN(e)?Date.parse(o)-Date.now():1e3*e}if(!(r&&0<=r&&r<6e4)){const n=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,n)}return await Ge(r),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const n=t-e;return Math.min(.5*Math.pow(2,n),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${M}`}}class $e{constructor(e,t,n,r){Ae.set(this,void 0),Ce(this,Ae,e,"f"),this.options=r,this.response=t,this.body=n}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageInfo()}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new H("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&"object"==typeof t.query)t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[t,r]of n)e.url.searchParams.set(t,r);t.query=void 0,t.path=e.url.toString()}return await Ee(this,Ae,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Ae=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class je extends Me{constructor(e,t,n){super(t,(async t=>new n(e,t.response,await Ie(t),t.options)))}async*[Symbol.asyncIterator](){const e=await(this);for await(const t of e)yield t}}const Pe=e=>new Proxy(Object.fromEntries(e.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),Te={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},Ne=e=>"object"==typeof e&&null!==e&&!Ke(e)&&Object.keys(e).every((e=>Ve(Te,e))),De=()=>{if("undefined"!=typeof Deno&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":M,"X-Stainless-OS":Le(Deno.build.os),"X-Stainless-Arch":Be(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":M,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if("[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":M,"X-Stainless-OS":Le(process.platform),"X-Stainless-Arch":Be(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const e=function t(){if("undefined"==typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:n}of e){const e=n.exec(navigator.userAgent);if(e){return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}}return null}();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":M,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":M,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};const Be=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",Le=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let Fe;const ze=()=>Fe??(Fe=De()),Ue=e=>{try{return JSON.parse(e)}catch(e){return}},qe=/^[a-z][a-z0-9+.-]*:/i,We=e=>qe.test(e),Ge=e=>new Promise((t=>setTimeout(t,e))),Xe=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new H(`${e} must be an integer`);if(t<0)throw new H(`${e} must be a positive integer`);return t},Je=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e)try{return new Error(JSON.stringify(e))}catch{}return new Error(e)},He=e=>"undefined"!=typeof process?process.env?.[e]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(e)?.trim():void 0;function Ke(e){if(!e)return!0;for(const t in e)return!1;return!0}function Ve(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Qe(e,t){for(const n in t){if(!Ve(t,n))continue;const r=n.toLowerCase();if(!r)continue;const s=t[n];null===s?delete e[r]:void 0!==s&&(e[r]=s)}}const Ye=new Set(["authorization","api-key"]);function Ze(e,...t){if("undefined"!=typeof process&&"true"===process?.env?.DEBUG){const n=t.map((e=>{if(!e)return e;if(e.headers){const t={...e,headers:{...e.headers}};for(const n in e.headers)Ye.has(n.toLowerCase())&&(t.headers[n]="REDACTED");return t}let t=null;for(const n in e)Ye.has(n.toLowerCase())&&(t??(t={...e}),t[n]="REDACTED");return t??e}));console.log(`OpenAI:DEBUG:${e}`,...n)}}const et=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),tt=(e,t)=>{const n=t.toLowerCase();if((e=>"function"==typeof e?.get)(e)){const r=t[0]?.toUpperCase()+t.substring(1).replace(/([^\w])(\w)/g,((e,t,n)=>t+n.toUpperCase()));for(const s of[t,n,t.toUpperCase(),r]){const t=e.get(s);if(t)return t}}for(const[r,s]of Object.entries(e))if(r.toLowerCase()===n)return Array.isArray(s)?(s.length<=1||console.warn(`Received ${s.length} entries for the ${t} header, using the first entry.`),s[0]):s};function nt(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}class rt{constructor(e){this._client=e}}class st extends rt{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class ot extends rt{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}}class it extends rt{constructor(){super(...arguments),this.completions=new ot(this._client)}}it.Completions=ot;class at extends rt{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}class ct extends $e{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class lt extends $e{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){const e=this.getPaginatedItems();if(!e.length)return null;const t=e[e.length-1]?.id;return t?{params:{after:t}}:null}}class ut extends rt{create(e,t){return this._client.post("/files",ke({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return Ne(e)?this.list({},e):this._client.getAPIList("/files",dt,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t?.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=18e5}={}){const r=new Set(["processed","error","deleted"]),s=Date.now();let o=await this.retrieve(e);for(;!o.status||!r.has(o.status);)if(await Ge(t),o=await this.retrieve(e),Date.now()-s>n)throw new Y({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return o}}class dt extends lt{}ut.FileObjectsPage=dt;class ht extends rt{createVariation(e,t){return this._client.post("/images/variations",ke({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",ke({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class ft extends rt{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t?.headers},__binaryResponse:!0})}}class pt extends rt{create(e,t){return this._client.post("/audio/transcriptions",ke({body:e,...t}))}}class mt extends rt{create(e,t){return this._client.post("/audio/translations",ke({body:e,...t}))}}class gt extends rt{constructor(){super(...arguments),this.transcriptions=new pt(this._client),this.translations=new mt(this._client),this.speech=new ft(this._client)}}gt.Transcriptions=pt,gt.Translations=mt,gt.Speech=ft;class yt extends rt{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class wt extends rt{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",bt,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class bt extends ct{}wt.ModelsPage=bt;class vt extends rt{list(e,t={},n){return Ne(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,_t,{query:t,...n})}}class _t extends lt{}vt.FineTuningJobCheckpointsPage=_t;class kt extends rt{constructor(){super(...arguments),this.checkpoints=new vt(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return Ne(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",St,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return Ne(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,xt,{query:t,...n})}}class St extends lt{}class xt extends lt{}kt.FineTuningJobsPage=St,kt.FineTuningJobEventsPage=xt,kt.Checkpoints=vt,kt.FineTuningJobCheckpointsPage=_t;class At extends rt{constructor(){super(...arguments),this.jobs=new kt(this._client)}}At.Jobs=kt,At.FineTuningJobsPage=St,At.FineTuningJobEventsPage=xt;class Ct extends rt{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},t){return Ne(e)?this.list({},e):this._client.getAPIList("/assistants",Et,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class Et extends lt{}function It(e){return"function"==typeof e.parse}Ct.AssistantsPage=Et;const Ot=e=>"assistant"===e?.role,Mt=e=>"function"===e?.role,Rt=e=>"tool"===e?.role;var $t,jt,Pt,Tt,Nt,Dt,Bt,Lt,Ft,zt,Ut,qt,Wt,Gt=function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},Xt=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class Jt{constructor(){$t.add(this),this.controller=new AbortController,jt.set(this,void 0),Pt.set(this,(()=>{})),Tt.set(this,(()=>{})),Nt.set(this,void 0),Dt.set(this,(()=>{})),Bt.set(this,(()=>{})),Lt.set(this,{}),Ft.set(this,!1),zt.set(this,!1),Ut.set(this,!1),qt.set(this,!1),Gt(this,jt,new Promise(((e,t)=>{Gt(this,Pt,e,"f"),Gt(this,Tt,t,"f")})),"f"),Gt(this,Nt,new Promise(((e,t)=>{Gt(this,Dt,e,"f"),Gt(this,Bt,t,"f")})),"f"),Xt(this,jt,"f").catch((()=>{})),Xt(this,Nt,"f").catch((()=>{}))}_run(e){setTimeout((()=>{e().then((()=>{this._emitFinal(),this._emit("end")}),Xt(this,$t,"m",Wt).bind(this))}),0)}_connected(){this.ended||(Xt(this,Pt,"f").call(this),this._emit("connect"))}get ended(){return Xt(this,Ft,"f")}get errored(){return Xt(this,zt,"f")}get aborted(){return Xt(this,Ut,"f")}abort(){this.controller.abort()}on(e,t){return(Xt(this,Lt,"f")[e]||(Xt(this,Lt,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=Xt(this,Lt,"f")[e];if(!n)return this;const r=n.findIndex((e=>e.listener===t));return r>=0&&n.splice(r,1),this}once(e,t){return(Xt(this,Lt,"f")[e]||(Xt(this,Lt,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise(((t,n)=>{Gt(this,qt,!0,"f"),"error"!==e&&this.once("error",n),this.once(e,t)}))}async done(){Gt(this,qt,!0,"f"),await Xt(this,Nt,"f")}_emit(e,...t){if(Xt(this,Ft,"f"))return;"end"===e&&(Gt(this,Ft,!0,"f"),Xt(this,Dt,"f").call(this));const n=Xt(this,Lt,"f")[e];if(n&&(Xt(this,Lt,"f")[e]=n.filter((e=>!e.once)),n.forEach((({listener:e})=>e(...t)))),"abort"===e){const e=t[0];return Xt(this,qt,"f")||n?.length||Promise.reject(e),Xt(this,Tt,"f").call(this,e),Xt(this,Bt,"f").call(this,e),void this._emit("end")}if("error"===e){const e=t[0];Xt(this,qt,"f")||n?.length||Promise.reject(e),Xt(this,Tt,"f").call(this,e),Xt(this,Bt,"f").call(this,e),this._emit("end")}}_emitFinal(){}}function Ht(e){return"auto-parseable-response-format"===e?.$brand}function Kt(e){return"auto-parseable-tool"===e?.$brand}function Vt(e,t){const n=e.choices.map((e=>{if("length"===e.finish_reason)throw new ae;if("content_filter"===e.finish_reason)throw new ce;return{...e,message:{...e.message,tool_calls:e.message.tool_calls?.map((e=>function n(e,t){const n=e.tools?.find((e=>e.function?.name===t.function.name));return{...t,function:{...t.function,parsed_arguments:Kt(n)?n.$parseRaw(t.function.arguments):n?.function.strict?JSON.parse(t.function.arguments):null}}}(t,e)))??[],parsed:e.message.content&&!e.message.refusal?Qt(t,e.message.content):null}}}));return{...e,choices:n}}function Qt(e,t){if("json_schema"!==e.response_format?.type)return null;if("json_schema"===e.response_format?.type){if("$parseRaw"in e.response_format){return e.response_format.$parseRaw(t)}return JSON.parse(t)}return null}function Yt(e,t){if(!e)return!1;const n=e.tools?.find((e=>e.function?.name===t.function.name));return Kt(n)||n?.function.strict||!1}function Zt(e){return!!Ht(e.response_format)||(e.tools?.some((e=>Kt(e)||"function"===e.type&&!0===e.function.strict))??!1)}jt=new WeakMap,Pt=new WeakMap,Tt=new WeakMap,Nt=new WeakMap,Dt=new WeakMap,Bt=new WeakMap,Lt=new WeakMap,Ft=new WeakMap,zt=new WeakMap,Ut=new WeakMap,qt=new WeakMap,$t=new WeakSet,Wt=function e(t){if(Gt(this,zt,!0,"f"),t instanceof Error&&"AbortError"===t.name&&(t=new V),t instanceof V)return Gt(this,Ut,!0,"f"),this._emit("abort",t);if(t instanceof H)return this._emit("error",t);if(t instanceof Error){const e=new H(t.message);return e.cause=t,this._emit("error",e)}return this._emit("error",new H(String(t)))};var en,tn,nn,rn,sn,on,an,cn,ln=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};const un=10;class dn extends Jt{constructor(){super(...arguments),en.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t)if(this._emit("message",e),(Mt(e)||Rt(e))&&e.content)this._emit("functionCallResult",e.content);else if(Ot(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Ot(e)&&e.tool_calls)for(const t of e.tool_calls)"function"===t.type&&this._emit("functionCall",t.function)}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new H("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),ln(this,en,"m",tn).call(this)}async finalMessage(){return await this.done(),ln(this,en,"m",nn).call(this)}async finalFunctionCall(){return await this.done(),ln(this,en,"m",rn).call(this)}async finalFunctionCallResult(){return await this.done(),ln(this,en,"m",sn).call(this)}async totalUsage(){return await this.done(),ln(this,en,"m",on).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=ln(this,en,"m",nn).call(this);t&&this._emit("finalMessage",t);const n=ln(this,en,"m",tn).call(this);n&&this._emit("finalContent",n);const r=ln(this,en,"m",rn).call(this);r&&this._emit("finalFunctionCall",r);const s=ln(this,en,"m",sn).call(this);null!=s&&this._emit("finalFunctionCallResult",s),this._chatCompletions.some((e=>e.usage))&&this._emit("totalUsage",ln(this,en,"m",on).call(this))}async _createChatCompletion(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort()))),ln(this,en,"m",an).call(this,t);const s=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Vt(s,t))}async _runChatCompletion(e,t,n){for(const e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){const r="function",{function_call:s="auto",stream:o,...i}=t,a="string"!=typeof s&&s?.name,{maxChatCompletions:c=un}=n||{},l={};for(const e of t.functions)l[e.name||e.function.name]=e;const u=t.functions.map((e=>({name:e.name||e.function.name,parameters:e.parameters,description:e.description})));for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<c;++t){const t=await this._createChatCompletion(e,{...i,function_call:s,functions:u,messages:[...this.messages]},n),o=t.choices[0]?.message;if(!o)throw new H("missing message in ChatCompletion response");if(!o.function_call)return;const{name:c,arguments:d}=o.function_call,h=l[c];if(!h){const e=`Invalid function_call: ${JSON.stringify(c)}. Available options are: ${u.map((e=>JSON.stringify(e.name))).join(", ")}. Please try again`;this._addMessage({role:r,name:c,content:e});continue}if(a&&a!==c){const e=`Invalid function_call: ${JSON.stringify(c)}. ${JSON.stringify(a)} requested. Please try again`;this._addMessage({role:r,name:c,content:e});continue}let f;try{f=It(h)?await h.parse(d):d}catch(e){this._addMessage({role:r,name:c,content:e instanceof Error?e.message:String(e)});continue}const p=await h.function(f,this),m=ln(this,en,"m",cn).call(this,p);if(this._addMessage({role:r,name:c,content:m}),a)return}}async _runTools(e,t,n){const r="tool",{tool_choice:s="auto",stream:o,...i}=t,a="string"!=typeof s&&s?.function?.name,{maxChatCompletions:c=un}=n||{},l=t.tools.map((e=>{if(Kt(e)){if(!e.$callback)throw new H("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e})),u={};for(const e of l)"function"===e.type&&(u[e.function.name||e.function.function.name]=e.function);const d="tools"in t?l.map((e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e)):void 0;for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<c;++t){const t=await this._createChatCompletion(e,{...i,tool_choice:s,tools:d,messages:[...this.messages]},n),o=t.choices[0]?.message;if(!o)throw new H("missing message in ChatCompletion response");if(!o.tool_calls?.length)return;for(const e of o.tool_calls){if("function"!==e.type)continue;const t=e.id,{name:n,arguments:s}=e.function,o=u[n];if(!o){const e=`Invalid tool_call: ${JSON.stringify(n)}. Available options are: ${Object.keys(u).map((e=>JSON.stringify(e))).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:t,content:e});continue}if(a&&a!==n){const e=`Invalid tool_call: ${JSON.stringify(n)}. ${JSON.stringify(a)} requested. Please try again`;this._addMessage({role:r,tool_call_id:t,content:e});continue}let i;try{i=It(o)?await o.parse(s):s}catch(e){const n=e instanceof Error?e.message:String(e);this._addMessage({role:r,tool_call_id:t,content:n});continue}const c=await o.function(i,this),l=ln(this,en,"m",cn).call(this,c);if(this._addMessage({role:r,tool_call_id:t,content:l}),a)return}}}}en=new WeakSet,tn=function e(){return ln(this,en,"m",nn).call(this).content??null},nn=function e(){let t=this.messages.length;for(;t-- >0;){const e=this.messages[t];if(Ot(e)){const{function_call:t,...n}=e,r={...n,content:e.content??null,refusal:e.refusal??null};return t&&(r.function_call=t),r}}throw new H("stream ended without producing a ChatCompletionMessage with role=assistant")},rn=function e(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Ot(t)&&t?.function_call)return t.function_call;if(Ot(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},sn=function e(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Mt(t)&&null!=t.content)return t.content;if(Rt(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some((e=>"assistant"===e.role&&e.tool_calls?.some((e=>"function"===e.type&&e.id===t.tool_call_id)))))return t.content}},on=function e(){const t={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:e}of this._chatCompletions)e&&(t.completion_tokens+=e.completion_tokens,t.prompt_tokens+=e.prompt_tokens,t.total_tokens+=e.total_tokens);return t},an=function e(t){if(null!=t.n&&t.n>1)throw new H("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},cn=function e(t){return"string"==typeof t?t:void 0===t?"undefined":JSON.stringify(t)};class hn extends dn{static runFunctions(e,t,n){const r=new hn,s={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run((()=>r._runFunctions(e,t,s))),r}static runTools(e,t,n){const r=new hn,s={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run((()=>r._runTools(e,t,s))),r}_addMessage(e,t=!0){super._addMessage(e,t),Ot(e)&&e.content&&this._emit("content",e.content)}}const fn=1,pn=2,mn=4,gn=8,yn=16,wn=32,bn=64,vn=128,_n=256,kn=511;class Sn extends Error{}class xn extends Error{}const An=(e,t)=>{const n=e.length;let r=0;const s=e=>{throw new Sn(`${e} at position ${r}`)},o=e=>{throw new xn(`${e} at position ${r}`)},i=()=>(d(),r>=n&&s("Unexpected end of input"),'"'===e[r]?a():"{"===e[r]?c():"["===e[r]?l():"null"===e.substring(r,r+4)||yn&t&&n-r<4&&"null".startsWith(e.substring(r))?(r+=4,null):"true"===e.substring(r,r+4)||wn&t&&n-r<4&&"true".startsWith(e.substring(r))?(r+=4,!0):"false"===e.substring(r,r+5)||wn&t&&n-r<5&&"false".startsWith(e.substring(r))?(r+=5,!1):"Infinity"===e.substring(r,r+8)||vn&t&&n-r<8&&"Infinity".startsWith(e.substring(r))?(r+=8,Infinity):"-Infinity"===e.substring(r,r+9)||_n&t&&1<n-r&&n-r<9&&"-Infinity".startsWith(e.substring(r))?(r+=9,-Infinity):"NaN"===e.substring(r,r+3)||bn&t&&n-r<3&&"NaN".startsWith(e.substring(r))?(r+=3,NaN):u()),a=()=>{const i=r;let a=!1;for(r++;r<n&&('"'!==e[r]||a&&"\\"===e[r-1]);)a="\\"===e[r]&&!a,r++;if('"'==e.charAt(r))try{return JSON.parse(e.substring(i,++r-Number(a)))}catch(e){o(String(e))}else if(fn&t)try{return JSON.parse(e.substring(i,r-Number(a))+'"')}catch(t){return JSON.parse(e.substring(i,e.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},c=()=>{r++,d();const o={};try{for(;"}"!==e[r];){if(d(),r>=n&&gn&t)return o;const s=a();d(),r++;try{const e=i();Object.defineProperty(o,s,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(e){if(gn&t)return o;throw e}d(),","===e[r]&&r++}}catch(e){if(gn&t)return o;s("Expected '}' at end of object")}return r++,o},l=()=>{r++;const n=[];try{for(;"]"!==e[r];)n.push(i()),d(),","===e[r]&&r++}catch(e){if(mn&t)return n;s("Expected ']' at end of array")}return r++,n},u=()=>{if(0===r){"-"===e&&pn&t&&s("Not sure what '-' is");try{return JSON.parse(e)}catch(n){if(pn&t)try{return"."===e[e.length-1]?JSON.parse(e.substring(0,e.lastIndexOf("."))):JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(e){}o(String(n))}}const i=r;for("-"===e[r]&&r++;e[r]&&!",]}".includes(e[r]);)r++;r!=n||pn&t||s("Unterminated number literal");try{return JSON.parse(e.substring(i,r))}catch(n){"-"===e.substring(i,r)&&pn&t&&s("Not sure what '-' is");try{return JSON.parse(e.substring(i,e.lastIndexOf("e")))}catch(e){o(String(e))}}},d=()=>{for(;r<n&&" \n\r\t".includes(e[r]);)r++};return i()},Cn=e=>function t(e,n=kn){if("string"!=typeof e)throw new TypeError("expecting str, got "+typeof e);if(!e.trim())throw new Error(`${e} is empty`);return An(e.trim(),n)}(e,kn^pn);var En,In,On,Mn,Rn,$n,jn,Pn,Tn,Nn,Dn,Bn,Ln=function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},Fn=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class zn extends dn{constructor(e){super(),En.add(this),In.set(this,void 0),On.set(this,void 0),Mn.set(this,void 0),Ln(this,In,e,"f"),Ln(this,On,[],"f")}get currentChatCompletionSnapshot(){return Fn(this,Mn,"f")}static fromReadableStream(e){const t=new zn(null);return t._run((()=>t._fromReadableStream(e))),t}static createChatCompletion(e,t,n){const r=new zn(t);return r._run((()=>r._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}}))),r}async _createChatCompletion(e,t,n){super._createChatCompletion;const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort()))),Fn(this,En,"m",Rn).call(this);const s=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const e of s)Fn(this,En,"m",jn).call(this,e);if(s.controller.signal?.aborted)throw new V;return this._addChatCompletion(Fn(this,En,"m",Nn).call(this))}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),Fn(this,En,"m",Rn).call(this),this._connected();const r=de.fromReadableStream(e,this.controller);let s;for await(const e of r)s&&s!==e.id&&this._addChatCompletion(Fn(this,En,"m",Nn).call(this)),Fn(this,En,"m",jn).call(this,e),s=e.id;if(r.controller.signal?.aborted)throw new V;return this._addChatCompletion(Fn(this,En,"m",Nn).call(this))}[(In=new WeakMap,On=new WeakMap,Mn=new WeakMap,En=new WeakSet,Rn=function e(){this.ended||Ln(this,Mn,void 0,"f")},$n=function e(t){let n=Fn(this,On,"f")[t.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},Fn(this,On,"f")[t.index]=n,n)},jn=function e(t){if(this.ended)return;const n=Fn(this,En,"m",Bn).call(this,t);this._emit("chunk",t,n);for(const e of t.choices){const t=n.choices[e.index];null!=e.delta.content&&"assistant"===t.message?.role&&t.message?.content&&(this._emit("content",e.delta.content,t.message.content),this._emit("content.delta",{delta:e.delta.content,snapshot:t.message.content,parsed:t.message.parsed})),null!=e.delta.refusal&&"assistant"===t.message?.role&&t.message?.refusal&&this._emit("refusal.delta",{delta:e.delta.refusal,snapshot:t.message.refusal}),null!=e.logprobs?.content&&"assistant"===t.message?.role&&this._emit("logprobs.content.delta",{content:e.logprobs?.content,snapshot:t.logprobs?.content??[]}),null!=e.logprobs?.refusal&&"assistant"===t.message?.role&&this._emit("logprobs.refusal.delta",{refusal:e.logprobs?.refusal,snapshot:t.logprobs?.refusal??[]});const r=Fn(this,En,"m",$n).call(this,t);t.finish_reason&&(Fn(this,En,"m",Tn).call(this,t),null!=r.current_tool_call_index&&Fn(this,En,"m",Pn).call(this,t,r.current_tool_call_index));for(const n of e.delta.tool_calls??[])r.current_tool_call_index!==n.index&&(Fn(this,En,"m",Tn).call(this,t),null!=r.current_tool_call_index&&Fn(this,En,"m",Pn).call(this,t,r.current_tool_call_index)),r.current_tool_call_index=n.index;for(const n of e.delta.tool_calls??[]){const e=t.message.tool_calls?.[n.index];e?.type&&("function"===e?.type&&this._emit("tool_calls.function.arguments.delta",{name:e.function?.name,index:n.index,arguments:e.function.arguments,parsed_arguments:e.function.parsed_arguments,arguments_delta:n.function?.arguments??""}))}}},Pn=function e(t,n){if(Fn(this,En,"m",$n).call(this,t).done_tool_calls.has(n))return;const r=t.message.tool_calls?.[n];if(!r)throw new Error("no tool call snapshot");if(!r.type)throw new Error("tool call snapshot missing `type`");if("function"===r.type){const e=Fn(this,In,"f")?.tools?.find((e=>"function"===e.type&&e.function.name===r.function.name));this._emit("tool_calls.function.arguments.done",{name:r.function.name,index:n,arguments:r.function.arguments,parsed_arguments:Kt(e)?e.$parseRaw(r.function.arguments):e?.function.strict?JSON.parse(r.function.arguments):null})}else r.type},Tn=function e(t){const n=Fn(this,En,"m",$n).call(this,t);if(t.message.content&&!n.content_done){n.content_done=!0;const e=Fn(this,En,"m",Dn).call(this);this._emit("content.done",{content:t.message.content,parsed:e?e.$parseRaw(t.message.content):null})}t.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),t.logprobs?.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),t.logprobs?.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},Nn=function e(){if(this.ended)throw new H("stream has ended, this shouldn't happen");const t=Fn(this,Mn,"f");if(!t)throw new H("request ended without sending any chunks");return Ln(this,Mn,void 0,"f"),Ln(this,On,[],"f"),function n(e,t){const{id:n,choices:r,created:s,model:o,system_fingerprint:i,...a}=e,c={...a,id:n,choices:r.map((({message:t,finish_reason:n,index:r,logprobs:s,...o})=>{if(!n)throw new H(`missing finish_reason for choice ${r}`);const{content:i=null,function_call:a,tool_calls:c,...l}=t,u=t.role;if(!u)throw new H(`missing role for choice ${r}`);if(a){const{arguments:e,name:c}=a;if(null==e)throw new H(`missing function_call.arguments for choice ${r}`);if(!c)throw new H(`missing function_call.name for choice ${r}`);return{...o,message:{content:i,function_call:{arguments:e,name:c},role:u,refusal:t.refusal??null},finish_reason:n,index:r,logprobs:s}}return c?{...o,index:r,finish_reason:n,logprobs:s,message:{...l,role:u,content:i,refusal:t.refusal??null,tool_calls:c.map(((t,n)=>{const{function:s,type:o,id:i,...a}=t,{arguments:c,name:l,...u}=s||{};if(null==i)throw new H(`missing choices[${r}].tool_calls[${n}].id\n${Un(e)}`);if(null==o)throw new H(`missing choices[${r}].tool_calls[${n}].type\n${Un(e)}`);if(null==l)throw new H(`missing choices[${r}].tool_calls[${n}].function.name\n${Un(e)}`);if(null==c)throw new H(`missing choices[${r}].tool_calls[${n}].function.arguments\n${Un(e)}`);return{...a,id:i,type:o,function:{...u,name:l,arguments:c}}}))}}:{...o,message:{...l,content:i,role:u,refusal:t.refusal??null},finish_reason:n,index:r,logprobs:s}})),created:s,model:o,object:"chat.completion",...i?{system_fingerprint:i}:{}};return function l(e,t){return t&&Zt(t)?Vt(e,t):{...e,choices:e.choices.map((e=>({...e,message:{...e.message,parsed:null,tool_calls:e.message.tool_calls??[]}})))}}(c,t)}(t,Fn(this,In,"f"))},Dn=function e(){const t=Fn(this,In,"f")?.response_format;return Ht(t)?t:null},Bn=function e(t){var n,r,s,o;let i=Fn(this,Mn,"f");const{choices:a,...c}=t;i?Object.assign(i,c):i=Ln(this,Mn,{...c,choices:[]},"f");for(const{delta:e,finish_reason:a,index:c,logprobs:l=null,...u}of t.choices){let t=i.choices[c];if(t||(t=i.choices[c]={finish_reason:a,index:c,message:{},logprobs:l,...u}),l)if(t.logprobs){const{content:e,refusal:s,...o}=l;Object.assign(t.logprobs,o),e&&((n=t.logprobs).content??(n.content=[]),t.logprobs.content.push(...e)),s&&((r=t.logprobs).refusal??(r.refusal=[]),t.logprobs.refusal.push(...s))}else t.logprobs=Object.assign({},l);if(a&&(t.finish_reason=a,Fn(this,In,"f")&&Zt(Fn(this,In,"f")))){if("length"===a)throw new ae;if("content_filter"===a)throw new ce}if(Object.assign(t,u),!e)continue;const{content:d,refusal:h,function_call:f,role:p,tool_calls:m,...g}=e;if(Object.assign(t.message,g),h&&(t.message.refusal=(t.message.refusal||"")+h),p&&(t.message.role=p),f&&(t.message.function_call?(f.name&&(t.message.function_call.name=f.name),f.arguments&&((s=t.message.function_call).arguments??(s.arguments=""),t.message.function_call.arguments+=f.arguments)):t.message.function_call=f),d&&(t.message.content=(t.message.content||"")+d,!t.message.refusal&&Fn(this,En,"m",Dn).call(this)&&(t.message.parsed=Cn(t.message.content))),m){t.message.tool_calls||(t.message.tool_calls=[]);for(const{index:e,id:n,type:r,function:s,...i}of m){const a=(o=t.message.tool_calls)[e]??(o[e]={});Object.assign(a,i),n&&(a.id=n),r&&(a.type=r),s&&(a.function??(a.function={name:s.name??"",arguments:""})),s?.name&&(a.function.name=s.name),s?.arguments&&(a.function.arguments+=s.arguments,Yt(Fn(this,In,"f"),a)&&(a.function.parsed_arguments=Cn(a.function.arguments)))}}}return i},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",(n=>{const r=t.shift();r?r.resolve(n):e.push(n)})),this.on("end",(()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),this.on("error",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise(((e,n)=>t.push({resolve:e,reject:n}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0}));return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new de(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Un(e){return JSON.stringify(e)}class qn extends zn{static fromReadableStream(e){const t=new qn(null);return t._run((()=>t._fromReadableStream(e))),t}static runFunctions(e,t,n){const r=new qn(null),s={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run((()=>r._runFunctions(e,t,s))),r}static runTools(e,t,n){const r=new qn(t),s={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run((()=>r._runTools(e,t,s))),r}}class Wn extends rt{parse(e,t){return function n(e){for(const t of e??[]){if("function"!==t.type)throw new H(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new H(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap((t=>Vt(t,e)))}runFunctions(e,t){return e.stream?qn.runFunctions(this._client,e,t):hn.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?qn.runTools(this._client,e,t):hn.runTools(this._client,e,t)}stream(e,t){return zn.createChatCompletion(this._client,e,t)}}class Gn extends rt{constructor(){super(...arguments),this.completions=new Wn(this._client)}}!function(e){e.Completions=Wn}(Gn||(Gn={}));class Xn extends rt{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class Jn extends rt{constructor(){super(...arguments),this.sessions=new Xn(this._client)}}Jn.Sessions=Xn;var Hn,Kn,Vn,Qn,Yn,Zn,er,tr,nr,rr,sr,or,ir,ar,cr,lr,ur,dr,hr,fr,pr,mr,gr=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},yr=function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n};class wr extends Jt{constructor(){super(...arguments),Hn.add(this),Kn.set(this,[]),Vn.set(this,{}),Qn.set(this,{}),Yn.set(this,void 0),Zn.set(this,void 0),er.set(this,void 0),tr.set(this,void 0),nr.set(this,void 0),rr.set(this,void 0),sr.set(this,void 0),or.set(this,void 0),ir.set(this,void 0)}[(Kn=new WeakMap,Vn=new WeakMap,Qn=new WeakMap,Yn=new WeakMap,Zn=new WeakMap,er=new WeakMap,tr=new WeakMap,nr=new WeakMap,rr=new WeakMap,sr=new WeakMap,or=new WeakMap,ir=new WeakMap,Hn=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",(n=>{const r=t.shift();r?r.resolve(n):e.push(n)})),this.on("end",(()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),this.on("error",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise(((e,n)=>t.push({resolve:e,reject:n}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0}));return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new wr;return t._run((()=>t._fromReadableStream(e))),t}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),this._connected();const r=de.fromReadableStream(e,this.controller);for await(const e of r)gr(this,Hn,"m",ar).call(this,e);if(r.controller.signal?.aborted)throw new V;return this._addRun(gr(this,Hn,"m",cr).call(this))}toReadableStream(){return new de(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,r,s){const o=new wr;return o._run((()=>o._runToolAssistantStream(e,t,n,r,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}}))),o}async _createToolAssistantStream(e,t,n,r,s){const o=s?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",(()=>this.controller.abort())));const i={...r,stream:!0},a=await e.submitToolOutputs(t,n,i,{...s,signal:this.controller.signal});this._connected();for await(const e of a)gr(this,Hn,"m",ar).call(this,e);if(a.controller.signal?.aborted)throw new V;return this._addRun(gr(this,Hn,"m",cr).call(this))}static createThreadAssistantStream(e,t,n){const r=new wr;return r._run((()=>r._threadAssistantStream(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}}))),r}static createAssistantStream(e,t,n,r){const s=new wr;return s._run((()=>s._runAssistantStream(e,t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}}))),s}currentEvent(){return gr(this,sr,"f")}currentRun(){return gr(this,or,"f")}currentMessageSnapshot(){return gr(this,Yn,"f")}currentRunStepSnapshot(){return gr(this,ir,"f")}async finalRunSteps(){return await this.done(),Object.values(gr(this,Vn,"f"))}async finalMessages(){return await this.done(),Object.values(gr(this,Qn,"f"))}async finalRun(){if(await this.done(),!gr(this,Zn,"f"))throw Error("Final run was not received.");return gr(this,Zn,"f")}async _createThreadAssistantStream(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort())));const s={...t,stream:!0},o=await e.createAndRun(s,{...n,signal:this.controller.signal});this._connected();for await(const e of o)gr(this,Hn,"m",ar).call(this,e);if(o.controller.signal?.aborted)throw new V;return this._addRun(gr(this,Hn,"m",cr).call(this))}async _createAssistantStream(e,t,n,r){const s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",(()=>this.controller.abort())));const o={...n,stream:!0},i=await e.create(t,o,{...r,signal:this.controller.signal});this._connected();for await(const e of i)gr(this,Hn,"m",ar).call(this,e);if(i.controller.signal?.aborted)throw new V;return this._addRun(gr(this,Hn,"m",cr).call(this))}static accumulateDelta(e,t){for(const[n,r]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=r;continue}let t=e[n];if(null!=t)if("index"!==n&&"type"!==n){if("string"==typeof t&&"string"==typeof r)t+=r;else if("number"==typeof t&&"number"==typeof r)t+=r;else{if(!nt(t)||!nt(r)){if(Array.isArray(t)&&Array.isArray(r)){if(t.every((e=>"string"==typeof e||"number"==typeof e))){t.push(...r);continue}for(const e of r){if(!nt(e))throw new Error(`Expected array delta entry to be an object but got: ${e}`);const n=e.index;if(null==n)throw console.error(e),new Error("Expected array delta entry to have an `index` property");if("number"!=typeof n)throw new Error(`Expected array delta entry \`index\` property to be a number but got ${n}`);const r=t[n];null==r?t.push(e):t[n]=this.accumulateDelta(r,e)}continue}throw Error(`Unhandled record type: ${n}, deltaValue: ${r}, accValue: ${t}`)}t=this.accumulateDelta(t,r)}e[n]=t}else e[n]=r;else e[n]=r}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,r){return await this._createAssistantStream(t,e,n,r)}async _runToolAssistantStream(e,t,n,r,s){return await this._createToolAssistantStream(n,e,t,r,s)}}ar=function e(t){if(!this.ended)switch(yr(this,sr,t,"f"),gr(this,Hn,"m",dr).call(this,t),t.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":gr(this,Hn,"m",mr).call(this,t);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":gr(this,Hn,"m",ur).call(this,t);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":gr(this,Hn,"m",lr).call(this,t);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},cr=function e(){if(this.ended)throw new H("stream has ended, this shouldn't happen");if(!gr(this,Zn,"f"))throw Error("Final run has not been received");return gr(this,Zn,"f")},lr=function e(t){const[n,r]=gr(this,Hn,"m",fr).call(this,t,gr(this,Yn,"f"));yr(this,Yn,n,"f"),gr(this,Qn,"f")[n.id]=n;for(const e of r){const t=n.content[e.index];"text"==t?.type&&this._emit("textCreated",t.text)}switch(t.event){case"thread.message.created":this._emit("messageCreated",t.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",t.data.delta,n),t.data.delta.content)for(const e of t.data.delta.content){if("text"==e.type&&e.text){let t=e.text,r=n.content[e.index];if(!r||"text"!=r.type)throw Error("The snapshot associated with this text delta is not text or missing");this._emit("textDelta",t,r.text)}if(e.index!=gr(this,er,"f")){if(gr(this,tr,"f"))switch(gr(this,tr,"f").type){case"text":this._emit("textDone",gr(this,tr,"f").text,gr(this,Yn,"f"));break;case"image_file":this._emit("imageFileDone",gr(this,tr,"f").image_file,gr(this,Yn,"f"))}yr(this,er,e.index,"f")}yr(this,tr,n.content[e.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==gr(this,er,"f")){const e=t.data.content[gr(this,er,"f")];if(e)switch(e.type){case"image_file":this._emit("imageFileDone",e.image_file,gr(this,Yn,"f"));break;case"text":this._emit("textDone",e.text,gr(this,Yn,"f"))}}gr(this,Yn,"f")&&this._emit("messageDone",t.data),yr(this,Yn,void 0,"f")}},ur=function e(t){const n=gr(this,Hn,"m",hr).call(this,t);switch(yr(this,ir,n,"f"),t.event){case"thread.run.step.created":this._emit("runStepCreated",t.data);break;case"thread.run.step.delta":const e=t.data.delta;if(e.step_details&&"tool_calls"==e.step_details.type&&e.step_details.tool_calls&&"tool_calls"==n.step_details.type)for(const t of e.step_details.tool_calls)t.index==gr(this,nr,"f")?this._emit("toolCallDelta",t,n.step_details.tool_calls[t.index]):(gr(this,rr,"f")&&this._emit("toolCallDone",gr(this,rr,"f")),yr(this,nr,t.index,"f"),yr(this,rr,n.step_details.tool_calls[t.index],"f"),gr(this,rr,"f")&&this._emit("toolCallCreated",gr(this,rr,"f")));this._emit("runStepDelta",t.data.delta,n);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":yr(this,ir,void 0,"f");"tool_calls"==t.data.step_details.type&&gr(this,rr,"f")&&(this._emit("toolCallDone",gr(this,rr,"f")),yr(this,rr,void 0,"f")),this._emit("runStepDone",t.data,n)}},dr=function e(t){gr(this,Kn,"f").push(t),this._emit("event",t)},hr=function e(t){switch(t.event){case"thread.run.step.created":return gr(this,Vn,"f")[t.data.id]=t.data,t.data;case"thread.run.step.delta":let e=gr(this,Vn,"f")[t.data.id];if(!e)throw Error("Received a RunStepDelta before creation of a snapshot");let n=t.data;if(n.delta){const r=wr.accumulateDelta(e,n.delta);gr(this,Vn,"f")[t.data.id]=r}return gr(this,Vn,"f")[t.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":gr(this,Vn,"f")[t.data.id]=t.data}if(gr(this,Vn,"f")[t.data.id])return gr(this,Vn,"f")[t.data.id];throw new Error("No snapshot available")},fr=function e(t,n){let r=[];switch(t.event){case"thread.message.created":return[t.data,r];case"thread.message.delta":if(!n)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let e=t.data;if(e.delta.content)for(const t of e.delta.content)if(t.index in n.content){let e=n.content[t.index];n.content[t.index]=gr(this,Hn,"m",pr).call(this,t,e)}else n.content[t.index]=t,r.push(t);return[n,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(n)return[n,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},pr=function e(t,n){return wr.accumulateDelta(n,t)},mr=function e(t){switch(yr(this,or,t.data,"f"),t.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.cancelling":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":yr(this,Zn,t.data,"f"),gr(this,rr,"f")&&(this._emit("toolCallDone",gr(this,rr,"f")),yr(this,rr,void 0,"f"))}};class br extends rt{create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t={},n){return Ne(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,vr,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}}class vr extends lt{}br.MessagesPage=vr;class _r extends rt{retrieve(e,t,n,r={},s){return Ne(r)?this.retrieve(e,t,n,{},r):this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,t,n={},r){return Ne(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,kr,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}}class kr extends lt{}_r.RunStepsPage=kr;class Sr extends rt{constructor(){super(...arguments),this.steps=new _r(this._client)}create(e,t,n){const{include:r,...s}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:r},body:s,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers},stream:t.stream??!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t={},n){return Ne(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,xr,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}createAndStream(e,t,n){return wr.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const r={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:s,response:o}=await this.retrieve(e,t,{...n,headers:{...n?.headers,...r}}).withResponse();switch(s.status){case"queued":case"in_progress":case"cancelling":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=o.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await Ge(e);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return s}}}stream(e,t,n){return wr.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,t,n,r){const s=await this.submitToolOutputs(e,t,n,r);return await this.poll(e,s.id,r)}submitToolOutputsStream(e,t,n,r){return wr.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,r)}}class xr extends lt{}Sr.RunsPage=xr,Sr.Steps=_r,Sr.RunStepsPage=kr;class Ar extends rt{constructor(){super(...arguments),this.runs=new Sr(this._client),this.messages=new br(this._client)}create(e={},t){return Ne(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.thread_id,n.id,t)}createAndRunStream(e,t){return wr.createThreadAssistantStream(e,this._client.beta.threads,t)}}Ar.Runs=Sr,Ar.RunsPage=xr,Ar.Messages=br,Ar.MessagesPage=vr;class Cr extends rt{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e,t={},n){return Ne(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,Er,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}async poll(e,t,n){const r={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const s=await this.retrieve(e,t,{...n,headers:r}).withResponse(),o=s.data;switch(o.status){case"in_progress":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=s.response.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await Ge(e);break;case"failed":case"completed":return o}}}async upload(e,t,n){const r=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:r.id},n)}async uploadAndPoll(e,t,n){const r=await this.upload(e,t,n);return await this.poll(e,r.id,n)}}class Er extends lt{}Cr.VectorStoreFilesPage=Er;class Ir extends rt{create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t);return await this.poll(e,r.id,n)}listFiles(e,t,n={},r){return Ne(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,Er,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async poll(e,t,n){const r={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:s,response:o}=await this.retrieve(e,t,{...n,headers:r}).withResponse();switch(s.status){case"in_progress":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=o.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await Ge(e);break;case"failed":case"cancelled":case"completed":return s}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},r){if(null==t||0==t.length)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const s=r?.maxConcurrency??5,o=Math.min(s,t.length),i=this._client,a=t.values(),c=[...n];const l=Array(o).fill(a).map((async function u(e){for(let t of e){const e=await i.files.create({file:t,purpose:"assistants"},r);c.push(e.id)}}));return await(async e=>{const t=await Promise.allSettled(e),n=t.filter((e=>"rejected"===e.status));if(n.length){for(const e of n)console.error(e.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const r=[];for(const e of t)"fulfilled"===e.status&&r.push(e.value);return r})(l),await this.createAndPoll(e,{file_ids:c})}}class Or extends rt{constructor(){super(...arguments),this.files=new Cr(this._client),this.fileBatches=new Ir(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},t){return Ne(e)?this.list({},e):this._client.getAPIList("/vector_stores",Mr,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class Mr extends lt{}Or.VectorStoresPage=Mr,Or.Files=Cr,Or.VectorStoreFilesPage=Er,Or.FileBatches=Ir;class Rr extends rt{constructor(){super(...arguments),this.realtime=new Jn(this._client),this.vectorStores=new Or(this._client),this.chat=new Gn(this._client),this.assistants=new Ct(this._client),this.threads=new Ar(this._client)}}Rr.Realtime=Jn,Rr.VectorStores=Or,Rr.VectorStoresPage=Mr,Rr.Assistants=Ct,Rr.AssistantsPage=Et,Rr.Threads=Ar;class $r extends rt{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return Ne(e)?this.list({},e):this._client.getAPIList("/batches",jr,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class jr extends lt{}$r.BatchesPage=jr;class Pr extends rt{create(e,t,n){return this._client.post(`/uploads/${e}/parts`,ke({body:t,...n}))}}class Tr extends rt{constructor(){super(...arguments),this.parts=new Pr(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(`/uploads/${e}/complete`,{body:t,...n})}}var Nr;Tr.Parts=Pr;class Dr extends Re{constructor({baseURL:e=He("OPENAI_BASE_URL"),apiKey:t=He("OPENAI_API_KEY"),organization:n=He("OPENAI_ORG_ID")??null,project:r=He("OPENAI_PROJECT_ID")??null,...s}={}){if(void 0===t)throw new H("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const o={apiKey:t,organization:n,project:r,...s,baseURL:e||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&"undefined"!=typeof window&&"undefined"!=typeof window.document&&"undefined"!=typeof navigator)throw new H("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:o.baseURL,timeout:o.timeout??6e5,httpAgent:o.httpAgent,maxRetries:o.maxRetries,fetch:o.fetch}),this.completions=new st(this),this.chat=new it(this),this.embeddings=new at(this),this.files=new ut(this),this.images=new ht(this),this.audio=new gt(this),this.moderations=new yt(this),this.models=new wt(this),this.fineTuning=new At(this),this.beta=new Rr(this),this.batches=new $r(this),this.uploads=new Tr(this),this._options=o,this.apiKey=t,this.organization=n,this.project=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return O(e,{arrayFormat:"brackets"})}}Nr=Dr,Dr.OpenAI=Nr,Dr.DEFAULT_TIMEOUT=6e5,Dr.OpenAIError=H,Dr.APIError=K,Dr.APIConnectionError=Q,Dr.APIConnectionTimeoutError=Y,Dr.APIUserAbortError=V,Dr.NotFoundError=ne,Dr.ConflictError=re,Dr.RateLimitError=oe,Dr.BadRequestError=Z,Dr.AuthenticationError=ee,Dr.InternalServerError=ie,Dr.PermissionDeniedError=te,Dr.UnprocessableEntityError=se,Dr.toFile=we,Dr.fileFromPath=B,Dr.Completions=st,Dr.Chat=it,Dr.Embeddings=at,Dr.Files=ut,Dr.FileObjectsPage=dt,Dr.Images=ht,Dr.Audio=gt,Dr.Moderations=yt,Dr.Models=wt,Dr.ModelsPage=bt,Dr.FineTuning=At,Dr.Beta=Rr,Dr.Batches=$r,Dr.BatchesPage=jr,Dr.Uploads=Tr;new Set(["/completions","/chat/completions","/embeddings","/audio/transcriptions","/audio/translations","/audio/speech","/images/generations"]);const Br=Dr;var Lr=i(352),Fr=i(669),zr=i(873),Ur=i(315);const qr=()=>(Fr.Ll?process.env.LLM_MODEL:Ur.f.LLM_MODEL)||"mistralai/Mistral-Small-24B-Instruct-2501";class Wr{static get client(){var e;return null!==(e=this._client)&&void 0!==e?e:this._client=new Br({baseURL:"https://api.deepinfra.com/v1/openai",apiKey:Fr.Ll?process.env.DEEPINFRA_API_KEY:Ur.f.DEEPINFRA_API_KEY,dangerouslyAllowBrowser:Fr.Bd})}static async prompt(e,{model:t=qr(),maxTokens:n=16384,seed:r=0xb03903d1159f4,temperature:s=0}={}){const{DEEPINFRA_API_KEY:o}=Ur.f;if(Fr.Bd&&!o)try{return await Lr.F.post("deep-infra/prompt",{prompt:e})}catch(t){return console.warn(t),await Lr.F.post("prompt",{prompt:e})}const{client:i}=Wr;try{const{choices:[{message:o}={message:{content:""}}],usage:a}=await i.chat.completions.create({max_tokens:n,messages:[{role:"user",content:e}],model:t,seed:r,temperature:s}),{content:c}=o;return{result:null!=c?c:"",usage:a}}catch(e){throw e}}static async transcribe(e){const{DEEPINFRA_API_KEY:t}=Ur.f;if(Fr.Bd&&!t)return Lr.F.post("deep-infra/transcribe",{file:e});const{client:n}=Wr;return await n.audio.transcriptions.create({file:e,model:"openai/whisper-large-v3-turbo",response_format:"verbose_json",language:"en",timestamp_granularities:["segment"]})}}Object.assign(globalThis,{DeepInfraService:Wr});var Gr=i(901),Xr=i(831);const Jr=e=>e.filter((({speaker:e})=>null!=e)),Hr=e=>{const t=Jr(e);let n=(0,o.Am)(t.map((0,o.by)("speaker")));const r=(0,o.cz)(t.map((0,o.by)("text")).map(f.aL).map((0,o.by)("length")));return Object.fromEntries(n.map((e=>[e,(0,o.cz)(t.filter((0,o.by)("speaker",e)).map((0,o.by)("text")).map(f.aL).map((0,o.by)("length")))/r])))},Kr=e=>{const t=Jr(e);let n=(0,o.Am)(t.map((0,o.by)("speaker")));const r=t.length;return Object.fromEntries(n.map((e=>[e,t.filter((0,o.by)("speaker",e)).length/r])))},Vr=e=>.05/e,Qr=e=>(0,o.Am)(e.filter((e=>null!=e.speaker)).map((0,o.by)("speaker"))),Yr=e=>Qr(e).length,Zr=([e,t,n])=>(t&&n?e=t+n:n?e&&e>n&&(t=e-n):t&&e&&e>t&&(n=e-t),[e,t,n]);let es;const ts=async()=>null!=es?es:es=new Set(await(0,Xr.RO)(i.e(142).then(i.t.bind(i,142,19)))),ns=async e=>{if(await(async e=>{const t=await ts(),n=(0,o.KC)(e.segments.map((e=>e.wordsSet.intersection(t))));return e.clients?n.size>=e.clients:n.size})(e))return await(async e=>{const t=await ts(),{segments:n}=e,r=n.filter((e=>e.wordsSet.intersection(t).size)),s=r.flatMap((e=>[n[r.indexOf(e)-1],n[r.indexOf(e)+1]].filter(Boolean)));return(0,o.Am)(s)})(e);const t=Yr(e.segments),n=[];for(const r of e.segments){n.push(r);const e=Yr(n),s=(0,o.Os)(n,(0,o.by)("speaker"));if(e===t&&s.length===e&&s.map((0,o.by)("length")).every((e=>e>=3)))break}return n},rs=e=>e.clinicians||(e.clients?Yr(e.segments)-e.clients:0),ss=e=>e.clients||(e.clinicians?Yr(e.segments)-e.clinicians:0),os=()=>("undefined"==typeof clinicianList?[]:clinicianList).map((0,o.by)("name")),is=()=>("undefined"==typeof patientList?[]:patientList).map((0,o.by)("name")),as=e=>1.3*((0,o.cz)(e,(0,o.by)("wordCount"))+e.length),cs=async(e,t=!1)=>{const n=e.clients||e.clinicians,r=rs(e),s=ss(e),o=(t?e.segments:await ns(e)).slice();let i=0,a=0;for(;(a=as(o))>16e3;)i+=1,(0,Gr.Rm)(`removing segment due to token count of ${a} (${i} removed so far)`),o.pop();const c=o.map((e=>`[${e.speaker}] ${e.text}`)).join("\n"),l=n?r:"one or more",u=n?s:"one or more",d=await(async e=>{const t=await ts(),{segments:n}=e;return n.flatMap((e=>[...e.wordsSet.intersection(t)]))})(e),h=os(),p=is(),m=h.length&&p.length,g=m?"":`names found in the transcript: ${(0,f.Rt)(d)}`,y=m?`\n\t\tthe list of names you have to work with as values are as follows:\n\n\t\tClinicians: ${h.join(", ")}\n\t\tClients: ${p.join(", ")}\n\n\t\twhen inferring a name, only appropriately selected values from the above lists should be used (appropriate depending on role).\n\t\tdo not use any name more times than it appears above (there may be two 'Sam's in a session but if that is the case the name will appear twice in the list)\n\t`:"";return Gr.Rm.data("transcript-names",d),`\n\t\tthe following is a ${t?"":"partial "}transcript of a therapy session. the numbers or names in brackets (e.g. [0] ...text... or [Sally] ...text...)\n\t\tpreceding each segment's text are speaker labels which indicate who was responsible for uttering the following text.\n\t\t${l} of the participants are the clinician(s) leading the session, but this is not indicated by the speaker labels.\n\t\tthe remaining ${u} participants are the clients receiving the treatment- this is also not indicated by the speaker labels.\n\t\t${t?"":"the segments selected are all those containing a first name and their immediate neighbors."}\n\t\t${g}\n\t\t------\n\t\t${c}\n\t\t------\n\t\tplease analyze the transcript and do your best to infer the mapping between speaker label as indicated, and speaker name or speaker role + index.\n\t\t${y}\n\t\tif you can determine which speaker(s) are the clinician(s), use that ("Clinician") (or "Clinician 1", "Clinician 2" for multiple) instead of trying to infer a name\n\t\tif you cannot determine a name for a given (non-clinician) speaker, (but you can be sure they aren't a clinician) then use "Client 1", "Client 2" etc. instead\n\t\tonly produce a key value pair if you can be fairly certain that you're able to deduce the correct name / role + index\n\t\t(for example, if a speaker says "Hi, I'm Melissa" (speaker -> "Melissa") or "Okay guys, let's begin" (speaker -> "Clinician" or "Clinician 1", etc.), (others -> "Client" or "Client 1", "Client 2", etc.) depending).\n\t\tthe mapping should be 1 to 1 (there should never be more than a single speaker label pointing to a single name or role).\n\t\t${t?"":"if you are nearly but not sufficiently able to be sure of any mappings, include the text MORE_DATA_NEEDED anywhere in your response."}\n\t\treturn the mapping in the form:\n\t\t------\n\t\tSpeaker 1::inferred-name-or-role-1\n\t\tSpeaker 2::inferred-name-or-role-2\n\t\t...etc...\n\t\t------\n\t`},ls=async e=>{var t,r,s;let o,i=await cs(e,!0);Gr.Rm.data("llm-prompt",i);try{({result:o}=await Wr.prompt(i))}catch(t){return Gr.Rm.data("llm-result",t),e}if(Gr.Rm.data("llm-result",o),o.includes("MORE_DATA_NEEDED")){(0,Gr.Rm)("WARN: sending full transcript to llm"),i=await cs(e,!0),Gr.Rm.data("llm-prompt",i);try{({result:o}=await Wr.prompt(i,{seed:0xb03903d1159f4}))}catch(t){return Gr.Rm.data("llm-result",t),e}Gr.Rm.data("llm-result",o)}const a=o.split("\n").filter((e=>e.includes("::"))).map((e=>e.split("::").map((e=>e.trim())))).filter((e=>2===e.length&&e[1]&&e[0]!==e[1]&&"unknown"!==e[1].toLowerCase())),c=new Set(Qr(e.segments));for(const[r,s]of a){let o=r.replace("[","").replace("]","").trim();if(!c.has(o)){const e=o.toLowerCase().replaceAll(" ","");o=null!==(t=[...c].find((t=>e.includes(t.toLowerCase().replaceAll(" ","")))))&&void 0!==t?t:o}e.speakerMap.set(o,(0,n.kR)(s.trim()))}const u=[...e.speakerMap.values()].flatMap((t=>{const n=[...e.speakerMap.keys()].filter((n=>e.speakerMap.get(n)===t));return n.length>1?n:[]}));u.length&&(0,Gr.Rm)(`found degenerate keys ${u.join(", ")}`);for(const t of u)e.speakerMap.delete(t);const d=os(),h=is();if(d.length&&h.length){const t=e=>!/^client ?\d*$/i.test(e)&&!/^clinician ?\d*$/i.test(e)&&!/^speaker ?\d*$/i.test(e),n=[...e.speakerMap.values()].filter(t).filter((e=>!d.includes(e)&&!h.includes(e)));for(const t of n){const n=l.ef.key(e.speakerMap,t);n&&e.speakerMap.delete(n)}}const f=[...e.speakerMap.values()],p=f.filter((e=>e.includes("Clinician"))),m=f.filter((e=>e.includes("Client"))),g=f.filter((e=>!e.includes("Clinician")&&!e.includes("Client"))),y=new Set(e.speakerMap.keys()),w=c.difference(y),b=rs(e)&&rs(e)===p.length,v=ss(e)&&ss(e)===m.length+g.length,_=p.length,k=m.length+g.length;w.size&&(b?[...w].forEach(((t,n)=>e.speakerMap.set(t,`Client ${n+k+1}`))):v&&[...w].forEach(((t,n)=>e.speakerMap.set(t,`Clinician ${n+_+1}`))));const S=()=>(0,l.B8)(e.speakerMap),x=rs(e),A=ss(e);1===x&&S().has("Clinician 1")?e.speakerMap.set(S().get("Clinician 1"),"Clinician"):x>1&&S().has("Clinician")&&e.speakerMap.set(S().get("Clinician"),"Clinician 1"),1===A&&S().has("Client 1")?e.speakerMap.set(S().get("Client 1"),"Client"):A>1&&S().has("Client")&&e.speakerMap.set(S().get("Client"),"Client 1");const C=[...e.speakerMap.values()].filter((e=>e.includes("Clinician"))).length,E=[...e.speakerMap.values()].filter((e=>e.includes("Client"))).length<=A;if(C<=x){const t=null!==(r=localStorage.getItem("userName"))&&void 0!==r?r:"",s=t&&!/^(?:true|false)$/.test(t);if(b&&1===p.length&&"Clinician"===p[0]&&s){const r=1===d.length?d[0]:(0,n.kR)(t);e.speakerMap.set(S().get("Clinician"),r)}}else for(const t of[...e.speakerMap.keys()].filter((t=>{var n;return null===(n=e.speakerMap.get(t))||void 0===n?void 0:n.includes("Clinician")})))e.speakerMap.delete(t);if(E){const t=(0,n.ZH)(null!==(s=sessionStorage.callClients)&&void 0!==s?s:"client"),r=e=>(0,n.ZH)(e.replace(/client/i,t));for(const[t,n]of e.speakerMap)/client/i.test(n)&&e.speakerMap.set(t,r(n))}else for(const t of[...e.speakerMap.keys()].filter((t=>{var n;return null===(n=e.speakerMap.get(t))||void 0===n?void 0:n.includes("Client")})))e.speakerMap.delete(t);return Gr.Rm.data("arg.speakerMap",e.speakerMap),{speakerMap:e.speakerMap,segments:e.segments}},us=e=>t=>(Gr.Rm.data("llm-result",t),e);class ds{constructor(e=[]){this.items=e,this.items=e.slice()}get(){return this.items.shift()}add(e){this.items.push(e)}get empty(){return!this.items.length}get pending(){return this.items.length}}var hs=i(784);class fs extends hs.v{constructor(){super(),this.input=new ds,this.sources=[],this.sinks=[],this.aborts=[],this.add=e=>{const t=this.input.empty;this.input.add(e),t&&this.processInputs()},this.source=e=>(e&&this.add(e),this),this.errors=[],this.process=async e=>{const t=this.sourcesDone&&0===this.input.pending;for(const n of this.modules)e&&(e=await n.process(e,t));return e},this.modules=new.target.modules.map((e=>new e));for(const e of this.modules)e.addEventListener("message",(({data:{status:e,args:t}})=>{"error"===e&&this.errors.push(t[0])}));this.outputPromise=new Promise(((e,t)=>{this.resolveOutput=e,this.rejectOutput=t}))}addSource(e){return e.addEventListener("next",this.add),this.sources.push(e),this}connect(e){this.addSink(e.source),e.sources.push(this)}addSink(e){return this.sinks.push(e),this}addAbort(e){return this.outputPromise.catch(e),this}static get isReady(){return(new this).isReady}get isReady(){return this.modules.every((0,o.by)("isReady"))}get sourcesDone(){return this.sources.every((0,o.by)("done"))}get done(){return this.sourcesDone&&this.input.empty&&this.output}get errored(){return this.errors.length}async processInputs(){var e,t;try{for(;!this.input.empty&&!this.errored;){const e=this.input.get(),t=await this.process(e);t&&(await Promise.all(this.sinks.map((e=>e(t)))),this.output=t)}}catch(e){this.errors.push(e)}if(this.done)return null===(e=this.resolveOutput)||void 0===e||e.call(this,this.output),this.output;this.errored&&(this.dispose(),null===(t=this.rejectOutput)||void 0===t||t.call(this,this.errors.map((e=>`${e}`)).join("\n")))}dispose(){this.sources.forEach((e=>{try{e.removeEventListener("next",this.add)}catch(e){}})),this.sources=[],this.modules.forEach((e=>e.terminate()))}}fs.modules=[],fs.preload=()=>{};class ps{static get isReady(){return this.pipelines.every((0,o.by)("isReady"))}get isReady(){return this.constructor.isReady}get done(){return this.pipelines.every((0,o.by)("done"))}addSource(e){for(const t of this.inputPipelines)t.addSource(e);return this}get sinks(){return this.outputPipeline.sinks}addSink(e){return this.outputPipeline.addSink(e),this}addAbort(e){return this.pipelines.forEach((t=>t.addAbort(e))),this}static get pipelines(){return[...this.inputPipelines,this.outputPipeline]}constructor(){this.inputPipelines=new.target.inputPipelines.map((e=>new e)),this.outputPipeline=new this.constructor.outputPipeline;for(const e of this.inputPipelines)e.connect(this.outputPipeline);this.outputPromise=this.outputPipeline.outputPromise,this.pipelines=[...this.inputPipelines,this.outputPipeline]}dispose(){this.pipelines.forEach((e=>e.dispose()))}}ps.preload=()=>{},ps.inputPipelines=[];class ms{constructor(e=((e,t)=>e<t)){this.lessThan=e,this.length=0,this.A=[]}push(e){const{A:t}=this;t.push(e);let n=t.length-1;for(;n>0&&!this.lessThan(t[n/2|0],t[n]);){const e=t[n/2|0];t[n/2|0]=t[n],t[n]=e,n=n/2|0}this.length+=1}pop(){const{A:e}=this;if(0===e.length)return;const t=e[0];return e[0]=e[e.length-1],this.heapify(0),e.length-=1,this.length-=1,t}heapify(e){const t=2*(e+=1),n=2*e+1,{A:r}=this;let s;if(s=t<=r.length&&this.lessThan(r[t-1],r[e-1])?t:e,n<=r.length&&this.lessThan(r[n-1],r[s-1])&&(s=n),s!==e){const t=r[e-1];r[e-1]=r[s-1],r[s-1]=t,this.heapify(s-1)}}}var gs=i(279),ys=i(75);const ws={async get(){var e;return null!==(e=gs.I.db.get("speaker-data"))&&void 0!==e?e:{}},set:async e=>gs.I.db.set("speaker-data",e)};class bs{static async new({db:e=ws,key:t="default",clinicians:n=0,clients:r=0,numSpeakers:s=0,matchThreshold:o=.5,matchesToKeepInContention:i=5,debug:a=!1}={}){const c=await e.get();return new bs(c,{db:e,key:t,clinicians:n,clients:r,numSpeakers:s,matchThreshold:o,matchesToKeepInContention:i,debug:a})}constructor(e,t){this.dbData=e,this.config=t,this.cache=new Map,this.isPersistableSpeaker=e=>!e.includes("Speaker")}get data(){var e,t,n;return null!==(e=(t=this.dbData)[n=this.config.key])&&void 0!==e?e:t[n]=[]}get clinicianData(){const e=this.data.filter((e=>"clinician"===e.name||"clinician"===e.role));return{id:"clinician",name:"clinician",role:"clinician",embeddings:e.flatMap((0,o.by)("embeddings")),timestamps:e.flatMap((0,o.by)("timestamps"))}}get clientData(){const e=this.data.filter((e=>"client"===e.name||"client"===e.role));return{id:"client",name:"client",role:"client",embeddings:e.flatMap((0,o.by)("embeddings")),timestamps:e.flatMap((0,o.by)("timestamps"))}}matchesForEmbedding(e,t){if(this.cache.has(e))return this.cache.get(e);const{data:n}=this,r=new Map(n.map((({embeddings:t})=>[t,(0,s.kA)(e,t)]))),o=n.filter((({embeddings:e})=>r.get(e)>=this.config.matchThreshold));return((e,t,n)=>{const r=new ms(((e,n)=>t(e)<t(n)));for(const s of e)(r.length<n||t(s)>t(r.A[0]))&&(r.length===n&&r.pop(),r.push(s));return r.A})(o,(({embeddings:e})=>r.get(e)),null!=t?t:o.length).map((e=>({...e,confidence:r.get(e.embeddings)})))}matchEmbedding(e,t=1){if(this.cache.has(e))return this.cache.get(e);const n=this.matchesForEmbedding(e,t);return n.length&&this.cache.set(e,n),n}computeSpeakerDeduction(e,t){const n=(0,ys.tB)(),{name:r}=t,i=t.embeddings.map((t=>(0,s.k8)(e,t))),a={speaker:r,similarity:{max:(0,o.T9)(i),min:(0,o.jk)(i),mean:(0,o.i2)(i),median:(0,o.JZ)(i)}},c=(0,ys.tB)()-n;return Object.assign(a,{elapsed:c})}assignSpeaker(e){if(!this.data.length)return e;const{embedding:t}=e;if(t){const[n]=this.matchEmbedding(t,this.config.matchesToKeepInContention);if(n&&(e.deducedSpeaker=n.name,e.deducedSpeakerConfidence=n.confidence),this.config.debug){const n=this.data.map((e=>this.computeSpeakerDeduction(t,e)));e.speakerDeduction=null==n?void 0:n[0],e.speakerDeductions=n}}return e}assignSpeakers(e){const t=(0,o.WH)(e,(e=>e.speaker)),n=Object.fromEntries([...t.keys()].map((e=>[e,(0,o.WH)(t.get(e),(e=>e.deducedSpeaker)).toCountMap()]))),r=Object.fromEntries(Object.entries(n).map((([e,t])=>[e,(0,o.Ph)(Object.entries(t),(e=>e[1]))[0]])));return e.forEach((e=>{var t;return e.speaker=null!==(t=e.deducedSpeaker)&&void 0!==t?t:r[e.speaker]})),e}matchData(e){const{data:t}=this,n=t.filter((({name:t})=>t===e.name)),r=(0,o.Bp)(n,(t=>(0,s.gz)(t.embeddings,e.embeddings)));if(r&&(0,s.gz)(r.embeddings,e.embeddings)<.333)return r}hasPersistableData(e){return e.speakers.length&&e.speakers.some(this.isPersistableSpeaker)}canDeduce(e){const t=(0,o.i2)(e.map((e=>{var t;return null!==(t=e.deducedSpeakerConfidence)&&void 0!==t?t:0})));return this.config.debug&&console.log(n.n`speaker deducer found mean confidence ${t}. ${t>.5?"will deduce":"will not deduce"}.`),t>.5}async persistFromTranscript(e){var t;const n=e.unprocessedSegments.filter((e=>e.speaker&&this.isPersistableSpeaker(e.speaker)&&e.embedding)),r=new Map(e.speakers.map((e=>[e,n.filter((0,o.by)("speaker",e))]))),s=(0,ys.tB)();for(const n of e.speakers){const e=null!==(t=localStorage.getItem("userName"))&&void 0!==t?t:"",i=e&&!/^(?:true|false)$/.test(e)?e:n,a=n.toLowerCase().includes("clinician")||n.toLowerCase()===i.toLowerCase(),c=a?"clinician":"client",l=a?i:n.toLowerCase().includes("client")?"client":n,u={id:crypto.randomUUID(),name:l,role:c,embeddings:r.get(n).map((0,o.by)("embedding")),timestamps:[s]},d=this.matchData(u);d?(d.embeddings.push(...u.embeddings),d.timestamps.push(s)):this.data.push(u)}await this.config.db.set(this.dbData)}}class vs extends fs{}vs.modules=[class _s extends u{async process(e){var t;return null===(t=e.useLLM)||void 0===t||t?await ls(e).catch(us(e)):await(async e=>{var t;const n=(await i.e(142).then(i.t.bind(i,142,19))).default,r=new Set(n),{segments:s,speakerMap:a}=e,c=(0,o.Am)(s.map((0,o.by)("speaker"))).length;if(2!==c)return(0,Gr.Rm)(`infer speaker names module exiting early due to non-2 speaker count of ${c}`),a.clear(),{segments:s,speakerMap:a};const l=s.flatMap((e=>(0,f.aL)(e.text).filter((e=>r.has(e)))));if((0,Gr.Rm)(`infer speaker names module found names ${l.join(", ")} in the transcript`),!l.length)return a.clear(),{segments:s,speakerMap:a};const u=(0,o.Os)(l),d=(0,o.i8)(u,(0,o.by)("length"))[0][0];(0,Gr.Rm)(`infer speaker names module found most mentioned name to be ${d}`);const h=null!==(t=(0,o.Mq)(s.filter((e=>e.text.includes(d))).map((0,o.by)("speaker"))))&&void 0!==t?t:"";let p=""+(1==+h?0:1);return"string"==typeof h&&(p=`${p}`),a.set(h,"Clinician"),a.set(p,d),(0,Gr.Rm)(`speaker ${h} mentioned this name the most. inferring him to be the Clinician`),{speakerMap:a,segments:s}})(e)}},h];class ks extends fs{}ks.modules=[class Ss extends u{async process(e){var t;const{segments:n}=e;for(const e of n){const{componentSegments:n}=e,r=null!==(t=null==n?void 0:n.map((e=>e.deducedSpeaker)))&&void 0!==t?t:[],s=(0,o.Mq)(r);e.speaker=s,null==n||n.forEach((e=>e.speaker=s))}return e}},h];class xs extends fs{}xs.modules=[h];class As extends fs{}As.modules=[d,class Cs extends u{async process(e){const t=new l.xP;if(!(0,o.Am)(e.map((0,o.by)("speaker"))).every((e=>{const[t,r]=e.split(" ");return"Speaker"===t&&(0,n.kf)(r)})))return e;for(const n of e)t.has(n.speaker)||t.set(n.speaker,`Speaker ${t.size+1}`);for(const n of e)n.speaker=t.get(n.speaker);return e}}];var Es=i(512),Is=i.n(Es);function Os(){return Is()('(()=>{var e,t,n={612:function(e){var t;"undefined"!=typeof self&&self,t=()=>(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function r(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,(o=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,"string");if("object"!==n(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(s.key),"symbol"===n(o)?o:String(o)),s)}var o}e.r(t),e.d(t,{default:()=>i});var i=function(){function e(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).sampleRate;(function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this._context=this._createContext(t),t||(t=this._context.sampleRate),this._sampleRate=t}var t,n;return t=e,n=[{key:"_createContext",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:44100;return window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,new AudioContext({sampleRate:e})}},{key:"context",get:function(){return this._context}},{key:"fetchAudio",value:async function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return await Promise.all(n.map((async function(t){var n;return n=t instanceof File||t instanceof Blob?await t.arrayBuffer():await fetch(t).then((function(e){return e.headers.has("Content-Type")&&!e.headers.get("Content-Type").includes("audio/")&&console.warn("Crunker: Attempted to fetch an audio file, but its MIME type is `".concat(e.headers.get("Content-Type").split(";")[0],"`. We\'ll try and continue anyway. (file: \\"").concat(t,\'")\')),e.arrayBuffer()})),await e._context.decodeAudioData(n)})))}},{key:"mergeAudio",value:function(e){var t=this._context.createBuffer(this._maxNumberOfChannels(e),this._sampleRate*this._maxDuration(e),this._sampleRate);return e.forEach((function(e){for(var n=0;n<e.numberOfChannels;n++){for(var r=t.getChannelData(n),s=e.getChannelData(n),o=e.getChannelData(n).length-1;o>=0;o--)r[o]+=s[o];t.getChannelData(n).set(r)}})),t}},{key:"concatAudio",value:function(e){var t=this._context.createBuffer(this._maxNumberOfChannels(e),this._totalLength(e),this._sampleRate),n=0;return e.forEach((function(e){for(var r=0;r<e.numberOfChannels;r++)t.getChannelData(r).set(e.getChannelData(r),n);n+=e.length})),t}},{key:"padAudio",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(0===n)return e;if(t<0)throw new Error(\'Crunker: Parameter "padStart" in padAudio must be positive\');if(n<0)throw new Error(\'Crunker: Parameter "seconds" in padAudio must be positive\');for(var r=this._context.createBuffer(e.numberOfChannels,Math.ceil(e.length+n*e.sampleRate),e.sampleRate),s=0;s<e.numberOfChannels;s++){var o=e.getChannelData(s);r.getChannelData(s).set(o.subarray(0,Math.ceil(t*e.sampleRate)+1),0),r.getChannelData(s).set(o.subarray(Math.ceil(t*e.sampleRate)+2,r.length+1),Math.ceil((t+n)*e.sampleRate))}return r}},{key:"sliceAudio",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(t>=n)throw new Error(\'Crunker: "start" time should be less than "end" time in sliceAudio method\');for(var o=Math.round((n-t)*this._sampleRate),i=Math.round(t*this._sampleRate),a=this._context.createBuffer(e.numberOfChannels,o,this._sampleRate),c=0;c<e.numberOfChannels;c++)for(var l=e.getChannelData(c),u=a.getChannelData(c),h=0;h<o;h++)u[h]=l[i+h],h<r*this._sampleRate&&(u[h]*=h/(r*this._sampleRate)),h>o-s*this._sampleRate&&(u[h]*=(o-h)/(s*this._sampleRate));return a}},{key:"play",value:function(e){var t=this._context.createBufferSource();return t.buffer=e,t.connect(this._context.destination),t.start(),t}},{key:"export",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"audio/wav",n=this._interleave(e),r=this._writeHeaders(n,e.numberOfChannels,e.sampleRate),s=new Blob([r],{type:t});return{blob:s,url:this._renderURL(s),element:this._renderAudioElement(s)}}},{key:"download",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"crunker",n=document.createElement("a");return n.style.display="none",n.href=this._renderURL(e),n.download="".concat(t,".").concat(e.type.split("/")[1]),n.click(),n}},{key:"notSupported",value:function(e){return this._isSupported()?void 0:e()}},{key:"close",value:function(){return this._context.close(),this}},{key:"_maxDuration",value:function(e){return Math.max.apply(Math,r(e.map((function(e){return e.duration}))))}},{key:"_maxNumberOfChannels",value:function(e){return Math.max.apply(Math,r(e.map((function(e){return e.numberOfChannels}))))}},{key:"_totalLength",value:function(e){return e.map((function(e){return e.length})).reduce((function(e,t){return e+t}),0)}},{key:"_isSupported",value:function(){return"AudioContext"in window||"webkitAudioContext"in window||"mozAudioContext"in window}},{key:"_writeHeaders",value:function(e,t,n){var r=2*t,s=2*e.length,o=36+s,i=new ArrayBuffer(8+o),a=new DataView(i);return this._writeString(a,0,"RIFF"),a.setUint32(4,o,!0),this._writeString(a,8,"WAVE"),this._writeString(a,12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,t,!0),a.setUint32(24,n,!0),a.setUint32(28,n*r,!0),a.setUint16(32,r,!0),a.setUint16(34,16,!0),this._writeString(a,36,"data"),a.setUint32(40,s,!0),this._floatTo16BitPCM(a,e,44)}},{key:"_floatTo16BitPCM",value:function(e,t,n){for(var r=0;r<t.length;r++,n+=2){var s=Math.max(-1,Math.min(1,t[r]));e.setInt16(n,s<0?32768*s:32767*s,!0)}return e}},{key:"_writeString",value:function(e,t,n){for(var r=0;r<n.length;r++)e.setUint8(t+r,n.charCodeAt(r))}},{key:"_interleave",value:function(e){if(1===e.numberOfChannels)return e.getChannelData(0);for(var t=[],n=0;n<e.numberOfChannels;n++)t.push(e.getChannelData(n));for(var r=t.reduce((function(e,t){return e+t.length}),0),s=new Float32Array(r),o=0,i=0;o<r;)t.forEach((function(e){s[o++]=e[i]})),i++;return s}},{key:"_renderAudioElement",value:function(e){var t=document.createElement("audio");return t.controls=!0,t.src=this._renderURL(e),t}},{key:"_renderURL",value:function(e){return(window.URL||window.webkitURL).createObjectURL(e)}}],n&&o(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();return t})(),e.exports=t()},790:(e,t,n)=>{\n/*!\n    localForage -- Offline Storage, Improved\n    Version 1.10.0\n    https://localforage.github.io/localForage\n    (c) 2013-2017 Mozilla, Apache License 2.0\n*/\ne.exports=function e(t,n,r){function s(i,a){if(!n[i]){if(!t[i]){if(o)return o(i,!0);var c=new Error("Cannot find module \'"+i+"\'");throw c.code="MODULE_NOT_FOUND",c}var l=n[i]={exports:{}};t[i][0].call(l.exports,(function(e){var n=t[i][1][e];return s(n||e)}),l,l.exports,e,t,n,r)}return n[i].exports}for(var o=void 0,i=0;i<r.length;i++)s(r[i]);return s}({1:[function(e,t,r){(function(e){"use strict";var n,r,s=e.MutationObserver||e.WebKitMutationObserver;if(s){var o=0,i=new s(u),a=e.document.createTextNode("");i.observe(a,{characterData:!0}),n=function(){a.data=o=++o%2}}else if(e.setImmediate||"undefined"==typeof e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){u(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(u,0)};else{var c=new e.MessageChannel;c.port1.onmessage=u,n=function(){c.port2.postMessage(0)}}var l=[];function u(){var e,t;r=!0;for(var n=l.length;n;){for(t=l,l=[],e=-1;++e<n;)t[e]();n=l.length}r=!1}function h(e){1!==l.push(e)||r||n()}t.exports=h}).call(this,"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){"use strict";var r=e(1);function s(){}var o={},i=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==s&&d(this,e)}function u(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function h(e,t,n){r((function(){var r;try{r=t(n)}catch(t){return o.reject(e,t)}r===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,r)}))}function f(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function n(){t.apply(e,arguments)}}function d(e,t){var n=!1;function r(t){n||(n=!0,o.reject(e,t))}function s(t){n||(n=!0,o.resolve(e,t))}function i(){t(s,r)}var a=p(i);"error"===a.status&&r(a.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}function m(e){return e instanceof this?e:o.resolve(new this(s),e)}function g(e){var t=new this(s);return o.reject(t,e)}function y(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var i=new Array(n),a=0,c=-1,l=new this(s);++c<n;)u(e[c],c);return l;function u(e,s){function c(e){i[s]=e,++a!==n||r||(r=!0,o.resolve(l,i))}t.resolve(e).then(c,(function(e){r||(r=!0,o.reject(l,e))}))}}function w(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var i=-1,a=new this(s);++i<n;)c(e[i]);return a;function c(e){t.resolve(e).then((function(e){r||(r=!0,o.resolve(a,e))}),(function(e){r||(r=!0,o.reject(a,e))}))}}t.exports=l,l.prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===i)return this;var n=new this.constructor(s);return this.state!==c?h(n,this.state===a?e:t,this.outcome):this.queue.push(new u(n,e,t)),n},u.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){h(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){o.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){h(this.promise,this.onRejected,e)},o.resolve=function(e,t){var n=p(f,t);if("error"===n.status)return o.reject(e,n.value);var r=n.value;if(r)d(e,r);else{e.state=a,e.outcome=t;for(var s=-1,i=e.queue.length;++s<i;)e.queue[s].callFulfilled(t)}return e},o.reject=function(e,t){e.state=i,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},l.resolve=m,l.reject=g,l.all=y,l.race=w},{1:1}],3:[function(e,t,r){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}var i=o();function a(){try{if(!i||!i.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}function c(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(s){if("TypeError"!==s.name)throw s;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var l=Promise;function u(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function h(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function f(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function d(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var p="local-forage-detect-blob-support",m=void 0,g={},y=Object.prototype.toString,w="readonly",b="readwrite";function v(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),s=0;s<t;s++)r[s]=e.charCodeAt(s);return n}function _(e){return new l((function(t){var n=e.transaction(p,b),r=c([""]);n.objectStore(p).put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\\/(\\d+)/),n=navigator.userAgent.match(/Edge\\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}function x(e){return"boolean"==typeof m?l.resolve(m):_(e).then((function(e){return m=e}))}function S(e){var t=g[e.name],n={};n.promise=new l((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function k(e){var t=g[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function A(e,t){var n=g[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function E(e,t){return new l((function(n,r){if(g[e.name]=g[e.name]||N(),e.db){if(!t)return n(e.db);S(e),e.db.close()}var s=[e.name];t&&s.push(e.version);var o=i.open.apply(i,s);t&&(o.onupgradeneeded=function(t){var n=o.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(p)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn(\'The database "\'+e.name+\'" has been upgraded from version \'+t.oldVersion+" to version "+t.newVersion+\', but the storage "\'+e.storeName+\'" already exists.\')}}),o.onerror=function(e){e.preventDefault(),r(o.error)},o.onsuccess=function(){var t=o.result;t.onversionchange=function(e){e.target.close()},n(t),k(e)}}))}function C(e){return E(e,!1)}function I(e){return E(e,!0)}function O(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,s=e.version>e.db.version;if(r&&(e.version!==t&&console.warn(\'The database "\'+e.name+"\\" can\'t be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),s||n){if(n){var o=e.db.version+1;o>e.version&&(e.version=o)}return!0}return!1}function R(e){return new l((function(t,n){var r=new FileReader;r.onerror=n,r.onloadend=function(n){var r=btoa(n.target.result||"");t({__local_forage_encoded_blob:!0,data:r,type:e.type})},r.readAsBinaryString(e)}))}function $(e){return c([v(atob(e.data))],{type:e.type})}function M(e){return e&&e.__local_forage_encoded_blob}function j(e){var t=this,n=t._initReady().then((function(){var e=g[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return h(n,e,e),n}function P(e){S(e);for(var t=g[e.name],n=t.forages,r=0;r<n.length;r++){var s=n[r];s._dbInfo.db&&(s._dbInfo.db.close(),s._dbInfo.db=null)}return e.db=null,C(e).then((function(t){return e.db=t,O(e)?I(e):t})).then((function(r){e.db=t.db=r;for(var s=0;s<n.length;s++)n[s]._dbInfo.db=r})).catch((function(t){throw A(e,t),t}))}function T(e,t,n,r){void 0===r&&(r=1);try{var s=e.db.transaction(e.storeName,t);n(null,s)}catch(s){if(r>0&&(!e.db||"InvalidStateError"===s.name||"NotFoundError"===s.name))return l.resolve().then((function(){if(!e.db||"NotFoundError"===s.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),I(e)})).then((function(){return P(e).then((function(){T(e,t,n,r-1)}))})).catch(n);n(s)}}function N(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function D(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var s=g[n.name];s||(s=N(),g[n.name]=s),s.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=j);var o=[];function i(){return l.resolve()}for(var a=0;a<s.forages.length;a++){var c=s.forages[a];c!==t&&o.push(c._initReady().catch(i))}var u=s.forages.slice(0);return l.all(o).then((function(){return n.db=s.db,C(n)})).then((function(e){return n.db=e,O(n,t._defaultConfig.version)?I(n):e})).then((function(e){n.db=s.db=e,t._dbInfo=n;for(var r=0;r<u.length;r++){var o=u[r];o!==t&&(o._dbInfo.db=n.db,o._dbInfo.version=n.version)}}))}function B(e,t){var n=this;e=f(e);var r=new l((function(t,r){n.ready().then((function(){T(n._dbInfo,w,(function(s,o){if(s)return r(s);try{var i=o.objectStore(n._dbInfo.storeName).get(e);i.onsuccess=function(){var e=i.result;void 0===e&&(e=null),M(e)&&(e=$(e)),t(e)},i.onerror=function(){r(i.error)}}catch(e){r(e)}}))})).catch(r)}));return u(r,t),r}function L(e,t){var n=this,r=new l((function(t,r){n.ready().then((function(){T(n._dbInfo,w,(function(s,o){if(s)return r(s);try{var i=o.objectStore(n._dbInfo.storeName).openCursor(),a=1;i.onsuccess=function(){var n=i.result;if(n){var r=n.value;M(r)&&(r=$(r));var s=e(r,n.key,a++);void 0!==s?t(s):n.continue()}else t()},i.onerror=function(){r(i.error)}}catch(e){r(e)}}))})).catch(r)}));return u(r,t),r}function F(e,t,n){var r=this;e=f(e);var s=new l((function(n,s){var o;r.ready().then((function(){return o=r._dbInfo,"[object Blob]"===y.call(t)?x(o.db).then((function(e){return e?t:R(t)})):t})).then((function(t){T(r._dbInfo,b,(function(o,i){if(o)return s(o);try{var a=i.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var c=a.put(t,e);i.oncomplete=function(){void 0===t&&(t=null),n(t)},i.onabort=i.onerror=function(){var e=c.error?c.error:c.transaction.error;s(e)}}catch(e){s(e)}}))})).catch(s)}));return u(s,n),s}function z(e,t){var n=this;e=f(e);var r=new l((function(t,r){n.ready().then((function(){T(n._dbInfo,b,(function(s,o){if(s)return r(s);try{var i=o.objectStore(n._dbInfo.storeName).delete(e);o.oncomplete=function(){t()},o.onerror=function(){r(i.error)},o.onabort=function(){var e=i.error?i.error:i.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return u(r,t),r}function U(e){var t=this,n=new l((function(e,n){t.ready().then((function(){T(t._dbInfo,b,(function(r,s){if(r)return n(r);try{var o=s.objectStore(t._dbInfo.storeName).clear();s.oncomplete=function(){e()},s.onabort=s.onerror=function(){var e=o.error?o.error:o.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return u(n,e),n}function q(e){var t=this,n=new l((function(e,n){t.ready().then((function(){T(t._dbInfo,w,(function(r,s){if(r)return n(r);try{var o=s.objectStore(t._dbInfo.storeName).count();o.onsuccess=function(){e(o.result)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return u(n,e),n}function W(e,t){var n=this,r=new l((function(t,r){e<0?t(null):n.ready().then((function(){T(n._dbInfo,w,(function(s,o){if(s)return r(s);try{var i=o.objectStore(n._dbInfo.storeName),a=!1,c=i.openKeyCursor();c.onsuccess=function(){var n=c.result;n?0===e||a?t(n.key):(a=!0,n.advance(e)):t(null)},c.onerror=function(){r(c.error)}}catch(e){r(e)}}))})).catch(r)}));return u(r,t),r}function G(e){var t=this,n=new l((function(e,n){t.ready().then((function(){T(t._dbInfo,w,(function(r,s){if(r)return n(r);try{var o=s.objectStore(t._dbInfo.storeName).openKeyCursor(),i=[];o.onsuccess=function(){var t=o.result;t?(i.push(t.key),t.continue()):e(i)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return u(n,e),n}function H(e,t){t=d.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,s=this;if(e.name){var o=e.name===n.name&&s._dbInfo.db?l.resolve(s._dbInfo.db):C(e).then((function(t){var n=g[e.name],r=n.forages;n.db=t;for(var s=0;s<r.length;s++)r[s]._dbInfo.db=t;return t}));r=e.storeName?o.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;S(e);var r=g[e.name],s=r.forages;t.close();for(var o=0;o<s.length;o++){var a=s[o];a._dbInfo.db=null,a._dbInfo.version=n}var c=new l((function(t,r){var s=i.open(e.name,n);s.onerror=function(e){s.result.close(),r(e)},s.onupgradeneeded=function(){s.result.deleteObjectStore(e.storeName)},s.onsuccess=function(){var e=s.result;e.close(),t(e)}}));return c.then((function(e){r.db=e;for(var t=0;t<s.length;t++){var n=s[t];n._dbInfo.db=e,k(n._dbInfo)}})).catch((function(t){throw(A(e,t)||l.resolve()).catch((function(){})),t}))}})):o.then((function(t){S(e);var n=g[e.name],r=n.forages;t.close();for(var s=0;s<r.length;s++)r[s]._dbInfo.db=null;var o=new l((function(t,n){var r=i.deleteDatabase(e.name);r.onerror=function(){var e=r.result;e&&e.close(),n(r.error)},r.onblocked=function(){console.warn(\'dropInstance blocked for database "\'+e.name+\'" until all open connections are closed\')},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}}));return o.then((function(e){n.db=e;for(var t=0;t<r.length;t++)k(r[t]._dbInfo)})).catch((function(t){throw(A(e,t)||l.resolve()).catch((function(){})),t}))}))}else r=l.reject("Invalid arguments");return u(r,t),r}var X={_driver:"asyncStorage",_initStorage:D,_support:a(),iterate:L,getItem:B,setItem:F,removeItem:z,clear:U,length:q,key:W,keys:G,dropInstance:H};function J(){return"function"==typeof openDatabase}var K="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",V="~~local_forage_type~",Q=/^~~local_forage_type~([^~]+)~/,Y="__lfsc__:",Z=Y.length,ee="arbf",te="blob",ne="si08",re="ui08",se="uic8",oe="si16",ie="si32",ae="ur16",ce="ui32",le="fl32",ue="fl64",he=Z+ee.length,fe=Object.prototype.toString;function de(e){var t,n,r,s,o,i=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(i--,"="===e[e.length-2]&&i--);var l=new ArrayBuffer(i),u=new Uint8Array(l);for(t=0;t<a;t+=4)n=K.indexOf(e[t]),r=K.indexOf(e[t+1]),s=K.indexOf(e[t+2]),o=K.indexOf(e[t+3]),u[c++]=n<<2|r>>4,u[c++]=(15&r)<<4|s>>2,u[c++]=(3&s)<<6|63&o;return l}function pe(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=K[n[t]>>2],r+=K[(3&n[t])<<4|n[t+1]>>4],r+=K[(15&n[t+1])<<2|n[t+2]>>6],r+=K[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}function me(e,t){var n="";if(e&&(n=fe.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===fe.call(e.buffer))){var r,s=Y;e instanceof ArrayBuffer?(r=e,s+=ee):(r=e.buffer,"[object Int8Array]"===n?s+=ne:"[object Uint8Array]"===n?s+=re:"[object Uint8ClampedArray]"===n?s+=se:"[object Int16Array]"===n?s+=oe:"[object Uint16Array]"===n?s+=ae:"[object Int32Array]"===n?s+=ie:"[object Uint32Array]"===n?s+=ce:"[object Float32Array]"===n?s+=le:"[object Float64Array]"===n?s+=ue:t(new Error("Failed to get type for BinaryArray"))),t(s+pe(r))}else if("[object Blob]"===n){var o=new FileReader;o.onload=function(){var n=V+e.type+"~"+pe(this.result);t(Y+te+n)},o.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn\'t convert value into a JSON string: ",e),t(null,n)}}function ge(e){if(e.substring(0,Z)!==Y)return JSON.parse(e);var t,n=e.substring(he),r=e.substring(Z,he);if(r===te&&Q.test(n)){var s=n.match(Q);t=s[1],n=n.substring(s[0].length)}var o=de(n);switch(r){case ee:return o;case te:return c([o],{type:t});case ne:return new Int8Array(o);case re:return new Uint8Array(o);case se:return new Uint8ClampedArray(o);case oe:return new Int16Array(o);case ae:return new Uint16Array(o);case ie:return new Int32Array(o);case ce:return new Uint32Array(o);case le:return new Float32Array(o);case ue:return new Float64Array(o);default:throw new Error("Unkown type: "+r)}}var ye={serialize:me,deserialize:ge,stringToBuffer:de,bufferToString:pe};function we(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function be(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var s=new l((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(s){we(s,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=ye,s}function ve(e,t,n,r,s,o){e.executeSql(n,r,s,(function(e,i){i.code===i.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type=\'table\' AND name = ?",[t.storeName],(function(e,a){a.rows.length?o(e,i):we(e,t,(function(){e.executeSql(n,r,s,o)}),o)}),o):o(e,i)}),o)}function _e(e,t){var n=this;e=f(e);var r=new l((function(t,r){n.ready().then((function(){var s=n._dbInfo;s.db.transaction((function(n){ve(n,s,"SELECT * FROM "+s.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=s.serializer.deserialize(r)),t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,t),r}function xe(e,t){var n=this,r=new l((function(t,r){n.ready().then((function(){var s=n._dbInfo;s.db.transaction((function(n){ve(n,s,"SELECT * FROM "+s.storeName,[],(function(n,r){for(var o=r.rows,i=o.length,a=0;a<i;a++){var c=o.item(a),l=c.value;if(l&&(l=s.serializer.deserialize(l)),void 0!==(l=e(l,c.key,a+1)))return void t(l)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,t),r}function Se(e,t,n,r){var s=this;e=f(e);var o=new l((function(o,i){s.ready().then((function(){void 0===t&&(t=null);var a=t,c=s._dbInfo;c.serializer.serialize(t,(function(t,l){l?i(l):c.db.transaction((function(n){ve(n,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){o(a)}),(function(e,t){i(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(r>0)return void o(Se.apply(s,[e,a,n,r-1]));i(t)}}))}))})).catch(i)}));return u(o,n),o}function ke(e,t,n){return Se.apply(this,[e,t,n,1])}function Ae(e,t){var n=this;e=f(e);var r=new l((function(t,r){n.ready().then((function(){var s=n._dbInfo;s.db.transaction((function(n){ve(n,s,"DELETE FROM "+s.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,t),r}function Ee(e){var t=this,n=new l((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){ve(t,r,"DELETE FROM "+r.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return u(n,e),n}function Ce(e){var t=this,n=new l((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){ve(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(t,n){var r=n.rows.item(0).c;e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return u(n,e),n}function Ie(e,t){var n=this,r=new l((function(t,r){n.ready().then((function(){var s=n._dbInfo;s.db.transaction((function(n){ve(n,s,"SELECT key FROM "+s.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,t),r}function Oe(e){var t=this,n=new l((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){ve(t,r,"SELECT key FROM "+r.storeName,[],(function(t,n){for(var r=[],s=0;s<n.rows.length;s++)r.push(n.rows.item(s).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return u(n,e),n}function Re(e){return new l((function(t,n){e.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type=\'table\' AND name <> \'__WebKitDatabaseInfoTable__\'",[],(function(n,r){for(var s=[],o=0;o<r.rows.length;o++)s.push(r.rows.item(o).name);t({db:e,storeNames:s})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}function $e(e,t){t=d.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,s=this;return u(r=e.name?new l((function(t){var r;r=e.name===n.name?s._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:r,storeNames:[e.storeName]}):t(Re(r))})).then((function(e){return new l((function(t,n){e.db.transaction((function(r){function s(e){return new l((function(t,n){r.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var o=[],i=0,a=e.storeNames.length;i<a;i++)o.push(s(e.storeNames[i]));l.all(o).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):l.reject("Invalid arguments"),t),r}var Me={_driver:"webSQLStorage",_initStorage:be,_support:J(),iterate:xe,getItem:_e,setItem:ke,removeItem:Ae,clear:Ee,length:Ce,key:Ie,keys:Oe,dropInstance:$e};function je(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}function Pe(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function Te(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}function Ne(){return!Te()||localStorage.length>0}function De(e){var t=this,n={};if(e)for(var r in e)n[r]=e[r];return n.keyPrefix=Pe(e,t._defaultConfig),Ne()?(t._dbInfo=n,n.serializer=ye,l.resolve()):l.reject()}function Be(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return u(n,e),n}function Le(e,t){var n=this;e=f(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r}));return u(r,t),r}function Fe(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,s=r.length,o=localStorage.length,i=1,a=0;a<o;a++){var c=localStorage.key(a);if(0===c.indexOf(r)){var l=localStorage.getItem(c);if(l&&(l=t.serializer.deserialize(l)),void 0!==(l=e(l,c.substring(s),i++)))return l}}}));return u(r,t),r}function ze(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t}));return u(r,t),r}function Ue(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],s=0;s<n;s++){var o=localStorage.key(s);0===o.indexOf(e.keyPrefix)&&r.push(o.substring(e.keyPrefix.length))}return r}));return u(n,e),n}function qe(e){var t=this.keys().then((function(e){return e.length}));return u(t,e),t}function We(e,t){var n=this;e=f(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return u(r,t),r}function Ge(e,t,n){var r=this;e=f(e);var s=r.ready().then((function(){void 0===t&&(t=null);var n=t;return new l((function(s,o){var i=r._dbInfo;i.serializer.serialize(t,(function(t,r){if(r)o(r);else try{localStorage.setItem(i.keyPrefix+e,t),s(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||o(e),o(e)}}))}))}));return u(s,n),s}function He(e,t){if(t=d.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r,s=this;return r=e.name?new l((function(t){e.storeName?t(Pe(e,s._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):l.reject("Invalid arguments"),u(r,t),r}var Xe={_driver:"localStorageWrapper",_initStorage:De,_support:je(),iterate:Fe,getItem:Le,setItem:Ge,removeItem:We,clear:Be,length:qe,key:ze,keys:Ue,dropInstance:He},Je=function e(t,n){return t===n||"number"==typeof t&&"number"==typeof n&&isNaN(t)&&isNaN(n)},Ke=function e(t,n){for(var r=t.length,s=0;s<r;){if(Je(t[s],n))return!0;s++}return!1},Ve=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Qe={},Ye={},Ze={INDEXEDDB:X,WEBSQL:Me,LOCALSTORAGE:Xe},et=[Ze.INDEXEDDB._driver,Ze.WEBSQL._driver,Ze.LOCALSTORAGE._driver],tt=["dropInstance"],nt=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(tt),rt={description:"",driver:et.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function st(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function ot(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(Ve(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var it=function(){function e(t){for(var n in s(this,e),Ze)if(Ze.hasOwnProperty(n)){var r=Ze[n],o=r._driver;this[n]=o,Qe[o]||this.defineDriver(r)}this._defaultConfig=ot({},rt),this._config=ot({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function e(t){if("object"===("undefined"==typeof t?"undefined":r(t))){if(this._ready)return new Error("Can\'t call config() after localforage has been used.");for(var n in t){if("storeName"===n&&(t[n]=t[n].replace(/\\W/g,"_")),"version"===n&&"number"!=typeof t[n])return new Error("Database version must be a number.");this._config[n]=t[n]}return!("driver"in t)||!t.driver||this.setDriver(this._config.driver)}return"string"==typeof t?this._config[t]:this._config},e.prototype.defineDriver=function e(t,n,r){var s=new l((function(e,n){try{var r=t._driver,s=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!t._driver)return void n(s);for(var o=nt.concat("_initStorage"),i=0,a=o.length;i<a;i++){var c=o[i];if((!Ke(tt,c)||t[c])&&"function"!=typeof t[c])return void n(s)}var h=function e(){for(var n=function e(t){return function(){var e=new Error("Method "+t+" is not implemented by the current driver"),n=l.reject(e);return u(n,arguments[arguments.length-1]),n}},r=0,s=tt.length;r<s;r++){var o=tt[r];t[o]||(t[o]=n(o))}};h();var f=function n(s){Qe[r]&&console.info("Redefining LocalForage driver: "+r),Qe[r]=t,Ye[r]=s,e()};"_support"in t?t._support&&"function"==typeof t._support?t._support().then(f,n):f(!!t._support):f(!0)}catch(e){n(e)}}));return h(s,n,r),s},e.prototype.driver=function e(){return this._driver||null},e.prototype.getDriver=function e(t,n,r){var s=Qe[t]?l.resolve(Qe[t]):l.reject(new Error("Driver not found."));return h(s,n,r),s},e.prototype.getSerializer=function e(t){var n=l.resolve(ye);return h(n,t),n},e.prototype.ready=function e(t){var n=this,r=n._driverSet.then((function(){return null===n._ready&&(n._ready=n._initDriver()),n._ready}));return h(r,t,t),r},e.prototype.setDriver=function e(t,n,r){var s=this;Ve(t)||(t=[t]);var o=this._getSupportedDrivers(t);function i(){s._config.driver=s.driver()}function a(e){return s._extend(e),i(),s._ready=s._initStorage(s._config),s._ready}function c(e){return function(){var t=0;function n(){for(;t<e.length;){var r=e[t];return t++,s._dbInfo=null,s._ready=null,s.getDriver(r).then(a).catch(n)}i();var o=new Error("No available storage method found.");return s._driverSet=l.reject(o),s._driverSet}return n()}}var u=null!==this._driverSet?this._driverSet.catch((function(){return l.resolve()})):l.resolve();return this._driverSet=u.then((function(){var e=o[0];return s._dbInfo=null,s._ready=null,s.getDriver(e).then((function(e){s._driver=e._driver,i(),s._wrapLibraryMethodsWithReady(),s._initDriver=c(o)}))})).catch((function(){i();var e=new Error("No available storage method found.");return s._driverSet=l.reject(e),s._driverSet})),h(this._driverSet,n,r),this._driverSet},e.prototype.supports=function e(t){return!!Ye[t]},e.prototype._extend=function e(t){ot(this,t)},e.prototype._getSupportedDrivers=function e(t){for(var n=[],r=0,s=t.length;r<s;r++){var o=t[r];this.supports(o)&&n.push(o)}return n},e.prototype._wrapLibraryMethodsWithReady=function e(){for(var t=0,n=nt.length;t<n;t++)st(this,nt[t])},e.prototype.createInstance=function t(n){return new e(n)},e}(),at=new it;t.exports=at},{3:3}]},{},[4])(4)},669:(e,t,n)=>{"use strict";n.d(t,{Bd:()=>f,KV:()=>m,Ll:()=>c,NG:()=>o,RK:()=>i,_o:()=>g,dv:()=>b,iF:()=>y,pE:()=>w,ri:()=>l,xD:()=>h});const r="undefined"!=typeof navigator&&navigator.userAgent.includes("Firefox");let s=48e3;if("undefined"!=typeof AudioContext){const e=new AudioContext;s=e.sampleRate,e.close()}const o=r?s:16e3,i=256,a=(!!globalThis.navigator&&/Mobi|Android/i.test(navigator.userAgent),"undefined"==typeof location?"":location.search),c="undefined"!=typeof process,l=!c&&"undefined"!=typeof location&&location.pathname.includes("/dashboard"),u="undefined"!=typeof AudioWorkletProcessor,h="undefined"!=typeof DedicatedWorkerGlobalScope||u,f=!c&&(h||u||"undefined"!=typeof navigator),d="undefined"!=typeof location&&("localhost"===location.hostname||location.href.startsWith("blob:http://localhost")),p=f&&"undefined"!=typeof location&&(location.host.includes("nuiq.com")||location.href.startsWith("blob:https://nuiq.com")||d&&"3004"!==location.port),m=("undefined"!=typeof location&&(location.host.includes("stage.nuiq.com")||location.href.startsWith("blob:https://stage.nuiq.com")),!!c||p&&!d),g=d||/debug(\\=true)?($|&)/.test(a),y=("undefined"!=typeof navigator&&/Safari/i.test(navigator.userAgent)&&navigator.userAgent.includes("Chrome"),`https://${a.includes("useDevServer=true")?"asrd.nuzi.ai":"asr.nuzi.ai"}`),w="turbo",b=(Math.PI,3e4)}},r={};function s(e){var t=r[e];if(void 0!==t)return t.exports;var o=r[e]={exports:{}};return n[e].call(o.exports,o,o.exports,s),o.exports}s.m=n,s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,s.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"==typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"==typeof n.then)return n}var o=Object.create(null);s.r(o);var i={};e=e||[null,t({}),t([]),t(t)];for(var a=2&r&&n;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>i[e]=()=>n[e]));return i.default=()=>n,s.d(o,i),o},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce(((t,n)=>(s.f[n](e,t),t)),[])),s.u=e=>e+".nuiq-asr.worker.js",s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=n[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\\?.*$/,"").replace(/\\/[^\\/]+$/,"/"),s.p=e})(),(()=>{var e={945:1};s.f.i=(t,n)=>{e[t]||importScripts(s.p+s.u(t))};var t=self.webpackChunkNuiqASR=self.webpackChunkNuiqASR||[],n=t.push.bind(t);t.push=t=>{var[r,o,i]=t;for(var a in o)s.o(o,a)&&(s.m[a]=o[a]);for(i&&i(s);r.length;)e[r.pop()]=1;n(t)}})(),(()=>{"use strict";var e,t;const n=(...e)=>e.reduce(((e,t)=>(e[t]=t,e)),{}),r=n("milliseconds","seconds","minutes","hours","days","weeks"),o=n("ms","s","m","h","d","w"),i=36e5,a=864e5,c={milliseconds:1,seconds:1e3,minutes:6e4,hours:i,days:a,weeks:7*a},l={ms:"milliseconds",s:"seconds",m:"minutes",h:"hours",d:"days",w:"weeks"};Number.prototype.in=function(e){return this/("number"==typeof e?e:c[e])},Object.defineProperties(Number.prototype,Object.values(r).reduce(((e,t)=>(e[t]={get(){return this*c[t]}},e)),{})),Object.defineProperties(Number.prototype,Object.values(o).reduce(((e,t)=>(e[t]={get(){return d(this*c[l[t]])}},e)),{}));const u="undefined"==typeof performance?()=>currentTime:performance.now.bind(performance),h="undefined"==typeof performance?u:()=>performance.timeOrigin+f(),f=new(t=class t extends Function{constructor(){super("return performance.now();"),this[e]=u}},e=Symbol.toPrimitive,t),d=e=>{let t=!1;const n=new Promise((n=>setTimeout((()=>!t&&n()),e)));return Object.assign(n,{cancel:()=>{t=!0}})},{fromEntries:p,keys:m}=((new Date).getDay(),Object),g=["string","number","boolean"],y=[null,void 0];function w(e){const t=typeof e;return g.includes(t)||y.includes(e)}const{parse:b,stringify:v}=JSON,_=e=>(e=>{const t=Object.keys(e),n=Object.getOwnPropertySymbols(e).filter((t=>{var n;return null===(n=Object.getOwnPropertyDescriptor(e,t))||void 0===n?void 0:n.enumerable}));return[...t,...n]})(e).map((t=>[t,e[t]])),x=(e,t)=>{for(const[n,r]of _(Object.getOwnPropertyDescriptors(t)))r.enumerable&&(r.get||r.set)&&Object.defineProperty(e,n,r);return e};var S=s(669);["upload","listen","summarize","telehealth"].map((e=>`finished-${e}-transcriptions`));const k=(e,t=void 0)=>e instanceof Function?e(t):e,A=(e,t=100,n=!0)=>{let r,s=-t,o=0;return(...i)=>{const a=performance.now();return a-s>=t?(s=a,o&&clearTimeout(o),r=e(...i)):(o&&clearTimeout(o),n&&(o=setTimeout((()=>r=e(...i)),t)),r)}},E=(e,t,n=(()=>{}))=>(...r)=>k(e)?t(...r):n(...r),C=(e,t,n=null)=>e.apply(n,t),I=async(e=4)=>await new Promise((t=>setTimeout(t,e)));var O;let R=!1;try{R=!1}catch(t){}const $=globalThis.setTimeout||(e=>{});class M{}O=M,M.passed=0,M.failed=0,M.testPromises=[],M.expect=E(R,((e,t,n="")=>{const r=new Promise((r=>$((async()=>{const s=await k(e),o=k(t),i=s===o,a=null!=n?n:e instanceof Function?e.name:"";i?O.passed+=1:(console.error(` failed InlineTest::${a} (expected ${o}, got ${s})`),O.failed+=1),r()}))));return O.testPromises.push(r),r})),$(E(R,(async()=>{await Promise.all(O.testPromises);const{passed:e,failed:t}=O,n=e+t;console.log(` InlineTest: passed ${e} / ${n} (${q(e/n)})`),t&&console.log(` InlineTest: failed ${t} / ${n} (${q(t/n)})`)})),5..seconds);const j=new Map,P=e=>{const t=JSON.stringify(e);return j.has(t)?j.get(t):(j.set(t,e),e)};M.expect(P({a:1,b:2,c:3}),P({a:1,b:2,c:3}));const{floor:T,max:N,round:D}=Math,{isArray:B}=Array,{entries:L}=Object,{ListFormat:F}=Intl,z=e=>{var t;return`${(null!==(t=e[0])&&void 0!==t?t:"").toUpperCase()}${e.slice(1)}`},U=e=>e.split(" ").map(z).join(" "),q=e=>H(e)?`${W(100*+e)}%`:"0%",W=e=>e.toFixed(/\\./.test(`${e}`)?2:0),G=new Set(["boolean","symbol"]),H=e=>!G.has(typeof e)&&""!==e&&+e==+e,X=/\\./,J=e=>{const t=`${e}`;let n=X.test(t);const r=(n?t.split(X)[0]:t).length>3;n&&(n=!r);const s=N(((e,t=Infinity)=>{const n=`${e}`.split(".")[1];if(!n)return 2;const r=n.split("").findIndex((e=>"0"!==e))+1;return r>t?2:r})(e,4),2);return n?(+e).toFixed(s):r?(e=>(new Intl.NumberFormat).format(e))(D(e)):t},K=(e,...t)=>(t=t.map((e=>H(e)?J(e):e)),String.raw({raw:e},...t)),V=(e,{joiner:t=", ",emptyText:n="none"}={})=>B(e)?e.length?e.join(t):n:e,Q=(e,{joiner:t="\\n",listJoiner:n=", ",emptyText:r="none",indentLevel:s=0}={})=>L(e).map((([e,o])=>{const i=w(o),a=B(o)||i,c=!i&&!a,l=c?`${t}${t}`:" ",u=c?t:"",h="\\t".repeat(s);return K`${h}${e}:${l}${a?V(o,{joiner:n,emptyText:r}):Q(o,{joiner:t,listJoiner:n,emptyText:r,indentLevel:s+1})}${u}`})).join(t);new F("en",{style:"long",type:"conjunction"});class Y extends Map{constructor(e,t=null){super(t),this.getDefault=e,this.getDefault=e}get(e){if(this.has(e))return super.get(e);const t=this.getDefault(e);return this.set(e,t),t}}Map;WeakMap;class Z extends Map{constructor(){super(...arguments),this.history=[]}set(e,t){const n=super.set(e,t);return this.history.push([e,t]),n}delete(e){const t=super.delete(e);return this.history.push([e,super.get(e)]),t}}class ee extends Map{constructor(e){super(e),this.inverseMap=new Map([...null!=e?e:[]].map((([e,t])=>[t,e])))}key(e){return this.inverseMap.get(e)}value(e){return this.get(e)}static key(e,t){return new ee(e.entries()).key(t)}static value(e,t){return new ee(e.entries()).value(t)}set(e,t){const n=super.set(e,t);return this.inverseMap.set(t,e),n}delete(e){this.has(e)&&this.inverseMap.delete(this.get(e));return super.delete(e)}clear(){const e=super.clear();return this.inverseMap.clear(),e}}const{log10:te}=Math,ne=(e,t,n=.5)=>e*(1-n)+t*n,re=(e,t,n)=>t-e?(n-e)/(t-e):0,se=(e=.5,t=0,n=1)=>Math.max(Math.min(e,n),t),{floor:oe,max:ie,min:ae,pow:ce,random:le,sqrt:ue}=Math,he=e=>e[e.length-1],fe=function(e,t=(e=>0)){return e.slice().sort(((e,n)=>t(e)-t(n)))},de=function(e,t=(e=>0)){return e.slice().sort(((e,n)=>t(n)-t(e)))};new Intl.Collator("en");function pe(e,t){return n=>null==t?n[e]:t instanceof Function?t(n[e]):n[e]===t}pe("length");const me=(e,t)=>e[t%e.length],ge=function(e,t){return Re(e,e.filter((e=>e!==t)))},ye=(e,t=(e=>e))=>{let n=0;for(let r=0;r<e.length;r+=1)n+=t(e[r]);return n},we=(e,t=(e=>e))=>ye(e,t)/e.length,be=(e,t=(e=>e))=>{const n=[].sort.call(e.map(t),((e,t)=>e-t)),r=n.length,s=oe(.5*r);return r%2?n[s]:.5*(n[s-1]+n[s])},ve=(e,t=(e=>e))=>ie.apply(null,e.map((e=>t(e)))),_e=(e,t=(e=>e))=>ae.apply(null,e.map((e=>t(e)))),xe=(e,t=(e=>e))=>{e=e.map((e=>t(e)));const n=we(e),r=[];let s=e.length;for(;s-- >0;)r.push(ce(e[s]-n,2));return we(r)},Se=(e,t=(e=>e))=>{var n;const r=new Map;for(const s of e){const e=t(s);r.set(e,(null!==(n=r.get(e))&&void 0!==n?n:0)+1)}const s=Math.max.apply(null,[...r.values()]);return[...r.keys()].find((e=>r.get(e)===s))},ke={sum:ye,mean:we,median:be,mode:Se,min:_e,max:ve,range:(e,t=(e=>e))=>(e=e.map((e=>t(e))),ve(e)-_e(e)),deviation:(e,t=(e=>e))=>ue(xe(e,t)),variance:xe},Ae=Object.keys(ke),Ee=(e,t=(e=>e))=>{const n=new Map;for(const r of e)n.set(t(r),r);return[...n.values()]};function Ce(e){if(!e.length)return new Float32Array(0);const t=new Float32Array(e[0].length);for(let n=0;n<e[0].length;n+=1)for(const r of e)t[n]+=r[n];return t}const Ie=(e,t)=>{const n=Array.from({length:e});return t instanceof Function?n.map(((e,n)=>t(n))):n.fill(null!=t?t:0)},Oe=e=>e.indexOf(ve(e)),Re=(e,t)=>{let{length:n}=t;for(e.length!==n&&(e.length=n);n-- >0;)e[n]=t[n];return e},$e=Re,Me=(e,t=(e=>e))=>{const n=new Y((()=>[]));for(let r=0;r<e.length;r+=1){const s=e[r];n.get(t(s,r)).push(s)}return[...n.values()]},je=(e,t)=>t<1?e[Math.floor(t*e.length)]:e[Math.floor(t)];let{from:Pe}=Array;const Te=(e,t=((e,t)=>e))=>("number"==typeof e?Ie(e):e).map(((e,n,r)=>t(n,r))),Ne=(e,t=(e=>e))=>{const n=_e(e,t),r=ve(e,t);return e.map((e=>re(n,r,e)))},De=(e,t,n)=>{let r=0;for(const s of e){const e=n[s];for(const n of t)r+=e[n]}return r/e.length/t.length},Be=function e(t,n,r){const s=t.length,o=n.length;let i=0;for(let e=0;e<s;e+=1){const n=r[t[e]];for(let r=e+1;r<s;r+=1)i+=n[t[r]]**2}for(let e=0;e<o;e+=1){const t=r[n[e]];for(let r=e+1;r<o;r+=1)i+=t[n[r]]**2}for(let e=0;e<s;e+=1){const s=r[t[e]];for(let e=0;e<o;e+=1)i+=s[n[e]]**2}const a=(s+o)*(s+o-1)/2;return Math.sqrt(i/a)},Le=(e,t,n)=>{let r=Number.MAX_SAFE_INTEGER;for(const s of e){const e=n[s];for(const n of t){const t=e[n];t<r&&(r=t)}}return r},Fe=function e(t,n,r){let s=0;for(const e of t){const t=r[e];for(const e of n){const n=t[e];n>s&&(s=n)}}return s},ze=De,Ue=Fe,qe=Be,We=new Map,Ge={average:De,ward:Be,single:Le,complete:Fe,composite:(e,t,n)=>{let r=We.get(e);r||We.set(e,r=new Map);let s=r.get(t);if(null!=s)return s;return s=ze(e,t,n)+Ue(e,t,n)+qe(e,t,n),r.set(t,s),s}};var He,Xe;const Je=globalThis.requestIdleCallback||(globalThis.requestIdleCallback=e=>+setTimeout((()=>e({didTimeout:!1,timeRemaining:()=>1}))));globalThis.cancelIdleCallback||(globalThis.cancelIdleCallback=clearTimeout);null!==(He=(Xe=Set.prototype).union)&&void 0!==He||(Xe.union=function(e){const t=new Set(this);for(const n of e.keys())t.add(n);return t});\n/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\nconst Ke=Symbol("Comlink.proxy"),Ve=Symbol("Comlink.endpoint"),Qe=Symbol("Comlink.releaseProxy"),Ye=Symbol("Comlink.finalizer"),Ze=Symbol("Comlink.thrown"),et=e=>"object"==typeof e&&null!==e||"function"==typeof e,tt=new Map([["proxy",{canHandle:e=>et(e)&&e[Ke],serialize(e){const{port1:t,port2:n}=new MessageChannel;return nt(e,t),[n,[n]]},deserialize:e=>(e.start(),function t(e,n){return ct(e,[],n)}(e))}],["throw",{canHandle:e=>et(e)&&Ze in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function nt(e,t=globalThis,n=["*"]){t.addEventListener("message",(function r(s){if(!s||!s.data)return;if(!function o(e,t){for(const n of e){if(t===n||"*"===n)return!0;if(n instanceof RegExp&&n.test(t))return!0}return!1}(n,s.origin))return void console.warn(`Invalid origin \'${s.origin}\' for comlink proxy`);const{id:i,type:a,path:c}=Object.assign({path:[]},s.data),l=(s.data.argumentList||[]).map(dt);let u;try{const t=c.slice(0,-1).reduce(((e,t)=>e[t]),e),n=c.reduce(((e,t)=>e[t]),e);switch(a){case"GET":u=n;break;case"SET":t[c.slice(-1)[0]]=dt(s.data.value),u=!0;break;case"APPLY":u=n.apply(t,l);break;case"CONSTRUCT":u=function r(e){return Object.assign(e,{[Ke]:!0})}(new n(...l));break;case"ENDPOINT":{const{port1:t,port2:n}=new MessageChannel;nt(e,n),u=function r(e,t){return ht.set(e,t),e}(t,[t])}break;case"RELEASE":u=void 0;break;default:return}}catch(e){u={value:e,[Ze]:0}}Promise.resolve(u).catch((e=>({value:e,[Ze]:0}))).then((n=>{const[s,o]=ft(n);t.postMessage(Object.assign(Object.assign({},s),{id:i}),o),"RELEASE"===a&&(t.removeEventListener("message",r),rt(t),Ye in e&&"function"==typeof e[Ye]&&e[Ye]())})).catch((e=>{const[n,r]=ft({value:new TypeError("Unserializable return value"),[Ze]:0});t.postMessage(Object.assign(Object.assign({},n),{id:i}),r)}))})),t.start&&t.start()}function rt(e){(function t(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function st(e){if(e)throw new Error("Proxy has been released and is not useable")}function ot(e){return pt(e,{type:"RELEASE"}).then((()=>{rt(e)}))}const it=new WeakMap,at="FinalizationRegistry"in globalThis&&new FinalizationRegistry((e=>{const t=(it.get(e)||0)-1;it.set(e,t),0===t&&ot(e)}));function ct(e,t=[],n=function(){}){let r=!1;const s=new Proxy(n,{get(n,o){if(st(r),o===Qe)return()=>{!function t(e){at&&at.unregister(e)}(s),ot(e),r=!0};if("then"===o){if(0===t.length)return{then:()=>s};const n=pt(e,{type:"GET",path:t.map((e=>e.toString()))}).then(dt);return n.then.bind(n)}return ct(e,[...t,o])},set(n,s,o){st(r);const[i,a]=ft(o);return pt(e,{type:"SET",path:[...t,s].map((e=>e.toString())),value:i},a).then(dt)},apply(n,s,o){st(r);const i=t[t.length-1];if(i===Ve)return pt(e,{type:"ENDPOINT"}).then(dt);if("bind"===i)return ct(e,t.slice(0,-1));const[a,c]=ut(o);return pt(e,{type:"APPLY",path:t.map((e=>e.toString())),argumentList:a},c).then(dt)},construct(n,s){st(r);const[o,i]=ut(s);return pt(e,{type:"CONSTRUCT",path:t.map((e=>e.toString())),argumentList:o},i).then(dt)}});return function o(e,t){const n=(it.get(t)||0)+1;it.set(t,n),at&&at.register(e,t,e)}(s,e),s}function lt(e){return Array.prototype.concat.apply([],e)}function ut(e){const t=e.map(ft);return[t.map((e=>e[0])),lt(t.map((e=>e[1])))]}const ht=new WeakMap;function ft(e){for(const[t,n]of tt)if(n.canHandle(e)){const[r,s]=n.serialize(e);return[{type:"HANDLER",name:t,value:r},s]}return[{type:"RAW",value:e},ht.get(e)||[]]}function dt(e){switch(e.type){case"HANDLER":return tt.get(e.name).deserialize(e.value);case"RAW":return e.value}}function pt(e,t,n){return new Promise((r=>{const s=function o(){return new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-")}();e.addEventListener("message",(function t(n){n.data&&n.data.id&&n.data.id===s&&(e.removeEventListener("message",t),r(n.data))})),e.start&&e.start(),e.postMessage(Object.assign({id:s},t),n)}))}S.xD&&self.addEventListener("unhandledrejection",(e=>{e.preventDefault(),postMessage({status:"error",args:[e.reason]}),console.error("error in worker",e)}));class mt{async init(e,t){S.xD&&postMessage({status:"ready"})}async process(e,t){return e}constructor(){S.xD&&(nt(this),postMessage({status:"listening"}))}}const{max:gt,min:yt,sqrt:wt}=Math,bt=(e,t)=>{const n=yt(e.length,t.length);let r=0;for(let s=0;s<n;s+=1)r+=(e[s]-t[s])**2;return wt(r)},vt=/(?:(?:\\s[.,?!:;\'"])|(?:[.,?!:;\'"]\\s)|[\\s.,?!:;])+/g,_t="Okay, so good evening, everyone. I want to say welcome to the Substance Abuse Support Group. I\'m Courtney and I will be the facilitator or the group leader of this group and I just want to say welcome first and I want to just kind of briefly go over some some rules, you know, I don\'t necessarily, you guys don\'t have to be on mute if you don\'t want to be, but I don\'t want anyone talking over anyone else or cutting them off.",xt=["Okay","so","good","evening","everyone","I","want","to","say","welcome","to","the","Substance","Abuse","Support","Group","I\'m","Courtney","and","I","will","be","the","facilitator","or","the","group","leader","of","this","group","and","I","just","want","to","say","welcome","first","and","I","want","to","just","kind","of","briefly","go","over","some","some","rules","you","know","I","don\'t","necessarily","you","guys","don\'t","have","to","be","on","mute","if","you","don\'t","want","to","be","but","I","don\'t","want","anyone","talking","over","anyone","else","or","cutting","them","off",""];M.expect((()=>_t.split(vt).join("::")),(()=>xt.join("::")));const St=/^.+\\@.+\\..+$/g;M.expect(St.test("test@email.com"),!0),M.expect(St.test("123 test address st., denver co 80201"),!1);const kt=/\\d+ .+\\,?.+[A-Z]{2}\\,? ?\\d{5}\\-?\\d{0,4}/;M.expect(kt.test("72 Applegate Drive Taunton, MA 02780"),!0),M.expect(kt.test("723 Applegate Dr, Taunton, MA 02780"),!0),M.expect(kt.test("7 Applegate Ln., Taunton MA 02780"),!0),M.expect(kt.test("72 Applegate Way, Taunton MA 02780-4052"),!0),M.expect(kt.test("Applegate Way, Taunton MA 02780-4052"),!1),M.expect(kt.test("42 Applegate Way, Taunton MA"),!1),M.expect(kt.test("42 Applegate Way, Taunton 02780"),!1);M.expect(/\\d{3}\\-\\d{2}\\-\\d{4}/.test("111-11-1111"),!0);const At=/^(?:\\$\\s*\\d+(\\.\\d{2})?\\s*|\\s*\\d+(\\.\\d{2})?\\s*\\$)$/;M.expect(At.test("$24.40"),!0),M.expect(At.test("$ 24.40"),!0),M.expect(At.test("$\\n24.40"),!0),M.expect(At.test("24.40 $"),!0),M.expect(At.test("24$"),!0),M.expect(At.test("24"),!1),M.expect(At.test("$ 24.3432"),!1);const Et=(e="")=>e.trim().split(vt).filter(Boolean),Ct=e=>e.end-e.start,It=e=>{let t=e.speaker;const n={...e,duration:Ct(e),isSilence:!1,componentSegments:[e],get speaker(){return t},set speaker(e){t=e;for(const t of n.componentSegments)t.speaker=e}};return n};class Ot extends EventTarget{constructor(){super(...arguments),this.isReady=!0,this.isReadyPromise=Promise.resolve({})}async set(e){Object.assign(this,e)}async process(e,t){return e}terminate(){}}class Rt extends Ot{constructor(){super(...arguments),this.joiner="\\n"}async process(e){const t=Array.isArray(e)?e:e.segments,n=Array.isArray(e)?new Z:e.speakerMap,{joiner:r}=this,s=t.map((e=>{var t;let{text:r}=e;return null!=r||(r=""),r=r.replace(/\\s{2,}/g," ").trim().replace(/^\\-\\s?/,""),r=r.replaceAll("i\'m","I\'m"),r=(e=>e?`${e[0].toUpperCase()}${e.slice(1)}`:"")(r),{...e,text:r,speaker:null!==(t=n.get(e.speaker))&&void 0!==t?t:e.speaker}}));return{text:s.map((e=>{const{text:t}=e,{speaker:n}=e;return null==n?t:`[${n}] ${t}`})).join(r),segments:s}}}const $t="RFC3986",Mt={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:e=>String(e)},jt=(Object.prototype.hasOwnProperty,Array.isArray),Pt=(()=>{const e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();const Tt=1024;function Nt(e,t){if(jt(e)){const n=[];for(let r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)}const Dt=Object.prototype.hasOwnProperty,Bt={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},Lt=Array.isArray,Ft=Array.prototype.push,zt=function(e,t){Ft.apply(e,Lt(t)?t:[t])},Ut=Date.prototype.toISOString,qt={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,n,r,s)=>{if(0===e.length)return e;let o=e;if("symbol"==typeof e?o=Symbol.prototype.toString.call(e):"string"!=typeof e&&(o=String(e)),"iso-8859-1"===n)return escape(o).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));let i="";for(let e=0;e<o.length;e+=Tt){const t=o.length>=Tt?o.slice(e,e+Tt):o,n=[];for(let e=0;e<t.length;++e){let r=t.charCodeAt(e);45===r||46===r||95===r||126===r||r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||"RFC1738"===s&&(40===r||41===r)?n[n.length]=t.charAt(e):r<128?n[n.length]=Pt[r]:r<2048?n[n.length]=Pt[192|r>>6]+Pt[128|63&r]:r<55296||r>=57344?n[n.length]=Pt[224|r>>12]+Pt[128|r>>6&63]+Pt[128|63&r]:(e+=1,r=65536+((1023&r)<<10|1023&t.charCodeAt(e)),n[n.length]=Pt[240|r>>18]+Pt[128|r>>12&63]+Pt[128|r>>6&63]+Pt[128|63&r])}i+=n.join("")}return i},encodeValuesOnly:!1,format:$t,formatter:Mt[$t],indices:!1,serializeDate:e=>Ut.call(e),skipNulls:!1,strictNullHandling:!1};const Wt={};function Gt(e,t,n,r,s,o,i,a,c,l,u,h,f,d,p,m,g,y){let w=e,b=y,v=0,_=!1;for(;void 0!==(b=b.get(Wt))&&!_;){const t=b.get(e);if(v+=1,"undefined"!=typeof t){if(t===v)throw new RangeError("Cyclic object value");_=!0}"undefined"==typeof b.get(Wt)&&(v=0)}if("function"==typeof l?w=l(t,w):w instanceof Date?w=f?.(w):"comma"===n&&Lt(w)&&(w=Nt(w,(function(e){return e instanceof Date?f?.(e):e}))),null===w){if(o)return c&&!m?c(t,qt.encoder,g,"key",d):t;w=""}if(function x(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||"symbol"==typeof e||"bigint"==typeof e}(w)||function S(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))}(w)){if(c){const e=m?t:c(t,qt.encoder,g,"key",d);return[p?.(e)+"="+p?.(c(w,qt.encoder,g,"value",d))]}return[p?.(t)+"="+p?.(String(w))]}const k=[];if("undefined"==typeof w)return k;let A;if("comma"===n&&Lt(w))m&&c&&(w=Nt(w,c)),A=[{value:w.length>0?w.join(",")||null:void 0}];else if(Lt(l))A=l;else{const e=Object.keys(w);A=u?e.sort(u):e}const E=a?String(t).replace(/\\./g,"%2E"):String(t),C=r&&Lt(w)&&1===w.length?E+"[]":E;if(s&&Lt(w)&&0===w.length)return C+"[]";for(let t=0;t<A.length;++t){const b=A[t],_="object"==typeof b&&"undefined"!=typeof b.value?b.value:w[b];if(i&&null===_)continue;const x=h&&a?b.replace(/\\./g,"%2E"):b,S=Lt(w)?"function"==typeof n?n(C,x):C:C+(h?"."+x:"["+x+"]");y.set(e,v);const E=new WeakMap;E.set(Wt,y),zt(k,Gt(_,S,n,r,s,o,i,a,"comma"===n&&m&&Lt(w)?null:c,l,u,h,f,d,p,m,g,E))}return k}function Ht(e,t={}){let n=e;const r=function s(e=qt){if("undefined"!=typeof e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if("undefined"!=typeof e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&"undefined"!=typeof e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");const t=e.charset||qt.charset;if("undefined"!=typeof e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=$t;if("undefined"!=typeof e.format){if(!Dt.call(Mt,e.format))throw new TypeError("Unknown format option provided.");n=e.format}const r=Mt[n];let s,o=qt.filter;if(("function"==typeof e.filter||Lt(e.filter))&&(o=e.filter),s=e.arrayFormat&&e.arrayFormat in Bt?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":qt.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const i="undefined"==typeof e.allowDots?1==!!e.encodeDotInKeys||qt.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:qt.addQueryPrefix,allowDots:i,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:qt.allowEmptyArrays,arrayFormat:s,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:qt.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:"undefined"==typeof e.delimiter?qt.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:qt.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:qt.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:qt.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:qt.encodeValuesOnly,filter:o,format:n,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:qt.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:qt.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:qt.strictNullHandling}}(t);let o,i;"function"==typeof r.filter?(i=r.filter,n=i("",n)):Lt(r.filter)&&(i=r.filter,o=i);const a=[];if("object"!=typeof n||null===n)return"";const c=Bt[r.arrayFormat],l="comma"===c&&r.commaRoundTrip;o||(o=Object.keys(n)),r.sort&&o.sort(r.sort);const u=new WeakMap;for(let e=0;e<o.length;++e){const t=o[e];r.skipNulls&&null===n[t]||zt(a,Gt(n[t],t,c,l,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,u))}const h=a.join(r.delimiter);let f=!0===r.addQueryPrefix?"?":"";return r.charsetSentinel&&("iso-8859-1"===r.charset?f+="utf8=%26%2310003%3B&":f+="utf8=%E2%9C%93&"),h.length>0?f+h:""}const Xt="4.82.0";let Jt,Kt,Vt,Qt,Yt,Zt,en,tn,nn,rn=!1,sn=null,on=null,an=null,cn=null;class ln{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}Jt||function hn(e,t={auto:!1}){if(rn)throw new Error(`you must \\`import \'openai/shims/${e.kind}\'\\` before importing anything else from openai`);if(Jt)throw new Error(`can\'t \\`import \'openai/shims/${e.kind}\'\\` after \\`import \'openai/shims/${Jt}\'\\``);rn=t.auto,Jt=e.kind,Kt=e.fetch,sn=e.Request,on=e.Response,an=e.Headers,Vt=e.FormData,cn=e.Blob,Qt=e.File,Yt=e.ReadableStream,Zt=e.getMultipartRequestOptions,en=e.getDefaultAgent,tn=e.fileFromPath,nn=e.isFsReadStream}(function un({manuallyImported:e}={}){const t=e?"You may need to use polyfills":"Add one of these imports before your first `import  from \'openai\'`:\\n- `import \'openai/shims/node\'` (if you\'re running on Node)\\n- `import \'openai/shims/web\'` (otherwise)\\n";let n,r,s,o;try{n=fetch,r=Request,s=Response,o=Headers}catch(e){throw new Error(`this environment is missing the following Web Fetch API type: ${e.message}. ${t}`)}return{kind:"web",fetch:n,Request:r,Response:s,Headers:o,FormData:"undefined"!=typeof FormData?FormData:class e{constructor(){throw new Error(`file uploads aren\'t supported in this environment yet as \'FormData\' is undefined. ${t}`)}},Blob:"undefined"!=typeof Blob?Blob:class e{constructor(){throw new Error(`file uploads aren\'t supported in this environment yet as \'Blob\' is undefined. ${t}`)}},File:"undefined"!=typeof File?File:class e{constructor(){throw new Error(`file uploads aren\'t supported in this environment yet as \'File\' is undefined. ${t}`)}},ReadableStream:"undefined"!=typeof ReadableStream?ReadableStream:class e{constructor(){throw new Error(`streaming isn\'t supported in this environment yet as \'ReadableStream\' is undefined. ${t}`)}},getMultipartRequestOptions:async(e,t)=>({...t,body:new ln(e)}),getDefaultAgent:e=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:e=>!1}}(),{auto:!0});class fn extends Error{}class dn extends fn{constructor(e,t,n,r){super(`${dn.makeMessage(e,t,n)}`),this.status=e,this.headers=r,this.request_id=r?.["x-request-id"],this.error=t;const s=t;this.code=s?.code,this.param=s?.param,this.type=s?.type}static makeMessage(e,t,n){const r=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,n,r){if(!e||!r)return new mn({message:n,cause:hr(t)});const s=t?.error;return 400===e?new yn(e,s,n,r):401===e?new wn(e,s,n,r):403===e?new bn(e,s,n,r):404===e?new vn(e,s,n,r):409===e?new _n(e,s,n,r):422===e?new xn(e,s,n,r):429===e?new Sn(e,s,n,r):e>=500?new kn(e,s,n,r):new dn(e,s,n,r)}}class pn extends dn{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class mn extends dn{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class gn extends mn{constructor({message:e}={}){super({message:e??"Request timed out."})}}class yn extends dn{}class wn extends dn{}class bn extends dn{}class vn extends dn{}class _n extends dn{}class xn extends dn{}class Sn extends dn{}class kn extends dn{}class An extends fn{constructor(){super("Could not parse response content as the length limit was reached")}}class En extends fn{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class Cn{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\\r"+t,this.trailingCR=!1),t.endsWith("\\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const n=Cn.NEWLINE_CHARS.has(t[t.length-1]||"");let r=t.split(Cn.NEWLINE_REGEXP);return n&&r.pop(),1!==r.length||n?(this.buffer.length>0&&(r=[this.buffer.join("")+r[0],...r.slice(1)],this.buffer=[]),n||(this.buffer=[r.pop()||""]),r):(this.buffer.push(r[0]),[])}decodeText(e){if(null==e)return"";if("string"==typeof e)return e;if("undefined"!=typeof Buffer){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new fn(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new fn(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new fn("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}function In(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}Cn.NEWLINE_CHARS=new Set(["\\n","\\r"]),Cn.NEWLINE_REGEXP=/\\r\\n|[\\n\\r]/g;class On{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;return new On((async function*r(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let r=!1;try{for await(const n of async function*s(e,t){if(!e.body)throw t.abort(),new fn("Attempted to iterate over a response with no body");const n=new $n,r=new Cn,s=In(e.body);for await(const e of async function*t(e){let t=new Uint8Array;for await(const n of e){if(null==n)continue;const e=n instanceof ArrayBuffer?new Uint8Array(n):"string"==typeof n?(new TextEncoder).encode(n):n;let r,s=new Uint8Array(t.length+e.length);for(s.set(t),s.set(e,t.length),t=s;-1!==(r=Rn(t));)yield t.slice(0,r),t=t.slice(r)}t.length>0&&(yield t)}(s))for(const t of r.decode(e)){const e=n.decode(t);e&&(yield e)}for(const e of r.flush()){const t=n.decode(e);t&&(yield t)}}(e,t))if(!r)if(n.data.startsWith("[DONE]"))r=!0;else if(null===n.event){let e;try{e=JSON.parse(n.data)}catch(e){throw console.error("Could not parse message into JSON:",n.data),console.error("From chunk:",n.raw),e}if(e&&e.error)throw new dn(void 0,e.error,void 0,void 0);yield e}else{let e;try{e=JSON.parse(n.data)}catch(e){throw console.error("Could not parse message into JSON:",n.data),console.error("From chunk:",n.raw),e}if("error"==n.event)throw new dn(void 0,e.error,e.message,void 0);yield{event:n.event,data:e}}r=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{r||t.abort()}}),t)}static fromReadableStream(e,t){let n=!1;return new On((async function*r(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let r=!1;try{for await(const t of async function*n(){const t=new Cn,n=In(e);for await(const e of n)for(const n of t.decode(e))yield n;for(const e of t.flush())yield e}())r||t&&(yield JSON.parse(t));r=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{r||t.abort()}}),t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),r=r=>({next:()=>{if(0===r.length){const r=n.next();e.push(r),t.push(r)}return r.shift()}});return[new On((()=>r(e)),this.controller),new On((()=>r(t)),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new Yt({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:r,done:s}=await t.next();if(s)return e.close();const o=n.encode(JSON.stringify(r)+"\\n");e.enqueue(o)}catch(t){e.error(t)}},async cancel(){await(t.return?.())}})}}function Rn(e){for(let t=0;t<e.length-2;t++){if(10===e[t]&&10===e[t+1])return t+2;if(13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return-1}class $n{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,r]=function s(e,t){const n=e.indexOf(t);if(-1!==n)return[e.substring(0,n),t,e.substring(n+t.length)];return[e,"",""]}(e,":");return r.startsWith(" ")&&(r=r.substring(1)),"event"===t?this.event=r:"data"===t&&this.data.push(r),null}}const Mn=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob,jn=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&Pn(e),Pn=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,Tn=e=>jn(e)||Mn(e)||nn(e);async function Nn(e,t,n){if(e=await e,jn(e))return e;if(Mn(e)){const r=await e.blob();t||(t=new URL(e.url).pathname.split(/[\\\\/]/).pop()??"unknown_file");const s=Pn(r)?[await r.arrayBuffer()]:[r];return new Qt(s,t,n)}const r=await async function s(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(Pn(e))t.push(await e.arrayBuffer());else{if(!Bn(e))throw new Error(`Unexpected data type: ${typeof e}; constructor: ${e?.constructor?.name}; props: ${function n(e){const t=Object.getOwnPropertyNames(e);return`[${t.map((e=>`"${e}"`)).join(", ")}]`}(e)}`);for await(const n of e)t.push(n)}return t}(e);if(t||(t=function o(e){return Dn(e.name)||Dn(e.filename)||Dn(e.path)?.split(/[\\\\/]/).pop()}(e)??"unknown_file"),!n?.type){const e=r[0]?.type;"string"==typeof e&&(n={...n,type:e})}return new Qt(r,t,n)}const Dn=e=>"string"==typeof e?e:"undefined"!=typeof Buffer&&e instanceof Buffer?String(e):void 0,Bn=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],Ln=e=>e&&"object"==typeof e&&e.body&&"MultipartBody"===e[Symbol.toStringTag],Fn=async e=>{const t=await zn(e.body);return Zt(t,e)},zn=async e=>{const t=new Vt;return await Promise.all(Object.entries(e||{}).map((([e,n])=>Un(t,e,n)))),t},Un=async(e,t,n)=>{if(void 0!==n){if(null==n)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string \'null\'`);if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)e.append(t,String(n));else if(Tn(n)){const r=await Nn(n);e.append(t,r)}else if(Array.isArray(n))await Promise.all(n.map((n=>Un(e,t+"[]",n))));else{if("object"!=typeof n)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`);await Promise.all(Object.entries(n).map((([n,r])=>Un(e,`${t}[${n}]`,r))))}}};var qn,Wn=function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},Gn=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};async function Hn(e){const{response:t}=e;if(e.options.stream)return yr("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):On.fromSSEResponse(t,e.controller);if(204===t.status)return null;if(e.options.__binaryResponse)return t;const n=t.headers.get("content-type");if(n?.includes("application/json")||n?.includes("application/vnd.api+json")){const e=await t.json();return yr("response",t.status,t.url,t.headers,e),Xn(e,t)}const r=await t.text();return yr("response",t.status,t.url,t.headers,r),r}function Xn(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class Jn extends Promise{constructor(e,t=Hn){super((e=>{e(null)})),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new Jn(this.responsePromise,(async t=>Xn(e(await this.parseResponse(t),t),t.response)))}asResponse(){return this.responsePromise.then((e=>e.response))}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class Kn{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:r,fetch:s}){this.baseURL=e,this.maxRetries=ur("maxRetries",t),this.timeout=ur("timeout",n),this.httpAgent=r,this.fetch=s??Kt}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...or(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${wr()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then((async n=>{const r=n&&Pn(n?.body)?new DataView(await n.body.arrayBuffer()):n?.body instanceof DataView?n.body:n?.body instanceof ArrayBuffer?new DataView(n.body):n&&ArrayBuffer.isView(n?.body)?new DataView(n.body.buffer):n?.body;return{method:e,path:t,...n,body:r}})))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if("string"==typeof e){if("undefined"!=typeof Buffer)return Buffer.byteLength(e,"utf8").toString();if("undefined"!=typeof TextEncoder){return(new TextEncoder).encode(e).length.toString()}}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){const{method:n,path:r,query:s,headers:o={}}=e,i=ArrayBuffer.isView(e.body)||e.__binaryRequest&&"string"==typeof e.body?e.body:Ln(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,a=this.calculateContentLength(i),c=this.buildURL(r,s);"timeout"in e&&ur("timeout",e.timeout);const l=e.timeout??this.timeout,u=e.httpAgent??this.httpAgent??en(c),h=l+1e3;"number"==typeof u?.options?.timeout&&h>(u.options.timeout??0)&&(u.options.timeout=h),this.idempotencyHeader&&"get"!==n&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);return{req:{method:n,...i&&{body:i},headers:this.buildHeaders({options:e,headers:o,contentLength:a,retryCount:t}),...u&&{agent:u},signal:e.signal??null},url:c,timeout:l}}buildHeaders({options:e,headers:t,contentLength:n,retryCount:r}){const s={};n&&(s["content-length"]=n);const o=this.defaultHeaders(e);return mr(s,o),mr(s,t),Ln(e.body)&&"node"!==Jt&&delete s["content-type"],void 0===br(o,"x-stainless-retry-count")&&void 0===br(t,"x-stainless-retry-count")&&(s["x-stainless-retry-count"]=String(r)),this.validateHeaders(s,t),s}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map((e=>[...e]))):{...e}:{}}makeStatusError(e,t,n,r){return dn.generate(e,t,n,r)}request(e,t=null){return new Jn(this.makeRequest(e,t))}async makeRequest(e,t){const n=await e,r=n.maxRetries??this.maxRetries;null==t&&(t=r),await this.prepareOptions(n);const{req:s,url:o,timeout:i}=this.buildRequest(n,{retryCount:r-t});if(await this.prepareRequest(s,{url:o,options:n}),yr("request",o,n,s.headers),n.signal?.aborted)throw new pn;const a=new AbortController,c=await this.fetchWithTimeout(o,s,i,a).catch(hr);if(c instanceof Error){if(n.signal?.aborted)throw new pn;if(t)return this.retryRequest(n,t);if("AbortError"===c.name)throw new gn;throw new mn({cause:c})}const l=Yn(c.headers);if(!c.ok){if(t&&this.shouldRetry(c)){return yr(`response (error; ${`retrying, ${t} attempts remaining`})`,c.status,o,l),this.retryRequest(n,t,l)}const e=await c.text().catch((e=>hr(e).message)),r=ir(e),s=r?void 0:e;yr(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,c.status,o,l,s);throw this.makeStatusError(c.status,r,s,l)}return{response:c,options:n,controller:a}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new Qn(this,n,e)}buildURL(e,t){const n=cr(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),r=this.defaultQuery();return dr(r)||(t={...r,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter((([e,t])=>"undefined"!=typeof t)).map((([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new fn(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { \'foo[key1]\': value1, \'foo[key2]\': value2 } }, and please open a GitHub issue requesting better support for your use case.`)})).join("&")}async fetchWithTimeout(e,t,n,r){const{signal:s,...o}=t||{};s&&s.addEventListener("abort",(()=>r.abort()));const i=setTimeout((()=>r.abort()),n),a={signal:r.signal,...o};return a.method&&(a.method=a.method.toUpperCase()),this.fetch.call(void 0,e,a).finally((()=>{clearTimeout(i)}))}shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||(409===e.status||(429===e.status||e.status>=500)))}async retryRequest(e,t,n){let r;const s=n?.["retry-after-ms"];if(s){const e=parseFloat(s);Number.isNaN(e)||(r=e)}const o=n?.["retry-after"];if(o&&!r){const e=parseFloat(o);r=Number.isNaN(e)?Date.parse(o)-Date.now():1e3*e}if(!(r&&0<=r&&r<6e4)){const n=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,n)}return await lr(r),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const n=t-e;return Math.min(.5*Math.pow(2,n),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Xt}`}}class Vn{constructor(e,t,n,r){qn.set(this,void 0),Wn(this,qn,e,"f"),this.options=r,this.response=t,this.body=n}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageInfo()}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new fn("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&"object"==typeof t.query)t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[t,r]of n)e.url.searchParams.set(t,r);t.query=void 0,t.path=e.url.toString()}return await Gn(this,qn,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(qn=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class Qn extends Jn{constructor(e,t,n){super(t,(async t=>new n(e,t.response,await Hn(t),t.options)))}async*[Symbol.asyncIterator](){const e=await(this);for await(const t of e)yield t}}const Yn=e=>new Proxy(Object.fromEntries(e.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),Zn={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},er=e=>"object"==typeof e&&null!==e&&!dr(e)&&Object.keys(e).every((e=>pr(Zn,e))),tr=()=>{if("undefined"!=typeof Deno&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Xt,"X-Stainless-OS":rr(Deno.build.os),"X-Stainless-Arch":nr(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Xt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if("[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Xt,"X-Stainless-OS":rr(process.platform),"X-Stainless-Arch":nr(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const e=function t(){if("undefined"==typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\\W+(\\d+)\\.(\\d+)(?:\\.(\\d+))?)?/},{key:"ie",pattern:/MSIE(?:\\W+(\\d+)\\.(\\d+)(?:\\.(\\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\\:(\\d+)\\.(\\d+)(?:\\.(\\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\\W+(\\d+)\\.(\\d+)(?:\\.(\\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\\W+(\\d+)\\.(\\d+)(?:\\.(\\d+))?)?/},{key:"safari",pattern:/(?:Version\\W+(\\d+)\\.(\\d+)(?:\\.(\\d+))?)?(?:\\W+Mobile\\S*)?\\W+Safari/}];for(const{key:t,pattern:n}of e){const e=n.exec(navigator.userAgent);if(e){return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}}return null}();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Xt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Xt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};const nr=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",rr=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let sr;const or=()=>sr??(sr=tr()),ir=e=>{try{return JSON.parse(e)}catch(e){return}},ar=/^[a-z][a-z0-9+.-]*:/i,cr=e=>ar.test(e),lr=e=>new Promise((t=>setTimeout(t,e))),ur=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new fn(`${e} must be an integer`);if(t<0)throw new fn(`${e} must be a positive integer`);return t},hr=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e)try{return new Error(JSON.stringify(e))}catch{}return new Error(e)},fr=e=>"undefined"!=typeof process?process.env?.[e]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(e)?.trim():void 0;function dr(e){if(!e)return!0;for(const t in e)return!1;return!0}function pr(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function mr(e,t){for(const n in t){if(!pr(t,n))continue;const r=n.toLowerCase();if(!r)continue;const s=t[n];null===s?delete e[r]:void 0!==s&&(e[r]=s)}}const gr=new Set(["authorization","api-key"]);function yr(e,...t){if("undefined"!=typeof process&&"true"===process?.env?.DEBUG){const n=t.map((e=>{if(!e)return e;if(e.headers){const t={...e,headers:{...e.headers}};for(const n in e.headers)gr.has(n.toLowerCase())&&(t.headers[n]="REDACTED");return t}let t=null;for(const n in e)gr.has(n.toLowerCase())&&(t??(t={...e}),t[n]="REDACTED");return t??e}));console.log(`OpenAI:DEBUG:${e}`,...n)}}const wr=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),br=(e,t)=>{const n=t.toLowerCase();if((e=>"function"==typeof e?.get)(e)){const r=t[0]?.toUpperCase()+t.substring(1).replace(/([^\\w])(\\w)/g,((e,t,n)=>t+n.toUpperCase()));for(const s of[t,n,t.toUpperCase(),r]){const t=e.get(s);if(t)return t}}for(const[r,s]of Object.entries(e))if(r.toLowerCase()===n)return Array.isArray(s)?(s.length<=1||console.warn(`Received ${s.length} entries for the ${t} header, using the first entry.`),s[0]):s};function vr(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}class _r{constructor(e){this._client=e}}class xr extends _r{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class Sr extends _r{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}}class kr extends _r{constructor(){super(...arguments),this.completions=new Sr(this._client)}}kr.Completions=Sr;class Ar extends _r{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}class Er extends Vn{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class Cr extends Vn{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){const e=this.getPaginatedItems();if(!e.length)return null;const t=e[e.length-1]?.id;return t?{params:{after:t}}:null}}class Ir extends _r{create(e,t){return this._client.post("/files",Fn({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return er(e)?this.list({},e):this._client.getAPIList("/files",Or,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t?.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=18e5}={}){const r=new Set(["processed","error","deleted"]),s=Date.now();let o=await this.retrieve(e);for(;!o.status||!r.has(o.status);)if(await lr(t),o=await this.retrieve(e),Date.now()-s>n)throw new gn({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return o}}class Or extends Cr{}Ir.FileObjectsPage=Or;class Rr extends _r{createVariation(e,t){return this._client.post("/images/variations",Fn({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",Fn({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class $r extends _r{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t?.headers},__binaryResponse:!0})}}class Mr extends _r{create(e,t){return this._client.post("/audio/transcriptions",Fn({body:e,...t}))}}class jr extends _r{create(e,t){return this._client.post("/audio/translations",Fn({body:e,...t}))}}class Pr extends _r{constructor(){super(...arguments),this.transcriptions=new Mr(this._client),this.translations=new jr(this._client),this.speech=new $r(this._client)}}Pr.Transcriptions=Mr,Pr.Translations=jr,Pr.Speech=$r;class Tr extends _r{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class Nr extends _r{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Dr,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class Dr extends Er{}Nr.ModelsPage=Dr;class Br extends _r{list(e,t={},n){return er(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Lr,{query:t,...n})}}class Lr extends Cr{}Br.FineTuningJobCheckpointsPage=Lr;class Fr extends _r{constructor(){super(...arguments),this.checkpoints=new Br(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return er(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",zr,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return er(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Ur,{query:t,...n})}}class zr extends Cr{}class Ur extends Cr{}Fr.FineTuningJobsPage=zr,Fr.FineTuningJobEventsPage=Ur,Fr.Checkpoints=Br,Fr.FineTuningJobCheckpointsPage=Lr;class qr extends _r{constructor(){super(...arguments),this.jobs=new Fr(this._client)}}qr.Jobs=Fr,qr.FineTuningJobsPage=zr,qr.FineTuningJobEventsPage=Ur;class Wr extends _r{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},t){return er(e)?this.list({},e):this._client.getAPIList("/assistants",Gr,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class Gr extends Cr{}function Hr(e){return"function"==typeof e.parse}Wr.AssistantsPage=Gr;const Xr=e=>"assistant"===e?.role,Jr=e=>"function"===e?.role,Kr=e=>"tool"===e?.role;var Vr,Qr,Yr,Zr,es,ts,ns,rs,ss,os,is,as,cs,ls=function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},us=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class hs{constructor(){Vr.add(this),this.controller=new AbortController,Qr.set(this,void 0),Yr.set(this,(()=>{})),Zr.set(this,(()=>{})),es.set(this,void 0),ts.set(this,(()=>{})),ns.set(this,(()=>{})),rs.set(this,{}),ss.set(this,!1),os.set(this,!1),is.set(this,!1),as.set(this,!1),ls(this,Qr,new Promise(((e,t)=>{ls(this,Yr,e,"f"),ls(this,Zr,t,"f")})),"f"),ls(this,es,new Promise(((e,t)=>{ls(this,ts,e,"f"),ls(this,ns,t,"f")})),"f"),us(this,Qr,"f").catch((()=>{})),us(this,es,"f").catch((()=>{}))}_run(e){setTimeout((()=>{e().then((()=>{this._emitFinal(),this._emit("end")}),us(this,Vr,"m",cs).bind(this))}),0)}_connected(){this.ended||(us(this,Yr,"f").call(this),this._emit("connect"))}get ended(){return us(this,ss,"f")}get errored(){return us(this,os,"f")}get aborted(){return us(this,is,"f")}abort(){this.controller.abort()}on(e,t){return(us(this,rs,"f")[e]||(us(this,rs,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=us(this,rs,"f")[e];if(!n)return this;const r=n.findIndex((e=>e.listener===t));return r>=0&&n.splice(r,1),this}once(e,t){return(us(this,rs,"f")[e]||(us(this,rs,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise(((t,n)=>{ls(this,as,!0,"f"),"error"!==e&&this.once("error",n),this.once(e,t)}))}async done(){ls(this,as,!0,"f"),await us(this,es,"f")}_emit(e,...t){if(us(this,ss,"f"))return;"end"===e&&(ls(this,ss,!0,"f"),us(this,ts,"f").call(this));const n=us(this,rs,"f")[e];if(n&&(us(this,rs,"f")[e]=n.filter((e=>!e.once)),n.forEach((({listener:e})=>e(...t)))),"abort"===e){const e=t[0];return us(this,as,"f")||n?.length||Promise.reject(e),us(this,Zr,"f").call(this,e),us(this,ns,"f").call(this,e),void this._emit("end")}if("error"===e){const e=t[0];us(this,as,"f")||n?.length||Promise.reject(e),us(this,Zr,"f").call(this,e),us(this,ns,"f").call(this,e),this._emit("end")}}_emitFinal(){}}function fs(e){return"auto-parseable-response-format"===e?.$brand}function ds(e){return"auto-parseable-tool"===e?.$brand}function ps(e,t){const n=e.choices.map((e=>{if("length"===e.finish_reason)throw new An;if("content_filter"===e.finish_reason)throw new En;return{...e,message:{...e.message,tool_calls:e.message.tool_calls?.map((e=>function n(e,t){const n=e.tools?.find((e=>e.function?.name===t.function.name));return{...t,function:{...t.function,parsed_arguments:ds(n)?n.$parseRaw(t.function.arguments):n?.function.strict?JSON.parse(t.function.arguments):null}}}(t,e)))??[],parsed:e.message.content&&!e.message.refusal?ms(t,e.message.content):null}}}));return{...e,choices:n}}function ms(e,t){if("json_schema"!==e.response_format?.type)return null;if("json_schema"===e.response_format?.type){if("$parseRaw"in e.response_format){return e.response_format.$parseRaw(t)}return JSON.parse(t)}return null}function gs(e,t){if(!e)return!1;const n=e.tools?.find((e=>e.function?.name===t.function.name));return ds(n)||n?.function.strict||!1}function ys(e){return!!fs(e.response_format)||(e.tools?.some((e=>ds(e)||"function"===e.type&&!0===e.function.strict))??!1)}Qr=new WeakMap,Yr=new WeakMap,Zr=new WeakMap,es=new WeakMap,ts=new WeakMap,ns=new WeakMap,rs=new WeakMap,ss=new WeakMap,os=new WeakMap,is=new WeakMap,as=new WeakMap,Vr=new WeakSet,cs=function e(t){if(ls(this,os,!0,"f"),t instanceof Error&&"AbortError"===t.name&&(t=new pn),t instanceof pn)return ls(this,is,!0,"f"),this._emit("abort",t);if(t instanceof fn)return this._emit("error",t);if(t instanceof Error){const e=new fn(t.message);return e.cause=t,this._emit("error",e)}return this._emit("error",new fn(String(t)))};var ws,bs,vs,_s,xs,Ss,ks,As,Es=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};const Cs=10;class Is extends hs{constructor(){super(...arguments),ws.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t)if(this._emit("message",e),(Jr(e)||Kr(e))&&e.content)this._emit("functionCallResult",e.content);else if(Xr(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Xr(e)&&e.tool_calls)for(const t of e.tool_calls)"function"===t.type&&this._emit("functionCall",t.function)}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new fn("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),Es(this,ws,"m",bs).call(this)}async finalMessage(){return await this.done(),Es(this,ws,"m",vs).call(this)}async finalFunctionCall(){return await this.done(),Es(this,ws,"m",_s).call(this)}async finalFunctionCallResult(){return await this.done(),Es(this,ws,"m",xs).call(this)}async totalUsage(){return await this.done(),Es(this,ws,"m",Ss).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=Es(this,ws,"m",vs).call(this);t&&this._emit("finalMessage",t);const n=Es(this,ws,"m",bs).call(this);n&&this._emit("finalContent",n);const r=Es(this,ws,"m",_s).call(this);r&&this._emit("finalFunctionCall",r);const s=Es(this,ws,"m",xs).call(this);null!=s&&this._emit("finalFunctionCallResult",s),this._chatCompletions.some((e=>e.usage))&&this._emit("totalUsage",Es(this,ws,"m",Ss).call(this))}async _createChatCompletion(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort()))),Es(this,ws,"m",ks).call(this,t);const s=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(ps(s,t))}async _runChatCompletion(e,t,n){for(const e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){const r="function",{function_call:s="auto",stream:o,...i}=t,a="string"!=typeof s&&s?.name,{maxChatCompletions:c=Cs}=n||{},l={};for(const e of t.functions)l[e.name||e.function.name]=e;const u=t.functions.map((e=>({name:e.name||e.function.name,parameters:e.parameters,description:e.description})));for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<c;++t){const t=await this._createChatCompletion(e,{...i,function_call:s,functions:u,messages:[...this.messages]},n),o=t.choices[0]?.message;if(!o)throw new fn("missing message in ChatCompletion response");if(!o.function_call)return;const{name:c,arguments:h}=o.function_call,f=l[c];if(!f){const e=`Invalid function_call: ${JSON.stringify(c)}. Available options are: ${u.map((e=>JSON.stringify(e.name))).join(", ")}. Please try again`;this._addMessage({role:r,name:c,content:e});continue}if(a&&a!==c){const e=`Invalid function_call: ${JSON.stringify(c)}. ${JSON.stringify(a)} requested. Please try again`;this._addMessage({role:r,name:c,content:e});continue}let d;try{d=Hr(f)?await f.parse(h):h}catch(e){this._addMessage({role:r,name:c,content:e instanceof Error?e.message:String(e)});continue}const p=await f.function(d,this),m=Es(this,ws,"m",As).call(this,p);if(this._addMessage({role:r,name:c,content:m}),a)return}}async _runTools(e,t,n){const r="tool",{tool_choice:s="auto",stream:o,...i}=t,a="string"!=typeof s&&s?.function?.name,{maxChatCompletions:c=Cs}=n||{},l=t.tools.map((e=>{if(ds(e)){if(!e.$callback)throw new fn("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e})),u={};for(const e of l)"function"===e.type&&(u[e.function.name||e.function.function.name]=e.function);const h="tools"in t?l.map((e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e)):void 0;for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<c;++t){const t=await this._createChatCompletion(e,{...i,tool_choice:s,tools:h,messages:[...this.messages]},n),o=t.choices[0]?.message;if(!o)throw new fn("missing message in ChatCompletion response");if(!o.tool_calls?.length)return;for(const e of o.tool_calls){if("function"!==e.type)continue;const t=e.id,{name:n,arguments:s}=e.function,o=u[n];if(!o){const e=`Invalid tool_call: ${JSON.stringify(n)}. Available options are: ${Object.keys(u).map((e=>JSON.stringify(e))).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:t,content:e});continue}if(a&&a!==n){const e=`Invalid tool_call: ${JSON.stringify(n)}. ${JSON.stringify(a)} requested. Please try again`;this._addMessage({role:r,tool_call_id:t,content:e});continue}let i;try{i=Hr(o)?await o.parse(s):s}catch(e){const n=e instanceof Error?e.message:String(e);this._addMessage({role:r,tool_call_id:t,content:n});continue}const c=await o.function(i,this),l=Es(this,ws,"m",As).call(this,c);if(this._addMessage({role:r,tool_call_id:t,content:l}),a)return}}}}ws=new WeakSet,bs=function e(){return Es(this,ws,"m",vs).call(this).content??null},vs=function e(){let t=this.messages.length;for(;t-- >0;){const e=this.messages[t];if(Xr(e)){const{function_call:t,...n}=e,r={...n,content:e.content??null,refusal:e.refusal??null};return t&&(r.function_call=t),r}}throw new fn("stream ended without producing a ChatCompletionMessage with role=assistant")},_s=function e(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Xr(t)&&t?.function_call)return t.function_call;if(Xr(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},xs=function e(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Jr(t)&&null!=t.content)return t.content;if(Kr(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some((e=>"assistant"===e.role&&e.tool_calls?.some((e=>"function"===e.type&&e.id===t.tool_call_id)))))return t.content}},Ss=function e(){const t={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:e}of this._chatCompletions)e&&(t.completion_tokens+=e.completion_tokens,t.prompt_tokens+=e.prompt_tokens,t.total_tokens+=e.total_tokens);return t},ks=function e(t){if(null!=t.n&&t.n>1)throw new fn("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},As=function e(t){return"string"==typeof t?t:void 0===t?"undefined":JSON.stringify(t)};class Os extends Is{static runFunctions(e,t,n){const r=new Os,s={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run((()=>r._runFunctions(e,t,s))),r}static runTools(e,t,n){const r=new Os,s={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run((()=>r._runTools(e,t,s))),r}_addMessage(e,t=!0){super._addMessage(e,t),Xr(e)&&e.content&&this._emit("content",e.content)}}const Rs=1,$s=2,Ms=4,js=8,Ps=16,Ts=32,Ns=64,Ds=128,Bs=256,Ls=511;class Fs extends Error{}class zs extends Error{}const Us=(e,t)=>{const n=e.length;let r=0;const s=e=>{throw new Fs(`${e} at position ${r}`)},o=e=>{throw new zs(`${e} at position ${r}`)},i=()=>(h(),r>=n&&s("Unexpected end of input"),\'"\'===e[r]?a():"{"===e[r]?c():"["===e[r]?l():"null"===e.substring(r,r+4)||Ps&t&&n-r<4&&"null".startsWith(e.substring(r))?(r+=4,null):"true"===e.substring(r,r+4)||Ts&t&&n-r<4&&"true".startsWith(e.substring(r))?(r+=4,!0):"false"===e.substring(r,r+5)||Ts&t&&n-r<5&&"false".startsWith(e.substring(r))?(r+=5,!1):"Infinity"===e.substring(r,r+8)||Ds&t&&n-r<8&&"Infinity".startsWith(e.substring(r))?(r+=8,Infinity):"-Infinity"===e.substring(r,r+9)||Bs&t&&1<n-r&&n-r<9&&"-Infinity".startsWith(e.substring(r))?(r+=9,-Infinity):"NaN"===e.substring(r,r+3)||Ns&t&&n-r<3&&"NaN".startsWith(e.substring(r))?(r+=3,NaN):u()),a=()=>{const i=r;let a=!1;for(r++;r<n&&(\'"\'!==e[r]||a&&"\\\\"===e[r-1]);)a="\\\\"===e[r]&&!a,r++;if(\'"\'==e.charAt(r))try{return JSON.parse(e.substring(i,++r-Number(a)))}catch(e){o(String(e))}else if(Rs&t)try{return JSON.parse(e.substring(i,r-Number(a))+\'"\')}catch(t){return JSON.parse(e.substring(i,e.lastIndexOf("\\\\"))+\'"\')}s("Unterminated string literal")},c=()=>{r++,h();const o={};try{for(;"}"!==e[r];){if(h(),r>=n&&js&t)return o;const s=a();h(),r++;try{const e=i();Object.defineProperty(o,s,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(e){if(js&t)return o;throw e}h(),","===e[r]&&r++}}catch(e){if(js&t)return o;s("Expected \'}\' at end of object")}return r++,o},l=()=>{r++;const n=[];try{for(;"]"!==e[r];)n.push(i()),h(),","===e[r]&&r++}catch(e){if(Ms&t)return n;s("Expected \']\' at end of array")}return r++,n},u=()=>{if(0===r){"-"===e&&$s&t&&s("Not sure what \'-\' is");try{return JSON.parse(e)}catch(n){if($s&t)try{return"."===e[e.length-1]?JSON.parse(e.substring(0,e.lastIndexOf("."))):JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(e){}o(String(n))}}const i=r;for("-"===e[r]&&r++;e[r]&&!",]}".includes(e[r]);)r++;r!=n||$s&t||s("Unterminated number literal");try{return JSON.parse(e.substring(i,r))}catch(n){"-"===e.substring(i,r)&&$s&t&&s("Not sure what \'-\' is");try{return JSON.parse(e.substring(i,e.lastIndexOf("e")))}catch(e){o(String(e))}}},h=()=>{for(;r<n&&" \\n\\r\\t".includes(e[r]);)r++};return i()},qs=e=>function t(e,n=Ls){if("string"!=typeof e)throw new TypeError("expecting str, got "+typeof e);if(!e.trim())throw new Error(`${e} is empty`);return Us(e.trim(),n)}(e,Ls^$s);var Ws,Gs,Hs,Xs,Js,Ks,Vs,Qs,Ys,Zs,eo,to,no=function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},ro=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class so extends Is{constructor(e){super(),Ws.add(this),Gs.set(this,void 0),Hs.set(this,void 0),Xs.set(this,void 0),no(this,Gs,e,"f"),no(this,Hs,[],"f")}get currentChatCompletionSnapshot(){return ro(this,Xs,"f")}static fromReadableStream(e){const t=new so(null);return t._run((()=>t._fromReadableStream(e))),t}static createChatCompletion(e,t,n){const r=new so(t);return r._run((()=>r._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}}))),r}async _createChatCompletion(e,t,n){super._createChatCompletion;const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort()))),ro(this,Ws,"m",Js).call(this);const s=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const e of s)ro(this,Ws,"m",Vs).call(this,e);if(s.controller.signal?.aborted)throw new pn;return this._addChatCompletion(ro(this,Ws,"m",Zs).call(this))}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),ro(this,Ws,"m",Js).call(this),this._connected();const r=On.fromReadableStream(e,this.controller);let s;for await(const e of r)s&&s!==e.id&&this._addChatCompletion(ro(this,Ws,"m",Zs).call(this)),ro(this,Ws,"m",Vs).call(this,e),s=e.id;if(r.controller.signal?.aborted)throw new pn;return this._addChatCompletion(ro(this,Ws,"m",Zs).call(this))}[(Gs=new WeakMap,Hs=new WeakMap,Xs=new WeakMap,Ws=new WeakSet,Js=function e(){this.ended||no(this,Xs,void 0,"f")},Ks=function e(t){let n=ro(this,Hs,"f")[t.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},ro(this,Hs,"f")[t.index]=n,n)},Vs=function e(t){if(this.ended)return;const n=ro(this,Ws,"m",to).call(this,t);this._emit("chunk",t,n);for(const e of t.choices){const t=n.choices[e.index];null!=e.delta.content&&"assistant"===t.message?.role&&t.message?.content&&(this._emit("content",e.delta.content,t.message.content),this._emit("content.delta",{delta:e.delta.content,snapshot:t.message.content,parsed:t.message.parsed})),null!=e.delta.refusal&&"assistant"===t.message?.role&&t.message?.refusal&&this._emit("refusal.delta",{delta:e.delta.refusal,snapshot:t.message.refusal}),null!=e.logprobs?.content&&"assistant"===t.message?.role&&this._emit("logprobs.content.delta",{content:e.logprobs?.content,snapshot:t.logprobs?.content??[]}),null!=e.logprobs?.refusal&&"assistant"===t.message?.role&&this._emit("logprobs.refusal.delta",{refusal:e.logprobs?.refusal,snapshot:t.logprobs?.refusal??[]});const r=ro(this,Ws,"m",Ks).call(this,t);t.finish_reason&&(ro(this,Ws,"m",Ys).call(this,t),null!=r.current_tool_call_index&&ro(this,Ws,"m",Qs).call(this,t,r.current_tool_call_index));for(const n of e.delta.tool_calls??[])r.current_tool_call_index!==n.index&&(ro(this,Ws,"m",Ys).call(this,t),null!=r.current_tool_call_index&&ro(this,Ws,"m",Qs).call(this,t,r.current_tool_call_index)),r.current_tool_call_index=n.index;for(const n of e.delta.tool_calls??[]){const e=t.message.tool_calls?.[n.index];e?.type&&("function"===e?.type&&this._emit("tool_calls.function.arguments.delta",{name:e.function?.name,index:n.index,arguments:e.function.arguments,parsed_arguments:e.function.parsed_arguments,arguments_delta:n.function?.arguments??""}))}}},Qs=function e(t,n){if(ro(this,Ws,"m",Ks).call(this,t).done_tool_calls.has(n))return;const r=t.message.tool_calls?.[n];if(!r)throw new Error("no tool call snapshot");if(!r.type)throw new Error("tool call snapshot missing `type`");if("function"===r.type){const e=ro(this,Gs,"f")?.tools?.find((e=>"function"===e.type&&e.function.name===r.function.name));this._emit("tool_calls.function.arguments.done",{name:r.function.name,index:n,arguments:r.function.arguments,parsed_arguments:ds(e)?e.$parseRaw(r.function.arguments):e?.function.strict?JSON.parse(r.function.arguments):null})}else r.type},Ys=function e(t){const n=ro(this,Ws,"m",Ks).call(this,t);if(t.message.content&&!n.content_done){n.content_done=!0;const e=ro(this,Ws,"m",eo).call(this);this._emit("content.done",{content:t.message.content,parsed:e?e.$parseRaw(t.message.content):null})}t.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),t.logprobs?.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),t.logprobs?.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},Zs=function e(){if(this.ended)throw new fn("stream has ended, this shouldn\'t happen");const t=ro(this,Xs,"f");if(!t)throw new fn("request ended without sending any chunks");return no(this,Xs,void 0,"f"),no(this,Hs,[],"f"),function n(e,t){const{id:n,choices:r,created:s,model:o,system_fingerprint:i,...a}=e,c={...a,id:n,choices:r.map((({message:t,finish_reason:n,index:r,logprobs:s,...o})=>{if(!n)throw new fn(`missing finish_reason for choice ${r}`);const{content:i=null,function_call:a,tool_calls:c,...l}=t,u=t.role;if(!u)throw new fn(`missing role for choice ${r}`);if(a){const{arguments:e,name:c}=a;if(null==e)throw new fn(`missing function_call.arguments for choice ${r}`);if(!c)throw new fn(`missing function_call.name for choice ${r}`);return{...o,message:{content:i,function_call:{arguments:e,name:c},role:u,refusal:t.refusal??null},finish_reason:n,index:r,logprobs:s}}return c?{...o,index:r,finish_reason:n,logprobs:s,message:{...l,role:u,content:i,refusal:t.refusal??null,tool_calls:c.map(((t,n)=>{const{function:s,type:o,id:i,...a}=t,{arguments:c,name:l,...u}=s||{};if(null==i)throw new fn(`missing choices[${r}].tool_calls[${n}].id\\n${oo(e)}`);if(null==o)throw new fn(`missing choices[${r}].tool_calls[${n}].type\\n${oo(e)}`);if(null==l)throw new fn(`missing choices[${r}].tool_calls[${n}].function.name\\n${oo(e)}`);if(null==c)throw new fn(`missing choices[${r}].tool_calls[${n}].function.arguments\\n${oo(e)}`);return{...a,id:i,type:o,function:{...u,name:l,arguments:c}}}))}}:{...o,message:{...l,content:i,role:u,refusal:t.refusal??null},finish_reason:n,index:r,logprobs:s}})),created:s,model:o,object:"chat.completion",...i?{system_fingerprint:i}:{}};return function l(e,t){return t&&ys(t)?ps(e,t):{...e,choices:e.choices.map((e=>({...e,message:{...e.message,parsed:null,tool_calls:e.message.tool_calls??[]}})))}}(c,t)}(t,ro(this,Gs,"f"))},eo=function e(){const t=ro(this,Gs,"f")?.response_format;return fs(t)?t:null},to=function e(t){var n,r,s,o;let i=ro(this,Xs,"f");const{choices:a,...c}=t;i?Object.assign(i,c):i=no(this,Xs,{...c,choices:[]},"f");for(const{delta:e,finish_reason:a,index:c,logprobs:l=null,...u}of t.choices){let t=i.choices[c];if(t||(t=i.choices[c]={finish_reason:a,index:c,message:{},logprobs:l,...u}),l)if(t.logprobs){const{content:e,refusal:s,...o}=l;Object.assign(t.logprobs,o),e&&((n=t.logprobs).content??(n.content=[]),t.logprobs.content.push(...e)),s&&((r=t.logprobs).refusal??(r.refusal=[]),t.logprobs.refusal.push(...s))}else t.logprobs=Object.assign({},l);if(a&&(t.finish_reason=a,ro(this,Gs,"f")&&ys(ro(this,Gs,"f")))){if("length"===a)throw new An;if("content_filter"===a)throw new En}if(Object.assign(t,u),!e)continue;const{content:h,refusal:f,function_call:d,role:p,tool_calls:m,...g}=e;if(Object.assign(t.message,g),f&&(t.message.refusal=(t.message.refusal||"")+f),p&&(t.message.role=p),d&&(t.message.function_call?(d.name&&(t.message.function_call.name=d.name),d.arguments&&((s=t.message.function_call).arguments??(s.arguments=""),t.message.function_call.arguments+=d.arguments)):t.message.function_call=d),h&&(t.message.content=(t.message.content||"")+h,!t.message.refusal&&ro(this,Ws,"m",eo).call(this)&&(t.message.parsed=qs(t.message.content))),m){t.message.tool_calls||(t.message.tool_calls=[]);for(const{index:e,id:n,type:r,function:s,...i}of m){const a=(o=t.message.tool_calls)[e]??(o[e]={});Object.assign(a,i),n&&(a.id=n),r&&(a.type=r),s&&(a.function??(a.function={name:s.name??"",arguments:""})),s?.name&&(a.function.name=s.name),s?.arguments&&(a.function.arguments+=s.arguments,gs(ro(this,Gs,"f"),a)&&(a.function.parsed_arguments=qs(a.function.arguments)))}}}return i},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",(n=>{const r=t.shift();r?r.resolve(n):e.push(n)})),this.on("end",(()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),this.on("error",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise(((e,n)=>t.push({resolve:e,reject:n}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0}));return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new On(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function oo(e){return JSON.stringify(e)}class io extends so{static fromReadableStream(e){const t=new io(null);return t._run((()=>t._fromReadableStream(e))),t}static runFunctions(e,t,n){const r=new io(null),s={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run((()=>r._runFunctions(e,t,s))),r}static runTools(e,t,n){const r=new io(t),s={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run((()=>r._runTools(e,t,s))),r}}class ao extends _r{parse(e,t){return function n(e){for(const t of e??[]){if("function"!==t.type)throw new fn(`Currently only \\`function\\` tool types support auto-parsing; Received \\`${t.type}\\``);if(!0!==t.function.strict)throw new fn(`The \\`${t.function.name}\\` tool is not marked with \\`strict: true\\`. Only strict function tools can be auto-parsed`)}}(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap((t=>ps(t,e)))}runFunctions(e,t){return e.stream?io.runFunctions(this._client,e,t):Os.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?io.runTools(this._client,e,t):Os.runTools(this._client,e,t)}stream(e,t){return so.createChatCompletion(this._client,e,t)}}class co extends _r{constructor(){super(...arguments),this.completions=new ao(this._client)}}!function(e){e.Completions=ao}(co||(co={}));class lo extends _r{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class uo extends _r{constructor(){super(...arguments),this.sessions=new lo(this._client)}}uo.Sessions=lo;var ho,fo,po,mo,go,yo,wo,bo,vo,_o,xo,So,ko,Ao,Eo,Co,Io,Oo,Ro,$o,Mo,jo,Po=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},To=function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n};class No extends hs{constructor(){super(...arguments),ho.add(this),fo.set(this,[]),po.set(this,{}),mo.set(this,{}),go.set(this,void 0),yo.set(this,void 0),wo.set(this,void 0),bo.set(this,void 0),vo.set(this,void 0),_o.set(this,void 0),xo.set(this,void 0),So.set(this,void 0),ko.set(this,void 0)}[(fo=new WeakMap,po=new WeakMap,mo=new WeakMap,go=new WeakMap,yo=new WeakMap,wo=new WeakMap,bo=new WeakMap,vo=new WeakMap,_o=new WeakMap,xo=new WeakMap,So=new WeakMap,ko=new WeakMap,ho=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",(n=>{const r=t.shift();r?r.resolve(n):e.push(n)})),this.on("end",(()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),this.on("error",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise(((e,n)=>t.push({resolve:e,reject:n}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0}));return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new No;return t._run((()=>t._fromReadableStream(e))),t}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),this._connected();const r=On.fromReadableStream(e,this.controller);for await(const e of r)Po(this,ho,"m",Ao).call(this,e);if(r.controller.signal?.aborted)throw new pn;return this._addRun(Po(this,ho,"m",Eo).call(this))}toReadableStream(){return new On(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,r,s){const o=new No;return o._run((()=>o._runToolAssistantStream(e,t,n,r,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}}))),o}async _createToolAssistantStream(e,t,n,r,s){const o=s?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",(()=>this.controller.abort())));const i={...r,stream:!0},a=await e.submitToolOutputs(t,n,i,{...s,signal:this.controller.signal});this._connected();for await(const e of a)Po(this,ho,"m",Ao).call(this,e);if(a.controller.signal?.aborted)throw new pn;return this._addRun(Po(this,ho,"m",Eo).call(this))}static createThreadAssistantStream(e,t,n){const r=new No;return r._run((()=>r._threadAssistantStream(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}}))),r}static createAssistantStream(e,t,n,r){const s=new No;return s._run((()=>s._runAssistantStream(e,t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}}))),s}currentEvent(){return Po(this,xo,"f")}currentRun(){return Po(this,So,"f")}currentMessageSnapshot(){return Po(this,go,"f")}currentRunStepSnapshot(){return Po(this,ko,"f")}async finalRunSteps(){return await this.done(),Object.values(Po(this,po,"f"))}async finalMessages(){return await this.done(),Object.values(Po(this,mo,"f"))}async finalRun(){if(await this.done(),!Po(this,yo,"f"))throw Error("Final run was not received.");return Po(this,yo,"f")}async _createThreadAssistantStream(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort())));const s={...t,stream:!0},o=await e.createAndRun(s,{...n,signal:this.controller.signal});this._connected();for await(const e of o)Po(this,ho,"m",Ao).call(this,e);if(o.controller.signal?.aborted)throw new pn;return this._addRun(Po(this,ho,"m",Eo).call(this))}async _createAssistantStream(e,t,n,r){const s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",(()=>this.controller.abort())));const o={...n,stream:!0},i=await e.create(t,o,{...r,signal:this.controller.signal});this._connected();for await(const e of i)Po(this,ho,"m",Ao).call(this,e);if(i.controller.signal?.aborted)throw new pn;return this._addRun(Po(this,ho,"m",Eo).call(this))}static accumulateDelta(e,t){for(const[n,r]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=r;continue}let t=e[n];if(null!=t)if("index"!==n&&"type"!==n){if("string"==typeof t&&"string"==typeof r)t+=r;else if("number"==typeof t&&"number"==typeof r)t+=r;else{if(!vr(t)||!vr(r)){if(Array.isArray(t)&&Array.isArray(r)){if(t.every((e=>"string"==typeof e||"number"==typeof e))){t.push(...r);continue}for(const e of r){if(!vr(e))throw new Error(`Expected array delta entry to be an object but got: ${e}`);const n=e.index;if(null==n)throw console.error(e),new Error("Expected array delta entry to have an `index` property");if("number"!=typeof n)throw new Error(`Expected array delta entry \\`index\\` property to be a number but got ${n}`);const r=t[n];null==r?t.push(e):t[n]=this.accumulateDelta(r,e)}continue}throw Error(`Unhandled record type: ${n}, deltaValue: ${r}, accValue: ${t}`)}t=this.accumulateDelta(t,r)}e[n]=t}else e[n]=r;else e[n]=r}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,r){return await this._createAssistantStream(t,e,n,r)}async _runToolAssistantStream(e,t,n,r,s){return await this._createToolAssistantStream(n,e,t,r,s)}}Ao=function e(t){if(!this.ended)switch(To(this,xo,t,"f"),Po(this,ho,"m",Oo).call(this,t),t.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":Po(this,ho,"m",jo).call(this,t);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Po(this,ho,"m",Io).call(this,t);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":Po(this,ho,"m",Co).call(this,t);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Eo=function e(){if(this.ended)throw new fn("stream has ended, this shouldn\'t happen");if(!Po(this,yo,"f"))throw Error("Final run has not been received");return Po(this,yo,"f")},Co=function e(t){const[n,r]=Po(this,ho,"m",$o).call(this,t,Po(this,go,"f"));To(this,go,n,"f"),Po(this,mo,"f")[n.id]=n;for(const e of r){const t=n.content[e.index];"text"==t?.type&&this._emit("textCreated",t.text)}switch(t.event){case"thread.message.created":this._emit("messageCreated",t.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",t.data.delta,n),t.data.delta.content)for(const e of t.data.delta.content){if("text"==e.type&&e.text){let t=e.text,r=n.content[e.index];if(!r||"text"!=r.type)throw Error("The snapshot associated with this text delta is not text or missing");this._emit("textDelta",t,r.text)}if(e.index!=Po(this,wo,"f")){if(Po(this,bo,"f"))switch(Po(this,bo,"f").type){case"text":this._emit("textDone",Po(this,bo,"f").text,Po(this,go,"f"));break;case"image_file":this._emit("imageFileDone",Po(this,bo,"f").image_file,Po(this,go,"f"))}To(this,wo,e.index,"f")}To(this,bo,n.content[e.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==Po(this,wo,"f")){const e=t.data.content[Po(this,wo,"f")];if(e)switch(e.type){case"image_file":this._emit("imageFileDone",e.image_file,Po(this,go,"f"));break;case"text":this._emit("textDone",e.text,Po(this,go,"f"))}}Po(this,go,"f")&&this._emit("messageDone",t.data),To(this,go,void 0,"f")}},Io=function e(t){const n=Po(this,ho,"m",Ro).call(this,t);switch(To(this,ko,n,"f"),t.event){case"thread.run.step.created":this._emit("runStepCreated",t.data);break;case"thread.run.step.delta":const e=t.data.delta;if(e.step_details&&"tool_calls"==e.step_details.type&&e.step_details.tool_calls&&"tool_calls"==n.step_details.type)for(const t of e.step_details.tool_calls)t.index==Po(this,vo,"f")?this._emit("toolCallDelta",t,n.step_details.tool_calls[t.index]):(Po(this,_o,"f")&&this._emit("toolCallDone",Po(this,_o,"f")),To(this,vo,t.index,"f"),To(this,_o,n.step_details.tool_calls[t.index],"f"),Po(this,_o,"f")&&this._emit("toolCallCreated",Po(this,_o,"f")));this._emit("runStepDelta",t.data.delta,n);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":To(this,ko,void 0,"f");"tool_calls"==t.data.step_details.type&&Po(this,_o,"f")&&(this._emit("toolCallDone",Po(this,_o,"f")),To(this,_o,void 0,"f")),this._emit("runStepDone",t.data,n)}},Oo=function e(t){Po(this,fo,"f").push(t),this._emit("event",t)},Ro=function e(t){switch(t.event){case"thread.run.step.created":return Po(this,po,"f")[t.data.id]=t.data,t.data;case"thread.run.step.delta":let e=Po(this,po,"f")[t.data.id];if(!e)throw Error("Received a RunStepDelta before creation of a snapshot");let n=t.data;if(n.delta){const r=No.accumulateDelta(e,n.delta);Po(this,po,"f")[t.data.id]=r}return Po(this,po,"f")[t.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":Po(this,po,"f")[t.data.id]=t.data}if(Po(this,po,"f")[t.data.id])return Po(this,po,"f")[t.data.id];throw new Error("No snapshot available")},$o=function e(t,n){let r=[];switch(t.event){case"thread.message.created":return[t.data,r];case"thread.message.delta":if(!n)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let e=t.data;if(e.delta.content)for(const t of e.delta.content)if(t.index in n.content){let e=n.content[t.index];n.content[t.index]=Po(this,ho,"m",Mo).call(this,t,e)}else n.content[t.index]=t,r.push(t);return[n,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(n)return[n,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Mo=function e(t,n){return No.accumulateDelta(n,t)},jo=function e(t){switch(To(this,So,t.data,"f"),t.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.cancelling":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":To(this,yo,t.data,"f"),Po(this,_o,"f")&&(this._emit("toolCallDone",Po(this,_o,"f")),To(this,_o,void 0,"f"))}};class Do extends _r{create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t={},n){return er(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,Bo,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}}class Bo extends Cr{}Do.MessagesPage=Bo;class Lo extends _r{retrieve(e,t,n,r={},s){return er(r)?this.retrieve(e,t,n,{},r):this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,t,n={},r){return er(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,Fo,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}}class Fo extends Cr{}Lo.RunStepsPage=Fo;class zo extends _r{constructor(){super(...arguments),this.steps=new Lo(this._client)}create(e,t,n){const{include:r,...s}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:r},body:s,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers},stream:t.stream??!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t={},n){return er(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,Uo,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}createAndStream(e,t,n){return No.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const r={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:s,response:o}=await this.retrieve(e,t,{...n,headers:{...n?.headers,...r}}).withResponse();switch(s.status){case"queued":case"in_progress":case"cancelling":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=o.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await lr(e);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return s}}}stream(e,t,n){return No.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,t,n,r){const s=await this.submitToolOutputs(e,t,n,r);return await this.poll(e,s.id,r)}submitToolOutputsStream(e,t,n,r){return No.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,r)}}class Uo extends Cr{}zo.RunsPage=Uo,zo.Steps=Lo,zo.RunStepsPage=Fo;class qo extends _r{constructor(){super(...arguments),this.runs=new zo(this._client),this.messages=new Do(this._client)}create(e={},t){return er(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.thread_id,n.id,t)}createAndRunStream(e,t){return No.createThreadAssistantStream(e,this._client.beta.threads,t)}}qo.Runs=zo,qo.RunsPage=Uo,qo.Messages=Do,qo.MessagesPage=Bo;class Wo extends _r{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e,t={},n){return er(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,Go,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}async poll(e,t,n){const r={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const s=await this.retrieve(e,t,{...n,headers:r}).withResponse(),o=s.data;switch(o.status){case"in_progress":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=s.response.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await lr(e);break;case"failed":case"completed":return o}}}async upload(e,t,n){const r=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:r.id},n)}async uploadAndPoll(e,t,n){const r=await this.upload(e,t,n);return await this.poll(e,r.id,n)}}class Go extends Cr{}Wo.VectorStoreFilesPage=Go;class Ho extends _r{create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t);return await this.poll(e,r.id,n)}listFiles(e,t,n={},r){return er(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,Go,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async poll(e,t,n){const r={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:s,response:o}=await this.retrieve(e,t,{...n,headers:r}).withResponse();switch(s.status){case"in_progress":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=o.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await lr(e);break;case"failed":case"cancelled":case"completed":return s}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},r){if(null==t||0==t.length)throw new Error("No `files` provided to process. If you\'ve already uploaded files you should use `.createAndPoll()` instead");const s=r?.maxConcurrency??5,o=Math.min(s,t.length),i=this._client,a=t.values(),c=[...n];const l=Array(o).fill(a).map((async function u(e){for(let t of e){const e=await i.files.create({file:t,purpose:"assistants"},r);c.push(e.id)}}));return await(async e=>{const t=await Promise.allSettled(e),n=t.filter((e=>"rejected"===e.status));if(n.length){for(const e of n)console.error(e.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const r=[];for(const e of t)"fulfilled"===e.status&&r.push(e.value);return r})(l),await this.createAndPoll(e,{file_ids:c})}}class Xo extends _r{constructor(){super(...arguments),this.files=new Wo(this._client),this.fileBatches=new Ho(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},t){return er(e)?this.list({},e):this._client.getAPIList("/vector_stores",Jo,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class Jo extends Cr{}Xo.VectorStoresPage=Jo,Xo.Files=Wo,Xo.VectorStoreFilesPage=Go,Xo.FileBatches=Ho;class Ko extends _r{constructor(){super(...arguments),this.realtime=new uo(this._client),this.vectorStores=new Xo(this._client),this.chat=new co(this._client),this.assistants=new Wr(this._client),this.threads=new qo(this._client)}}Ko.Realtime=uo,Ko.VectorStores=Xo,Ko.VectorStoresPage=Jo,Ko.Assistants=Wr,Ko.AssistantsPage=Gr,Ko.Threads=qo;class Vo extends _r{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return er(e)?this.list({},e):this._client.getAPIList("/batches",Qo,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class Qo extends Cr{}Vo.BatchesPage=Qo;class Yo extends _r{create(e,t,n){return this._client.post(`/uploads/${e}/parts`,Fn({body:t,...n}))}}class Zo extends _r{constructor(){super(...arguments),this.parts=new Yo(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(`/uploads/${e}/complete`,{body:t,...n})}}var ei;Zo.Parts=Yo;class ti extends Kn{constructor({baseURL:e=fr("OPENAI_BASE_URL"),apiKey:t=fr("OPENAI_API_KEY"),organization:n=fr("OPENAI_ORG_ID")??null,project:r=fr("OPENAI_PROJECT_ID")??null,...s}={}){if(void 0===t)throw new fn("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: \'My API Key\' }).");const o={apiKey:t,organization:n,project:r,...s,baseURL:e||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&"undefined"!=typeof window&&"undefined"!=typeof window.document&&"undefined"!=typeof navigator)throw new fn("It looks like you\'re running in a browser-like environment.\\n\\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\\nIf you understand the risks and have appropriate mitigations in place,\\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\\n\\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\\n\\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\\n");super({baseURL:o.baseURL,timeout:o.timeout??6e5,httpAgent:o.httpAgent,maxRetries:o.maxRetries,fetch:o.fetch}),this.completions=new xr(this),this.chat=new kr(this),this.embeddings=new Ar(this),this.files=new Ir(this),this.images=new Rr(this),this.audio=new Pr(this),this.moderations=new Tr(this),this.models=new Nr(this),this.fineTuning=new qr(this),this.beta=new Ko(this),this.batches=new Vo(this),this.uploads=new Zo(this),this._options=o,this.apiKey=t,this.organization=n,this.project=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return Ht(e,{arrayFormat:"brackets"})}}ei=ti,ti.OpenAI=ei,ti.DEFAULT_TIMEOUT=6e5,ti.OpenAIError=fn,ti.APIError=dn,ti.APIConnectionError=mn,ti.APIConnectionTimeoutError=gn,ti.APIUserAbortError=pn,ti.NotFoundError=vn,ti.ConflictError=_n,ti.RateLimitError=Sn,ti.BadRequestError=yn,ti.AuthenticationError=wn,ti.InternalServerError=kn,ti.PermissionDeniedError=bn,ti.UnprocessableEntityError=xn,ti.toFile=Nn,ti.fileFromPath=tn,ti.Completions=xr,ti.Chat=kr,ti.Embeddings=Ar,ti.Files=Ir,ti.FileObjectsPage=Or,ti.Images=Rr,ti.Audio=Pr,ti.Moderations=Tr,ti.Models=Nr,ti.ModelsPage=Dr,ti.FineTuning=qr,ti.Beta=Ko,ti.Batches=Vo,ti.BatchesPage=Qo,ti.Uploads=Zo;new Set(["/completions","/chat/completions","/embeddings","/audio/transcriptions","/audio/translations","/audio/speech","/images/generations"]);const ni=ti;class ri extends EventTarget{constructor(){super(...arguments),this.handlerMap=new WeakMap}addEventListener(e,t){const n=({detail:e})=>t(e);return this.handlerMap.set(t,n),super.addEventListener(e,n)}removeEventListener(e,t){const n=this.handlerMap.get(t);return super.removeEventListener(e,n)}dispatchEvent(e,t){return super.dispatchEvent(new CustomEvent(e,{detail:t}))}}const si=e=>{let t=44;const n=new ArrayBuffer(t+4*e.length),r=new DataView(n);oi(r,0,"RIFF"),r.setUint32(4,36+4*e.length,!0),oi(r,8,"WAVE"),oi(r,12,"fmt "),r.setUint32(16,16,!0),r.setUint16(20,3,!0),r.setUint16(22,1,!0),r.setUint32(24,S.NG,!0),r.setUint32(28,4*S.NG,!0),r.setUint16(32,4,!0),r.setUint16(34,32,!0),oi(r,36,"data"),r.setUint32(40,4*e.length,!0);for(let n=0;n<e.length;++n,t+=4)r.setFloat32(t,e[n],!0);return n};function oi(e,t,n){for(let r=0;r<n.length;++r)e.setUint8(t+r,n.charCodeAt(r))}const ii=(e,t=0,n=e.length)=>{let r=0;for(let s=t;s<n;s+=1){const t=e[s];r+=t*t}const s=r/e.length;return Math.sqrt(s)};const ai=S.KV&&!S._o,ci=Object.fromEntries(["log","info","warn","error"].map((e=>[e,ai?()=>{}:(...t)=>console[e](...(e=>e.map((e=>"string"==typeof e?e.trim():e)))(t))]))),li={};ai||Object.assign(globalThis,{debugData:li});const ui=ai?()=>{}:(e,t)=>{var n;return null!==(n=li[e])&&void 0!==n||(li[e]=[]),li[e].push(t),ci.log(e,t)},hi=Object.assign(ci.log,{data:ui}),{info:fi,warn:di,error:pi}=ci;class mi extends ri{constructor(){super(...arguments),this.state="not-started",this.slices=[],this.isOnline=!1,this.duration=0,this.done=!1,this.isReadyPromise=new Promise((e=>this.resolveIsReady=e))}get isFinished(){return"finished"===this.state||"failed"===this.state}static getAudioSlice(e,t,n){return Ce(e.map((e=>e.getAudioSlice(t,n))))}getAudioSlice(e,t){const{slices:n}=this,r=n.find((t=>e>=t.start&&e<t.end)),s=n.find((e=>t>e.start&&t<e.end));if(!r)return[];const o=Math.floor(r.audio.length*re(r.start,r.end,e));if(!s)return r.audio.slice(o);const i=Math.floor(s.audio.length*re(s.start,s.end,t));if(r===s)return r.audio.slice(o,i);const a=new Set(n.slice(n.indexOf(r),n.indexOf(s)+1)),c=new Set([r,s]),l=[...a.difference(c)];return[...r.audio.slice(o),...l.flatMap((e=>[...e.audio])),...s.audio.slice(0,i)]}async start(e){}async stop(){}}const gi=((e,t)=>{e=se(e);const n=S.NG/t,r=-.008/Math.log(1-e);return 1-Math.exp(-1/n/r)})(.05,S.RK);class yi extends mi{async getSegmentSlices(e=this.buffer,{maxDuration:t,minDuration:n}=yi){const r=S.NG*t/2,s=[];if(e.length<S.NG*n){const n=new Float32Array(S.NG*t);n.set(e,S.NG*t-e.length);const r={audio:n,start:0,end:e.length/S.NG,index:0};return this.dispatchEvent("next",r),this.slices=[r]}let o=0;for(let t=0;t<e.length;t+=1)if(e[t]){o=t;break}const i=o/S.NG;e=e.slice(o);const a=Math.ceil(e.length/S.NG/(t/2));let c=0,l=0;for(let t=0;t<a;t+=1){let o,i=1,a=0;for(let n=t*r;n<(t+1)*r;n+=S.RK){const r=ii(e,n,n+S.RK);null!=o||(o=r),o=ne(o,r,gi),(t>0||n>S.NG)&&o<i&&(i=o,a=n+S.RK/2)}const u=a,h=u>=e.length-n*S.NG;if((u-l)/S.NG>=n){const t={audio:e.slice(l,u),start:l/S.NG,end:u/S.NG,index:c};h&&(t.last=h),l=u,c+=1,s.push(t),this.dispatchEvent("next",t),c%16==0&&await I(20)}}if(l<e.length){const t=e.slice(l),r=new Float32Array(Math.max(n*S.NG,t.length)),o=l/S.NG+i,a=o+r.length/S.NG;r.set(t);const u={audio:r,start:o,end:a,last:!0,index:c};s.push(u),this.dispatchEvent("next",u)}return this.slices=s}async start(e={maxDuration:20,minDuration:10}){const{buffer:t}=this;setTimeout((async()=>{this.state="active";try{const n=(await this.getSegmentSlices(t,e)).map((({audio:{length:e}})=>e/S.NG));hi("offline-audio-source-durations",((e,t=Ae,n=(e=>e))=>{const r={};for(const s of t)r[s]=ke[s](e,n);const s=(t=W)=>{const n=Object.keys(r).map((e=>`${e}: ${null==r[e]?"":t(r[e])}`));return n.unshift(`samples: ${e.length}`),n.join(", ")},o=s;return Object.defineProperties(r,{format:{value:s,enumerable:!1},toString:{value:o,enumerable:!1}}),r})(n).toString()),this.state="finished"}catch(e){hi("error initiating offline-audio-source",e),this.state="failed"}}))}constructor(e){super(),this.buffer=e,this.isOnline=!1,this.done=!0,Object.assign(this,{buffer:e,duration:e.length/S.NG}),this.resolveIsReady()}}yi.maxDuration=20,yi.minDuration=10;const wi=(e="GET")=>async(t,...n)=>await fetch(n[0],{method:e,...n[1],signal:AbortSignal.timeout(t)}),bi=Object.assign(fetch,{cors:(...e)=>(e[1]?e[1].mode="cors":e[1]={mode:"cors"},fetch(...e)),timeout:Object.assign(wi(),{post:wi("POST")})}),vi=bi;const _i=S.Ll?e=>Buffer.from(e.buffer).toString("base64"):e=>{const t=new Uint8Array(e.buffer),n=Array.from(t,(e=>String.fromCharCode(e))).join("");return btoa(n)};var xi=s(612),Si=s.n(xi);class ki{constructor(e){if(!e)throw TypeError("options argument is required");if(!e.sampleRate)throw TypeError("options.sampleRate is required");if(e.sampleRate<3e3||e.sampleRate>768e3)throw TypeError("options.sampleRate must be within 3000..768000");if(!e.length)throw TypeError("options.length must be more than 0");this.sampleRate=e.sampleRate,this.numberOfChannels=e.numberOfChannels||1,this.length=0|e.length,this.duration=this.length/this.sampleRate,this._data=new Float32Array(this.length*this.numberOfChannels),this._channelData=[];for(let e=0;e<this.numberOfChannels;e++)this._channelData.push(this._data.subarray(e*this.length,(e+1)*this.length))}getChannelData(e){if(e>=this.numberOfChannels||e<0||null==e)throw Error("Cannot getChannelData: channel number ("+e+") exceeds number of channels ("+this.numberOfChannels+")");return this._channelData[e]}copyFromChannel(e,t,n){null==n&&(n=0);for(var r=this._channelData[t],s=n,o=0;s<this.length&&o<e.length;s++,o++)e[o]=r[s]}copyToChannel(e,t,n){var r=this._channelData[t];n||(n=0);for(var s=n,o=0;s<this.length&&o<e.length;s++,o++)r[s]=e[o]}}function Ai(e){const t=new AudioContext({sampleRate:S.NG}),n=t.createBuffer(1,e.length,S.NG);return n.getChannelData(0).set(e),t.close(),n}class Ei{static get resampler(){return e=>{const t=new OfflineAudioContext(1,e.duration*S.NG,S.NG),n=t.createBufferSource();return n.buffer=e,n.connect(t.destination),n.start(),t.startRendering()}}static get slicer(){var e;return null!==(e=this._slicer)&&void 0!==e?e:this._slicer=new(Si())({sampleRate:S.NG})}static fromTo(e,t,...n){const r=Ei.from(e);return r instanceof Promise?r.then((async e=>e.to(t,...n))):r.to(t,...n)}static fromSync(e){if(e instanceof Array&&(e=Float32Array.from(e)),e instanceof Float32Array){const t=Ai(e);return new Ei(t)}if(e instanceof ArrayBuffer){const t=Ai(new Float32Array(e));return new Ei(t)}if(e instanceof ki)return new Ei(e);const t=+e;return new Ei(new ki({numberOfChannels:1,sampleRate:S.NG,length:t==t?t:1e3}))}static async fromAsync(e){if("upload"===`${e}`.toLowerCase()){const{files:t}=await(async({accept:e="audio",directory:t=!1,multiple:n=t,keepInput:r=!0}={})=>{const s=document.createElement("input");s.type="file",s.accept=e,s.multiple=n,s.webkitdirectory=t,s.click();const o=await new Promise((e=>s.onchange=async t=>{const{files:n}=t.target;e(n),r||s.remove()}));return{input:s,files:Array.from(o)}})();e=t[0]}if(e instanceof Blob){const t=URL.createObjectURL(e),n=await Ei.resampler((await this.slicer.fetchAudio(t))[0]);return URL.revokeObjectURL(t),new Ei(n)}if("string"==typeof e)try{const[t]=await this.slicer.fetchAudio(e),n=await Ei.resampler(t);return new Ei(n)}catch(t){console.warn(t);const n=Ai(function r(e){const t=atob(e),n=t.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=t.charCodeAt(e);return new Float32Array(r.buffer)}(e));return new Ei(n)}if(e instanceof HTMLAudioElement)return await Ei.from(e.src);const t=+e;return new Ei(new ki({numberOfChannels:1,sampleRate:S.NG,length:t==t?t:1e3}))}static from(e){return"number"==typeof e||e instanceof Array||e instanceof Float32Array||e instanceof ArrayBuffer||e instanceof ki?Ei.fromSync(e):Ei.fromAsync(e)}constructor(e){this.audioBuffer=e,this.out={Buffer:()=>this.audioBuffer,Float32Array:()=>this.audioBuffer.getChannelData(0),Array:()=>this.audioBuffer.getChannelData(0),Audio:()=>function e(t){const n=si(t),r=new Blob([n],{type:"audio/wav"}),s=URL.createObjectURL(r);return new Audio(s)}(this.audioBuffer.getChannelData(0)),Blob:()=>Ei.slicer.export(this.audioBuffer).blob,File:()=>{const e=this.to.Blob();return new File([e],"audio.wav",{type:"audio/mpeg"})},Wav:()=>si(this.audioBuffer.getChannelData(0)),String:()=>URL.createObjectURL(this.to.Blob()),URL:()=>this.out.String(),Base64:()=>_i(this.audioBuffer.getChannelData(0)),Download:(e="audio.wav")=>Ei.slicer.download(this.to.Blob(),e),Duration:e=>{let t=this.to.Array();return t=e>this.audioBuffer.duration?Float32Array.from([...t,...t.slice(0,Math.floor(S.NG*e)-t.length)]):t.slice(0,Math.floor(e*S.NG)),Ei.from(t)},Segment:e=>{const t=this.to.Array();return Ei.from(t.slice(Math.floor(e.start*S.NG),Math.floor(e.end*S.NG)))}},this.to=Object.assign(((e,...t)=>{e=e.toLowerCase();const n=Object.fromEntries(Object.entries(this.out).map((([e,t])=>[e.toLowerCase(),t])));return e in n?n[e].apply(n[e],t):this.out.String()}),this.out),this.audioBuffer=e}static async play(e){return(await Ei.from(e)).play()}async play(){return this.to("Audio").play()}static async compress(e){const{compressor:t}=await s.e(405).then(s.bind(s,405));return Ei.from(await t.process(await Ei.fromTo(e,"Buffer")))}}const Ci=async(e,t,{timeout:n=1e9}={})=>{const r=t instanceof File?[(await Ei.fromTo(t,"Float32Array")).buffer]:[t.buffer],s=new Blob(r,{type:"application/octet-stream"}),o=new FormData;o.append("audio",s);try{return await vi.timeout(n,e,{method:"POST",body:o,mode:"cors"})}catch(e){console.error(e)}},Ii=async(e,t,{model:n,xvects:r=!1,transcriptionId:s="",noteId:o="",diarize:i,numSpeakers:a,clients:c,clinicians:l,timeout:u})=>{const h=`?${`&diarize=${i}`}${`&id=${s}`}${`&noteId=${o}`}${n&&n!==S.pE?`&model=${n}`:""}${`&xvects=${r}`}${[a?`&numSpeakers=${a}`:"",l?`&clinicians=${l}`:"",c?`&clients=${c}`:""].join("")}`,f=`${e.includes("localhost")?"http":"https"}://${e}/${t instanceof File?"api/transcribe-file":"api/transcribe"}${h}`;return await(async e=>{let t;if(!e)return{processed:!1};try{if(404===e.status)throw void 0;t=await e.json(),!1!==t.processed&&(t.processed=!0)}catch(e){t={processed:!1},console.error(e)}return t})(await Ci(f,t,{timeout:u}))},{abs:Oi,sign:Ri}=Math,$i=Math;class Mi{static create({x:e,y:t,z:n,w:r}={}){return new Mi(e,t,n,r)}clone(){return Mi.create(this)}get brightness(){return 1/3*(this.x+this.y+this.z)}static random(e=(()=>$i.random())){return Mi.create({x:e(),y:e(),z:e(),w:1})}static stringHash(e){const t=(e=>()=>{e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296})(ye([...e].map((e=>e.charCodeAt(0))))),n=[je(Mi.rainbow,t()),je(Mi.rainbow,t())];return n[0].mix(n[1],t())}[Symbol.iterator](){return[this.x,this.y,this.z,this.w][Symbol.iterator]()}constructor(e=0,t=0,n=0,r=1){this.x=e,this.y=t,this.z=n,this.w=r}static named(e){const t=document.createElement("div");t.setAttribute("style",`color: ${e}; display: none;`),document.body.append(t),setTimeout(t.remove.bind(t));const n=Mi.parse(`${t.computedStyleMap().get("color")}`);return"white"!==e&&`${n}`==`${Mi.white}`?null:n}static parse(e){const t=`${e}`,n=!/rgba?|\\(|\\)|\\"/g.test(t);if(!S.Ll&&n)return Mi.named(t);const r=t.replace(/rgba?|\\(|\\)|\\"/g,"").split(/,\\s?/).map(Number),[s,o,i]=r.map((e=>e/255)),[,,,a]=r;return Mi.create({x:s,y:o,z:i,w:a})}static complementary(e){return Mi.create({x:1-e.x,y:1-e.y,z:1-e.z,w:e.w})}complementary(){return Mi.create({x:1-this.x,y:1-this.y,z:1-this.z,w:this.w})}static mix(e,t,n=.5){return"number"!=typeof n&&(n=.5*n[1]),Mi.create({x:ne(e.x,t.x,n),y:ne(e.y,t.y,n),z:ne(e.z,t.z,n),w:ne(e.w,t.w,n)})}mix(e,t=.5){return"number"!=typeof t&&(t=.5*t[1]),Mi.create({x:ne(this.x,e.x,t),y:ne(this.y,e.y,t),z:ne(this.z,e.z,t),w:ne(this.w,e.w,t)})}scale(e,t=this.w){return Mi.create({x:se(e*this.x),y:se(e*this.y),z:se(e*this.z),w:se(t)})}alpha(e){return Mi.create({...this,w:e})}toHex(){return 255*this.x<<16^255*this.y<<8^255*this.z}equals(e,t=0){return t?$i.abs(this.x-e.x)<t&&$i.abs(this.y-e.y)<t&&$i.abs(this.z-e.z)<t:this.x===e.x&&this.y===e.y&&this.z===e.z}toString(){return`rgba(${255*this.x|0},${255*this.y|0},${255*this.z|0},${this.w})`}toArray(e=[],t=0){return e[t+0]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}toVec4({precision:e=6}={}){const t=t=>((e,t)=>{if(!t)return e;if(e!=e)return 0;if(Infinity===e)return Infinity;const n=Ri(e),r=(e*=n)-e%t,s=r+t;let o=Oi(e-s)<Oi(e-r)?s:r;if(o%1!=0){const e=`${o}`.split(".");o=+`${e[0]}.${e[1].slice(0,(e=>{const t=`${e}`,n=t.indexOf(".")+1;return n?t.length-n:0})(t))}`}return n*o})(se(t),Math.pow(10,-e));return`vec4(${t(this.x)}, ${t(this.y)}, ${t(this.z)}, ${t(this.w)})`}toJSON(){return`${this}`}}Mi.white=Mi.create({x:1,y:1,z:1}),Mi.black=Mi.create(),Mi.darkBrown=Mi.create({x:.128,y:.052,z:.008}),Mi.brown=Mi.create({x:.5823529411764707,y:.3529411764705882,z:.12352941176470589}),Mi.gray=Mi.create({x:.5,y:.5,z:.5}),Mi.red=Mi.create({x:.95,y:.05,z:.05}),Mi.orange=Mi.create({x:.9,y:.35,z:.03137}),Mi.goldenYellow=Mi.create({x:.87952,y:.797,z:.115}),Mi.green=Mi.create({x:.025,y:.775,z:.025}),Mi.blue=Mi.create({x:.05,y:.05,z:.75}),Mi.indigo=Mi.create({x:75/255,y:0,z:130/255}),Mi.violet=Mi.create({x:.5,y:0,z:.95}),Mi.skyBlue=Mi.create({x:.529,y:.808,z:.922}),Mi.darkRed=Mi.create(Mi.red.scale(.5)),Mi.darkOrange=Mi.create({x:.75,y:.275,z:.01}),Mi.yellow=Mi.create({x:.91776,y:.8315999999999999,z:.15}),Mi.brilliantYellow=Mi.create({x:.95,y:.975,z:.0075}),Mi.darkGreen=Mi.create({x:.025,y:.3,z:.025}),Mi.cyan=Mi.create({x:.0863,y:.8824,z:.969}),Mi.darkCyan=Mi.create({x:.05,y:.2,z:.255}),Mi.navy=Mi.create({z:.8}),Mi.darkViolet=Mi.create({x:.93,y:.51,z:.93}),Mi.purple=Mi.create({x:.75,y:.1,z:.75}),Mi.magenta=Mi.create({x:1,y:.01,z:1}),Mi.pink=Mi.create({x:1,y:.08,z:.57}),Mi.teal=Mi.create({x:.0075,y:.5,z:.85}),Mi.rainbow=((e=[])=>{let t=0;return Object.assign(e,{next(n=(e=>!0)){let r=me(e,t);for(t+=1;!n(r);)r=me(e,t),t+=1;return r},peekNext:()=>me(e,t+1),add(t){e.includes(t)||e.push(t)},delete(t){ge(e,t)},set(t){$e(e,t)}})})(["red","orange","yellow","green","blue","purple","violet"]).map((e=>Mi[e])),Mi.transparent=Mi.create({w:0}),Mi.transparentBlack=Mi.transparent.scale(0),Mi.rgbaString=/rgba?\\(.+\\)/;var ji,Pi,Ti=s(790);const{parse:Ni,stringify:Di}=JSON;class Bi extends Map{constructor(){super(...arguments),this.setItem=(e,t)=>this.set(e,"string"==typeof t?t:Di(t)),this.setIfAbsent=(e,t)=>this.has(e)||this.set(e,t),this.getItem=e=>Di(this.get(e)),this.removeItem=e=>this.delete(e)}key(e){return[...Object.keys(this)][e]}get length(){return+this}}const Li=null!==(ji=globalThis.localStorage)&&void 0!==ji?ji:new Bi,Fi=null!==(Pi=globalThis.sessionStorage)&&void 0!==Pi?Pi:new Bi;class zi{constructor(e,t=0){this.storage=e,this.version=t,this.memoryStore={},this.get=(e,t="")=>{var n;if((e=this.key(e))in this.memoryStore)return this.memoryStore[e];const r=null!==(n=this.storage.getItem(e))&&void 0!==n?n:"",s=zi.parse(r,t),o=t instanceof Object?x(s,t):s;return this.memoryStore[e]=o}}key(e){if(this.version){const t=`~v${this.version}`;return e.endsWith(t)?e:`${e}${t}`}return e}static parse(e,t=e){var n;if("string"!=typeof e)return e;let r;try{for(const[t,n]of zi.parsers.entries())if(t.test(e)){r=n(e);break}null!=r||(r=Ni(e,zi.revive))}catch(e){}return null!==(n=r)&&void 0!==n?n:t}set(e,t){e=this.key(e),this.memoryStore[e]=t;const{storage:n,memoryStore:r}=this;Je((function s(o){if(!o.timeRemaining())return Je(s);try{n.setItem(e,Di(t,zi.serialize))}catch(e){if(console.warn(e),e.code===DOMException.QUOTA_EXCEEDED_ERR){const[e]=de(Object.keys(n),(e=>n.getItem(e).length));return n.removeItem(e),delete r[e],Je(s)}}}))}has(e){return this.key(e)in this.storage}remove(e){this.storage.removeItem(this.key(e))}synced(e,t){const n=x(this.get(e,t),t),r=A(this.set.bind(this),1e3,!0);return new Proxy(n,{get:(e,t)=>{const n=Reflect.get(e,t);return zi.parse(n)},set:(t,n,s)=>{const o=Reflect.set(t,n,s);return r(e,t),o},deleteProperty:(t,n)=>{const r=Reflect.deleteProperty(t,n);return this.set(e,t),r}})}collection(e,t,n=(e=>{})){const r=this,s=new Proxy(this.get(e,t),{set(t,s,o){const i=Reflect.set(t,s,o);return"length"===s&&(r.set(e,t),setTimeout((()=>n(t)))),i}});return s}}zi.parsers=new Map([[/^rgba?\\(\\d+,\\s?\\d+,\\s?\\d+,?\\s?(?:\\d+\\s?)?\\)$/,Mi.parse]]),zi.revive=(e,t)=>(null==t?void 0:t.isFloat32Array)?new Float32Array(Object.values(t).filter((e=>"number"==typeof e))):t,zi.serialize=(e,t)=>t instanceof Float32Array?{isFloat32Array:!0,...t}:t;const Ui={local:new zi(Li,4),session:new zi(Fi),db:S.Ll?{}:new class qi{constructor(e){this.localForage=e,this.syncStore={},this.ready=S.Ll?Promise.resolve():new Promise((e=>this.resolveReady=e)),e.setItem=A(e.setItem.bind(e)),e.getItem=A(e.getItem.bind(e)),e.removeItem=A(e.removeItem.bind(e)),e.keys().then((async t=>{const n=await Promise.all(t.map((t=>e.getItem(t))));Object.assign(this.syncStore,Object.fromEntries(t.map(((e,t)=>[e,n[t]])))),this.resolveReady()}))}set(e,t){return this.syncStore[e]=t,this.localForage.setItem(e,t),t}get(e){return this.syncStore[e]}has(e){return e in this.syncStore}keys(){return Object.keys(this.syncStore)}del(e){delete this.syncStore[e],this.localForage.removeItem(e)}}((0,Ti.createInstance)({name:"db",driver:Ti.INDEXEDDB}))};setTimeout((()=>{const e=Ui.local.get=Ki("storage.local.get",Ui.local.get);e.addMock("no-last-active-servers",(e=>"last-active-servers"===e?[]:Ji.pass)),e.addMock("has-last-active-servers",(e=>"last-active-servers"===e?["asr4.nuzi.ai"]:Ji.pass))}));const Wi=()=>crypto.randomUUID().split("-")[0];var Gi;const Hi={name:"default",mocksConfiguration:{}},{stringify:Xi}=JSON;class Ji{static get activeConfiguration(){return Ui.session.get("active-test-configuration",Hi)}static clearActiveConfiguration(){Ui.session.set("active-test-configuration",Hi),Gi.isActive=!1}static setActiveConfiguration(e){this.clearActiveConfiguration(),Ui.session.set("active-test-configuration",e),Gi.isActive=!0}static async expect(e,t,n=Hi){Gi.setActiveConfiguration(n);const r=h(),s=await e(),o=h()-r,i=await t(s),{activeConfiguration:a}=Gi;return Gi.clearActiveConfiguration(),"boolean"==typeof i?{passed:i,configuration:a,elapsed:o,refs:{}}:{...i,configuration:a,elapsed:o}}}Gi=Ji,Ji.pass=Symbol(),Ji.watchableRegistry={},Ji.mockable=(e,t)=>{const n={};return Object.assign(((...r)=>{var s;const o=(null!==(s=n[Gi.activeConfiguration.mocksConfiguration[e]])&&void 0!==s?s:t)(...r);return o===Gi.pass?t(...r):o}),{addMock(e,t){n[e]=t}})},Ji.watchable=(e,t)=>Gi.watchableRegistry[e]=(e=>{const t=[],n={get wasCalled(){return t.length>0},get wasCalledAndErrored(){return t.length>0&&t.some(pe("2"))},wasCalledWithArgs:e=>{const n=Xi(e);return t.some((([e])=>Xi(e)===n))},wasCalledWithArgsAndReturned:(e,n)=>{const r=Xi(e),s=Xi(n);return t.some((([e,t])=>Xi(e)===r&&Xi(t)===s))},wasCalledWithArgsAndErrored:(e,n)=>{const r=Xi(e),s=Xi(n);return t.some((([e,,t])=>t&&Xi(e)===r&&Xi(t)===s))},reset:()=>t.length=0};return Object.assign(((...n)=>{var r,s;if(!Gi.isActive)return e(...n);let o;const i=[n];try{o=e(...n),i[1]=o}catch(e){o=e,i[2]=null!==(r=e.message)&&void 0!==r?r:null!==(s=e.reason)&&void 0!==s?s:e}return t.push(i),o}),n)})(t),Ji.lookupWatchable=e=>{if(e in Gi.watchableRegistry)return Gi.watchableRegistry[e];throw Error(`key ${e} does not exist in watchable registry`)},Ji.isActive=!1,Ji.smokeTest=async e=>{var t,n,r,s;const o=null!==(t=Gi.smokeTestBuffer)&&void 0!==t?t:Gi.smokeTestBuffer=await Ei.fromTo("/brimley.wav","Buffer");let i=f();const a=new yi(o.getChannelData(0)),{4:{audio:c}}=await a.getSegmentSlices(),l=Wi(),u=Wi(),h={passed:!1,elapsed:0,processingTime:0,words:0,error:null};try{i=f();const t=await Ii(e,c,{model:"turbo",transcriptionId:l,noteId:u,diarize:!0,timeout:30..seconds});if(!t.processed)throw Error("Transcript Not Processed");const o=f()-i,a=null===(n=null==t?void 0:t.text)||void 0===n?void 0:n.length,d=null===(r=null==t?void 0:t.segments)||void 0===r?void 0:r.length,p=null===(s=null==t?void 0:t.segments)||void 0===s?void 0:s.every(pe("embedding")),m=!t.errored;h.passed=Boolean(a&&d&&p&&m),h.elapsed=o,h.processingTime=t.processingTime,h.words=Et(t.text).length,m&&!p&&(h.error="No Embeddings")}catch(e){h.passed=!1,h.error=e.message||e.reason,console.error(e)}return h},setTimeout((()=>Ji.clearActiveConfiguration()),16);const{mockable:Ki,pass:Vi}=Ji;var Qi,Yi,Zi;const ea={unknown:5,"2g":5,"3g":4,"4g":3,"5g/WiFi":1},ta={type:"5g/WiFi",downlink:null,rtt:null,effectiveType:"5g/WiFi",timeoutMultiplier:1},na=null!==(Qi=globalThis.navigator)&&void 0!==Qi?Qi:{};class ra{static async getInfo(){const e=await new Promise((async e=>{var t;if(S.Ll)return e(ta);const n={type:"unknown",downlink:null,rtt:null,effectiveType:"unknown",timeoutMultiplier:ea.unknown},{connection:r}=na;if(r){const{type:e,downlink:t,rtt:s,effectiveType:o}=r;n.type=null!=e?e:"unknown",n.downlink=null!=t?t:null,n.rtt=null!=s?s:null,n.effectiveType=null!=o?o:"unknown"}const s=h(),o=S.ri?`/julie.wav?q=${Date.now()}`:`${location.origin}/assets/audios/Free_Test_Data_1OMB_MP3.mp3?q=${Date.now()}`;let i,a=n.effectiveType;try{const e=await fetch(o,{cache:"no-store"}),t=await e.blob(),n=h()-s;i=8*t.size/1024/1024/n.in("seconds"),a=i<.1?"2g":i<.5?"3g":i<5?"4g":"5g/WiFi"}catch(e){di(e),i=0}e({...n,type:a,effectiveType:a,downlink:i,timeoutMultiplier:null!==(t=ea[a])&&void 0!==t?t:ea.unknown})}));return hi(`found network info: ${Q(e)}`),e}static getAdjustedTimeout(e,t=1){var n,r,s;null!==(n=ra.timeoutMultiplier)&&void 0!==n||(ra.timeoutMultiplier=S.xD?self["timeout-multiplier"]:Ui.local.get("timeout-multiplier",ea[null!==(s=null===(r=na.connection)||void 0===r?void 0:r.effectiveType)&&void 0!==s?s:"unknown"])),S.xD&&("timeout-multiplier"in self?hi(`worker: received \'timeout-multiplier\' of ${ra.timeoutMultiplier} from self`):di("worker: key \'timeout-multiplier\' missing on self - set this to adjust timeouts properly"));const{timeoutMultiplier:o=2}=ra;return t*o*e}}ra.timeoutMultiplier=S.xD?self["timeout-multiplier"]:Ui.local.get("timeout-multiplier",ea[null!==(Zi=null===(Yi=na.connection)||void 0===Yi?void 0:Yi.effectiveType)&&void 0!==Zi?Zi:"unknown"]),S.xD||ra.getInfo().then((({timeoutMultiplier:e})=>{Ui.local.set("timeout-multiplier",ra.timeoutMultiplier=e),hi(`set timeout multiplier to ${e}`)}));const sa=()=>Ui.local.get("remote-origin",S.iF),oa=(Ui.local.get("last-active-servers",[...Te(Ie(5),(e=>`asr${e+2}.nuzi.ai`))]),Ki("heartbeat",(async(e,{timeout:t=ra.getAdjustedTimeout(S.dv)}={})=>{try{const n=await vi.timeout(t,`${e}/api/heartbeat`,{mode:"cors"}),r=await n.json();return 200===n.status&&"number"==typeof r}catch(e){return!1}})));oa.addMock("fail-gateway-pass-compute",(async e=>e!==sa())),oa.addMock("pass-gateway-fail-compute",(async e=>e===sa())),oa.addMock("fail-all",(async()=>!1));((e,{mode:t="chain"}={})=>{let n,r=!1;const s=async(...o)=>r?"chain"===t?n.then((()=>s(...o))):n:(r=!0,n=new Promise((async(t,n)=>{try{t(await e(...o))}catch(e){console.error(e),n(e)}finally{r=!1}})),n)})((async(e="asr2.nuzi.ai")=>{try{return(await vi(`${e}/api/performance-metrics`,{mode:"cors"})).json()}catch(e){return console.log(e),[]}}));const ia=e=>e.replace(/\\/{1,}/g,"/").replace(/^(https?)\\:\\//,"$1://"),aa={req:(e="GET",t)=>({method:e,cache:"no-cache",headers:{"Content-Type":"application/json"},...t?{body:JSON.stringify(t)}:null}),async get(e="",t=sa()){const n=await vi.timeout(ra.getAdjustedTimeout(1e4),ia(`${t}/api/${e}`),{mode:"cors"});return await n.json()},async post(e="",t={},n=sa()){const r=ia(`${n}/api/${e}`),s=await vi(r,{mode:"cors",method:"POST",body:JSON.stringify(t),headers:{Accept:"application/json","Content-Type":"application/json"}}),{status:o}=s;if(400===o||404===o)throw Error(`post request to ${r} was rejected`);return await s.json()}},ca=new URLSearchParams("undefined"!=typeof location?location.search:""),la=()=>history.replaceState({},document.title,`?${ca}`),ua=new Proxy(ca,{get(e,t){const n=ca.get(t);try{return JSON.parse(n)}catch(e){return n}},set:(e,t,n)=>(ca.set(t,n),la(),!0),deleteProperty:(e,t)=>(ca.delete(t),la(),!0),has:(e,t)=>ca.has(t)}),ha=()=>(S.Ll?process.env.LLM_MODEL:ua.LLM_MODEL)||"mistralai/Mistral-Small-24B-Instruct-2501";class fa{static get client(){var e;return null!==(e=this._client)&&void 0!==e?e:this._client=new ni({baseURL:"https://api.deepinfra.com/v1/openai",apiKey:S.Ll?process.env.DEEPINFRA_API_KEY:ua.DEEPINFRA_API_KEY,dangerouslyAllowBrowser:S.Bd})}static async prompt(e,{model:t=ha(),maxTokens:n=16384,seed:r=0xb03903d1159f4,temperature:s=0}={}){const{DEEPINFRA_API_KEY:o}=ua;if(S.Bd&&!o)try{return await aa.post("deep-infra/prompt",{prompt:e})}catch(t){return console.warn(t),await aa.post("prompt",{prompt:e})}const{client:i}=fa;try{const{choices:[{message:o}={message:{content:""}}],usage:a}=await i.chat.completions.create({max_tokens:n,messages:[{role:"user",content:e}],model:t,seed:r,temperature:s}),{content:c}=o;return{result:null!=c?c:"",usage:a}}catch(e){throw e}}static async transcribe(e){const{DEEPINFRA_API_KEY:t}=ua;if(S.Bd&&!t)return aa.post("deep-infra/transcribe",{file:e});const{client:n}=fa;return await n.audio.transcriptions.create({file:e,model:"openai/whisper-large-v3-turbo",response_format:"verbose_json",language:"en",timestamp_granularities:["segment"]})}}Object.assign(globalThis,{DeepInfraService:fa});const da=e=>e.filter((({speaker:e})=>null!=e)),pa=e=>{const t=da(e);let n=Ee(t.map(pe("speaker")));const r=ye(t.map(pe("text")).map(Et).map(pe("length")));return Object.fromEntries(n.map((e=>[e,ye(t.filter(pe("speaker",e)).map(pe("text")).map(Et).map(pe("length")))/r])))},ma=e=>{const t=da(e);let n=Ee(t.map(pe("speaker")));const r=t.length;return Object.fromEntries(n.map((e=>[e,t.filter(pe("speaker",e)).length/r])))},ga=e=>.05/e,ya=e=>Ee(e.filter((e=>null!=e.speaker)).map(pe("speaker"))),wa=e=>ya(e).length;let ba;const va=async()=>null!=ba?ba:ba=new Set(await(async e=>(await e).default)(s.e(142).then(s.t.bind(s,142,19)))),_a=async e=>{const t=await va(),n=(r=e.segments.map((e=>e.wordsSet.intersection(t))),r.reduce(((e,t)=>e.union(t)),new Set));var r;return e.clients?n.size>=e.clients:n.size},xa=async e=>{if(await _a(e))return await(async e=>{const t=await va(),{segments:n}=e,r=n.filter((e=>e.wordsSet.intersection(t).size)),s=r.flatMap((e=>[n[r.indexOf(e)-1],n[r.indexOf(e)+1]].filter(Boolean)));return Ee(s)})(e);const t=wa(e.segments),n=[];for(const r of e.segments){n.push(r);const e=wa(n),s=Me(n,pe("speaker"));if(e===t&&s.length===e&&s.map(pe("length")).every((e=>e>=3)))break}return n},Sa=e=>e.clinicians||(e.clients?wa(e.segments)-e.clients:0),ka=e=>e.clients||(e.clinicians?wa(e.segments)-e.clinicians:0),Aa=()=>("undefined"==typeof clinicianList?[]:clinicianList).map(pe("name")),Ea=()=>("undefined"==typeof patientList?[]:patientList).map(pe("name")),Ca=e=>1.3*(ye(e,pe("wordCount"))+e.length),Ia=async(e,t=!1)=>{const n=e.clients||e.clinicians,r=Sa(e),s=ka(e),o=(t?e.segments:await xa(e)).slice();let i=0,a=0;for(;(a=Ca(o))>16e3;)i+=1,hi(`removing segment due to token count of ${a} (${i} removed so far)`),o.pop();const c=o.map((e=>`[${e.speaker}] ${e.text}`)).join("\\n"),l=n?r:"one or more",u=n?s:"one or more",h=await(async e=>{const t=await va(),{segments:n}=e;return n.flatMap((e=>[...e.wordsSet.intersection(t)]))})(e),f=Aa(),d=Ea(),p=f.length&&d.length,m=p?"":`names found in the transcript: ${((e,t="and")=>0===e.length?"":1===e.length?e[0]:2===e.length?e.join(` ${t} `):[e.slice(0,-1).join(", "),he(e)].join(`, ${t} `))(h)}`,g=p?`\\n\\t\\tthe list of names you have to work with as values are as follows:\\n\\n\\t\\tClinicians: ${f.join(", ")}\\n\\t\\tClients: ${d.join(", ")}\\n\\n\\t\\twhen inferring a name, only appropriately selected values from the above lists should be used (appropriate depending on role).\\n\\t\\tdo not use any name more times than it appears above (there may be two \'Sam\'s in a session but if that is the case the name will appear twice in the list)\\n\\t`:"";return hi.data("transcript-names",h),`\\n\\t\\tthe following is a ${t?"":"partial "}transcript of a therapy session. the numbers or names in brackets (e.g. [0] ...text... or [Sally] ...text...)\\n\\t\\tpreceding each segment\'s text are speaker labels which indicate who was responsible for uttering the following text.\\n\\t\\t${l} of the participants are the clinician(s) leading the session, but this is not indicated by the speaker labels.\\n\\t\\tthe remaining ${u} participants are the clients receiving the treatment- this is also not indicated by the speaker labels.\\n\\t\\t${t?"":"the segments selected are all those containing a first name and their immediate neighbors."}\\n\\t\\t${m}\\n\\t\\t------\\n\\t\\t${c}\\n\\t\\t------\\n\\t\\tplease analyze the transcript and do your best to infer the mapping between speaker label as indicated, and speaker name or speaker role + index.\\n\\t\\t${g}\\n\\t\\tif you can determine which speaker(s) are the clinician(s), use that ("Clinician") (or "Clinician 1", "Clinician 2" for multiple) instead of trying to infer a name\\n\\t\\tif you cannot determine a name for a given (non-clinician) speaker, (but you can be sure they aren\'t a clinician) then use "Client 1", "Client 2" etc. instead\\n\\t\\tonly produce a key value pair if you can be fairly certain that you\'re able to deduce the correct name / role + index\\n\\t\\t(for example, if a speaker says "Hi, I\'m Melissa" (speaker -> "Melissa") or "Okay guys, let\'s begin" (speaker -> "Clinician" or "Clinician 1", etc.), (others -> "Client" or "Client 1", "Client 2", etc.) depending).\\n\\t\\tthe mapping should be 1 to 1 (there should never be more than a single speaker label pointing to a single name or role).\\n\\t\\t${t?"":"if you are nearly but not sufficiently able to be sure of any mappings, include the text MORE_DATA_NEEDED anywhere in your response."}\\n\\t\\treturn the mapping in the form:\\n\\t\\t------\\n\\t\\tSpeaker 1::inferred-name-or-role-1\\n\\t\\tSpeaker 2::inferred-name-or-role-2\\n\\t\\t...etc...\\n\\t\\t------\\n\\t`},Oa=async e=>{var t,n,r;let s,o=await Ia(e,!0);hi.data("llm-prompt",o);try{({result:s}=await fa.prompt(o))}catch(t){return hi.data("llm-result",t),e}if(hi.data("llm-result",s),s.includes("MORE_DATA_NEEDED")){hi("WARN: sending full transcript to llm"),o=await Ia(e,!0),hi.data("llm-prompt",o);try{({result:s}=await fa.prompt(o,{seed:0xb03903d1159f4}))}catch(t){return hi.data("llm-result",t),e}hi.data("llm-result",s)}const i=s.split("\\n").filter((e=>e.includes("::"))).map((e=>e.split("::").map((e=>e.trim())))).filter((e=>2===e.length&&e[1]&&e[0]!==e[1]&&"unknown"!==e[1].toLowerCase())),a=new Set(ya(e.segments));for(const[n,r]of i){let s=n.replace("[","").replace("]","").trim();if(!a.has(s)){const e=s.toLowerCase().replaceAll(" ","");s=null!==(t=[...a].find((t=>e.includes(t.toLowerCase().replaceAll(" ","")))))&&void 0!==t?t:s}e.speakerMap.set(s,U(r.trim()))}const c=[...e.speakerMap.values()].flatMap((t=>{const n=[...e.speakerMap.keys()].filter((n=>e.speakerMap.get(n)===t));return n.length>1?n:[]}));c.length&&hi(`found degenerate keys ${c.join(", ")}`);for(const t of c)e.speakerMap.delete(t);const l=Aa(),u=Ea();if(l.length&&u.length){const t=e=>!/^client ?\\d*$/i.test(e)&&!/^clinician ?\\d*$/i.test(e)&&!/^speaker ?\\d*$/i.test(e),n=[...e.speakerMap.values()].filter(t).filter((e=>!l.includes(e)&&!u.includes(e)));for(const t of n){const n=ee.key(e.speakerMap,t);n&&e.speakerMap.delete(n)}}const h=[...e.speakerMap.values()],f=h.filter((e=>e.includes("Clinician"))),d=h.filter((e=>e.includes("Client"))),p=h.filter((e=>!e.includes("Clinician")&&!e.includes("Client"))),m=new Set(e.speakerMap.keys()),g=a.difference(m),y=Sa(e)&&Sa(e)===f.length,w=ka(e)&&ka(e)===d.length+p.length,b=f.length,v=d.length+p.length;g.size&&(y?[...g].forEach(((t,n)=>e.speakerMap.set(t,`Client ${n+v+1}`))):w&&[...g].forEach(((t,n)=>e.speakerMap.set(t,`Clinician ${n+b+1}`))));const _=()=>{return t=e.speakerMap,new Map([...t.entries()].map((e=>e.reverse())));var t},x=Sa(e),S=ka(e);1===x&&_().has("Clinician 1")?e.speakerMap.set(_().get("Clinician 1"),"Clinician"):x>1&&_().has("Clinician")&&e.speakerMap.set(_().get("Clinician"),"Clinician 1"),1===S&&_().has("Client 1")?e.speakerMap.set(_().get("Client 1"),"Client"):S>1&&_().has("Client")&&e.speakerMap.set(_().get("Client"),"Client 1");const k=[...e.speakerMap.values()].filter((e=>e.includes("Clinician"))).length,A=[...e.speakerMap.values()].filter((e=>e.includes("Client"))).length<=S;if(k<=x){const t=null!==(n=localStorage.getItem("userName"))&&void 0!==n?n:"",r=t&&!/^(?:true|false)$/.test(t);if(y&&1===f.length&&"Clinician"===f[0]&&r){const n=1===l.length?l[0]:U(t);e.speakerMap.set(_().get("Clinician"),n)}}else for(const t of[...e.speakerMap.keys()].filter((t=>{var n;return null===(n=e.speakerMap.get(t))||void 0===n?void 0:n.includes("Clinician")})))e.speakerMap.delete(t);if(A){const t=z(null!==(r=sessionStorage.callClients)&&void 0!==r?r:"client"),n=e=>z(e.replace(/client/i,t));for(const[t,r]of e.speakerMap)/client/i.test(r)&&e.speakerMap.set(t,n(r))}else for(const t of[...e.speakerMap.keys()].filter((t=>{var n;return null===(n=e.speakerMap.get(t))||void 0===n?void 0:n.includes("Client")})))e.speakerMap.delete(t);return hi.data("arg.speakerMap",e.speakerMap),{speakerMap:e.speakerMap,segments:e.segments}},Ra=e=>t=>(hi.data("llm-result",t),e);class $a{constructor(e=[]){this.items=e,this.items=e.slice()}get(){return this.items.shift()}add(e){this.items.push(e)}get empty(){return!this.items.length}get pending(){return this.items.length}}class Ma extends ri{constructor(){super(),this.input=new $a,this.sources=[],this.sinks=[],this.aborts=[],this.add=e=>{const t=this.input.empty;this.input.add(e),t&&this.processInputs()},this.source=e=>(e&&this.add(e),this),this.errors=[],this.process=async e=>{const t=this.sourcesDone&&0===this.input.pending;for(const n of this.modules)e&&(e=await n.process(e,t));return e},this.modules=new.target.modules.map((e=>new e));for(const e of this.modules)e.addEventListener("message",(({data:{status:e,args:t}})=>{"error"===e&&this.errors.push(t[0])}));this.outputPromise=new Promise(((e,t)=>{this.resolveOutput=e,this.rejectOutput=t}))}addSource(e){return e.addEventListener("next",this.add),this.sources.push(e),this}connect(e){this.addSink(e.source),e.sources.push(this)}addSink(e){return this.sinks.push(e),this}addAbort(e){return this.outputPromise.catch(e),this}static get isReady(){return(new this).isReady}get isReady(){return this.modules.every(pe("isReady"))}get sourcesDone(){return this.sources.every(pe("done"))}get done(){return this.sourcesDone&&this.input.empty&&this.output}get errored(){return this.errors.length}async processInputs(){var e,t;try{for(;!this.input.empty&&!this.errored;){const e=this.input.get(),t=await this.process(e);t&&(await Promise.all(this.sinks.map((e=>e(t)))),this.output=t)}}catch(e){this.errors.push(e)}if(this.done)return null===(e=this.resolveOutput)||void 0===e||e.call(this,this.output),this.output;this.errored&&(this.dispose(),null===(t=this.rejectOutput)||void 0===t||t.call(this,this.errors.map((e=>`${e}`)).join("\\n")))}dispose(){this.sources.forEach((e=>{try{e.removeEventListener("next",this.add)}catch(e){}})),this.sources=[],this.modules.forEach((e=>e.terminate()))}}Ma.modules=[],Ma.preload=()=>{};class ja{static get isReady(){return this.pipelines.every(pe("isReady"))}get isReady(){return this.constructor.isReady}get done(){return this.pipelines.every(pe("done"))}addSource(e){for(const t of this.inputPipelines)t.addSource(e);return this}get sinks(){return this.outputPipeline.sinks}addSink(e){return this.outputPipeline.addSink(e),this}addAbort(e){return this.pipelines.forEach((t=>t.addAbort(e))),this}static get pipelines(){return[...this.inputPipelines,this.outputPipeline]}constructor(){this.inputPipelines=new.target.inputPipelines.map((e=>new e)),this.outputPipeline=new this.constructor.outputPipeline;for(const e of this.inputPipelines)e.connect(this.outputPipeline);this.outputPromise=this.outputPipeline.outputPromise,this.pipelines=[...this.inputPipelines,this.outputPipeline]}dispose(){this.pipelines.forEach((e=>e.dispose()))}}ja.preload=()=>{},ja.inputPipelines=[];(class Pa extends Ma{}).modules=[class Ta extends Ot{async process(e){var t;return null===(t=e.useLLM)||void 0===t||t?await Oa(e).catch(Ra(e)):await(async e=>{var t;const n=(await s.e(142).then(s.t.bind(s,142,19))).default,r=new Set(n),{segments:o,speakerMap:i}=e,a=Ee(o.map(pe("speaker"))).length;if(2!==a)return hi(`infer speaker names module exiting early due to non-2 speaker count of ${a}`),i.clear(),{segments:o,speakerMap:i};const c=o.flatMap((e=>Et(e.text).filter((e=>r.has(e)))));if(hi(`infer speaker names module found names ${c.join(", ")} in the transcript`),!c.length)return i.clear(),{segments:o,speakerMap:i};const l=Me(c),u=de(l,pe("length"))[0][0];hi(`infer speaker names module found most mentioned name to be ${u}`);const h=null!==(t=Se(o.filter((e=>e.text.includes(u))).map(pe("speaker"))))&&void 0!==t?t:"";let f=""+(1==+h?0:1);return"string"==typeof h&&(f=`${f}`),i.set(h,"Clinician"),i.set(f,u),hi(`speaker ${h} mentioned this name the most. inferring him to be the Clinician`),{speakerMap:i,segments:o}})(e)}},Rt];(class Na extends Ma{}).modules=[class Da extends Ot{async process(e){var t;const{segments:n}=e;for(const e of n){const{componentSegments:n}=e,r=null!==(t=null==n?void 0:n.map((e=>e.deducedSpeaker)))&&void 0!==t?t:[],s=Se(r);e.speaker=s,null==n||n.forEach((e=>e.speaker=s))}return e}},Rt];(class Ba extends Ma{}).modules=[Rt];class La extends Ma{}La.modules=[class Fa extends Ot{constructor(){super(...arguments),this.joiner=" ",this.segmentToSpeaker=pe("speaker")}async process(e){var t,n;const{joiner:r,segmentToSpeaker:s}=this;let o,i=null;const a=[];for(let c=0;c<e.length;c+=1){const l=e[c],u=s(l),{end:h,text:f,words:d=[],wordCount:p=0,wordsSet:m}=l;u===o&&i?(i.end=h,i.text=`${i.text}${r}${f}`,null===(t=i.words)||void 0===t||t.push(...d),i.wordCount=(null!==(n=i.wordCount)&&void 0!==n?n:0)+p,i.wordsSet=i.wordsSet.union(m),i.componentSegments.push(l)):(o=u,i=It(l),a.push(i))}return a}},class za extends Ot{async process(e){const t=new Z,n=Ee(e.map(pe("speaker"))).every((e=>{const[t,n]=e.split(" ");return"Speaker"===t&&H(n)}));if(!n)return e;for(const n of e)t.has(n.speaker)||t.set(n.speaker,`Speaker ${t.size+1}`);for(const n of e)n.speaker=t.get(n.speaker);return e}}];class Ua{constructor(e){this.clusters=e.map((e=>({points:[e],centroid:[...e],size:1}))),this.distances=new Map}getDistanceKey(e,t){return e<t?`${e}-${t}`:`${t}-${e}`}calculateWardDistance(e,t){const n=e.size,r=t.size,s=n+r;let o=0;for(let n=0;n<e.centroid.length;n++){const r=e.centroid[n]-t.centroid[n];o+=r*r}return n*r/s*o}getDistance(e,t){if(e===t)return Infinity;const n=this.getDistanceKey(e,t);if(!this.distances.has(n)){const r=this.calculateWardDistance(this.clusters[e],this.clusters[t]);this.distances.set(n,r)}return this.distances.get(n)}findNearest(e){let t=0,n=Infinity;for(let r=0;r<this.clusters.length;r++){if(r===e)continue;const s=this.getDistance(e,r);s<n&&(n=s,t=r)}return t}mergeClusters(e,t){const n=this.clusters[e],r=this.clusters[t],s=n.size,o=r.size,i=s+o,a=new Array(n.centroid.length).fill(0);for(let e=0;e<a.length;e++)a[e]=(s*n.centroid[e]+o*r.centroid[e])/i;const c={points:[...n.points,...r.points],centroid:a,size:i};this.clusters=this.clusters.filter(((n,r)=>r!==e&&r!==t)),this.clusters.push(c),this.distances.clear()}cluster(e){for(;this.clusters.length>e;){const e=[];let t=Math.floor(Math.random()*this.clusters.length);for(;;){e.push(t);const n=this.findNearest(t);if(e.length>1&&e.includes(n)){const t=e[e.length-1],r=n;this.mergeClusters(t,r);break}t=n}}return this.clusters}elbowMethod(e){const t=[],n=[...this.clusters];for(this.cluster(e);this.clusters.length>1;){let e=Infinity,n=[0,0];for(let t=0;t<this.clusters.length;t++)for(let r=t+1;r<this.clusters.length;r++){const s=this.getDistance(t,r);s<e&&(e=s,n=[t,r])}t.push(e),this.mergeClusters(...n)}this.clusters=n,this.distances.clear();const r=t.slice(0,-2).map(((e,n)=>t[n]-2*t[n+1]+t[n+2])),s=r.indexOf(Math.max(...r));return t.length-s}calculateGapStatistic(e,t=8){const n=[...this.clusters],r=this.clusters.reduce(((e,t)=>e+t.points.length),0),s=this.clusters[0].points[0].length,o=e=>e.reduce(((e,t)=>e+t.points.reduce(((e,n)=>e+t.points.reduce(((e,t)=>{let r=0;for(let e=0;e<s;e++)r+=(n[e]-t[e])**2;return e+r}),0)/(2*t.points.length)),0)),0),i=[],a=[];for(let c=1;c<=e;c++){const e=this.cluster(c),l=Math.log(o(e)),u=[];for(let e=0;e<t;e++){const e=Array(r).fill(0).map((()=>Array(s).fill(0).map((()=>2*Math.random()-1))));e.forEach((e=>{const t=Math.sqrt(e.reduce(((e,t)=>e+t*t),0));for(let n=0;n<e.length;n++)e[n]/=t}));const t=new Ua(e).cluster(c);u.push(Math.log(o(t)))}const h=u.reduce(((e,t)=>e+t))/t,f=Math.sqrt(u.reduce(((e,t)=>e+(t-h)**2),0)/t);i.push(h-l),a.push(f*Math.sqrt(1+1/t)),this.clusters=[...n],this.distances.clear()}for(let e=0;e<i.length-1;e++)if(i[e]>=i[e+1]-a[e+1])return e+1;return e}calculateSilhouetteScore(){let e=0,t=0;for(let n=0;n<this.clusters.length;n++){const r=this.clusters[n];for(const s of r.points){let o=0;for(const e of r.points){if(s===e)continue;let t=0;for(let n=0;n<s.length;n++)t+=(s[n]-e[n])**2;o+=Math.sqrt(t)}o=r.points.length>1?o/(r.points.length-1):0;let i=Infinity;for(let e=0;e<this.clusters.length;e++){if(n===e)continue;let t=0;for(const n of this.clusters[e].points){let e=0;for(let t=0;t<s.length;t++)e+=(s[t]-n[t])**2;t+=Math.sqrt(e)}t/=this.clusters[e].points.length,i=Math.min(i,t)}e+=i===o?0:(i-o)/Math.max(o,i),t++}}return e/t}findOptimalClustersUsingSilhouette(e=10){const t=[...this.clusters],n=[];for(let r=2;r<=e;r++){this.clusters=[...t],this.distances.clear(),this.cluster(r);const e=this.calculateSilhouetteScore();n.push(e)}this.clusters=t,this.distances.clear();return 2+n.indexOf(Math.max(...n))}findOptimalClusterCount(e=10){const t=this.elbowMethod(e),n=this.calculateGapStatistic(e),r=this.findOptimalClustersUsingSilhouette(e),s=_e([t,n,r]);return console.log(Q({elbowMethod:t,gapStatistic:n,silhouetteScore:r,aggregate:s})),s}findOptimalClusters(e=10){return this.cluster(this.findOptimalClusterCount(e||10))}}if(S.Ll)var qa="cluster-module";const Wa=()=>{function e(e,t){let n=e.length,r=0;for(;n-- >0;)r+=e[n]*t[n];return r}const t={numSpeakers:0,metric:"angular",linkage:"composite",clustering:"hClust"},n={euclidean:bt,angular:(t,n)=>1-e(t,n),threshold:(t,n)=>{const r=e(t,n),s=1-r;return ne(s,r>.5?0:r<0?1:s,0)}};const r=(e,n,r=[])=>{const s=e.map((e=>((e,n)=>{let r=0;const{linkage:s}=t,o=Ge[s];for(let t=0;t<e.length;t+=1){const s=e[t];let i=0;for(let e=0;e<s.length;e+=1)1!==s.length&&(i+=o([s[e]],s.filter(((t,n)=>e!==n)),n));r+=i/s.length}return Math.sqrt(r/e.length)})(e,n))),o=ve(s),i=s.map((e=>o-e)),a=e.map((e=>((e,n)=>{let r=0;const{linkage:s}=t,o=Ge[s];for(let t=0;t<e.length;t+=1)for(let s=0;s<e.length;s+=1)t!==s&&(r+=o(e[t],e[s],n));return Math.sqrt(r/e.length/e.length)})(e,n)));hi(K`intraClusterSimilarities: ${i.join(", ")}`),hi(K`interClusterVariances: ${a.join(", ")}`);const c=i.map(((e,t)=>e+a[t]));hi(K`combinedVariances: ${c.join(", ")}`);const l=Ne(i),u=Ne(a);hi(K`normalizedIntraClusterSimilarities: ${l.join(", ")}`),hi(K`normalizedInterClusterVariances: ${u.join(", ")}`);const h=Oe(l)+2,f=Oe(u)+2,d=l.map(((e,t)=>e+u[t]));hi(K`combinedNormalizedVariances: ${d.join(", ")}`);const p=Oe(d)+2;hi(`arg max ${p}`);const m=[f,h,p,...r];return hi(`counts: ${V(m)}`),Math.ceil(we(m))},s=(e,s,o)=>{const{metric:i,linkage:a}=t,c=n[i],l=Ge[a];hi(`cluster module using ${a} linkage and ${i} metric`);let u=h();const f=e.map((({embedding:e})=>e));e.forEach(((e,t)=>e.index=t));let{clustersGivenK:d,distances:p}=(({data:e=[],distance:t=bt,linkage:n=De})=>{var r;const s=[];for(let n=0;n<e.length;n+=1){const o=e[n],i=null!==(r=s[n])&&void 0!==r?r:s[n]=[];for(let n=0;n<e.length;n+=1){const r=e[n];i[n]=t(o,r)}}const o=e.map(((e,t)=>({height:0,indexes:[t]})));let i=[];const a=e.length;for(let t=0;t<a&&(i.push(o.map((({indexes:e})=>e))),!(t>=e.length-1));t+=1){let e=Infinity,t=0,r=0;for(let i=0;i<o.length;i++)for(let a=i+1;a<o.length;a++){const c=n(o[i].indexes,o[a].indexes,s);c<e&&(e=c,t=i,r=a)}const i={indexes:[...o[t].indexes,...o[r].indexes],height:e,children:[o[t],o[r]]};o.splice(gt(t,r),1),o.splice(yt(t,r),1),o.push(i)}return i=[[],...i.reverse()],{clusters:o[0],distances:s,order:o[0].indexes,clustersGivenK:i}})({data:f,distance:c,linkage:l});if(hi(K`finding possible clusters took ${h()-u} ms`),u=h(),s)d=d.slice(null!=o?o:2,s+1);else{let e=Infinity;const t=[...d];d=d.slice(null!=o?o:2).filter(((t,n)=>{const r=t.every((e=>e.length>1));return r||(e=n),r&&n<e})),d.length||(d=t.slice(2,16))}d=d.slice(0,14);let m=t.numSpeakers||r(d,p);const g=d.map((t=>e.map(((e,n)=>t.findIndex((e=>e.includes(n)))))));t.numSpeakers&&hi(`cluster module using passed speaker count of ${t.numSpeakers}`),hi(K`finding # of speakers took ${h()-u} ms`);const y=e;if(m<2){for(let e=0;e<y.length;e+=1)y[e].speaker="0";hi(qa,`finished (found 1 speaker over ${y.length} segments)`)}else{let e=g[m-2];for(;!e;)m-=1,e=g[m-2];if(e)for(let t=0;t<y.length;t+=1)y[t].speaker=`${e[t]}`;else{for(let e=0;e<y.length;e+=1)y[e].speaker="0";hi(qa,`finished (found 1 speaker over ${y.length} segments)`)}}return{segments:y,distances:p}},o=()=>{},i={hClust:s,kMeans:async(e,n=12,r=2)=>{const s=t.numSpeakers?[e,t.numSpeakers,t.numSpeakers]:[e,n,r];return await C(o,s)},nnChain:async(e,n=12,r=2)=>{const s=new Ua(e.map((({embedding:e})=>e))),o=t.numSpeakers?s.cluster(t.numSpeakers):s.findOptimalClusters(n),i=[...e];for(const e of i)e.speaker=`${o.findIndex((t=>t.points.includes(e.embedding)))}`;return i}},a=(e,n)=>{let r=Ee(e.map(pe("speaker"))).length,s=Ee(e.map(pe("speaker"))),o=pa(e),i=ma(e),a=ga(s.length),c=fe(s.filter((e=>o[e]<a)),(e=>o[e]));hi(K`found speaker word shares:\\n\\n${Q(o)}`),hi(K`found speaker segment shares:\\n\\n${Q(i)}`);const l=s=>{const i=e.filter(pe("speaker",s)),a=new Set(i),l=e.filter((e=>!a.has(e))),u=Me(l,pe("speaker")),h=i.length;c.length&&hi(`\\n\\t\\t\\t\\t\\treassigning ${h} segments from speaker ${s}\\n\\t\\t\\t\\t\\t(word share ${o[s]}) (under the threshold of ${ga(r)})\\n\\t\\t\\t\\t`);const{linkage:f}=t,d=Ge[f],p=fe(u,(e=>d(i.map(pe("index")),e.map(pe("index")),n))),[m]=p,g=m[0].speaker;for(const e of i)e.speaker=g;r-=1},u=((e,t=(e=>e))=>{const n=new Y((()=>[]));for(let r=0;r<e.length;r+=1){const s=e[r];n.get(t(s,r)).push(s)}const r=new Map([...n.entries()]);return Object.assign(r,{toObject:()=>Object.fromEntries([...r.entries()]),toCountMap(){const e=[...r.entries()].map((([e,t])=>[e,t.length]));return Object.fromEntries(de(e,pe("1")))}})})(e,pe("speaker")),h=s.filter((e=>{var t;return null===(t=u.get(e))||void 0===t?void 0:t.every((e=>{var t;return 1===(null===(t=e.words)||void 0===t?void 0:t.length)}))}));h.length&&hi(`reassigning speakers ${h.join(", ")} who only have single word segments`);for(const e of h)l(e);for(;c.length;)l(c[0]),s=Ee(e.map(pe("speaker"))),a=ga(s.length),hi(K`new word share threshold: ${a}`),o=pa(e),i=ma(e),hi(K`found speaker word shares:\\n\\n${Q(o)}\\n\\nafter reassigning speaker ${c[0]}`),c=fe(s.filter((e=>o[e]<a)),(e=>o[e]));hi(qa,`finished (found ${s.length} speakers over ${e.length} segments)`)},c=async e=>{var n,r;const o=t.numSpeakers||0;hi(`using clustering method ${t.clustering}`);const c=null!==(r=i[null!==(n=t.clustering)&&void 0!==n?n:"hClust"])&&void 0!==r?r:s,l=o?[e,t.numSpeakers,t.numSpeakers]:[e];let{segments:u,distances:h}=await C(c,l);return!o?a(u,h):hi("skipping reassignLowCountSpeakers"),u},l=async n=>{hi(qa,`processing ${n.length} segments`);let r;if(1===t.numSpeakers||!t.numSpeakers&&(t=>{const[n]=t,r=n.embedding,s=512===n.embedding.length?.5:0;for(const n of t.slice(1))if(e(r,n.embedding)<s)return!1;return!0})(n))hi("cluster module only found one speaker"),r=(e=>{for(const t of e)t.speaker="1";return e})(n);else if(n.length<800){const{numSpeakers:e}=t;t.numSpeakers=0,r=await c(n);const s=wa(r);e&&e!==s&&(t.numSpeakers=e,r=await c(n))}else r=await c(n);return await(async e=>{const t=Ee(e.map(pe("speaker")));for(const n of t)for(const r of e.filter(pe("speaker",n)))r.speakerIndex=t.indexOf(n);for(const t of e)t.speaker="Speaker "+(+t.speakerIndex+1);const n=new La;return await n.source(e).processInputs(),await n.outputPromise})(r)};return new class u extends mt{async process({segments:e,options:n}){if(Object.assign(t,n),!e.length)return e;e=e.filter(pe("embedding")),t.numSpeakers&&t.numSpeakers>e.length&&(t.numSpeakers=e.length);return await l(e)}}};Wa()})()})();',"Worker",void 0,void 0)}const Ms=(e,t,n)=>{let r=0;for(const s of e){const e=n[s];for(const n of t)r+=e[n]}return r/e.length/t.length},Rs=function e(t,n,r){const s=t.length,o=n.length;let i=0;for(let e=0;e<s;e+=1){const n=r[t[e]];for(let r=e+1;r<s;r+=1)i+=n[t[r]]**2}for(let e=0;e<o;e+=1){const t=r[n[e]];for(let r=e+1;r<o;r+=1)i+=t[n[r]]**2}for(let e=0;e<s;e+=1){const s=r[t[e]];for(let e=0;e<o;e+=1)i+=s[n[e]]**2}const a=(s+o)*(s+o-1)/2;return Math.sqrt(i/a)},$s=(e,t,n)=>{let r=Number.MAX_SAFE_INTEGER;for(const s of e){const e=n[s];for(const n of t){const t=e[n];t<r&&(r=t)}}return r},js=function e(t,n,r){let s=0;for(const e of t){const t=r[e];for(const e of n){const n=t[e];n>s&&(s=n)}}return s},Ps=Ms,Ts=js,Ns=Rs,Ds=new Map,Bs={average:Ms,ward:Rs,single:$s,complete:js,composite:(e,t,n)=>{let r=Ds.get(e);r||Ds.set(e,r=new Map);let s=r.get(t);if(null!=s)return s;return s=Ps(e,t,n)+Ts(e,t,n)+Ns(e,t,n),r.set(t,s),s}};var Ls=i(656);const{max:Fs,min:zs,sqrt:Us}=Math,qs=(e,t)=>{const n=zs(e.length,t.length);let r=0;for(let s=0;s<n;s+=1)r+=(e[s]-t[s])**2;return Us(r)};var Ws=i(436);class Gs{constructor(e){this.clusters=e.map((e=>({points:[e],centroid:[...e],size:1}))),this.distances=new Map}getDistanceKey(e,t){return e<t?`${e}-${t}`:`${t}-${e}`}calculateWardDistance(e,t){const n=e.size,r=t.size,s=n+r;let o=0;for(let n=0;n<e.centroid.length;n++){const r=e.centroid[n]-t.centroid[n];o+=r*r}return n*r/s*o}getDistance(e,t){if(e===t)return Infinity;const n=this.getDistanceKey(e,t);if(!this.distances.has(n)){const r=this.calculateWardDistance(this.clusters[e],this.clusters[t]);this.distances.set(n,r)}return this.distances.get(n)}findNearest(e){let t=0,n=Infinity;for(let r=0;r<this.clusters.length;r++){if(r===e)continue;const s=this.getDistance(e,r);s<n&&(n=s,t=r)}return t}mergeClusters(e,t){const n=this.clusters[e],r=this.clusters[t],s=n.size,o=r.size,i=s+o,a=new Array(n.centroid.length).fill(0);for(let e=0;e<a.length;e++)a[e]=(s*n.centroid[e]+o*r.centroid[e])/i;const c={points:[...n.points,...r.points],centroid:a,size:i};this.clusters=this.clusters.filter(((n,r)=>r!==e&&r!==t)),this.clusters.push(c),this.distances.clear()}cluster(e){for(;this.clusters.length>e;){const e=[];let t=Math.floor(Math.random()*this.clusters.length);for(;;){e.push(t);const n=this.findNearest(t);if(e.length>1&&e.includes(n)){const t=e[e.length-1],r=n;this.mergeClusters(t,r);break}t=n}}return this.clusters}elbowMethod(e){const t=[],n=[...this.clusters];for(this.cluster(e);this.clusters.length>1;){let e=Infinity,n=[0,0];for(let t=0;t<this.clusters.length;t++)for(let r=t+1;r<this.clusters.length;r++){const s=this.getDistance(t,r);s<e&&(e=s,n=[t,r])}t.push(e),this.mergeClusters(...n)}this.clusters=n,this.distances.clear();const r=t.slice(0,-2).map(((e,n)=>t[n]-2*t[n+1]+t[n+2])),s=r.indexOf(Math.max(...r));return t.length-s}calculateGapStatistic(e,t=8){const n=[...this.clusters],r=this.clusters.reduce(((e,t)=>e+t.points.length),0),s=this.clusters[0].points[0].length,o=e=>e.reduce(((e,t)=>e+t.points.reduce(((e,n)=>e+t.points.reduce(((e,t)=>{let r=0;for(let e=0;e<s;e++)r+=(n[e]-t[e])**2;return e+r}),0)/(2*t.points.length)),0)),0),i=[],a=[];for(let c=1;c<=e;c++){const e=this.cluster(c),l=Math.log(o(e)),u=[];for(let e=0;e<t;e++){const e=Array(r).fill(0).map((()=>Array(s).fill(0).map((()=>2*Math.random()-1))));e.forEach((e=>{const t=Math.sqrt(e.reduce(((e,t)=>e+t*t),0));for(let n=0;n<e.length;n++)e[n]/=t}));const t=new Gs(e).cluster(c);u.push(Math.log(o(t)))}const d=u.reduce(((e,t)=>e+t))/t,h=Math.sqrt(u.reduce(((e,t)=>e+(t-d)**2),0)/t);i.push(d-l),a.push(h*Math.sqrt(1+1/t)),this.clusters=[...n],this.distances.clear()}for(let e=0;e<i.length-1;e++)if(i[e]>=i[e+1]-a[e+1])return e+1;return e}calculateSilhouetteScore(){let e=0,t=0;for(let n=0;n<this.clusters.length;n++){const r=this.clusters[n];for(const s of r.points){let o=0;for(const e of r.points){if(s===e)continue;let t=0;for(let n=0;n<s.length;n++)t+=(s[n]-e[n])**2;o+=Math.sqrt(t)}o=r.points.length>1?o/(r.points.length-1):0;let i=Infinity;for(let e=0;e<this.clusters.length;e++){if(n===e)continue;let t=0;for(const n of this.clusters[e].points){let e=0;for(let t=0;t<s.length;t++)e+=(s[t]-n[t])**2;t+=Math.sqrt(e)}t/=this.clusters[e].points.length,i=Math.min(i,t)}e+=i===o?0:(i-o)/Math.max(o,i),t++}}return e/t}findOptimalClustersUsingSilhouette(e=10){const t=[...this.clusters],n=[];for(let r=2;r<=e;r++){this.clusters=[...t],this.distances.clear(),this.cluster(r);const e=this.calculateSilhouetteScore();n.push(e)}this.clusters=t,this.distances.clear();return 2+n.indexOf(Math.max(...n))}findOptimalClusterCount(e=10){const t=this.elbowMethod(e),r=this.calculateGapStatistic(e),s=this.findOptimalClustersUsingSilhouette(e),i=[t,r,s],a=(0,o.jk)(i);return console.log((0,n.Ik)({elbowMethod:t,gapStatistic:r,silhouetteScore:s,aggregate:a})),a}findOptimalClusters(e=10){return this.cluster(this.findOptimalClusterCount(e||10))}}if(Fr.Ll)var Xs="cluster-module";const Js=()=>{function t(e,t){let n=e.length,r=0;for(;n-- >0;)r+=e[n]*t[n];return r}const r={numSpeakers:0,metric:"angular",linkage:"composite",clustering:"hClust"},s={euclidean:qs,angular:(e,n)=>1-t(e,n),threshold:(e,n)=>{const r=t(e,n),s=1-r;return(0,Ws.Cc)(s,r>.5?0:r<0?1:s,0)}};class i extends Ls.n{async process({segments:e,options:t}){if(Object.assign(r,t),!e.length)return e;e=e.filter((0,o.by)("embedding")),r.numSpeakers&&r.numSpeakers>e.length&&(r.numSpeakers=e.length);return await h(e)}}const a=(e,t,s=[])=>{const i=e.map((e=>((e,t)=>{let n=0;const{linkage:s}=r,o=Bs[s];for(let r=0;r<e.length;r+=1){const s=e[r];let i=0;for(let e=0;e<s.length;e+=1)1!==s.length&&(i+=o([s[e]],s.filter(((t,n)=>e!==n)),t));n+=i/s.length}return Math.sqrt(n/e.length)})(e,t))),a=(0,o.T9)(i),c=i.map((e=>a-e)),l=e.map((e=>((e,t)=>{let n=0;const{linkage:s}=r,o=Bs[s];for(let r=0;r<e.length;r+=1)for(let s=0;s<e.length;s+=1)r!==s&&(n+=o(e[r],e[s],t));return Math.sqrt(n/e.length/e.length)})(e,t)));(0,Gr.Rm)(n.n`intraClusterSimilarities: ${c.join(", ")}`),(0,Gr.Rm)(n.n`interClusterVariances: ${l.join(", ")}`);const u=c.map(((e,t)=>e+l[t]));(0,Gr.Rm)(n.n`combinedVariances: ${u.join(", ")}`);const d=(0,o.S8)(c),h=(0,o.S8)(l);(0,Gr.Rm)(n.n`normalizedIntraClusterSimilarities: ${d.join(", ")}`),(0,Gr.Rm)(n.n`normalizedInterClusterVariances: ${h.join(", ")}`);const f=(0,o.FL)(d)+2,p=(0,o.FL)(h)+2,m=d.map(((e,t)=>e+h[t]));(0,Gr.Rm)(n.n`combinedNormalizedVariances: ${m.join(", ")}`);const g=(0,o.FL)(m)+2;(0,Gr.Rm)(`arg max ${g}`);const y=[p,f,g,...s];return(0,Gr.Rm)(`counts: ${(0,n.p_)(y)}`),Math.ceil((0,o.i2)(y))},c=(e,t,o)=>{const{metric:i,linkage:c}=r,l=s[i],u=Bs[c];(0,Gr.Rm)(`cluster module using ${c} linkage and ${i} metric`);let d=(0,ys.tB)();const h=e.map((({embedding:e})=>e));e.forEach(((e,t)=>e.index=t));let{clustersGivenK:f,distances:p}=(({data:e=[],distance:t=qs,linkage:n=Ms})=>{var r;const s=[];for(let n=0;n<e.length;n+=1){const o=e[n],i=null!==(r=s[n])&&void 0!==r?r:s[n]=[];for(let n=0;n<e.length;n+=1){const r=e[n];i[n]=t(o,r)}}const o=e.map(((e,t)=>({height:0,indexes:[t]})));let i=[];const a=e.length;for(let t=0;t<a&&(i.push(o.map((({indexes:e})=>e))),!(t>=e.length-1));t+=1){let e=Infinity,t=0,r=0;for(let i=0;i<o.length;i++)for(let a=i+1;a<o.length;a++){const c=n(o[i].indexes,o[a].indexes,s);c<e&&(e=c,t=i,r=a)}const i={indexes:[...o[t].indexes,...o[r].indexes],height:e,children:[o[t],o[r]]};o.splice(Fs(t,r),1),o.splice(zs(t,r),1),o.push(i)}return i=[[],...i.reverse()],{clusters:o[0],distances:s,order:o[0].indexes,clustersGivenK:i}})({data:h,distance:l,linkage:u});if((0,Gr.Rm)(n.n`finding possible clusters took ${(0,ys.tB)()-d} ms`),d=(0,ys.tB)(),t)f=f.slice(null!=o?o:2,t+1);else{let e=Infinity;const t=[...f];f=f.slice(null!=o?o:2).filter(((t,n)=>{const r=t.every((e=>e.length>1));return r||(e=n),r&&n<e})),f.length||(f=t.slice(2,16))}f=f.slice(0,14);let m=r.numSpeakers||a(f,p);const g=f.map((t=>e.map(((e,n)=>t.findIndex((e=>e.includes(n)))))));r.numSpeakers&&(0,Gr.Rm)(`cluster module using passed speaker count of ${r.numSpeakers}`),(0,Gr.Rm)(n.n`finding # of speakers took ${(0,ys.tB)()-d} ms`);const y=e;if(m<2){for(let e=0;e<y.length;e+=1)y[e].speaker="0";(0,Gr.Rm)(Xs,`finished (found 1 speaker over ${y.length} segments)`)}else{let e=g[m-2];for(;!e;)m-=1,e=g[m-2];if(e)for(let t=0;t<y.length;t+=1)y[t].speaker=`${e[t]}`;else{for(let e=0;e<y.length;e+=1)y[e].speaker="0";(0,Gr.Rm)(Xs,`finished (found 1 speaker over ${y.length} segments)`)}}return{segments:y,distances:p}},l=()=>{},u={hClust:c,kMeans:async(t,n=12,s=2)=>{const o=r.numSpeakers?[t,r.numSpeakers,r.numSpeakers]:[t,n,s];return await(0,e.Bb)(l,o)},nnChain:async(e,t=12,n=2)=>{const s=new Gs(e.map((({embedding:e})=>e))),o=r.numSpeakers?s.cluster(r.numSpeakers):s.findOptimalClusters(t),i=[...e];for(const e of i)e.speaker=`${o.findIndex((t=>t.points.includes(e.embedding)))}`;return i}},d=async t=>{var s,i;const a=r.numSpeakers||0;(0,Gr.Rm)(`using clustering method ${r.clustering}`);const l=null!==(i=u[null!==(s=r.clustering)&&void 0!==s?s:"hClust"])&&void 0!==i?i:c,d=a?[t,r.numSpeakers,r.numSpeakers]:[t];let{segments:h,distances:f}=await(0,e.Bb)(l,d);return!a?((e,t)=>{let s=(0,o.Am)(e.map((0,o.by)("speaker"))).length,i=(0,o.Am)(e.map((0,o.by)("speaker"))),a=Hr(e),c=Kr(e),l=Vr(i.length),u=(0,o.Y6)(i.filter((e=>a[e]<l)),(e=>a[e]));(0,Gr.Rm)(n.n`found speaker word shares:\n\n${(0,n.Ik)(a)}`),(0,Gr.Rm)(n.n`found speaker segment shares:\n\n${(0,n.Ik)(c)}`);const d=n=>{const i=e.filter((0,o.by)("speaker",n)),c=new Set(i),l=e.filter((e=>!c.has(e))),d=(0,o.Os)(l,(0,o.by)("speaker")),h=i.length;u.length&&(0,Gr.Rm)(`\n\t\t\t\t\treassigning ${h} segments from speaker ${n}\n\t\t\t\t\t(word share ${a[n]}) (under the threshold of ${Vr(s)})\n\t\t\t\t`);const{linkage:f}=r,p=Bs[f],m=(0,o.Y6)(d,(e=>p(i.map((0,o.by)("index")),e.map((0,o.by)("index")),t))),[g]=m,y=g[0].speaker;for(const e of i)e.speaker=y;s-=1},h=(0,o.WH)(e,(0,o.by)("speaker")),f=i.filter((e=>{var t;return null===(t=h.get(e))||void 0===t?void 0:t.every((e=>{var t;return 1===(null===(t=e.words)||void 0===t?void 0:t.length)}))}));f.length&&(0,Gr.Rm)(`reassigning speakers ${f.join(", ")} who only have single word segments`);for(const e of f)d(e);for(;u.length;)d(u[0]),i=(0,o.Am)(e.map((0,o.by)("speaker"))),l=Vr(i.length),(0,Gr.Rm)(n.n`new word share threshold: ${l}`),a=Hr(e),c=Kr(e),(0,Gr.Rm)(n.n`found speaker word shares:\n\n${(0,n.Ik)(a)}\n\nafter reassigning speaker ${u[0]}`),u=(0,o.Y6)(i.filter((e=>a[e]<l)),(e=>a[e]));(0,Gr.Rm)(Xs,`finished (found ${i.length} speakers over ${e.length} segments)`)})(h,f):(0,Gr.Rm)("skipping reassignLowCountSpeakers"),h},h=async e=>{(0,Gr.Rm)(Xs,`processing ${e.length} segments`);const n=1===r.numSpeakers||!r.numSpeakers&&(e=>{const[n]=e,r=n.embedding,s=512===n.embedding.length?.5:0;for(const n of e.slice(1))if(t(r,n.embedding)<s)return!1;return!0})(e);let s;if(n)(0,Gr.Rm)("cluster module only found one speaker"),s=(e=>{for(const t of e)t.speaker="1";return e})(e);else if(e.length<800){const{numSpeakers:t}=r;r.numSpeakers=0,s=await d(e);const n=Yr(s);t&&t!==n&&(r.numSpeakers=t,s=await d(e))}else s=await d(e);return await(async e=>{const t=(0,o.Am)(e.map((0,o.by)("speaker")));for(const n of t)for(const r of e.filter((0,o.by)("speaker",n)))r.speakerIndex=t.indexOf(n);for(const t of e)t.speaker="Speaker "+(+t.speakerIndex+1);const n=new As;return await n.source(e).processInputs(),await n.outputPromise})(s)};return new i},{random:Hs,round:Ks}=Math,Vs=(e=1)=>Ks(e*Hs());var Qs=i(803);const Ys=new Set(["divorced","married","single","widowed","separated"]),Zs=["male","female"],eo=[(0,o.QL)(3),(0,o.QL)(2),(0,o.QL)(4)],to=[(0,o.QL)(2),(0,o.QL)(3),(0,o.QL)(4)],no=["january","february","march","april","may","june","july","august","september","october","november","december"],ro=async e=>{const t=(await i.e(142).then(i.t.bind(i,142,19))).default,r=new Set(t.map((e=>e.toLowerCase()))),s=(await i.e(154).then(i.t.bind(i,154,19))).default,a=new Set(s.map((e=>e.toLowerCase()))),c={email:(e="")=>Qs.A3.test(e),firstName:(e="")=>r.has(e.toLowerCase()),lastName:(e="",t)=>a.has(e.toLowerCase())||a.has(e.replace(/s$/,"").toLowerCase())||c.firstName(t)&&e.length>3&&e.length<9,age:(e="")=>(0,n.kf)(e)&&+e>0&&+e<100,maritalStatus:(e="")=>Ys.has(e.toLowerCase()),address:(e="")=>Qs.kf.test(e),sex:(e="")=>Zs.includes(e),month:(e="")=>no.some((t=>e.toLowerCase()===t)),year:(e="")=>(0,n.kf)(e)&&(2===e.length||4===e.length),day:(e="")=>(0,n.kf)(e)&&2===e.length||!(0,n.kf)(e)&&(0,n.kf)(e.slice(0,2))&&4===e.length,ssn:(e="")=>Qs.Vr.test(e),driversLicenseNumber:(e="")=>Qs.xo.test(e),payment:(e="")=>Qs.Ji.test(e)},l=e.segments.flatMap((0,o.by)("words")),u=l.map((e=>e.word)),d=Object.entries(c);return u.forEach(((e,t,{[t-1]:n=e,[t+1]:r=e})=>{e=e.replaceAll(Qs.nZ,""),n=n.replaceAll(Qs.nZ,""),r=r.replaceAll(Qs.nZ,"");const[s]=d.filter((([,t])=>t(e,n,r))).map((0,o.by)("0")),i=l[t];i.phi=Boolean(s),i.phiCategory=s})),e},so=async e=>{e.segments.some((e=>{var t;return null===(t=e.words)||void 0===t?void 0:t.some((e=>!("phi"in e)))}))&&(e=await ro(e));const t=(await i.e(142).then(i.t.bind(i,142,19))).default,n=(await i.e(154).then(i.t.bind(i,154,19))).default,r=(await i.e(979).then(i.t.bind(i,979,19))).default,s={email:()=>`${(0,o.yT)(t)}@gmail.com`,firstName:()=>(0,o.yT)(t),lastName:()=>(0,o.yT)(n),age:()=>`${Math.round(18+62*Math.random())}`,maritalStatus:()=>(0,o.yT)([...Ys]),address:()=>(0,o.yT)(r),sex:()=>(0,o.yT)(Zs),month:()=>(0,o.yT)(no),year:()=>1950+Vs(80),day:()=>Vs(30)+1,ssn:()=>eo.map((e=>e.map((()=>Vs(9))).join(""))).join("-"),driversLicenseNumber:()=>to.map((e=>e.map((()=>Vs(9))).join(""))).join("-"),payment:()=>`$${Vs(1e3)}.${Vs(99)}`},a=e.segments.flatMap((0,o.by)("words"));return a.map((e=>e.word)).forEach(((e,t,{[t-1]:n=e,[t+1]:r=e})=>{e=e.replaceAll(Qs.nZ,""),n=n.replaceAll(Qs.nZ,""),r=r.replaceAll(Qs.nZ,"");const o=a[t];o.phi&&(o.word=o.word.replace(e,s[o.phiCategory]()))})),e.segments.forEach((e=>{var t;return e.text=null===(t=e.words)||void 0===t?void 0:t.map((0,o.by)("word")).join("")})),e.text=e.segments.map((0,o.by)("text")).join(""),e};var oo=i(712),io=i(600);class ao{get endTime(){return(0,o.T9)(Object.values(this.phases).map((0,o.by)("endTime")))}get elapsed(){return this.endTime-this.startTime}constructor(){this.startTime=(0,ys.tB)(),this.phases={}}startPhase(e){this.phases[e]={startTime:(0,ys.tB)(),endTime:(0,ys.tB)(),elapsed:0}}endPhase(e){this.phases[e].endTime=(0,ys.tB)(),this.phases[e].elapsed=this.phases[e].endTime-this.phases[e].startTime}get summary(){const e=Object.entries(this.phases).map((([e,t])=>`${e}: ${(0,n.p0)(t.elapsed.in("seconds"))}`));return e.push(`total: ${(0,n.p0)(this.elapsed.in("seconds"))}`),(0,n.p_)(e)}}const co=async(e,{channel:t,leader:n,joiner:r}={})=>{null!=t&&e.forEach((e=>e.speaker=t));const s=n?({text:e})=>`${n}${e.trim()}`:(0,o.by)("text");return{text:e.map(s).join(r).replace(/ +/g," ").trim(),segments:e}};class lo{constructor(e,t){Object.assign(this,e),Object.defineProperty(this,"getAudio",{value:t,enumerable:!1})}get audio(){var e;return this.overriddenAudio?this.overriddenAudio:this.overriddenAudio=io.uU.fromTo(null!==(e=this.segmentAudio)&&void 0!==e?e:this.segmentAudio=this.getAudio(this),"Audio")}play(){var e,t,n;return(null===(e=this.audio)||void 0===e?void 0:e.paused)?null===(t=this.audio)||void 0===t?void 0:t.play():null===(n=this.audio)||void 0===n?void 0:n.pause()}}const uo=(e,t)=>e.start<=t.start&&e.end>=t.end,ho=(e,t)=>{const n=uo(e,t),r=uo(t,e);if(n||r)return!0;return!(e.end<=t.start||e.start>=t.end)},fo=(e,t)=>{var n,r,s,i;const a=Math.max(e.start,t.start),[c,l]=[a===e.start?t:e,a===e.start?e:t],u=null!==(r=null===(n=c.words)||void 0===n?void 0:n.filter((e=>e.end<=a)))&&void 0!==r?r:[],d=u.map((0,o.by)("word")).join(" "),h=null!==(i=null===(s=l.words)||void 0===s?void 0:s.filter((e=>e.start>a)))&&void 0!==i?i:[],f=h.map((0,o.by)("word")).join(" ");return{start:c.start,end:l.end,text:`${d} ${f}`,words:[...u,...h]}};function po({segments:e}){const t=[],n=(0,o.Y6)(e,(0,o.by)("start")),r=new Set;for(let e=0;e<n.length;e+=1){const s=n[e];if(r.has(s))continue;let o=s;const i=()=>n.filter((e=>o!==e&&!r.has(e))).filter((e=>ho(o,e)));for(;i().length;){const e=i()[0];o=fo(s,e),r.add(e)}t.push(o)}return t}async function mo({segments:e=[],audioSource:t,audioSources:r=(t?[t]:[]),metrics:s=new ao}={},i={},a=co){s.startPhase("post-process");let c=await a(e,i);s.endPhase("post-process"),i.replacePhi?c=await so(c):i.detectPhi&&(c=await ro(c));const l=e=>oo.uC.getAudioSlice(r,e.start,e.end);[...c.segments,...e].forEach((e=>{var t;let n,r;Object.defineProperties(e,{audio:{get:()=>n||(n=io.uU.fromTo(null!=r?r:r=l(e),"Audio")),set(e){n=e},configurable:!0,enumerable:!1},play:{value:()=>{var t,n,r;return(null===(t=e.audio)||void 0===t?void 0:t.paused)?null===(n=e.audio)||void 0===n?void 0:n.play():null===(r=e.audio)||void 0===r?void 0:r.pause()},configurable:!0,enumerable:!1}}),e.words=(null!==(t=e.words)&&void 0!==t?t:[]).map((e=>new lo(e,l)))}));const u={audioSources:r,get processed(){return true},unprocessedSegments:e,segments:c.segments,wordCount:(0,o.cz)(c.segments.map((0,o.by)("wordCount"))),options:i,get isDiarized(){return this.segments.every((0,o.by)("embedding"))},get speakers(){return(0,o.Am)(c.segments.map((0,o.by)("speaker"))).filter(Boolean)},get didInferClinicians(){return u.speakers.filter((e=>!/^speaker \d+$/i.test(e))).filter((e=>e.includes("Clinician"))).length===i.clinicians},get didInferClients(){var e;const t=u.speakers.filter((e=>!/^speaker \d+$/i.test(e))),r=(0,n.ZH)(null!==(e=sessionStorage.callClients)&&void 0!==e?e:"client");return t.length===u.speakers.length||t.filter((e=>e.includes(r))).length===i.clients},get didInferNames(){var e;const t=u.speakers.filter((e=>!/^speaker \d+$/i.test(e))),r=(0,n.ZH)(null!==(e=sessionStorage.callClients)&&void 0!==e?e:"client");return t.some((e=>!e.includes("Clinician")&&!e.includes(r)))},groupedSegments:c.segments,text:c.text,metrics:s,toString:()=>c.text};return u}async function go({segments:e=[],audioSource:t,audioSources:n=(t?[t]:[])}={},i={}){var a;const[c,u,h]=Zr([i.numSpeakers,i.clinicians,i.clients]);Object.assign(i,{numSpeakers:c,clinicians:u,clients:h});const f=null!==(a=i.speakerMap)&&void 0!==a?a:i.speakerMap=new l.xP,p=new ao;e=e.filter(s.Kg);let m=await mo({segments:e,audioSources:n,metrics:p},i,(async()=>{var t,n,s,a;const c=e,l=e.some((e=>null==e.speaker)),u=c.length>0,h=i.numSpeakers&&i.numSpeakers!==(0,o.Am)(e.map((0,o.by)("speaker"))).length,m=u&&(l||h),g=!Fr.Ll&&!Fr.nr;if(!(null===(n=null===(t=c[0])||void 0===t?void 0:t.embedding)||void 0===n?void 0:n.buffer))for(const e of c)e.embedding=new Float32Array(null!==(s=e.embedding)&&void 0!==s?s:[]);m&&(0,Gr.Rm)(`clustering ${e.length} segments ${g?"using":"not using"} worker`);const y=g?new Os:{terminate(){}},w=g?r.LV(y):Js();p.startPhase("clustering");const b=m?await w.process({segments:c,options:{...i,speakerDeducer:void 0}}):await(new d).process(e);p.endPhase("clustering"),setTimeout((()=>y.terminate()),200..seconds);const v=b.flatMap((({componentSegments:e=[]})=>e));c.forEach(((e,t)=>{var n,r,s,o,i,a;null!==(n=(a=e).speaker)&&void 0!==n||(a.speaker=null===(r=v[t])||void 0===r?void 0:r.speaker),e.speakerIndex=null===(s=v[t])||void 0===s?void 0:s.speakerIndex,0===(null===(o=e.embedding)||void 0===o?void 0:o.length)&&(e.embedding=null===(i=v.find((({text:t})=>e.text===t)))||void 0===i?void 0:i.embedding)}));const _=null!=i.channel,{inferSpeakerNames:k,deduceSpeakerNames:S}=i,x=null===(a=i.speakerDeducer)||void 0===a?void 0:a.canDeduce(b),A=_||!k&&!S?new xs:x&&S?new ks:k?new vs:new xs;A instanceof vs?p.startPhase("infer-speaker-names"):A instanceof ks&&p.startPhase("deduce-speaker-names"),await A.source({speakerMap:f,segments:b,clinicians:i.clinicians,clients:i.clients}).processInputs();const C=await A.outputPromise;return A instanceof vs?p.endPhase("infer-speaker-names"):A instanceof ks&&p.endPhase("deduce-speaker-names"),C}));const g=e=>Object.fromEntries((0,o.Os)(e,(0,o.by)("speaker")).map((e=>{var t;return[null===(t=e[0])||void 0===t?void 0:t.speaker,new Set(e.map((0,o.by)("index")))]})));return Object.assign(m,{async rediarize(n){if(i.inferSpeakerNames)return await go({segments:e,audioSource:t},Object.assign(i,n));{const r=new l.xP(f),s=(0,l.B8)(f);m.unprocessedSegments.forEach((e=>e.speaker=s.get(e.speaker)));const o=g(m.unprocessedSegments);f.clear();let a=await go({segments:e,audioSource:t},Object.assign(i,n));const c=g(a.unprocessedSegments);for(const[e,t]of r){const n=o[e],r=c[e];n.isSubsetOf(r)&&f.set(e,t)}return f.size&&(a=await go({segments:e,audioSource:t},Object.assign(i,n))),m=a}},async setSegmentsSpeaker(e,t){for(const n of e)n.speaker=t;const n=await(new d).process(m.segments);return m.segments=n,m={...m}},async renameSpeaker(e,t){f.set(e,t);const n=new xs;await n.source({speakerMap:f,segments:m.segments}).processInputs(),Object.assign(m,await n.outputPromise),m.segments.forEach((({speaker:e,componentSegments:t})=>null==t?void 0:t.forEach((t=>t.speaker=e))));const r=m.segments.flatMap((e=>{var t;return null!==(t=e.componentSegments)&&void 0!==t?t:[]}));return m.unprocessedSegments.forEach(((e,t)=>e.speaker=r[t].speaker)),m={...m,segments:[...m.segments],unprocessedSegments:[...m.unprocessedSegments],speakers:(0,o.Am)(m.segments.map((0,o.by)("speaker"))).filter(Boolean)}}})}async function yo(e){for(let t=0;t<e.length;t+=1){const r=e[t];let{options:{channel:s},unprocessedSegments:i,speakers:a}=r;if(null!=s){s=(0,n.ZH)(s);for(const e of i)e.speaker=a.length>1?(0,o.Am)([s,e.speakerIndex+1]).filter((e=>null!=e)).join(" "):s}}const t=(0,o.Y6)(e.flatMap((e=>{var t;return null!==(t=e.unprocessedSegments)&&void 0!==t?t:[]})),(0,o.by)("start")),r=(0,o.Am)(e.flatMap((0,o.by)("audioSources"))),s=await go({segments:t,audioSources:r});return Object.assign(s,{async rediarize(t){var n;const r=e.find((({options:{channel:e=""}})=>/clinician/i.test(e))),s=e.find((({options:{channel:e=""}})=>{var t;return e.toLowerCase()===(null!==(t=sessionStorage.callClients)&&void 0!==t?t:"client").toLowerCase()})),o=null!=s?s:e.find((e=>e!==r)),i=null!==(n=t.numSpeakers)&&void 0!==n?n:2,a=t.clinicians,c=t.clients,l=null!=a?a:c?i-c:1,u=null!=c?c:a?i-a:1;return await yo([await(null==r?void 0:r.rediarize(Object.assign(r.options,{numSpeakers:l}))),await(null==o?void 0:o.rediarize(Object.assign(o.options,{numSpeakers:u})))])}})}var wo=i(981);var bo=i(758),vo=i(601);class _o{constructor(e){this.transcript=e,this.segmentsWords=e=>e.map((0,o.by)("text")).flatMap(f.aL),this.segmentsNumWords=e=>this.segmentsWords(e).length}get silenceDuration(){const{segments:e}=this.transcript;let t=0;for(let n=0;n<e.length;n+=1){const r=e[n],s=e[n-1];s&&(t+=r.start-s.end)}return t}get silenceRatio(){return this.silenceDuration/(0,o.T9)(this.transcript.segments.map((0,o.by)("end")))}get numSpeakers(){const{speakers:e}=this.transcript;return e.length}get speakerWordDistribution(){const e=this.transcript.speakers.map((e=>this.transcript.segments.filter((0,o.by)("speaker",e)))).map(this.segmentsNumWords),t=(0,o.cz)(e);return Object.fromEntries(this.transcript.speakers.map(((n,r)=>[n,e[r]/t])))}speakerSegmentDistribution(e=this.transcript.segments){const t=this.transcript.speakers.map((t=>e.filter((0,o.by)("speaker",t)))).map((0,o.by)("length"));return Object.fromEntries(this.transcript.speakers.map(((n,r)=>[n,t[r]/e.length])))}toString(){var e;const t=[];t.push(this.speakerSegmentDistribution());const{length:r}=null!==(e=this.transcript.groupedSegments)&&void 0!==e?e:[];r&&t.push(this.speakerSegmentDistribution(this.transcript.groupedSegments));const s=["segments dist","grouped segments dist"],o=t.map(((e,t)=>`${s[t]}:\n\n${(0,n.Ik)(e)}`)),i=r?` grouped segments: ${r}`:"";return[`speakers: ${this.transcript.speakers} (${this.numSpeakers} distinct)`,`segments: ${this.transcript.segments.length}${i}`,`word dist:\n\n${(0,n.Ik)(this.speakerWordDistribution)}`,...o].join("\n\n")}}var ko=i(148),So=i(158),xo=i.n(So),Ao=i(78);class Co extends oo.uC{constructor(e,t){super(),this.recorder=e,this.context=t,this.isOnline=!0,this.done=!1,this.didStart=!1,this.isReadyPromise=new Promise((e=>this.resolveIsReady=e)),this.minChunkDuration=10,this.maxChunkDuration=20,this.processorName="segment-processor",this.context=t,this.recorder=e,this.source=t.createMediaStreamSource(e.stream);let{state:n}=this;Object.defineProperty(this,"state",{get:()=>n,set(e){var t;n=e,null===(t=this.workletInterface)||void 0===t||t.set({state:n})}}),e.addEventListener("start",(()=>{this.didStart=!0,this.state="active"}),{once:!0}),e.addEventListener("pause",(()=>{this.state="paused"})),e.addEventListener("resume",(()=>{this.state="active"})),e.addEventListener("stop",(()=>{this.state="finished"})),this.isReadyPromise=new Promise((e=>this.resolveIsReady=e)),this.init()}async preprocessChunk(e){return Fr.gm&&(e.audio=(await(0,Ao.cg)((0,io.gh)(e.audio),{sampleRate:16e3})).getChannelData(0)),e}async init(){try{await this.context.audioWorklet.addModule(xo())}catch(e){console.log(`error instantiating audio-worklet: ${e.message}`)}this.worklet=new AudioWorkletNode(this.context,this.processorName,{numberOfInputs:1,numberOfOutputs:1,processorOptions:{numberOfChannels:1,sampleRate:Fr.NG}}),this.worklet.onprocessorerror=e=>console.log(e.message),this.workletInterface=(0,r.LV)(this.worklet.port),await this.workletInterface.set({state:this.state,minChunkDuration:this.minChunkDuration,maxChunkDuration:this.maxChunkDuration,started:!0});const{stop:e}=this.recorder;this.recorder.stop=async(...t)=>{const n=await this.workletInterface.last();if(n){const e=await this.preprocessChunk({...n,last:!0});this.dispatchEvent("next",e),this.slices.push(e)}this.done=!0,this.dispatchEvent("done"),e.apply(this.recorder,t),this.source.disconnect(),"running"===this.context.state&&this.context.close()},this.source.connect(this.worklet),this.addEventListener("next",(({audio:e})=>{var t;return this.duration+=(null!==(t=e.length)&&void 0!==t?t:0)/Fr.NG}));this.worklet.port.addEventListener("message",(async({data:{method:e,args:t}})=>{if("next"===e){console.log(`got segment of duration ${(0,n.p0)(t[0].end-t[0].start)}`);const e=await this.preprocessChunk(t[0]);this.dispatchEvent("next",e),this.slices.push(e)}"log"===e&&console.log(...t)})),this.resolveIsReady()}async start({maxChunkDuration:e,minChunkDuration:t}={maxChunkDuration:20,minChunkDuration:10}){await this.workletInterface.set({maxChunkDuration:e,minChunkDuration:t,elapsed:0}),this.recorder.start()}async stop(){return this.recorder.stop()}}class Eo{static get worker(){var e;return null!==(e=this._worker)&&void 0!==e?e:this._worker=new Os}static get processor(){var e;return null!==(e=this._processor)&&void 0!==e?e:this._processor=r.LV(this.worker)}static async diarize(e,t={}){var n,r,o;const i=e.filter(s.Kg);if(!i.length)return e;if(!(null===(r=null===(n=i[0])||void 0===n?void 0:n.embedding)||void 0===r?void 0:r.buffer))for(const e of i)e.embedding=new Float32Array(null!==(o=e.embedding)&&void 0!==o?o:[]);(0,Gr.Rm)(`diarizing ${i.length} segments using cluster worker`);const{processor:a}=this,c=await a.process({segments:i,options:t}),u=c.flatMap((({componentSegments:e=[]})=>e));i.forEach(((e,t)=>{var n,r,s,o,i,a;null!==(n=(a=e).speaker)&&void 0!==n||(a.speaker=null===(r=u[t])||void 0===r?void 0:r.speaker),e.speakerIndex=null===(s=u[t])||void 0===s?void 0:s.speakerIndex,0===(null===(o=e.embedding)||void 0===o?void 0:o.length)&&(e.embedding=null===(i=u.find((({text:t})=>e.text===t)))||void 0===i?void 0:i.embedding)}));const d=new xs,h=new l.xP;return await d.source({speakerMap:h,segments:c}).processInputs(),(await d.outputPromise).segments}static dispose(){this.worker.terminate(),delete this._worker,delete this._processor}}const Io=async(e=(0,vo.xr)())=>{try{return await(0,vo.jQ)(e)}catch(t){if(console.warn(t),e===Fr.jV)throw t;return Io(Fr.jV)}};let Oo=Io();class Mo{constructor(e){this.audioSource=e,this.initTime=0,this.transcribeQueue=new ds,this.embedQueue=new ds,this.type=this.audioSource instanceof Co?"online":"offline",this.createdTime=(0,ys.tB)(),this.totalAudioProcessed=0,this.totalElapsed=0,this.results=new Promise(((e,t)=>Object.assign(this,{resolve:e,reject:t}))),this.stage="initializing",this.remoteOrigin=(0,vo.xr)(),this.stopTime=0,this.audioSource=e,e.addEventListener("next",(e=>this.transcribeQueue.add(e))),this.initTime=performance.now()}fallback(e){var t;console.error("falling back due to error",e),null===(t=this.onFallback)||void 0===t||t.call(this,e),this.reject(e),this.cleanUp()}get telemetry(){return(0,n.Ik)({backend:this.backend.name,totalAudioProcessed:this.totalAudioProcessed,totalElapsed:this.totalElapsed,stage:this.stage})}get useCase(){return(0,e.M_)(this.session).useCase}async registerStart(){try{const{id:e,backend:{name:t},remoteOrigin:n,useCase:r}=this,s="RemoteBackend"!==t||await(0,bo.j6)();await(0,ko.TB)(`${n}/api/start-transcription`,{id:e,useCase:r,backend:t,localTranscriptionAvailable:s},{mode:"cors"},25e3)}catch(e){console.warn(e)}}async registerEnd(){try{const{id:e,backend:t,backend:{name:n},remoteOrigin:r,useCase:s,startTime:o,totalAudioProcessed:i}=this,{wordCount:a,segments:c,speakers:{length:l},didInferClinicians:u,didInferClients:d,didInferNames:h}=await this.results,f="telehealth"===s?{}:{didInferClinicians:u,didInferClients:d,didInferNames:h},{redundancyRatio:p}=await t.metrics(),m={id:e,useCase:s,backend:n,elapsed:(0,ys.tB)()-o,processed:i,redundancy:p,chunks:this.audioSource.slices.length,words:a,segments:c.length,speakers:l,...f};await(0,ko.TB)(`${r}/api/end-transcription`,m,{mode:"cors"},25e3)}catch(e){console.warn(e)}}static async getPreferredBackend(){if(!await Oo&&!gs.I.local.get("last-active-servers",[]).length&&await(0,bo.j6)())return"LocalBackend"}async init({transcriptionId:r=(0,t.u)(),session:s,speaker:i,realtime:a=!1,diarize:c=!1,numSpeakers:l,clinicians:u,clients:d,inferSpeakerNames:h,deduceSpeakerNames:p,speakerDeducer:m,detectPhi:g=!1,replacePhi:y=!1,leader:w="",joiner:b=" ",backend:v,preferBackend:_,remoteOrigin:k=(0,vo.xr)(),debug:S,onLog:x,onMonitor:A,onMonitorPerformance:C,onMetrics:E,onUpdate:I,onFinish:O,onFallback:M}){var R;let $;null!=p||(p=await wo.q.get("useDeduceSpeakerNames")),p&&(null!=m||(m=await bs.new())),Gr.Rm.data("transcription",this),[l,u,d]=Zr([l,u,d]),null!=Oo||(Oo=Io()),Object.assign(this,{id:r,session:s,channel:i,remoteOrigin:k,onFinish:O,onFallback:M}),Fr.Ll||addEventListener("trigger-fallback",(({detail:e})=>this.fallback(e)),{once:!0}),null==v&&(_=await Mo.getPreferredBackend(),v=await(0,bo.jz)(_)),null!==(R=this.backend)&&void 0!==R||(this.backend=v),this.registerStart(),await this.audioSource.isReadyPromise;const j=new Set,P=new Set,T=e=>{console.log("error in transcription",e.reason)};Fr.Ll?process.on("unhandledRejection",T):addEventListener("unhandledrejection",T);const{transcribeQueue:N,embedQueue:D}=this,B=(0,e.Oo)((()=>{this.stage="transcribing"})),L=async(t,r)=>{var s,i,u;B();const{audio:d,start:h,index:f}=r,g=null===(s=(0,e.M_)(this.session))||void 0===s?void 0:s.id;r.transcriptionId=this.id,r.noteId=g;const y=crypto.randomUUID();null==x||x(`sending chunk ${y.slice(0,4)}`);const w=(0,ys.t)();let b;null!=$||($=w),P.add(f);try{b=await t.process(r),b.audio&&(r.audio=b.audio)}catch(e){console.log("error in transcription",e),b={processed:!0,segments:[]}}if(j.has(f))return;j.add(f);const _=d.length/Fr.NG,k=b.segments.some((e=>!e.embedding));if(c&&k&&!r.retried)return j.delete(f),Object.assign(r,b),D.add(r),void(k&&(r.retried=!0));for(const e of null!==(i=b.segments)&&void 0!==i?i:[]){e.start+=h,e.end+=h,e.index=f;for(const t of null!==(u=e.words)&&void 0!==u?u:[])t.start+=e.start,t.end+=e.start;Object.defineProperty(e,"chunk",{value:r,configurable:!0,enumerable:!1}),"text"in e||(null==x||x("got segment without text from node",t),e.text="")}r.processed=!0,r.processor=b.processor;const{segments:S}=v,E=(0,o.Y6)(b.segments.filter((0,o.by)("text")),(0,o.by)("start"));c&&p&&(E.forEach((e=>null==m?void 0:m.assignSpeaker(e))),E.forEach((e=>e.deducedSpeaker&&(e.speaker=e.deducedSpeaker))));const O=S.concat(E);(0,o.mx)(S,(0,o.Y6)((0,o.Y6)(O,(0,o.by)("start")),(({index:e})=>null!=e?e:0)));const M=.001*((0,ys.t)()-w);this.totalAudioProcessed+=_;this.audioSource.isOnline?this.totalElapsed+=M:this.totalElapsed=.001*((0,ys.t)()-$);const R=this.totalAudioProcessed/this.totalElapsed,T=1/R*45..minutes;null==C||C(R);const N=Math.min(1,this.totalAudioProcessed/this.audioSource.duration),L=a&&this.audioSource.isOnline?po({segments:S}):S,F="realtime"!==c||p?L:await Eo.diarize(L,{numSpeakers:l}),z="realtime"===c?Qr(F):[];null==I||I({text:`${S.map((0,o.by)("text")).join("\n")}`,segments:F,unprocessedSegments:S,speakers:z,progress:N,performance:R});const U=this.audioSource.duration?`(${(0,n.X1)(N)}) `:"";null==A||A(`got chunk ${y.slice(0,4)} (${(0,o.cz)(E,(({words:e})=>{var t;return null!==(t=null==e?void 0:e.length)&&void 0!==t?t:0}))} words) after ${(0,n.p0)(M)} ${U}(${n.n`${R}`}x real-time) (~${(0,n.p0)(T,"ms")} to process full session)`)},F=({processed:e,groupedSegments:t})=>{var n;const r=(null==t?void 0:t.length)>0,s=c&&r,o=null!=(null===(n=null==t?void 0:t[0])||void 0===n?void 0:n.speaker);return!1!==e&&(!s||o)},z=async e=>{null==e||e.preventDefault();try{await this.registerEnd()}finally{this.cleanUp()}},U=(0,e.Oo)((async(t={diarize:c})=>{var r,s;this.stage="finalizing";const{segments:_}=v;await this.stop();const k=_.every((({embedding:e})=>e)),S=async()=>{var e;const t=.001*((0,ys.t)()-$),r=this.totalAudioProcessed/t,s=1/r*45..minutes,i=(0,o.cz)(_.map((0,o.by)("wordCount"))),a=this.audioSource.isOnline?this.totalAudioProcessed:this.audioSource.duration,c=await this.backend.metrics(),l=(0,n.Ik)((0,zr.d4)(c,f._h),{joiner:", "}),u=n.n`${r/+(null!==(e=c.xRealTime)&&void 0!==e?e:1)}`,d=`${(0,n.p0)(t)} (${n.n`${r}`}x real-time) (${u}x concurrent speedup)`,h=t<30..minutes?`(~${(0,n.p0)(s,"ms")} to process full session)`:"",p=i/a;return{summary:[(0,f.vp)(`\n\t\t\t\t\t\tfinished transcribing ${(0,n.p0)(a)} of audio in ${d} ${h}\n\t\t\t\t\t`),`word count: ${i}, words / sec: ${n.n`${p}`} (${n.n`${p/Fr.Qp}`}x observed mean)`,l?`backend metrics:\n\n${l}`:""].join("\n\n"),backendMetricsObject:c,backendMetrics:l,wordCount:i,audioDuration:a,elapsed:t,xRealtime:r}};if((0,o.mx)(_,a?po({segments:_}):_),t.diarize&&k){null!=h||(h=await wo.q.get("useInferSpeakerNames"));const t=await go({segments:_,audioSource:this.audioSource},{inferSpeakerNames:h,deduceSpeakerNames:p,speakerDeducer:m,detectPhi:g,replacePhi:y,numSpeakers:l,clinicians:u,clients:d,channel:i});if(t&&F(t)){const n=await S(),{speakers:s}=t,o=s.length,i=`transcript post-processing metrics:\n\n${t.metrics.summary}`;n.summary=[n.summary,i].join("\n\n");const a={waitTime:.001*((0,ys.t)()-this.stopTime),speakers:o,...n};Object.assign((0,e.M_)(this.session).metrics,a),null==E||E(a),this.endTime=(0,ys.tB)(),null==O||O(t),null===(r=this.resolve)||void 0===r||r.call(this,Object.assign(t,{transcription:this})),null==A||A(`${n.summary}\n\n${new _o(t)}`)}else{const e=`invalid transcript (got ${JSON.stringify(t.text)}) [${this.telemetry}]`;this.fallback(e)}}else{const t=await mo({segments:v.segments,audioSource:this.audioSource},{channel:i,inferSpeakerNames:h,detectPhi:g,replacePhi:y,leader:w,joiner:b,numSpeakers:l});if(F(t)){const n=await S(),r={waitTime:.001*((0,ys.t)()-this.stopTime),speakers:1,...n};Object.assign((0,e.M_)(this.session).metrics,r),null==E||E(r),this.endTime=(0,ys.tB)(),null==O||O(t),null===(s=this.resolve)||void 0===s||s.call(this,Object.assign(t,{transcription:this})),null==A||A(n.summary)}else{const e=`invalid transcript (got ${JSON.stringify(t.text)}) [${this.telemetry}]`;this.fallback(e)}}z().then((()=>!Fr.Ll&&removeEventListener("beforeunload",z))),null==x||x("done")})),{audioSource:q}=this,W=async(e,t)=>{try{await L(e,t)}catch(e){console.log("error in transcription",e),!1!==e.processed&&(e.segments||e.embedding)||!("audio"in e)||N.add(e)}},G=()=>{const e=q.isFinished,t=j.size===P.size&&N.empty,n=!c||D.empty,r=j.size===q.slices.length;return e&&t&&r&&n};v.consume(N,q,v.transcribeNodes,W,G,(()=>U())),v.consume(D,q,v.embedNodes,W,G,(()=>U())),this.results.finally((()=>this.cleanUp())),"automated"in Ur.f||Fr.Ll||addEventListener("beforeunload",z,{once:!0}),S&&Object.assign(globalThis,{backend:v,transcription:this,results:this.results,audioSource:q})}async start(){this.startTime=(0,ys.t)(),await this.audioSource.start()}async stop(){this.stopTime=(0,ys.t)(),await this.audioSource.stop()}cleanUp(){this.backend.dispose(),Oo=void 0}}var Ro;class $o extends Mo{static async new(e){var t,n;e.audio instanceof Float32Array||16e3===(null===(t=e.audio)||void 0===t?void 0:t.sampleRate)&&(null===(n=e.audio)||void 0===n?void 0:n.numberOfChannels)===Fr.L9||(e.audio=await(0,Ao.cg)(e.audio,{sampleRate:16e3}));const r=new Ro(e.session,e.audio);return await r.init(e),r.start(),r}constructor(e,t){super(new oo.fm(t instanceof Float32Array?t:t.getChannelData(0))),this.session=e}async init({diarize:t=!0,preferBackend:n,localWorkers:r=1,session:s,...o}={}){var i;const a="telehealth"===(null===(i=(0,e.M_)(s))||void 0===i?void 0:i.useCase)?"load":"preload",c=await Ro[a]({diarize:t,preferBackend:n,localWorkers:r,...o});this.results.finally((()=>Ro.preload=(0,e.Oo)(Ro.load))),await super.init({...o,session:s,diarize:t,backend:c})}async start(){this.startTime=(0,ys.t)(),await this.audioSource.start(this.backend.chunkParams)}cleanUp(){Ro.preload=(0,e.Oo)(Ro.load),super.cleanUp()}}var jo;Ro=$o,$o.load=async({transcriptionId:e=(0,t.u)(),diarize:n=!0,...r})=>{var s,o,i,a;const c=null!==(s=r.localWorkers)&&void 0!==s?s:gs.I.local.get("offline-transcription-local-workers",1),l=null!==(o=r.remoteWorkers)&&void 0!==o?o:gs.I.local.get("offline-transcription-remote-workers",(()=>{var e;return(Fr.Ll?8:null!==(e=navigator.deviceMemory)&&void 0!==e?e:4)/8*16})());let u=null!==(i=r.preferBackend)&&void 0!==i?i:await Mo.getPreferredBackend();const d=await(0,bo.jz)(u);return null!==(a=r.embedQuantized)&&void 0!==a||(r.embedQuantized=!1),d.init({...r,type:"offline",diarize:n,localWorkers:c,remoteWorkers:l})},$o.preload=(0,e.Oo)(Ro.load),function(e){e.tiny="tiny",e.base="base",e.turbo="turbo",e.small="small",e.medium="medium"}(jo||(jo={}));Object.keys({tiny:0,base:1,turbo:2,small:3,medium:4});class Po extends Co{constructor(){super(...arguments),this.minChunkDuration=2.5,this.maxChunkDuration=5,this.processorName="realtime-segment-processor"}}class To extends Mo{static async new({session:e,realtime:t=!1,diarize:n=!0,audio:r,...s}){const o=!r;null!=r||(r=new MediaRecorder(await navigator.mediaDevices.getUserMedia({audio:{sampleRate:Fr.NG,channelCount:Fr.L9}})));const i=new To(e,r,t);return await i.init({session:e,realtime:t,diarize:n,...s}),o&&i.start(),o||(i.stop=async()=>{i.stopTime=(0,ys.t)()}),i}async init(t){var n,r,s,o;const i=await(0,bo.jz)(t.preferBackend),a=await wo.q.get("useMediumModelForSummarize");null!==(n=t.embedQuantized)&&void 0!==n||(t.embedQuantized=!1),null!==(r=t.remoteWorkers)&&void 0!==r||(t.remoteWorkers=4);const c=null!==(o=null===(s=(0,e.M_)(t.session))||void 0===s?void 0:s.useCase)&&void 0!==o?o:t.diarize?"listen":"summarize",l="LocalBackend"===i.name?Fr.RS:a&&"summarize"===c?jo.medium:Fr.pE;await i.init({...t,model:l,type:"online"});const{context:u,source:d}=this,h=this.analyzer=u.createAnalyser();h.fftSize=Fr.nu,d.connect(h),await super.init({...t,backend:i})}constructor(e,t,n=!1){const r=new(n?Po:Co)(t,new AudioContext({sampleRate:Fr.NG}));super(r),this.session=e,this.mediaRecorder=r.recorder,this.context=r.context,this.source=r.source}async start(){await this.audioSource.start(),this.startTime=this.context.currentTime}}let No=!1;Fr.Ll&&Object.defineProperties(globalThis,{MediaRecorder:{value:class{},configurable:!0}});const Do=e=>e.audio instanceof MediaRecorder||!e.audio?To:$o,Bo=async e=>{const{onFallback:n=(()=>{})}=e,r=((e="upload")=>({id:(0,t.u)(),useCase:e,metrics:{waitTime:0,speakers:0}}))(),{audio:s,session:o=r,...i}=e;return No?(async r=>(n(r),await Do(e).new({session:o,audio:s,transcriptionId:(0,t.u)()})))("explicitly disabled"):await Do(e).new({audio:s,session:o,...i})},Lo=async n=>{const r=(0,t.u)(),[{session:s,onFallback:o=(()=>{})}]=n,i=n.map((({onFinish:e})=>null!=e?e:()=>{}));s&&((0,e.M_)(s).metrics.speakers=n.length),n.slice(1).forEach((e=>e.onFallback=o)),n.forEach((e=>delete e.onFinish));const a=await Promise.all(n.map((e=>Bo({...e,transcriptionId:r}))));return a.forEach(((e,t)=>e.results.then((()=>e.onFinish=i[t])))),a},Fo=(0,e.vX)((async r=>{var s,o;if(Fr.Ll||await gs.I.db.ready,r instanceof Array){const e=r[0]instanceof To||r[0]instanceof $o?r:await Lo(r),t=await Promise.all(e.map((e=>e.results))),n=await yo(t);return e.forEach((({onFinish:e})=>null==e?void 0:e(n))),n}{null!==(s=r.transcriptionId)&&void 0!==s||(r.transcriptionId=(0,t.u)()),r.onFallback=(0,e.Oo)(null!==(o=r.onFallback)&&void 0!==o?o:()=>{});const i=e=>{var t;null===(t=r.onFallback)||void 0===t||t.call(r,e);return{text:"",segments:[]}};if(No)return i("explicitly disabled");try{if(r.audio instanceof File)return await zo(r);const e=r instanceof To||r instanceof $o?r:await Bo(r),{results:t}=e;return t}catch(e){return console.log("error in transcription. falling back",e),i((0,n.z3)(e))}}}),{mode:"last"}),zo=(0,e.vX)((async e=>{const{segments:t}=await(0,Xr.X8)((0,vo.HI)(),e.audio,e);return await go({segments:t},e)})),Uo=(...e)=>$o.preload(...e),qo=async()=>{await wo.q.get("useAllowForceDisable")&&(No=!0)},Wo=()=>No,Go="88078a5f284b3a24607497c02c73775bb1e8ef41"})(),a})()));